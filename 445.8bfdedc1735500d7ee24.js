(("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect=("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect||[]).push([[445],{80445:(e,t,n)=>{"use strict";n.d(t,{sequence:()=>Bo});var i={};n.r(i),n.d(i,{walletContracts:()=>m});var s={};n.r(s),n.d(s,{API:()=>k,SequenceAPIClient:()=>S,SmartRampOrderStatus:()=>E,SmartRampTxnStatus:()=>C,SortOrder:()=>I,WebRPCSchemaHash:()=>b,WebRPCSchemaVersion:()=>v,WebRPCVersion:()=>y});var r={};n.r(r),n.d(r,{Logger:()=>De,base64Decode:()=>Se,base64DecodeObject:()=>Ne,base64Encode:()=>Te,base64EncodeObject:()=>_e,checkProperties:()=>et,configureLogger:()=>Ge,deepCopy:()=>nt,defineReadOnly:()=>Ze,encodeMessageDigest:()=>Oe,encodeTypedDataDigest:()=>ze,encodeTypedDataHash:()=>Ye,getRandomInt:()=>We,getStatic:()=>Xe,isBigNumberish:()=>st,isBrowser:()=>Ue,isNode:()=>Me,jwtDecodeClaims:()=>Be,logger:()=>qe,packMessageData:()=>xe,promisify:()=>Fe,queryStringFromObject:()=>He,queryStringToObject:()=>Ve,resolveProperties:()=>Qe,sanitizeAlphanumeric:()=>$e,sanitizeHost:()=>Ke,sanitizeNumberString:()=>je,shallowCopy:()=>tt,sleep:()=>Je,subDigestOf:()=>Re,urlClean:()=>it});var a={};n.r(a),n.d(a,{Multicall:()=>Et,providers:()=>kt});var o={};n.r(o),n.d(o,{ConfigFinder:()=>Wt,SequenceUtilsFinder:()=>Vt,SignatureType:()=>zt,WalletContractBytecode:()=>At,addressOf:()=>Bt,buildStubSignature:()=>on,compareAddr:()=>qt,createWalletConfig:()=>Rt,decodeSignature:()=>Zt,editConfig:()=>Gt,encodeSignature:()=>sn,genConfig:()=>Ft,imageHash:()=>Pt,isConfigEqual:()=>Dt,isDecodedAddress:()=>jt,isDecodedEOASigner:()=>Kt,isDecodedEOASplitSigner:()=>Jt,isDecodedFullSigner:()=>Yt,isDecodedSigner:()=>$t,isUsableConfig:()=>Mt,isValidConfigSigners:()=>Ut,joinSignatures:()=>tn,joinTwoSignatures:()=>nn,mutateSignature:()=>an,recoverEOASigner:()=>en,signerOf:()=>rn,sortConfig:()=>Lt,splitDecodedEOASigner:()=>Qt});var c={};n.r(c),n.d(c,{ContractType:()=>un,EventLogDataType:()=>gn,EventLogType:()=>pn,Indexer:()=>vn,SequenceIndexerClient:()=>kn,SequenceIndexerServices:()=>Cn,SortOrder:()=>yn,TransactionStatus:()=>mn,TransactionType:()=>wn,TxnTransferType:()=>fn,WebRPCSchemaHash:()=>dn,WebRPCSchemaVersion:()=>hn,WebRPCVersion:()=>ln});var l={};n.r(l),n.d(l,{ContractType:()=>Nn,Metadata:()=>Mn,PropertyType:()=>On,SequenceMetadataClient:()=>Ln,SortOrder:()=>Rn,SwapType:()=>xn,WebRPCSchemaHash:()=>Sn,WebRPCSchemaVersion:()=>_n,WebRPCVersion:()=>Tn});var h={};n.r(h),n.d(h,{MetaTransactionsType:()=>ci,appendNonce:()=>Ci,computeMetaTxnHash:()=>pi,decodeNonce:()=>Ti,digestOfTransactions:()=>di,digestOfTransactionsNonce:()=>ui,encodeNonce:()=>Ai,flattenAuxTransactions:()=>fi,fromTransactionish:()=>Si,hasSequenceTransactions:()=>vi,isAsyncSendable:()=>wi,isSequenceTransaction:()=>yi,isSignedTransactions:()=>_i,makeAfterNonce:()=>ki,makeExpirable:()=>Ii,packMetaTransactionsData:()=>li,packMetaTransactionsNonceData:()=>hi,readSequenceNonce:()=>bi,sequenceTxAbiEncode:()=>Ei,toSequenceTransaction:()=>mi,toSequenceTransactions:()=>gi});var d={};n.r(d),n.d(d,{Guard:()=>ns,WebRPCSchemaHash:()=>ts,WebRPCSchemaVersion:()=>es,WebRPCVersion:()=>Qi});var u={};n.r(u),n.d(u,{BaseRelayer:()=>cs,BaseRelayerDefaults:()=>os,LocalRelayer:()=>gs,ProviderRelayer:()=>us,ProviderRelayerDefaults:()=>hs,RpcRelayer:()=>_s,RpcRelayerProto:()=>Cs,isBaseRelayerOptions:()=>as,isLocalRelayerOptions:()=>ps,isProviderRelayerOptions:()=>ds,isRelayer:()=>Ns,isRpcRelayerOptions:()=>As,proto:()=>Cs});var p={};n.r(p),n.d(p,{AuthError:()=>Ys,DEFAULT_SESSION_EXPIRATION:()=>Hs,ErrAccountIsRequired:()=>zs,LONG_SESSION_EXPIRATION:()=>Vs,Session:()=>js,ValidateSequenceDeployedWalletProof:()=>Zs,ValidateSequenceUndeployedWalletProof:()=>Xs,signAuthorization:()=>Js});var g={};n.r(g),n.d(g,{AllowProvider:()=>Or,CachedProvider:()=>Rr,ChainId:()=>gr,EagerProvider:()=>Mr,JsonRpcExternalProvider:()=>Nr,JsonRpcProvider:()=>Fr,JsonRpcRouter:()=>Ir,JsonRpcSender:()=>Sr,JsonRpcVersion:()=>Cr,PublicProvider:()=>qr,SigningProvider:()=>Dr,SingleflightMiddleware:()=>Gr,allowProviderMiddleware:()=>xr,checkNetworkConfig:()=>hr,createJsonRpcMiddlewareStack:()=>kr,ensureUniqueNetworks:()=>ar,ensureValidNetworks:()=>rr,exceptionProviderMiddleware:()=>Ur,findNetworkConfig:()=>lr,getAuthNetwork:()=>ir,getChainId:()=>tr,indexerURL:()=>fr,isJsonRpcHandler:()=>Tr,isJsonRpcProvider:()=>Ar,isNetworkConfig:()=>er,isValidNetworkConfig:()=>sr,loggingProviderMiddleware:()=>Br,mainnetNetworks:()=>vr,maybeChainId:()=>nr,networkProviderMiddleware:()=>Pr,networks:()=>yr,networksIndex:()=>dr,nodesURL:()=>wr,relayerURL:()=>mr,sequenceContext:()=>Er,sortNetworks:()=>ur,stringTemplate:()=>pr,testnetNetworks:()=>br,updateNetworkConfig:()=>or,validateAndSortNetworks:()=>cr});var f={};n.r(f),n.d(f,{BaseInjectedTransport:()=>oo,BaseProviderTransport:()=>Ia,BaseWalletTransport:()=>Ya,CHANNEL_ID:()=>so,DefaultProviderConfig:()=>mo,ErrSignedInRequired:()=>va,EventType:()=>fa,ExtensionMessageHandler:()=>ro,ExtensionMessageProvider:()=>ao,InitState:()=>wa,LocalStorage:()=>$a,LocalStore:()=>Ka,LocalWeb3Provider:()=>Sa,MuxMessageProvider:()=>eo,OpenState:()=>ma,PROVIDER_OPEN_TIMEOUT:()=>ba,ProviderError:()=>ya,ProxyMessageChannel:()=>za,ProxyMessageChannelPort:()=>Za,ProxyMessageHandler:()=>Qa,ProxyMessageProvider:()=>Xa,UnrealMessageHandler:()=>po,UnrealMessageProvider:()=>uo,Wallet:()=>fo,WalletRequestHandler:()=>ka,Web3Provider:()=>Ta,Web3Signer:()=>Na,WindowMessageHandler:()=>io,WindowMessageProvider:()=>no,WindowSessionParams:()=>ga,getWallet:()=>bo,initWallet:()=>yo,isBrowserExtension:()=>Ha,isSequenceProvider:()=>_a,isUnityPlugin:()=>Va,isValidMessageSignature:()=>Ga,isValidSignature:()=>qa,isValidTypedDataSignature:()=>Fa,isWalletUpToDate:()=>ja,messageToBytes:()=>La,nextMessageIdx:()=>Ca,prefixEIP191Message:()=>Da,recoverWalletConfig:()=>Wa,unregisterWallet:()=>vo});const m={erc1271:Object.freeze({__proto__:null,abi:[{type:"function",name:"isValidSignature",constant:!0,inputs:[{type:"bytes32"},{type:"bytes"}],outputs:[{type:"bytes4"}],payable:!1,stateMutability:"view"}],returns:{isValidSignatureBytes32:"0x1626ba7e"}}),factory:Object.freeze({__proto__:null,abi:[{type:"function",name:"deploy",constant:!1,inputs:[{type:"address"},{type:"bytes32"}],outputs:[],payable:!0,stateMutability:"payable"}]}),mainModule:Object.freeze({__proto__:null,abi:[{type:"function",name:"nonce",constant:!0,inputs:[],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"readNonce",constant:!0,inputs:[{type:"uint256"}],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"updateImplementation",constant:!1,inputs:[{type:"address"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"selfExecute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"execute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"},{type:"uint256"},{type:"bytes"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"createContract",inputs:[{type:"bytes"}],payable:!0,stateMutability:"payable"}]}),mainModuleUpgradable:Object.freeze({__proto__:null,abi:[{type:"function",name:"updateImageHash",constant:!0,inputs:[{type:"bytes32"}],outputs:[],payable:!1,stateMutability:"view"},{type:"function",name:"imageHash",constant:!0,inputs:[],outputs:[{type:"bytes32"}],payable:!1,stateMutability:"view"}]}),sequenceUtils:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_mainModule",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"bytes32",name:"_imageHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"_threshold",type:"uint256"},{indexed:!1,internalType:"bytes",name:"_signers",type:"bytes"}],name:"RequiredConfig",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"address",name:"_signer",type:"address"}],name:"RequiredSigner",type:"event"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callBalanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_i",type:"uint256"}],name:"callBlockhash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"callChainId",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCode",outputs:[{internalType:"bytes",name:"code",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeHash",outputs:[{internalType:"bytes32",name:"codeHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeSize",outputs:[{internalType:"uint256",name:"size",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callCoinbase",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callDifficulty",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLeft",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLimit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callOrigin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"knownImageHashes",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"lastImageHashUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastSignerUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastWalletUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bool",name:"delegateCall",type:"bool"},{internalType:"bool",name:"revertOnError",type:"bool"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IModuleCalls.Transaction[]",name:"_txs",type:"tuple[]"}],name:"multiCall",outputs:[{internalType:"bool[]",name:"_successes",type:"bool[]"},{internalType:"bytes[]",name:"_results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_threshold",type:"uint256"},{components:[{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"address",name:"signer",type:"address"}],internalType:"struct RequireUtils.Member[]",name:"_members",type:"tuple[]"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishConfig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"uint256",name:"_sizeMembers",type:"uint256"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishInitialSigners",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_nonce",type:"uint256"}],name:"requireMinNonce",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_expiration",type:"uint256"}],name:"requireNonExpired",outputs:[],stateMutability:"view",type:"function"}]}),requireFreshSigner:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"",type:"address"}],name:"requireFreshSigner",outputs:[],stateMutability:"nonpayable",type:"function"}]})};function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},w.apply(this,arguments)}const y="v1",v="v0.4.0",b="e4aaaf3a3c07a1f339226fcac3b8addcb3120c7b";let E,C,I;!function(e){e.UNKNOWN="UNKNOWN",e.RUNNING_CHECKS="RUNNING_CHECKS",e.PROCESSING="PROCESSING",e.FAILED="FAILED",e.COMPLETE="COMPLETE"}(E||(E={})),function(e){e.UNKNOWN="UNKNOWN",e.SUCCESSFUL="SUCCESSFUL",e.FAILED="FAILED"}(C||(C={})),function(e){e.DESC="DESC",e.ASC="ASC"}(I||(I={}));class k{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/API/",this.ping=e=>this.fetch(this.url("Ping"),A({},e)).then((e=>T(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),A({},e)).then((e=>T(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),A({},e)).then((e=>T(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),A({},e)).then((e=>T(e).then((e=>({data:e.data}))))),this.getAuthToken=(e,t)=>this.fetch(this.url("GetAuthToken"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user}))))),this.sendPasswordlessLink=(e,t)=>this.fetch(this.url("SendPasswordlessLink"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.friendList=(e,t)=>this.fetch(this.url("FriendList"),A(e,t)).then((e=>T(e).then((e=>({page:e.page,friends:e.friends}))))),this.getFriendByAddress=(e,t)=>this.fetch(this.url("GetFriendByAddress"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,friend:e.friend}))))),this.searchFriends=(e,t)=>this.fetch(this.url("SearchFriends"),A(e,t)).then((e=>T(e).then((e=>({friends:e.friends}))))),this.addFriend=(e,t)=>this.fetch(this.url("AddFriend"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,friend:e.friend}))))),this.updateFriendNickname=(e,t)=>this.fetch(this.url("UpdateFriendNickname"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,friend:e.friend}))))),this.removeFriend=(e,t)=>this.fetch(this.url("RemoveFriend"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.contractCall=(e,t)=>this.fetch(this.url("ContractCall"),A(e,t)).then((e=>T(e).then((e=>({returns:e.returns}))))),this.decodeContractCall=(e,t)=>this.fetch(this.url("DecodeContractCall"),A(e,t)).then((e=>T(e).then((e=>({call:e.call}))))),this.lookupContractCallSelectors=(e,t)=>this.fetch(this.url("LookupContractCallSelectors"),A(e,t)).then((e=>T(e).then((e=>({signatures:e.signatures}))))),this.userStorageFetch=(e,t)=>this.fetch(this.url("UserStorageFetch"),A(e,t)).then((e=>T(e).then((e=>({object:e.object}))))),this.userStorageSave=(e,t)=>this.fetch(this.url("UserStorageSave"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.userStorageDelete=(e,t)=>this.fetch(this.url("UserStorageDelete"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.userStorageFetchAll=(e,t)=>this.fetch(this.url("UserStorageFetchAll"),A(e,t)).then((e=>T(e).then((e=>({objects:e.objects}))))),this.getMoonpayLink=(e,t)=>this.fetch(this.url("GetMoonpayLink"),A(e,t)).then((e=>T(e).then((e=>({signedUrl:e.signedUrl}))))),this.getSardineClientToken=e=>this.fetch(this.url("GetSardineClientToken"),A({},e)).then((e=>T(e).then((e=>({token:e.token}))))),this.isUsingGoogleMail=(e,t)=>this.fetch(this.url("IsUsingGoogleMail"),A(e,t)).then((e=>T(e).then((e=>({yes:e.yes}))))),this.resolveENSAddress=(e,t)=>this.fetch(this.url("ResolveENSAddress"),A(e,t)).then((e=>T(e).then((e=>({address:e.address,ok:e.ok}))))),this.isValidSignature=(e,t)=>this.fetch(this.url("IsValidSignature"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.isValidMessageSignature=(e,t)=>this.fetch(this.url("IsValidMessageSignature"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.isValidTypedDataSignature=(e,t)=>this.fetch(this.url("IsValidTypedDataSignature"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.isValidETHAuthProof=(e,t)=>this.fetch(this.url("IsValidETHAuthProof"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.getCoinPrices=(e,t)=>this.fetch(this.url("GetCoinPrices"),A(e,t)).then((e=>T(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getCollectiblePrices=(e,t)=>this.fetch(this.url("GetCollectiblePrices"),A(e,t)).then((e=>T(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getExchangeRate=(e,t)=>this.fetch(this.url("GetExchangeRate"),A(e,t)).then((e=>T(e).then((e=>({exchangeRate:e.exchangeRate}))))),this.memoryStore=(e,t)=>this.fetch(this.url("MemoryStore"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.memoryLoad=(e,t)=>this.fetch(this.url("MemoryLoad"),A(e,t)).then((e=>T(e).then((e=>({value:e.value}))))),this.listPayCardsOnFile=e=>this.fetch(this.url("ListPayCardsOnFile"),A({},e)).then((e=>T(e).then((e=>({payCards:e.payCards}))))),this.savePayCard=(e,t)=>this.fetch(this.url("SavePayCard"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok,payCard:e.payCard}))))),this.updatePayCardCVC=(e,t)=>this.fetch(this.url("UpdatePayCardCVC"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.deletePayCard=(e,t)=>this.fetch(this.url("DeletePayCard"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.smartRampQuote=(e,t)=>this.fetch(this.url("SmartRampQuote"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,quoteDetails:e.quoteDetails}))))),this.smartRampPurchase=(e,t)=>this.fetch(this.url("SmartRampPurchase"),A(e,t)).then((e=>T(e).then((e=>({processing:e.processing,receipt:e.receipt}))))),this.smartRampWaitOrderConfirmation=(e,t)=>this.fetch(this.url("SmartRampWaitOrderConfirmation"),A(e,t)).then((e=>T(e).then((e=>({done:e.done,receipt:e.receipt}))))),this.smartRampGetOrder=(e,t)=>this.fetch(this.url("SmartRampGetOrder"),A(e,t)).then((e=>T(e).then((e=>({order:e.order}))))),this.smartRampCheckCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampCheckCardAuthorization"),A(e,t)).then((e=>T(e).then((e=>({cardAuth:e.cardAuth}))))),this.smartRampOrdersList=(e,t)=>this.fetch(this.url("SmartRampOrdersList"),A(e,t)).then((e=>T(e).then((e=>({page:e.page,orders:e.orders}))))),this.smartRampGetOrderTxnHash=(e,t)=>this.fetch(this.url("SmartRampGetOrderTxnHash"),A(e,t)).then((e=>T(e).then((e=>({txnHash:e.txnHash,txnSuccessful:e.txnSuccessful}))))),this.smartRampSubmitCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampSubmitCardAuthorization"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.adminSmartRampGetOrder=(e,t)=>this.fetch(this.url("AdminSmartRampGetOrder"),A(e,t)).then((e=>T(e).then((e=>({order:e.order}))))),this.adminSmartRampListCompletedOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListCompletedOrders"),A(e,t)).then((e=>T(e).then((e=>({orders:e.orders}))))),this.adminSmartRampListPendingOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListPendingOrders"),A(e,t)).then((e=>T(e).then((e=>({pendingOrders:e.pendingOrders}))))),this.getInviteInfo=e=>this.fetch(this.url("GetInviteInfo"),A({},e)).then((e=>T(e).then((e=>({inviteInfo:e.inviteInfo}))))),this.isValidAccessCode=(e,t)=>this.fetch(this.url("IsValidAccessCode"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.internalClaimAccessCode=(e,t)=>this.fetch(this.url("InternalClaimAccessCode"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.walletRecover=(e,t)=>this.fetch(this.url("WalletRecover"),A(e,t)).then((e=>T(e).then((e=>({encryptedWallet:e.encryptedWallet}))))),this.blockNumberAtTime=(e,t)=>this.fetch(this.url("BlockNumberAtTime"),A(e,t)).then((e=>T(e).then((e=>({blocks:e.blocks}))))),this.paperSessionSecret=(e,t)=>this.fetch(this.url("PaperSessionSecret"),A(e,t)).then((e=>T(e).then((e=>({secret:e.secret}))))),this.paperSessionSecret2=(e,t)=>this.fetch(this.url("PaperSessionSecret2"),A(e,t)).then((e=>T(e).then((e=>({secret:e.secret}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const A=(e={},t={})=>({method:"POST",headers:w({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),T=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n})),_="object"==typeof n.g?n.g.fetch:window.fetch;class S extends k{constructor(e,t){super(e.endsWith("/")?e.slice(0,-1):e,_),this.jwtAuth=t,this._fetch=(e,t)=>{const n={};return this.jwtAuth&&this.jwtAuth.length>0&&(n.Authorization=`BEARER ${this.jwtAuth}`),t.headers=w({},t.headers,n),_(e,t)},this.fetch=this._fetch}}var N=n(71277),O=n(8047),x=n(5372),R=n(89729),M=n(37273),U=n(53117),B=n(14986),P=n(1048).Buffer;const L="function"==typeof P,D="function"==typeof TextDecoder?new TextDecoder:void 0,q="function"==typeof TextEncoder?new TextEncoder:void 0,G=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),F=(e=>{let t={};return e.forEach(((e,n)=>t[e]=n)),t})(G),W=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,H=String.fromCharCode.bind(String),V="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),j=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),$="function"==typeof btoa?e=>btoa(e):L?e=>P.from(e,"binary").toString("base64"):e=>{let t,n,i,s,r="";const a=e.length%3;for(let a=0;a<e.length;){if((n=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255||(s=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=n<<16|i<<8|s,r+=G[t>>18&63]+G[t>>12&63]+G[t>>6&63]+G[63&t]}return a?r.slice(0,a-3)+"===".substring(a):r},K=L?e=>P.from(e).toString("base64"):e=>{let t=[];for(let n=0,i=e.length;n<i;n+=4096)t.push(H.apply(null,e.subarray(n,n+4096)));return $(t.join(""))},J=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?H(192|t>>>6)+H(128|63&t):H(224|t>>>12&15)+H(128|t>>>6&63)+H(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return H(240|t>>>18&7)+H(128|t>>>12&63)+H(128|t>>>6&63)+H(128|63&t)},Y=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,z=L?e=>P.from(e,"utf8").toString("base64"):q?e=>K(q.encode(e)):e=>$(e.replace(Y,J)),Z=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,X=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return H(55296+(t>>>10))+H(56320+(1023&t));case 3:return H((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return H((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Q="function"==typeof atob?e=>atob(j(e)):L?e=>P.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!W.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,n,i,s="";for(let r=0;r<e.length;)t=F[e.charAt(r++)]<<18|F[e.charAt(r++)]<<12|(n=F[e.charAt(r++)])<<6|(i=F[e.charAt(r++)]),s+=64===n?H(t>>16&255):64===i?H(t>>16&255,t>>8&255):H(t>>16&255,t>>8&255,255&t);return s},ee=L?e=>V(P.from(e,"base64")):e=>V(Q(e).split("").map((e=>e.charCodeAt(0)))),te=L?e=>P.from(e,"base64").toString("utf8"):D?e=>D.decode(ee(e)):e=>Q(e).replace(Z,X),ne=(e,t=!1)=>t?(e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")))(z(e)):z(e),ie=e=>te(j(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))));var se=function(){return se=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},se.apply(this,arguments)};function re(e,t,n,i){return new(n||(n=Promise))((function(s,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function o(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))}function ae(e,t){var n,i,s,r,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,o[0]&&(a=0)),a;)try{if(n=1,i&&(s=2&o[0]?i.return:o[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,o[1])).done)return s;switch(i=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var oe=function(){function e(e){this.prefix=pe,this.address=(null==e?void 0:e.address)?e.address.toLowerCase():"",this.claims=(null==e?void 0:e.claims)?e.claims:{app:"",iat:0,exp:0,v:ue},this.signature=(null==e?void 0:e.signature)?e.signature:"",this.extra=(null==e?void 0:e.extra)?e.extra:""}return e.prototype.setIssuedAtNow=function(){this.claims.iat=Math.round((new Date).getTime()/1e3)},e.prototype.setExpiryIn=function(e){this.claims.exp=Math.round((new Date).getTime()/1e3)+e},e.prototype.validateClaims=function(){return ce(this.claims)},e.prototype.messageDigest=function(){var e,t=this.validateClaims();if(t.err)throw t.err;return x.arrayify((e=this.messageTypedData(),M.z.hash(e.domain,e.types,e.message)))},e.prototype.messageTypedData=function(){var e={domain:se({},ge),types:{Claims:[]},message:{}};return this.claims.app&&this.claims.app.length>0&&(e.types.Claims.push({name:"app",type:"string"}),e.message.app=this.claims.app),this.claims.iat&&this.claims.iat>0&&(e.types.Claims.push({name:"iat",type:"int64"}),e.message.iat=this.claims.iat),this.claims.exp&&this.claims.exp>0&&(e.types.Claims.push({name:"exp",type:"int64"}),e.message.exp=this.claims.exp),this.claims.n&&this.claims.n>0&&(e.types.Claims.push({name:"n",type:"uint64"}),e.message.n=this.claims.n),this.claims.typ&&this.claims.typ.length>0&&(e.types.Claims.push({name:"typ",type:"string"}),e.message.typ=this.claims.typ),this.claims.ogn&&this.claims.ogn.length>0&&(e.types.Claims.push({name:"ogn",type:"string"}),e.message.ogn=this.claims.ogn),this.claims.v&&this.claims.v.length>0&&(e.types.Claims.push({name:"v",type:"string"}),e.message.v=this.claims.v),e},e}(),ce=function(e){if(""===e.app)return{ok:!1,err:new Error("claims: app is empty")};var t=Math.round((new Date).getTime()/1e3),n=31536300;return""===e.v?{ok:!1,err:new Error("claims: ethauth version is empty")}:e.iat&&0!==e.iat&&(e.iat>t+300||e.iat<t-n)?{ok:!1,err:new Error("claims: iat is invalid")}:e.exp<t-300||e.exp>t+n?{ok:!1,err:new Error("claims: token has expired")}:{ok:!0}},le=function(e,t,n){return re(void 0,void 0,void 0,(function(){var e,t;return ae(this,(function(i){return e=n.messageDigest(),"0x"===(t=U.verifyMessage(e,n.signature)).slice(0,2)&&42===t.length&&t.toLowerCase()===n.address.toLowerCase()?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}))}))},he=function(e,t,n){return re(void 0,void 0,void 0,(function(){var t,i,s;return ae(this,(function(r){switch(r.label){case 0:return e&&void 0!==e?(t=n.messageDigest(),[4,e.getCode(n.address)]):[2,{isValid:!1}];case 1:if("0x"===(i=r.sent())||i.length<=2)throw new Error("ValidateContractAccountProof failed. unable to fetch wallet contract code");return s=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],[4,new O.NZ(n.address,s,e).isValidSignature(t,x.arrayify(n.signature))];case 2:return r.sent()===de?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}}))}))},de="0x1626ba7e",ue="1",pe="eth",ge={name:"ETHAuth",version:ue},fe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;this.configJsonRpcProvider=function(e){return re(n,void 0,void 0,(function(){var t;return ae(this,(function(n){switch(n.label){case 0:return this.provider=new B.F(e),[4,this.provider.send("net_version",[])];case 1:if(t=n.sent(),this.chainId=parseInt(t),!this.chainId||0===this.chainId||NaN===this.chainId)throw new Error("ethauth: unable to get chainId");return this.ethereumJsonRpcURL=e,[2]}}))}))},this.configValidators=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0==e.length)throw new Error("validators list is empty");n.validators=e},this.encodeProof=function(e,t){return void 0===t&&(t=!1),re(n,void 0,void 0,(function(){var n,i;return ae(this,(function(s){switch(s.label){case 0:if(42!==e.address.length||"0x"!==e.address.slice(0,2))throw new Error("ethauth: invalid address");if(""===e.signature||"0x"!==e.signature.slice(0,2))throw new Error("ethauth: invalid signature");if(e.extra&&"0x"!==e.extra.slice(0,2))throw new Error("ethauth: invalid extra encoding, expecting hex data");return[4,this.validateProof(e,t)];case 1:if(!s.sent())throw new Error("ethauth: proof is invalid");return n=JSON.stringify(e.claims),i=pe+"."+e.address.toLowerCase()+"."+ne(n,!0)+"."+e.signature,e.extra&&e.extra.length>0&&(i+="."+e.extra),[2,i]}}))}))},this.decodeProof=function(e,t){return void 0===t&&(t=!1),re(n,void 0,void 0,(function(){var n,i,s,r,a,o,c,l,h;return ae(this,(function(d){switch(d.label){case 0:if((n=e.split(".")).length<4||n.length>5)throw new Error("ethauth: invalid proof string");if(i=n[0],s=n[1],r=n[2],a=n[3],o=n[4],i!==pe)throw new Error("ethauth: not an ethauth proof");return c=ie(r),l=JSON.parse(c),h=new oe({address:s,claims:l,signature:a,extra:o}),[4,this.validateProof(h,t)];case 1:if(!d.sent())throw new Error("ethauth: proof is invalid");return[2,h]}}))}))},this.validateProof=function(e,t){return void 0===t&&(t=!1),re(n,void 0,void 0,(function(){var n;return ae(this,(function(i){switch(i.label){case 0:if((n=this.validateProofClaims(e)).err)throw new Error("ethauth: proof claims are invalid ".concat(n.err));return!0===t?[3,2]:[4,this.validateProofSignature(e)];case 1:if(!0!==i.sent())throw new Error("ethauth: proof signature is invalid");i.label=2;case 2:return[2,!0]}}))}))},this.validateProofSignature=function(e){return re(n,void 0,void 0,(function(){var t,n,i;return ae(this,(function(s){switch(s.label){case 0:t=[],i=0,s.label=1;case 1:if(!(i<this.validators.length))return[3,6];s.label=2;case 2:return s.trys.push([2,4,,5]),[4,(0,this.validators[i])(this.provider,this.chainId,e)];case 3:return!0===(n=s.sent().isValid)?[2,!0]:(t.push(n),[3,5]);case 4:return s.sent(),t.push(!1),[3,5];case 5:return i++,[3,1];case 6:for(i=0;i<t.length;i++)if(t[i])return[2,!0];return[2,!1]}}))}))},this.validateProofClaims=function(e){return e.validateClaims()},0==e.length?this.validators=[le,he]:this.validators=e},me=n(53844),we=n(39674),ye=n(32899),ve=n(58981),be=n(26596),Ee=n(84087),Ce=n(57808),Ie=n(97867),ke=n(80639),Ae=n(39907);const Te=e=>ne(e,!0),_e=e=>ne(JSON.stringify(e),!0),Se=e=>{if(null!=e)return ie(e)},Ne=e=>{if(null!=e)return JSON.parse(ie(e))},Oe=e=>"string"==typeof e?x.arrayify(R.keccak256(Ie.YW(e))):x.arrayify(R.keccak256(e)),xe=(e,t,n)=>ve.pack(["string","uint256","address","bytes32"],["",t,e,n]),Re=(e,t,n)=>R.keccak256(xe(e,t,n)),Me=()=>"undefined"==typeof window&&"object"==typeof Ae,Ue=()=>!Me(),Be=e=>{const t=e.split(".");if(3!==t.length)throw new Error("invalid jwt");return JSON.parse(ie(t[1]))};function Pe(){return Pe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Pe.apply(this,arguments)}var Le;!function(e){e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DISABLED=5]="DISABLED"}(Le||(Le={}));class De{constructor(e){this.config=e,this.logLevel=void 0,this.configure(e)}configure(e){switch(this.config=Pe({},this.config,e),this.config.logLevel){case"DEBUG":this.logLevel=Le.DEBUG;break;case"INFO":default:this.logLevel=Le.INFO;break;case"WARN":this.logLevel=Le.WARN;break;case"ERROR":this.logLevel=Le.ERROR;break;case"DISABLED":this.logLevel=Le.DISABLED}void 0===this.config.silence&&(this.config.silence=!1)}debug(e,...t){!0!==this.config.silence&&this.logLevel===Le.DEBUG&&console.log(e,...t)}info(e,...t){!0!==this.config.silence&&this.logLevel<=Le.INFO&&console.log(e,...t)}warn(e,...t){!0!==this.config.silence&&this.logLevel<=Le.WARN&&(console.warn(e,...t),this.config.onwarn&&this.config.onwarn(e,t))}error(e,...t){!0!==this.config.silence&&this.logLevel<=Le.ERROR&&(console.error(e,...t),this.config.onerror&&this.config.onerror(e,t))}}const qe=new De({logLevel:"INFO",silence:!0}),Ge=e=>qe.configure(e);function Fe(e,t){return function(...n){const i=Array.prototype.slice.call(n);return new Promise((async(n,s)=>{try{i.push(((e,t)=>e?s(e):n(t))),await e.apply(t,i)}catch(e){s(e)}}))}}const We=(e=0,t=Number.MAX_SAFE_INTEGER)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e);function He(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(JSON.stringify(t))}`}function Ve(e){const t=e.split("&"),n={};for(const e of t){const t=e.split("=");n[decodeURIComponent(t[0])]=JSON.parse(decodeURIComponent(t[1]))}return n}const je=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\d.]+/);return t&&t.length>0?t[0].trim():""},$e=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\s\d]+/);return t&&t.length>0?t[0].trim():""},Ke=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\d.\-:\/]+/);return t&&t.length>0?t[0].trim():""},Je=e=>new Promise((t=>{const n=setTimeout((()=>{clearTimeout(n),t()}),e)})),Ye=e=>{const t=Pe({},e.types);return delete t.EIP712Domain,M.z.hash(e.domain,t,e.message)},ze=e=>x.arrayify(Ye(e)),{defineReadOnly:Ze,getStatic:Xe,resolveProperties:Qe,checkProperties:et,shallowCopy:tt,deepCopy:nt}=ke,it=e=>e.replace(/([^:]\/)\/+/g,"$1");function st(e){return null!=e&&(we.gH.isBigNumber(e)||"number"==typeof e&&e%1==0||"string"==typeof e&&!!e.match(/^-?[0-9]+$/)||x.isHexString(e)||"bigint"==typeof e||x.isBytes(e))}var rt=n(87699),at=n(9929),ot=n(83546);function ct(){return ct=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ct.apply(this,arguments)}const lt=e=>((e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const a=i.map((e=>e.name)).sort(),o=a.filter(((e,t)=>a.indexOf(e)!==t));if(o.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${o}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l&&t)throw new Error("invalid network config: AuthChain must be set")})(e,!0,t),e))(ht(e)),ht=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},dt=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let ut;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(ut||(ut={}));const pt=e=>dt("https://${network}-indexer.sequence.app",{network:e}),gt=e=>dt("https://${network}-relayer.sequence.app",{network:e}),ft=e=>dt("https://nodes.sequence.app/${network}",{network:e}),mt={[ut.MAINNET]:{chainId:ut.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[ut.ROPSTEN]:{chainId:ut.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[ut.RINKEBY]:{chainId:ut.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[ut.GOERLI]:{chainId:ut.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[ut.KOVAN]:{chainId:ut.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[ut.POLYGON]:{chainId:ut.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[ut.POLYGON_MUMBAI]:{chainId:ut.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[ut.POLYGON_ZKEVM]:{chainId:ut.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[ut.BSC]:{chainId:ut.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[ut.BSC_TESTNET]:{chainId:ut.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[ut.OPTIMISM]:{chainId:ut.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[ut.OPTIMISM_TESTNET]:{chainId:ut.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[ut.ARBITRUM]:{chainId:ut.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[ut.ARBITRUM_GOERLI]:{chainId:ut.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[ut.ARBITRUM_NOVA]:{chainId:ut.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[ut.AVALANCHE]:{chainId:ut.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[ut.AVALANCHE_TESTNET]:{chainId:ut.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[ut.FANTOM]:{chainId:ut.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[ut.FANTOM_TESTNET]:{chainId:ut.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[ut.GNOSIS]:{chainId:ut.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[ut.AURORA]:{chainId:ut.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[ut.AURORA_TESTNET]:{chainId:ut.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[ut.BASE_GOERLI]:{chainId:ut.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},wt=(lt([ct({},mt[ut.MAINNET],{rpcUrl:ft("mainnet"),relayer:{url:gt("mainnet")},indexerUrl:pt("mainnet")}),ct({},mt[ut.POLYGON],{rpcUrl:ft("polygon"),relayer:{url:gt("polygon")},indexerUrl:pt("polygon"),isDefaultChain:!0,isAuthChain:!0}),ct({},mt[ut.BSC],{rpcUrl:ft("bsc"),indexerUrl:pt("bsc"),relayer:{url:gt("bsc")}}),ct({},mt[ut.AVALANCHE],{rpcUrl:ft("avalanche"),indexerUrl:pt("avalanche"),relayer:{url:gt("avalanche")}}),ct({},mt[ut.ARBITRUM],{rpcUrl:ft("arbitrum"),indexerUrl:pt("arbitrum"),relayer:{url:gt("arbitrum")}}),ct({},mt[ut.ARBITRUM_NOVA],{rpcUrl:ft("arbitrum-nova"),indexerUrl:pt("arbitrum-nova"),relayer:{url:gt("arbitrum-nova")}}),ct({},mt[ut.OPTIMISM],{rpcUrl:ft("optimism"),indexerUrl:pt("optimism"),relayer:{url:gt("optimism")}}),ct({},mt[ut.POLYGON_ZKEVM],{rpcUrl:ft("polygon-zkevm"),indexerUrl:pt("polygon-zkevm"),relayer:{url:gt("polygon-zkevm")}}),ct({},mt[ut.GNOSIS],{rpcUrl:ft("gnosis"),indexerUrl:pt("gnosis"),relayer:{url:gt("gnosis")}})]),lt([ct({},mt[ut.RINKEBY],{rpcUrl:ft("rinkeby"),relayer:{url:gt("rinkeby")},indexerUrl:pt("rinkeby")}),ct({},mt[ut.GOERLI],{rpcUrl:ft("goerli"),relayer:{url:gt("goerli")},indexerUrl:pt("goerli")}),ct({},mt[ut.POLYGON_MUMBAI],{rpcUrl:ft("mumbai"),relayer:{url:gt("mumbai")},indexerUrl:pt("mumbai"),isDefaultChain:!0,isAuthChain:!0}),ct({},mt[ut.BSC_TESTNET],{rpcUrl:ft("bsc-testnet"),relayer:{url:gt("bsc-testnet")},indexerUrl:pt("bsc-testnet")}),ct({},mt[ut.ARBITRUM_GOERLI],{rpcUrl:ft("arbitrum-goerli"),relayer:{url:gt("arbitrum-goerli")},indexerUrl:pt("arbitrum-goerli")}),ct({},mt[ut.BASE_GOERLI],{rpcUrl:ft("base-goerli"),relayer:{url:gt("base-goerli")},indexerUrl:pt("base-goerli")})]),"2.0");function yt(){return yt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},yt.apply(this,arguments)}let vt;function bt(e,t){return e.reduce((function(e,n,i){return t(n,i)?e[0].push(n):e[1].push(n),e}),[[],[]])}B.F,function(e){e.ethCall="eth_call",e.ethGetBalance="eth_getBalance",e.ethGetCode="eth_getCode"}(vt||(vt={}));class Et{constructor(e){var t=this;if(this.batchableJsonRpcMethods=[vt.ethCall,vt.ethGetCode,vt.ethGetBalance],this.multicallInterface=new rt.KA(m.sequenceUtils.abi),this.options=void 0,this.timeout=void 0,this.queue=[],this.scheduleExecution=()=>{this.queue.length>0&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.run,this.options.timeWindow))},this.handle=(e,t,n)=>this.batchableJsonRpcMethods.find((e=>e===t.method))?(this.queue.push({request:t,callback:n,next:e}),this.options.verbose&&console.log("Scheduling call",t.method),void this.scheduleExecution()):(this.options.verbose&&console.log("Forwarded call",t.method),e(t,n)),this.run=async function(){t.options.verbose&&console.log("Processing multicall");const e=Math.min(t.options.batchSize,t.queue.length);if(0===e)return;if(1===e)return t.forward(t.queue[0]),t.queue=[],void(t.options.verbose&&console.log("Skip multicall, single item"));t.options.verbose&&console.log("Resolving",e);var n=t.queue.slice(0,e);t.queue=e===t.queue.length?[]:t.queue.slice(e),t.options.verbose&&console.log("Updated queue",t.queue.length),0!==t.queue.length&&t.scheduleExecution();const i=n[0].next;let s;var[n,r]=bt(n,(e=>{try{if(e.next!==i)return!1;switch(e.request.method){case vt.ethCall:if(e.request.params[0].from||e.request.params[0].gasPrice||e.request.params[0].value)return!1;case vt.ethGetBalance:case vt.ethGetCode:const i=function(e){if(void 0===e)return"latest";switch(e){case"earliest":case"latest":case"pending":return e}return we.gH.from(e)}(e.request.params[1]);if(void 0===s&&(s=i),(t=i)!==(n=s)&&!(we.gH.isBigNumber(t)?we.gH.isBigNumber(n)&&t.eq(n):!we.gH.isBigNumber(n)&&t===n))return!1}return!0}catch(e){return!1}var t,n}));if(0!==r.length&&(t.options.verbose&&console.log("Forwarding incompatible calls",r.length),t.forward(r),0===n.length))return;let a=n.map((e=>{try{switch(e.request.method){case vt.ethCall:return{delegateCall:!1,revertOnError:!1,target:e.request.params[0].to,data:e.request.params[0].data,gasLimit:e.request.params[0].gas?e.request.params[0].gas:0,value:0};case vt.ethGetCode:return{delegateCall:!1,revertOnError:!1,target:t.options.contract,gasLimit:0,value:0,data:t.multicallInterface.encodeFunctionData(t.multicallInterface.getFunction("callCode"),[e.request.params[0]])};case vt.ethGetBalance:return{delegateCall:!1,revertOnError:!1,target:t.options.contract,gasLimit:0,value:0,data:t.multicallInterface.encodeFunctionData(t.multicallInterface.getFunction("callBalanceOf"),[e.request.params[0]])};default:return null}}catch(e){return null}}));var[n,r]=bt(n,((e,t)=>void 0!==a[t]));if(a=a.filter((e=>e)),0!==r.length&&(t.options.verbose&&console.log("Forwarding calls on error",r.length),t.forward(r),0===n.length))return;let o;try{o=t.multicallInterface.encodeFunctionData(t.multicallInterface.getFunction("multiCall"),[a])}catch(e){return void t.forward(n)}const c=We(),l=await async function(e,t){try{return await e}catch(e){return t instanceof Function?t(e):t}}(Fe(i)({id:c,jsonrpc:wt,method:vt.ethCall,params:[{to:t.options.contract,value:0,data:o},we.gH.isBigNumber(s)?s.toNumber():s]}),(e=>({jsonrpc:wt,id:c,result:void 0,error:e})));if(l.error)return t.forward(n);let h;try{h=t.multicallInterface.decodeFunctionResult(t.multicallInterface.getFunction("multiCall"),l.result)}catch(e){return void t.forward(n)}t.options.verbose&&console.log("Got response for",n.length),n.forEach(((e,n)=>{if(h[0][n])switch(e.request.method){case vt.ethCall:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:h[1][n]});break;case vt.ethGetCode:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:be.D.decode(["bytes"],h[1][n])[0]});break;case vt.ethGetBalance:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:be.D.decode(["uint256"],h[1][n])[0]})}else t.forward(e)}))},this.options=e?yt({},Et.DefaultOptions,e):Et.DefaultOptions,this.options.batchSize<=0)throw new Error(`Invalid batch size of ${this.options.batchSize}`)}forward(e){Array.isArray(e)?e.forEach((e=>e.next(e.request,e.callback))):e.next(e.request,e.callback)}static isMulticall(e){return e&&void 0!==e.handle&&void 0!==e.conf&&Et.isMulticallOptions(e.options)}static isMulticallOptions(e){return void 0!==e&&void 0!==e.batchSize&&void 0!==e.timeWindow&&void 0!==e.contract}}Et.DefaultOptions=yt({},{batchSize:50,timeWindow:50,contract:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",verbose:!1});const Ct=["getNetwork","getBlockNumber","getGasPrice","getTransactionCount","getStorageAt","sendTransaction","estimateGas","getBlock","getTransaction","getTransactionReceipt","getLogs","emit","litenerCount","addListener","removeListener","waitForTransaction","detectNetwork","getBlockWithTransactions"];class It extends at.DJ{constructor(e,t){var n;super(e.getNetwork()),n=this,this.provider=e,this.multicall=void 0,this.listenerCount=this.provider.listenerCount,this.getResolver=async function(e){const t=n.provider;if(t.getResolver){const i=await t.getResolver(await e);return i?new at.xR(n,i.address,i.name):null}return t.getResolver(await e)},this.next=async function(e,t){try{switch(e.method){case vt.ethCall:n.callback(e,t,await n.provider.call(e.params[0],e.params[1]));break;case vt.ethGetCode:n.callback(e,t,await n.provider.getCode(e.params[0],e.params[1]));break;case vt.ethGetBalance:n.callback(e,t,await n.provider.getBalance(e.params[0],e.params[1]))}}catch(i){n.callback(e,t,void 0,i)}},this.multicall=Et.isMulticall(t)?t:new Et(t),Ct.forEach((t=>{void 0!==e[t]&&(this[t]=(...n)=>e[t](...n))}))}callback(e,t,n,i){t(i,{jsonrpc:wt,id:e.id,result:n,error:i})}async call(e,t){return this.rpcCall(vt.ethCall,e,t)}async getCode(e,t){return this.rpcCall(vt.ethGetCode,e,t)}async getBalance(e,t){return this.rpcCall(vt.ethGetBalance,e,t)}async rpcCall(e,...t){const n=We();return(await Fe(this.multicall.handle)(this.next,{jsonrpc:wt,id:n,method:e,params:t})).result}}var kt=Object.freeze({__proto__:null,ProxyMethods:Ct,MulticallProvider:It,MulticallExternalProvider:class{constructor(e,t){if(this.provider=e,this.multicall=void 0,this.multicall=Et.isMulticall(t)?t:new Et(t),e.send){const t=async function(t,n){e.send(t,n)};this.send=(e,n)=>{this.multicall.handle(t,e,n)}}if(e.sendAsync){const t=async function(t,n){e.sendAsync(t,n)};this.sendAsync=(e,n)=>{this.multicall.handle(t,e,n)}}}get isMetaMask(){return this.provider.isMetaMask}get isStatus(){return this.provider.isStatus}},multicallMiddleware:e=>t=>{const n=Et.isMulticall(e)?e:new Et(e);return(e,i)=>n.handle(t,e,i)}});const At="0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3",Tt=10,_t="@sequence.config.imageHashes",St=e=>`@sequence.config.${e}`;let Nt;try{Nt=localStorage}catch(e){const t=new Map;Nt={getItem:e=>{var n;return null!=(n=t.get(e))?n:null},setItem:(e,n)=>t.set(e,n),removeItem:e=>t.delete(e)}}function Ot(e){var t;const n=JSON.parse(null!=(t=Nt.getItem(St(e)))?t:"null");return n?(xt(e),n):void 0}function xt(e){var t;let n=JSON.parse(null!=(t=Nt.getItem(_t))?t:"[]");for(n=n.filter((t=>t!==e)),n.push(e);n.length>Tt;)Nt.removeItem(St(n.shift()));Nt.setItem(_t,JSON.stringify(n))}const Rt=async(e,t)=>{const n={threshold:e,signers:[]};if(t.forEach((async e=>{n.signers.push({weight:e.weight,address:me.l.isSigner(e.signer)?await e.signer.getAddress():e.signer})})),!Mt(n))throw new Error("wallet config is not usable");return n},Mt=e=>e.signers.reduce(((e,t)=>we.gH.from(t.weight).add(e)),ye.XK).gte(we.gH.from(e.threshold)),Ut=(e,t)=>{if(0===t.length)return!0;const n=e.signers.map((e=>N.getAddress(e.address))),i=t.map((e=>N.getAddress(e)));let s=!0;return i.forEach((e=>{n.includes(e)||(s=!1)})),s},Bt=(e,t,n=!1)=>{if("string"==typeof e){const n=R.keccak256(ve.pack(["bytes","bytes32"],[At,x.hexZeroPad(t.mainModule,32)])),i=R.keccak256(ve.pack(["bytes1","address","bytes32","bytes32"],["0xff",t.factory,e,n]));return N.getAddress(x.hexDataSlice(i,12))}return e.address&&!n?e.address:Bt(Pt(e),t)},Pt=e=>{const t=(e=Lt(e)).signers.reduce(((e,t)=>R.keccak256(be.D.encode(["bytes32","uint8","address"],[e,t.weight,t.address]))),ve.pack(["uint256"],[e.threshold]));return function(e,t){Nt.setItem(St(e),JSON.stringify(t)),xt(e)}(t,e),t},Lt=e=>{e.signers.sort(((e,t)=>qt(e.address,t.address))),e.signers.forEach((e=>e.address=N.getAddress(e.address))),e.address&&(e.address=N.getAddress(e.address));const t=e.signers.map((e=>e.address));if(t.filter(((e,n)=>t.indexOf(e)!==n)).length>0)throw new Error("invalid wallet config: duplicate signer addresses detected in the config, ${signerDupes}");return e},Dt=(e,t)=>Pt(e)===Pt(t),qt=(e,t)=>{const n=we.gH.from(e),i=we.gH.from(t);return n.lt(i)?-1:n.eq(i)?0:1};function Gt(e,t){const n=e=>({weight:we.gH.from(e.weight).toNumber(),address:N.getAddress(e.address)}),i=e.signers.map(n),s=t.set?t.set.map(n):[],r=t.del?t.del.map((e=>N.getAddress(e.address))):[],a=s.map((e=>e.address)),o=i.filter((e=>-1===r.indexOf(e.address)&&-1===a.indexOf(e.address))).concat(...s);return Lt({address:e.address,threshold:t.threshold?we.gH.from(t.threshold).toNumber():e.threshold,signers:o})}function Ft(e,t){return Lt({threshold:we.gH.from(e).toNumber(),signers:t.map((e=>({weight:we.gH.from(e.weight).toNumber(),address:N.getAddress(e.address)})))})}class Wt{constructor(){this.findCurrentConfig=void 0,this.findLastWalletOfInitialSigner=void 0}}function Ht(){return Ht=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ht.apply(this,arguments)}class Vt{constructor(e){var t=this;this.authProvider=e,this.findCurrentConfig=async function(e){const{provider:n,context:i,ignoreIndex:s,requireIndex:r,skipCache:a}=e,o=N.getAddress(e.address);if(qe.info(`[findCurrentConfig] address:${o}, ignoreIndex:${s}, requireIndex:${r}`),r&&s)throw Error("findCurrentConfig: can't ignore index and require index");const c=n.getNetwork(),l=e.knownConfigs?e.knownConfigs:[],{imageHash:h,config:d}=await t.findCurrentImageHash(i,n,o,l,a);if(void 0===h)return{config:void 0};const u=await t.findConfigForImageHash(i,h,d?[d,...l]:l,a),p=(await c).chainId;return{config:u?Ht({},u,{chainId:p,address:o}):void 0}},this.findLastWalletOfInitialSigner=async function(e){const{signer:n,context:i,ignoreIndex:s,requireIndex:r}=e;if(qe.info(`[findLastWalletOfInitialSigner] signer:${n}`),r&&s)throw Error("findCurrentConfig: can't ignore index and require index");const a=new O.NZ(i.sequenceUtils,m.sequenceUtils.abi,t.authProvider),o=s?0:(await a.lastSignerUpdate(n)).toNumber();if(r&&0===o)return{wallet:void 0};const c=a.filters.RequiredSigner(null,n),l=await t.findLatestLog(t.authProvider,Ht({},c,{fromBlock:o,toBlock:0!==o?o:"latest"}));return void 0===l?(qe.warn("publishConfig: wallet config last log not found"),{wallet:void 0}):{wallet:a.interface.decodeEventLog("RequiredSigner",l.data,l.topics)._wallet}},this.findConfigForImageHash=async function(e,n,i=[],s=!1){const r=i.find((e=>Pt(e)===n));if(r)return r;if(!s){const e=Ot(n);if(e)return e}qe.info(`[findConfigForImageHash] image:${n}`);const a=new O.NZ(e.sequenceUtils,m.sequenceUtils.abi,t.authProvider),o=(await a.lastImageHashUpdate(n)).toNumber(),c=a.filters.RequiredConfig(void 0,n),l=await t.findLatestLog(t.authProvider,Ht({},c,{fromBlock:o,toBlock:0!==o?o:"latest"}));if(void 0===l)return;const h=a.interface.decodeEventLog("RequiredConfig",l.data,l.topics),d=be.D.decode(["tuple(\n        uint256 weight,\n        address signer\n      )[]"],h._signers)[0],u={threshold:we.gH.from(h._threshold).toNumber(),signers:d.map((e=>({address:e.signer,weight:we.gH.from(e.weight).toNumber()})))};return Pt(u),u},this.findCurrentImageHash=async function(e,n,i,s=[],r){qe.info(`[findCurrentImageHash] address:${i}`);const a=new O.NZ(i,m.mainModuleUpgradable.abi,n),o=await a.functions.imageHash.call([]).catch((()=>[]));if(void 0!==o[0])return{imageHash:o[0],config:r?void 0:Ot(o[0])};const c=N.getAddress(i),l=s.find((t=>Bt(t,e,!0)===c));if(l)return{imageHash:Pt(l),config:l};const h=new O.NZ(e.sequenceUtils,m.sequenceUtils.abi,t.authProvider),d=await h.knownImageHashes(i);if(d!==Ee.j){if(Bt(d,e)!==i)throw Error("findCurrentImageHash: inconsistent RequireUtils results");return{imageHash:d}}const u=h.filters.RequiredConfig(i),p=await t.findFirstLog(t.authProvider,u);if(void 0!==p){const t=h.interface.decodeEventLog("RequiredConfig",p.data,p.topics),n=be.D.decode(["tuple(\n          uint256 weight,\n          address signer\n        )[]"],t._signers)[0],s={threshold:we.gH.from(t._threshold).toNumber(),signers:n.map((e=>({address:e.signer,weight:we.gH.from(e.weight).toNumber()})))},r=Pt(s);if(Bt(r,e)===i)return{imageHash:r,config:s}}return{}},this.findLatestLog=async function(e,n){const i="latest"===n.toBlock?await e.getBlockNumber():n.toBlock,s=n.fromBlock;0===s&&qe.warn(`findLatestLog: expensive getLogs query fromBlock 0 toBlock ${i}`);try{const t=await e.getLogs(Ht({},n,{toBlock:i}));return 0===t.length?void 0:t[t.length-1]}catch(r){const a=Math.floor((i-s)/2+s),o=await t.findLatestLog(e,Ht({},n,{fromBlock:a,toBlock:i}));return void 0!==o?o:t.findLatestLog(e,Ht({},n,{fromBlock:s,toBlock:a}))}},this.findFirstLog=async function(e,n){const i="latest"!==n.toBlock&&n.toBlock?n.toBlock:await e.getBlockNumber(),s=n.fromBlock?n.fromBlock:0;0===s&&qe.warn(`findFirstLog: expensive getLogs query fromBlock 0 toBlock ${i}`);try{const t=await e.getLogs(Ht({},n,{fromBlock:s,toBlock:i}));return 0===t.length?void 0:t[0]}catch(r){const a=Math.floor((i-s)/2+s),o=await t.findFirstLog(e,Ht({},n,{fromBlock:s,toBlock:a}));return void 0!==o?o:t.findFirstLog(e,Ht({},n,{fromBlock:a,toBlock:i}))}}}}function jt(e){return void 0!==e.address&&!$t(e)}function $t(e){return Kt(e)||Jt(e)||Yt(e)}function Kt(e){const t=e;return void 0!==t.signature&&void 0===t.address}function Jt(e){const t=e;return void 0!==t.r&&void 0!==t.s&&void 0!==t.v&&void 0!==t.t}function Yt(e){const t=e;return void 0!==t.address&&void 0!==t.signature}let zt;!function(e){e[e.EOA=0]="EOA",e[e.Address=1]="Address",e[e.Full=2]="Full"}(zt||(zt={}));const Zt=e=>{if("string"!=typeof e)return e;const t=e.replace("0x",""),n=we.gH.from(`0x${t.slice(0,4)}`).toNumber(),i=[];for(let e=4;e<t.length;){const n=we.gH.from(t.slice(e,e+2)).toNumber();e+=2;const s=we.gH.from(`0x${t.slice(e,e+2)}`).toNumber();switch(e+=2,n){case zt.Address:const n=N.getAddress(t.slice(e,e+40));e+=40,i.push({weight:s,address:n});break;case zt.EOA:const r=x.arrayify(`0x${t.slice(e,e+132)}`);e+=132;const a=x.splitSignature(r.slice(0,65)),o=a.r,c=a.s,l=a.v,h=we.gH.from(r[r.length-1]).toNumber();i.push({weight:s,signature:r,r:o,s:c,v:l,t:h});break;case zt.Full:const d=N.getAddress(t.slice(e,e+40));e+=40;const u=we.gH.from(`0x${t.slice(e,e+4)}`).mul(2).toNumber();e+=4;const p=x.arrayify(`0x${t.slice(e,e+u)}`);e+=u,i.push({weight:s,address:d,signature:p});break;default:throw Error("Signature type not supported")}}return{threshold:n,signers:i}},Xt=3,Qt=e=>{const t=x.arrayify(e.signature);return Ht({},e,x.splitSignature(t.slice(0,65)),{t:we.gH.from(t[t.length-1]).toNumber()})},en=(e,t)=>{const n=Jt(t)?t:Qt(t);switch(n.t){case 1:return Ce.recoverAddress(e,{r:n.r,s:n.s,v:n.v});case 2:const t=R.keccak256(ve.pack(["string","bytes32"],["Ethereum Signed Message:\n32",e]));return Ce.recoverAddress(t,{r:n.r,s:n.s,v:n.v});default:throw new Error("Unknown signature")}},tn=(...e)=>e.map((e=>"string"==typeof e?Zt(e):e)).reduce(((e,t)=>nn(e,t))),nn=(e,t)=>({threshold:e.threshold,signers:e.signers.map(((e,n)=>jt(e)?t.signers[n]:e))}),sn=e=>{if("string"==typeof e)return sn(Zt(e));const t=e.signers.map((e=>{if(jt(e))return ve.pack(["uint8","uint8","address"],[zt.Address,e.weight,e.address]);if(Jt(e))return ve.pack(["uint8","uint8","bytes32","bytes32","uint8","uint8"],[zt.EOA,e.weight,e.r,e.s,e.v,e.t]);if(Yt(e)){const t=x.arrayify(e.signature).length;return ve.pack(["uint8","uint8","address","uint16","bytes"],[zt.Full,e.weight,e.address,t,e.signature])}if(Kt(e))return ve.pack(["uint8","uint8","bytes"],[zt.EOA,e.weight,e.signature]);throw Error("Unkwnown signature part type")}));return ve.pack(["uint16",...Array(t.length).fill("bytes")],[e.threshold,...t])};function rn(e,t){if(jt(e))return e.address;if(Yt(e))return e.address;if(Jt(e)||Kt(e))return en(t,e);throw Error("Unkwnown signature part type")}function an(e,t,n){const i=e.signers.map((e=>rn(e,n)));return{threshold:t.threshold,signers:t.signers.map((t=>{const n=i.indexOf(t.address);return-1!==n?Ht({},e.signers[n],{weight:t.weight}):{weight:t.weight,address:t.address}}))}}async function on(e,t){const n=new kt.MulticallProvider(e);let i=(await Promise.all(t.signers.map((async(e,t)=>Ht({},e,{index:t,isEOA:0===x.arrayify(await n.getCode(e.address)).length}))))).sort(((e,t)=>e.weight-t.weight)),s=0;i=i.map((e=>s>=t.threshold||e.isEOA?e:(s+=e.weight,Ht({},e,{willSign:!0})))),s<t.threshold&&(i=i.map((e=>e.willSign||s>=t.threshold?e:(s+=e.weight,Ht({},e,{willSign:!0})))));const r=x.arrayify("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a01b02"),a=i.sort(((e,t)=>e.index-t.index));return{threshold:t.threshold,signers:a.map((e=>e.willSign?e.isEOA?{weight:e.weight,signature:r}:{weight:e.weight,address:e.address,signature:sn({threshold:1,signers:[{address:U.Wallet.createRandom().address,weight:1},{weight:1,signature:r}]})+x.hexlify(Xt).substring(2)}:{address:e.address,weight:e.weight}))}}function cn(){return cn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},cn.apply(this,arguments)}const ln="v1",hn="v0.4.0",dn="3254a537c563d6b612b7ab5365c305664abb5951";let un,pn,gn,fn,mn,wn,yn;!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e.SEQUENCE_WALLET="SEQUENCE_WALLET",e.ERC20_BRIDGE="ERC20_BRIDGE",e.ERC721_BRIDGE="ERC721_BRIDGE",e.ERC1155_BRIDGE="ERC1155_BRIDGE"}(un||(un={})),function(e){e.UNKNOWN="UNKNOWN",e.BLOCK_ADDED="BLOCK_ADDED",e.BLOCK_REMOVED="BLOCK_REMOVED"}(pn||(pn={})),function(e){e.UNKNOWN="UNKNOWN",e.TOKEN_TRANSFER="TOKEN_TRANSFER",e.NATIVE_TOKEN_TRANSFER="NATIVE_TOKEN_TRANSFER",e.SEQUENCE_TXN="SEQUENCE_TXN"}(gn||(gn={})),function(e){e.UNKNOWN="UNKNOWN",e.SEND="SEND",e.RECEIVE="RECEIVE"}(fn||(fn={})),function(e){e.FAILED="FAILED",e.SUCCESSFUL="SUCCESSFUL"}(mn||(mn={})),function(e){e.LegacyTxnType="LegacyTxnType",e.AccessListTxnType="AccessListTxnType",e.DynamicFeeTxnType="DynamicFeeTxnType"}(wn||(wn={})),function(e){e.DESC="DESC",e.ASC="ASC"}(yn||(yn={}));class vn{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Indexer/",this.ping=e=>this.fetch(this.url("Ping"),bn({},e)).then((e=>En(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),bn({},e)).then((e=>En(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),bn({},e)).then((e=>En(e).then((e=>({status:e.status}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),bn({},e)).then((e=>En(e).then((e=>({chainID:e.chainID}))))),this.getEtherBalance=(e,t)=>this.fetch(this.url("GetEtherBalance"),bn(e,t)).then((e=>En(e).then((e=>({balance:e.balance}))))),this.getTokenBalances=(e,t)=>this.fetch(this.url("GetTokenBalances"),bn(e,t)).then((e=>En(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTokenSupplies=(e,t)=>this.fetch(this.url("GetTokenSupplies"),bn(e,t)).then((e=>En(e).then((e=>({page:e.page,contractType:e.contractType,tokenIDs:e.tokenIDs}))))),this.getTokenSuppliesMap=(e,t)=>this.fetch(this.url("GetTokenSuppliesMap"),bn(e,t)).then((e=>En(e).then((e=>({supplies:e.supplies}))))),this.getBalanceUpdates=(e,t)=>this.fetch(this.url("GetBalanceUpdates"),bn(e,t)).then((e=>En(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTransactionHistory=(e,t)=>this.fetch(this.url("GetTransactionHistory"),bn(e,t)).then((e=>En(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.syncBalance=(e,t)=>this.fetch(this.url("SyncBalance"),bn(e,t)).then((e=>En(e).then((e=>({}))))),this.fetchTransactionReceipt=(e,t)=>this.fetch(this.url("FetchTransactionReceipt"),bn(e,t)).then((e=>En(e).then((e=>({receipt:e.receipt}))))),this.fetchTransactionReceiptWithFilter=(e,t)=>this.fetch(this.url("FetchTransactionReceiptWithFilter"),bn(e,t)).then((e=>En(e).then((e=>({receipt:e.receipt}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const bn=(e={},t={})=>({method:"POST",headers:cn({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),En=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));let Cn;!function(e){e.MAINNET="https://mainnet-indexer.sequence.app",e.POLYGON="https://polygon-indexer.sequence.app",e.POLYGON_MUMBAI="https://mumbai-indexer.sequence.app",e.POLYGON_ZKEVM="https://polygon-zkevm-indexer.sequence.app",e.ARBITRUM="https://arbitrum-indexer.sequence.app",e.ARBITRUM_NOVA="https://arbitrum-nova-indexer.sequence.app",e.OPTIMISM="https://optimism-indexer.sequence.app",e.AVALANCHE="https://avalanche-indexer.sequence.app",e.GNOSIS="https://gnosis-indexer.sequence.app",e.BSC="https://bsc-indexer.sequence.app",e.BSC_TESTNET="https://bsc-testnet-indexer.sequence.app",e.GOERLI="https://goerli-indexer.sequence.app"}(Cn||(Cn={}));const In="object"==typeof n.g?n.g.fetch:window.fetch;class kn extends vn{constructor(e,t){super(e.endsWith("/")?e.slice(0,-1):e,In),this.jwtAuth=t,this._fetch=(e,t)=>{const n={};return this.jwtAuth&&this.jwtAuth.length>0&&(n.Authorization=`BEARER ${this.jwtAuth}`),t.headers=cn({},t.headers,n),In(e,t)},this.fetch=this._fetch}}function An(){return An=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},An.apply(this,arguments)}const Tn="v1",_n="v0.4.0",Sn="5d87d77b951c5d197544d97d75241bf3d02679d9";let Nn,On,xn,Rn;!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155"}(Nn||(Nn={})),function(e){e.INT="INT",e.STRING="STRING",e.ARRAY="ARRAY",e.GENERIC="GENERIC"}(On||(On={})),function(e){e.UNKNOWN="UNKNOWN",e.BUY="BUY",e.SELL="SELL"}(xn||(xn={})),function(e){e.DESC="DESC",e.ASC="ASC"}(Rn||(Rn={}));class Mn{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Metadata/",this.ping=e=>this.fetch(this.url("Ping"),Un({},e)).then((e=>Bn(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),Un({},e)).then((e=>Bn(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),Un({},e)).then((e=>Bn(e).then((e=>({status:e.status}))))),this.getTokenMetadata=(e,t)=>this.fetch(this.url("GetTokenMetadata"),Un(e,t)).then((e=>Bn(e).then((e=>({tokenMetadata:e.tokenMetadata}))))),this.refreshTokenMetadata=(e,t)=>this.fetch(this.url("RefreshTokenMetadata"),Un(e,t)).then((e=>Bn(e).then((e=>({status:e.status}))))),this.getTokenMetadataBatch=(e,t)=>this.fetch(this.url("GetTokenMetadataBatch"),Un(e,t)).then((e=>Bn(e).then((e=>({contractTokenMetadata:e.contractTokenMetadata}))))),this.searchTokenMetadata=(e,t)=>this.fetch(this.url("SearchTokenMetadata"),Un(e,t)).then((e=>Bn(e).then((e=>({page:e.page,tokenMetadata:e.tokenMetadata}))))),this.searchTokenIDs=(e,t)=>this.fetch(this.url("SearchTokenIDs"),Un(e,t)).then((e=>Bn(e).then((e=>({page:e.page,tokenIds:e.tokenIds}))))),this.tokenCollectionFilters=(e,t)=>this.fetch(this.url("TokenCollectionFilters"),Un(e,t)).then((e=>Bn(e).then((e=>({filters:e.filters}))))),this.getContractInfo=(e,t)=>this.fetch(this.url("GetContractInfo"),Un(e,t)).then((e=>Bn(e).then((e=>({contractInfo:e.contractInfo}))))),this.getContractInfoBatch=(e,t)=>this.fetch(this.url("GetContractInfoBatch"),Un(e,t)).then((e=>Bn(e).then((e=>({contractInfoMap:e.contractInfoMap}))))),this.searchContractInfo=(e,t)=>this.fetch(this.url("SearchContractInfo"),Un(e,t)).then((e=>Bn(e).then((e=>({contractInfoList:e.contractInfoList}))))),this.searchContractInfoBatch=(e,t)=>this.fetch(this.url("SearchContractInfoBatch"),Un(e,t)).then((e=>Bn(e).then((e=>({contractInfoByChain:e.contractInfoByChain}))))),this.searchMetadata=(e,t)=>this.fetch(this.url("SearchMetadata"),Un(e,t)).then((e=>Bn(e).then((e=>({tokenMetadata:e.tokenMetadata,contractInfo:e.contractInfo}))))),this.getNiftyswapTokenQuantity=(e,t)=>this.fetch(this.url("GetNiftyswapTokenQuantity"),Un(e,t)).then((e=>Bn(e).then((e=>({quantity:e.quantity}))))),this.getNiftyswapUnitPrices=(e,t)=>this.fetch(this.url("GetNiftyswapUnitPrices"),Un(e,t)).then((e=>Bn(e).then((e=>({prices:e.prices}))))),this.getNiftyswapUnitPricesWithQuantities=(e,t)=>this.fetch(this.url("GetNiftyswapUnitPricesWithQuantities"),Un(e,t)).then((e=>Bn(e).then((e=>({prices:e.prices}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const Un=(e={},t={})=>({method:"POST",headers:An({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),Bn=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n})),Pn="object"==typeof n.g?n.g.fetch:window.fetch;class Ln extends Mn{constructor(e="https://metadata.sequence.app"){super(e.endsWith("/")?e.slice(0,-1):e,Pn)}}function Dn(){return Dn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Dn.apply(this,arguments)}const qn=e=>((e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const a=i.map((e=>e.name)).sort(),o=a.filter(((e,t)=>a.indexOf(e)!==t));if(o.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${o}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l&&t)throw new Error("invalid network config: AuthChain must be set")})(e,!0,t),e))(Gn(e)),Gn=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},Fn=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let Wn;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(Wn||(Wn={}));const Hn=e=>Fn("https://${network}-indexer.sequence.app",{network:e}),Vn=e=>Fn("https://${network}-relayer.sequence.app",{network:e}),jn=e=>Fn("https://nodes.sequence.app/${network}",{network:e}),$n={[Wn.MAINNET]:{chainId:Wn.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Wn.ROPSTEN]:{chainId:Wn.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Wn.RINKEBY]:{chainId:Wn.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[Wn.GOERLI]:{chainId:Wn.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Wn.KOVAN]:{chainId:Wn.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[Wn.POLYGON]:{chainId:Wn.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[Wn.POLYGON_MUMBAI]:{chainId:Wn.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[Wn.POLYGON_ZKEVM]:{chainId:Wn.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[Wn.BSC]:{chainId:Wn.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[Wn.BSC_TESTNET]:{chainId:Wn.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[Wn.OPTIMISM]:{chainId:Wn.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[Wn.OPTIMISM_TESTNET]:{chainId:Wn.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[Wn.ARBITRUM]:{chainId:Wn.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[Wn.ARBITRUM_GOERLI]:{chainId:Wn.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[Wn.ARBITRUM_NOVA]:{chainId:Wn.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[Wn.AVALANCHE]:{chainId:Wn.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[Wn.AVALANCHE_TESTNET]:{chainId:Wn.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[Wn.FANTOM]:{chainId:Wn.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[Wn.FANTOM_TESTNET]:{chainId:Wn.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[Wn.GNOSIS]:{chainId:Wn.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[Wn.AURORA]:{chainId:Wn.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[Wn.AURORA_TESTNET]:{chainId:Wn.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[Wn.BASE_GOERLI]:{chainId:Wn.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},Kn=(qn([Dn({},$n[Wn.MAINNET],{rpcUrl:jn("mainnet"),relayer:{url:Vn("mainnet")},indexerUrl:Hn("mainnet")}),Dn({},$n[Wn.POLYGON],{rpcUrl:jn("polygon"),relayer:{url:Vn("polygon")},indexerUrl:Hn("polygon"),isDefaultChain:!0,isAuthChain:!0}),Dn({},$n[Wn.BSC],{rpcUrl:jn("bsc"),indexerUrl:Hn("bsc"),relayer:{url:Vn("bsc")}}),Dn({},$n[Wn.AVALANCHE],{rpcUrl:jn("avalanche"),indexerUrl:Hn("avalanche"),relayer:{url:Vn("avalanche")}}),Dn({},$n[Wn.ARBITRUM],{rpcUrl:jn("arbitrum"),indexerUrl:Hn("arbitrum"),relayer:{url:Vn("arbitrum")}}),Dn({},$n[Wn.ARBITRUM_NOVA],{rpcUrl:jn("arbitrum-nova"),indexerUrl:Hn("arbitrum-nova"),relayer:{url:Vn("arbitrum-nova")}}),Dn({},$n[Wn.OPTIMISM],{rpcUrl:jn("optimism"),indexerUrl:Hn("optimism"),relayer:{url:Vn("optimism")}}),Dn({},$n[Wn.POLYGON_ZKEVM],{rpcUrl:jn("polygon-zkevm"),indexerUrl:Hn("polygon-zkevm"),relayer:{url:Vn("polygon-zkevm")}}),Dn({},$n[Wn.GNOSIS],{rpcUrl:jn("gnosis"),indexerUrl:Hn("gnosis"),relayer:{url:Vn("gnosis")}})]),qn([Dn({},$n[Wn.RINKEBY],{rpcUrl:jn("rinkeby"),relayer:{url:Vn("rinkeby")},indexerUrl:Hn("rinkeby")}),Dn({},$n[Wn.GOERLI],{rpcUrl:jn("goerli"),relayer:{url:Vn("goerli")},indexerUrl:Hn("goerli")}),Dn({},$n[Wn.POLYGON_MUMBAI],{rpcUrl:jn("mumbai"),relayer:{url:Vn("mumbai")},indexerUrl:Hn("mumbai"),isDefaultChain:!0,isAuthChain:!0}),Dn({},$n[Wn.BSC_TESTNET],{rpcUrl:jn("bsc-testnet"),relayer:{url:Vn("bsc-testnet")},indexerUrl:Hn("bsc-testnet")}),Dn({},$n[Wn.ARBITRUM_GOERLI],{rpcUrl:jn("arbitrum-goerli"),relayer:{url:Vn("arbitrum-goerli")},indexerUrl:Hn("arbitrum-goerli")}),Dn({},$n[Wn.BASE_GOERLI],{rpcUrl:jn("base-goerli"),relayer:{url:Vn("base-goerli")},indexerUrl:Hn("base-goerli")})]),{factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}});class Jn{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=Yn(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const Yn=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};let zn=0;class Zn{constructor(e,t){var n;this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,void 0!==(n=e)&&void 0!==n.send&&void 0!==n.constructor.defaultUrl&&void 0!==n.detectNetwork&&void 0!==n.getSigner&&void 0!==n.perform?this.send=e.send.bind(e):function(e){return void 0!==e&&void 0!==e.sendAsync}(e)?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:"2.0",id:++zn,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class Xn{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class Qn{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}class ei{constructor(){this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(!this.singleflightJsonRpcMethods.includes(t.method))return void e(t,n,i);const s=this.requestKey(t.method,t.params||[],i);this.inflight[s]?this.inflight[s].push({id:t.id,callback:n}):(this.inflight[s]=[],e(t,((e,t,i)=>{n(e,t);for(let n=0;n<this.inflight[s].length;n++){const i=this.inflight[s][n];e?i.callback(e,t):t&&i.callback(void 0,{jsonrpc:"2.0",id:i.id,result:t.result})}delete this.inflight[s]}),i))},this.requestKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.inflight={}}}class ti extends B.F{constructor(e,t){super(e,null==t?void 0:t.chainId),this._chainId=void 0,this._sender=void 0,this.send=(e,t)=>this._sender.send(e,t),this.fetch=(e,t)=>{const n={method:e,params:t,id:this._nextId++,jsonrpc:"2.0"};return ot.fetchJson(this.connection,JSON.stringify(n),ni).then((e=>e),(e=>{throw e}))};const n=null==t?void 0:t.chainId,i=null==t?void 0:t.middlewares,s=null==t?void 0:t.blockCache;this._chainId=n;const r=new Jn(null!=i?i:[new Qn({chainId:n}),new ei,new Xn({defaultChainId:n,blockCache:s})],new Zn(this.fetch,n));this._sender=new Zn(r,n)}async getNetwork(){const e=this._chainId;if(e){const t=$n[e];return{name:(null==t?void 0:t.name)||"",chainId:e,ensAddress:null==t?void 0:t.ensAddress}}{const e=await this.send("eth_chainId",[]);return this._chainId=we.gH.from(e).toNumber(),this.getNetwork()}}}function ni(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}var ii=n(52428),si=n(36681),ri=n(24495),ai=n(76135);function oi(){return oi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},oi.apply(this,arguments)}const ci="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]";function li(...e){const t=bi(...e);if(void 0===t)throw new Error("Encoding transactions without defined nonce");return hi(t,...e)}function hi(e,...t){return be.D.encode(["uint256",ci],[e,Ei(t)])}function di(...e){const t=bi(...e);if(void 0===t)throw new Error("Computing hash for transactions without defined nonce");return ui(t,...e)}function ui(e,...t){return R.keccak256(hi(e,...t))}function pi(e,t,...n){return Re(e,t,di(...n)).replace(/^0x/,"")}async function gi(e,t,n=!1,i){const s=fi(t),r=(await Promise.all(t.map((e=>e.nonce)))).filter((e=>void 0!==e)).map((e=>we.gH.from(e))),a=0!==r.length?r.reduce(((e,t)=>e.lt(t)?e:t)):void 0;return Promise.all(s.map((t=>mi(e,t,n,i,a))))}function fi(e){if(!Array.isArray(e)){if("auxiliary"in e){const t=e.auxiliary,n=oi({},e);return delete n.auxiliary,t?[n,...fi(t)]:[n]}return[e]}return e.flatMap(fi)}async function mi(e,t,n=!1,i,s){if(yi(t))return t;const r=void 0===t.gasLimit?t.gas:t.gasLimit;if(t.to)return{delegateCall:!1,revertOnError:n,gasLimit:r?await r:i,to:await t.to,value:t.value?await t.value:0,data:await t.data,nonce:s||await t.nonce};{const a=new rt.KA(m.mainModule.abi),o=a.encodeFunctionData(a.getFunction("createContract"),[t.data]),c="string"==typeof e?e:e.getAddress();return{delegateCall:!1,revertOnError:n,gasLimit:r?await r:i,to:await c,value:t.value?await t.value:0,data:o,nonce:s||await t.nonce}}}function wi(e){return e.send||e.sendAsync}function yi(e){return void 0!==e.delegateCall||void 0!==e.revertOnError}function vi(e){return void 0!==e.find((e=>yi(e)))}function bi(...e){const t=e.find((e=>void 0!==e.nonce));if(!t)return;const n=we.gH.from(t.nonce);if(e.find((e=>void 0!==e.nonce&&!we.gH.from(e.nonce).eq(n))))throw new Error("Mixed nonces on Sequence transactions");return t?t.nonce:void 0}function Ei(e){return e.map((e=>{var t;return{delegateCall:!0===e.delegateCall,revertOnError:!0===e.revertOnError,gasLimit:void 0!==e.gasLimit?e.gasLimit:ye.XK,target:null!=(t=e.to)?t:ai.L,value:void 0!==e.value?e.value:ye.XK,data:void 0!==e.data?e.data:[]}}))}function Ci(e,t){return e.map((e=>oi({},e,{nonce:t})))}function Ii(e,t,n){const i=new rt.KA(m.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:i.encodeFunctionData(i.getFunction("requireNonExpired"),[n])},...t]}function ki(e,t,n){const i=new rt.KA(m.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:i.encodeFunctionData(i.getFunction("requireMinNonce"),[n.address,n.space?Ai(n.space,n.nonce):n.nonce])},...t]}function Ai(e,t){const n=we.gH.from(e),i=we.gH.from(t),s=ye.d0.pow(we.gH.from(96));if(!i.div(s).eq(ye.XK))throw new Error("Space already encoded");return i.add(n.mul(s))}function Ti(e){const t=we.gH.from(e),n=ye.d0.pow(we.gH.from(96));return[t.div(n),t.mod(n)]}function _i(e){return void 0!==e&&void 0!==e.chainId&&void 0!==e.config&&void 0!==e.context&&void 0!==e.signature&&void 0!==e.transactions&&Array.isArray(e.transactions)&&e.transactions.reduce(((e,t)=>e&&yi(t)),!0)}async function Si(e,t,n){let i=[];if(i=Array.isArray(n)?vi(n)?fi(n):await gi(t,n):yi(n)?fi([n]):await gi(t,[n]),n.expiration&&(i=Ii(e,i,n.expiration)),n.afterNonce){const s=n.afterNonce;i=ki(e,i,s.address?{address:s.address,nonce:s.nonce,space:s.space}:{address:t,nonce:s})}return i}function Ni(){return Ni=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ni.apply(this,arguments)}const Oi=e=>"number"==typeof e?e:e.chainId?e.chainId:we.gH.from(e).toNumber(),xi=(e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const a=i.map((e=>e.name)).sort(),o=a.filter(((e,t)=>a.indexOf(e)!==t));if(o.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${o}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l){if(t)throw new Error("invalid network config: AuthChain must be set")}})(e,!0,t),e),Ri=e=>xi(Mi(e)),Mi=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},Ui=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let Bi;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(Bi||(Bi={}));const Pi=e=>Ui("https://${network}-indexer.sequence.app",{network:e}),Li=e=>Ui("https://${network}-relayer.sequence.app",{network:e}),Di=e=>Ui("https://nodes.sequence.app/${network}",{network:e}),qi={[Bi.MAINNET]:{chainId:Bi.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Bi.ROPSTEN]:{chainId:Bi.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Bi.RINKEBY]:{chainId:Bi.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[Bi.GOERLI]:{chainId:Bi.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Bi.KOVAN]:{chainId:Bi.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[Bi.POLYGON]:{chainId:Bi.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[Bi.POLYGON_MUMBAI]:{chainId:Bi.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[Bi.POLYGON_ZKEVM]:{chainId:Bi.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[Bi.BSC]:{chainId:Bi.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[Bi.BSC_TESTNET]:{chainId:Bi.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[Bi.OPTIMISM]:{chainId:Bi.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[Bi.OPTIMISM_TESTNET]:{chainId:Bi.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[Bi.ARBITRUM]:{chainId:Bi.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[Bi.ARBITRUM_GOERLI]:{chainId:Bi.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[Bi.ARBITRUM_NOVA]:{chainId:Bi.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[Bi.AVALANCHE]:{chainId:Bi.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[Bi.AVALANCHE_TESTNET]:{chainId:Bi.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[Bi.FANTOM]:{chainId:Bi.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[Bi.FANTOM_TESTNET]:{chainId:Bi.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[Bi.GNOSIS]:{chainId:Bi.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[Bi.AURORA]:{chainId:Bi.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[Bi.AURORA_TESTNET]:{chainId:Bi.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[Bi.BASE_GOERLI]:{chainId:Bi.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},Gi=Ri([Ni({},qi[Bi.MAINNET],{rpcUrl:Di("mainnet"),relayer:{url:Li("mainnet")},indexerUrl:Pi("mainnet")}),Ni({},qi[Bi.POLYGON],{rpcUrl:Di("polygon"),relayer:{url:Li("polygon")},indexerUrl:Pi("polygon"),isDefaultChain:!0,isAuthChain:!0}),Ni({},qi[Bi.BSC],{rpcUrl:Di("bsc"),indexerUrl:Pi("bsc"),relayer:{url:Li("bsc")}}),Ni({},qi[Bi.AVALANCHE],{rpcUrl:Di("avalanche"),indexerUrl:Pi("avalanche"),relayer:{url:Li("avalanche")}}),Ni({},qi[Bi.ARBITRUM],{rpcUrl:Di("arbitrum"),indexerUrl:Pi("arbitrum"),relayer:{url:Li("arbitrum")}}),Ni({},qi[Bi.ARBITRUM_NOVA],{rpcUrl:Di("arbitrum-nova"),indexerUrl:Pi("arbitrum-nova"),relayer:{url:Li("arbitrum-nova")}}),Ni({},qi[Bi.OPTIMISM],{rpcUrl:Di("optimism"),indexerUrl:Pi("optimism"),relayer:{url:Li("optimism")}}),Ni({},qi[Bi.POLYGON_ZKEVM],{rpcUrl:Di("polygon-zkevm"),indexerUrl:Pi("polygon-zkevm"),relayer:{url:Li("polygon-zkevm")}}),Ni({},qi[Bi.GNOSIS],{rpcUrl:Di("gnosis"),indexerUrl:Pi("gnosis"),relayer:{url:Li("gnosis")}})]),Fi=(Ri([Ni({},qi[Bi.RINKEBY],{rpcUrl:Di("rinkeby"),relayer:{url:Li("rinkeby")},indexerUrl:Pi("rinkeby")}),Ni({},qi[Bi.GOERLI],{rpcUrl:Di("goerli"),relayer:{url:Li("goerli")},indexerUrl:Pi("goerli")}),Ni({},qi[Bi.POLYGON_MUMBAI],{rpcUrl:Di("mumbai"),relayer:{url:Li("mumbai")},indexerUrl:Pi("mumbai"),isDefaultChain:!0,isAuthChain:!0}),Ni({},qi[Bi.BSC_TESTNET],{rpcUrl:Di("bsc-testnet"),relayer:{url:Li("bsc-testnet")},indexerUrl:Pi("bsc-testnet")}),Ni({},qi[Bi.ARBITRUM_GOERLI],{rpcUrl:Di("arbitrum-goerli"),relayer:{url:Li("arbitrum-goerli")},indexerUrl:Pi("arbitrum-goerli")}),Ni({},qi[Bi.BASE_GOERLI],{rpcUrl:Di("base-goerli"),relayer:{url:Li("base-goerli")},indexerUrl:Pi("base-goerli")})]),{factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}});class Wi{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=Hi(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const Hi=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};function Vi(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}let ji=0;class $i{constructor(e,t){var n;this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,Vi(e)?this.send=e.send.bind(e):void 0!==(n=e)&&void 0!==n.sendAsync?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:"2.0",id:++ji,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class Ki{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class Ji{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}class Yi{constructor(){this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(!this.singleflightJsonRpcMethods.includes(t.method))return void e(t,n,i);const s=this.requestKey(t.method,t.params||[],i);this.inflight[s]?this.inflight[s].push({id:t.id,callback:n}):(this.inflight[s]=[],e(t,((e,t,i)=>{n(e,t);for(let n=0;n<this.inflight[s].length;n++){const i=this.inflight[s][n];e?i.callback(e,t):t&&i.callback(void 0,{jsonrpc:"2.0",id:i.id,result:t.result})}delete this.inflight[s]}),i))},this.requestKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.inflight={}}}class zi extends B.F{constructor(e,t){super(e,null==t?void 0:t.chainId),this._chainId=void 0,this._sender=void 0,this.send=(e,t)=>this._sender.send(e,t),this.fetch=(e,t)=>{const n={method:e,params:t,id:this._nextId++,jsonrpc:"2.0"};return ot.fetchJson(this.connection,JSON.stringify(n),Zi).then((e=>e),(e=>{throw e}))};const n=null==t?void 0:t.chainId,i=null==t?void 0:t.middlewares,s=null==t?void 0:t.blockCache;this._chainId=n;const r=new Wi(null!=i?i:[new Ji({chainId:n}),new Yi,new Ki({defaultChainId:n,blockCache:s})],new $i(this.fetch,n));this._sender=new $i(r,n)}async getNetwork(){const e=this._chainId;if(e){const t=qi[e];return{name:(null==t?void 0:t.name)||"",chainId:e,ensAddress:null==t?void 0:t.ensAddress}}{const e=await this.send("eth_chainId",[]);return this._chainId=we.gH.from(e).toNumber(),this.getNetwork()}}}function Zi(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}function Xi(){return Xi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Xi.apply(this,arguments)}const Qi="v1",es="v0.4.0",ts="98e0726794b2b5922a0e356280daac3a409602e4";class ns{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Guard/",this.ping=e=>this.fetch(this.url("Ping"),is({},e)).then((e=>ss(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),is({},e)).then((e=>ss(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),is({},e)).then((e=>ss(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),is({},e)).then((e=>ss(e).then((e=>({data:e.data}))))),this.getSignerConfig=e=>this.fetch(this.url("GetSignerConfig"),is({},e)).then((e=>ss(e).then((e=>({signerConfig:e.signerConfig}))))),this.sign=(e,t)=>this.fetch(this.url("Sign"),is(e,t)).then((e=>ss(e).then((e=>({sig:e.sig}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const is=(e={},t={})=>({method:"POST",headers:Xi({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),ss=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));function rs(){return rs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},rs.apply(this,arguments)}function as(e){return void 0!==e.bundleCreation&&"boolean"==typeof e.bundleCreation||void 0!==e.creationGasLimit&&st(e.creationGasLimit)||void 0!==e.provider&&(si.Kq.isProvider(e.provider)||"string"==typeof e.provider)}const os={bundleCreation:!0,creationGasLimit:ye.d0.pow(17)};class cs{constructor(e){this.provider=void 0,this.bundleCreation=void 0,this.creationGasLimit=void 0;const t=rs({},os,e);this.bundleCreation=t.bundleCreation,this.provider=t.provider,this.creationGasLimit=we.gH.from(t.creationGasLimit)}async isWalletDeployed(e){if(!this.provider)throw new Error("Bundled creation provider not found");return"0x"!==await this.provider.getCode(e)}prepareWalletDeploy(e,t){const n=new rt.KA(m.factory.abi);return{to:t.factory,data:n.encodeFunctionData(n.getFunction("deploy"),[t.mainModule,Pt(e)])}}async prependWalletDeploy(e){const{config:t,context:n,transactions:i,nonce:s,signature:r}=e,a=Bt(t,n),o=new rt.KA(m.mainModule.abi),c=async function(){const e=await r;return"string"==typeof e?e:sn(e)}();return this.bundleCreation&&!await this.isWalletDeployed(a)?{to:n.guestModule,execute:{transactions:[rs({},this.prepareWalletDeploy(t,n),{delegateCall:!1,revertOnError:!1,gasLimit:this.creationGasLimit,value:ye.XK}),{delegateCall:!1,revertOnError:!0,gasLimit:ye.XK,to:a,value:ye.XK,data:o.encodeFunctionData(o.getFunction("execute"),[Ei(i),s,await c])}],nonce:ye.XK,signature:"0x"}}:{to:a,execute:{transactions:i,nonce:we.gH.from(s),signature:await c}}}async prepareTransactions(e,t,n,...i){const s=bi(...i);if(!s)throw new Error("Unable to prepare transactions without a defined nonce");const{to:r,execute:a}=await this.prependWalletDeploy({config:e,context:t,transactions:i,nonce:s,signature:n}),o=new rt.KA(m.mainModule.abi);return{to:r,data:o.encodeFunctionData(o.getFunction("execute"),[Ei(a.transactions),a.nonce,a.signature])}}}const ls=we.gH.from(8e5),hs={waitPollRate:1e3,deltaBlocksLog:12,fromBlockLog:-1024};function ds(e){return void 0!==e.provider&&si.Kq.isProvider(e.provider)}class us extends cs{constructor(e){super(e),this.provider=void 0,this.waitPollRate=void 0,this.deltaBlocksLog=void 0,this.fromBlockLog=void 0;const t=rs({},hs,e);this.provider=t.provider,this.waitPollRate=t.waitPollRate,this.deltaBlocksLog=t.deltaBlocksLog,this.fromBlockLog=t.fromBlockLog}async simulate(e,...t){var n=this;return(await Promise.all(t.map((async function(t){if(t.gasLimit&&!we.gH.from(t.gasLimit||0).eq(ye.XK))return t.gasLimit;if(t.delegateCall)return ls;if(t.to===e&&!await n.isWalletDeployed(e))return ls;if(!n.provider)throw new Error("signer.provider is not set, but is required");return n.provider.estimateGas({from:e,to:t.to,data:t.data,value:t.value})})))).map((e=>({executed:!0,succeeded:!0,gasUsed:we.gH.from(e).toNumber(),gasLimit:we.gH.from(e).toNumber()})))}async getNonce(e,t,n,i){if(!this.provider)throw new Error("provider is not set");const s=Bt(e,t);if("0x"===await this.provider.getCode(s))return 0;void 0===n&&(n=0);const r=new O.NZ(s,m.mainModule.abi,this.provider);return Ai(n,await r.readNonce(n,{blockTag:i}))}async wait(e,t,n=this.waitPollRate,i=5){var s=this;"string"!=typeof e&&(qe.info("computing id",e.config,e.context,e.chainId,...e.transactions),e=pi(Bt(e.config,e.context),e.chainId,...e.transactions));let r=!1;const a=async function(e,t){let s=0;for(;!r;){try{return await e()}catch(e){if(s++,void 0!==i&&s>=i)throw qe.error(`giving up after ${s} failed attempts${t?`: ${t}`:""}`,e),e;qe.warn(`attempt #${s} failed${t?`: ${t}`:""}`,e)}n>0&&await new Promise((e=>setTimeout(e,n)))}throw new Error(`timed out after ${s} failed attempts${t?`: ${t}`:""}`)},o=async function(){let t=s.fromBlockLog;if(t<0){const e=await a((()=>s.provider.getBlockNumber()),"unable to get latest block number");t=e+t}if("string"!=typeof e)throw new Error("impossible");const i=e.replace("0x","");for(;!r;){const e=await a((()=>s.provider.getBlockNumber()),"unable to get latest block number"),o=await a((()=>s.provider.getLogs({fromBlock:Math.max(0,t-s.deltaBlocksLog),toBlock:e,topics:["0x1f180c27086c7a39ea2a7b25239d1ab92348f07ca7bb59d1438fcf527568f881"]})),`unable to get NonceChange logs for blocks ${Math.max(0,t-s.deltaBlocksLog)} to ${e}`);t=e;const c=(await Promise.all(o.map((e=>a((()=>s.provider.getTransactionReceipt(e.transactionHash)),`unable to get receipt for transaction ${e.transactionHash}`))))).find((e=>e.logs.find((e=>0===e.topics.length&&e.data.replace("0x","")===i||1===e.topics.length&&"0x3dbd1590ea96dd3253a91f24e64e3a502e1225d602a5731357bc12643070ccd7"===e.topics[0]&&e.data.length>=64&&e.data.replace("0x","").startsWith(i)))));if(c)return rs({receipt:c},await a((()=>s.provider.getTransaction(c.transactionHash)),`unable to get transaction ${c.transactionHash}`));r||await new Promise((e=>setTimeout(e,n)))}throw new Error(`Timeout waiting for transaction receipt ${e}`)};return void 0!==t?Promise.race([o(),new Promise(((n,i)=>setTimeout((()=>{r=!0,i(`Timeout waiting for transaction receipt ${e}`)}),t)))]):o()}}function ps(e){return void 0!==e.signer&&me.l.isSigner(e.signer)}class gs extends us{constructor(e){if(super(me.l.isSigner(e)?{provider:e.provider}:rs({},e,{provider:e.signer.provider})),this.signer=void 0,this.txnOptions=void 0,this.signer=me.l.isSigner(e)?e:e.signer,!this.signer.provider)throw new Error("Signer must have a provider")}async deployWallet(e,t){const n=this.prepareWalletDeploy(e,t);return this.signer.sendTransaction(rs({},n,{gasLimit:ye.d0.pow(17)}))}async getFeeOptions(e,t,...n){return{options:[]}}async gasRefundOptions(e,t,...n){const{options:i}=await this.getFeeOptions(e,t,...n);return i}setTransactionOptions(e){this.txnOptions=e}async relay(e,t,n=!0){if(void 0!==t&&qe.warn("LocalRelayer doesn't accept fee quotes"),!e.context.guestModule||42!==e.context.guestModule.length)throw new Error("LocalRelayer requires the context.guestModule address");const{to:i,execute:s}=await this.prependWalletDeploy(e),r=new rt.KA(m.mainModule.abi),a=r.encodeFunctionData(r.getFunction("execute"),[Ei(s.transactions),s.nonce,s.signature]),o=this.signer.sendTransaction(rs({to:i,data:a},this.txnOptions));if(n){const e=await o;return e.receipt=await e.wait(),e}return o}}let fs,ms,ws,ys;!function(e){e.UNKNOWN="UNKNOWN",e.DROPPED="DROPPED",e.QUEUED="QUEUED",e.SENT="SENT",e.SUCCEEDED="SUCCEEDED",e.PARTIALLY_FAILED="PARTIALLY_FAILED",e.FAILED="FAILED"}(fs||(fs={})),function(e){e.SEND="SEND",e.RECEIVE="RECEIVE",e.BRIDGE_DEPOSIT="BRIDGE_DEPOSIT",e.BRIDGE_WITHDRAW="BRIDGE_WITHDRAW",e.BURN="BURN",e.UNKNOWN="UNKNOWN"}(ms||(ms={})),function(e){e.UNKNOWN="UNKNOWN",e.ERC20_TOKEN="ERC20_TOKEN",e.ERC1155_TOKEN="ERC1155_TOKEN"}(ws||(ws={})),function(e){e.DESC="DESC",e.ASC="ASC"}(ys||(ys={}));class vs{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Relayer/",this.ping=e=>this.fetch(this.url("Ping"),bs({},e)).then((e=>Es(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),bs({},e)).then((e=>Es(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),bs({},e)).then((e=>Es(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),bs({},e)).then((e=>Es(e).then((e=>({data:e.data}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),bs({},e)).then((e=>Es(e).then((e=>({chainID:e.chainID}))))),this.sendMetaTxn=(e,t)=>this.fetch(this.url("SendMetaTxn"),bs(e,t)).then((e=>Es(e).then((e=>({status:e.status,txnHash:e.txnHash}))))),this.getMetaTxnNonce=(e,t)=>this.fetch(this.url("GetMetaTxnNonce"),bs(e,t)).then((e=>Es(e).then((e=>({nonce:e.nonce}))))),this.getMetaTxnReceipt=(e,t)=>this.fetch(this.url("GetMetaTxnReceipt"),bs(e,t)).then((e=>Es(e).then((e=>({receipt:e.receipt}))))),this.simulate=(e,t)=>this.fetch(this.url("Simulate"),bs(e,t)).then((e=>Es(e).then((e=>({results:e.results}))))),this.updateMetaTxnGasLimits=(e,t)=>this.fetch(this.url("UpdateMetaTxnGasLimits"),bs(e,t)).then((e=>Es(e).then((e=>({payload:e.payload}))))),this.feeTokens=e=>this.fetch(this.url("FeeTokens"),bs({},e)).then((e=>Es(e).then((e=>({isFeeRequired:e.isFeeRequired,tokens:e.tokens}))))),this.feeOptions=(e,t)=>this.fetch(this.url("FeeOptions"),bs(e,t)).then((e=>Es(e).then((e=>({options:e.options,quote:e.quote}))))),this.getMetaTxnNetworkFeeOptions=(e,t)=>this.fetch(this.url("GetMetaTxnNetworkFeeOptions"),bs(e,t)).then((e=>Es(e).then((e=>({options:e.options}))))),this.sentTransactions=(e,t)=>this.fetch(this.url("SentTransactions"),bs(e,t)).then((e=>Es(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.pendingTransactions=(e,t)=>this.fetch(this.url("PendingTransactions"),bs(e,t)).then((e=>Es(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.listGasSponsors=(e,t)=>this.fetch(this.url("ListGasSponsors"),bs(e,t)).then((e=>Es(e).then((e=>({page:e.page,gasSponsors:e.gasSponsors}))))),this.addGasSponsor=(e,t)=>this.fetch(this.url("AddGasSponsor"),bs(e,t)).then((e=>Es(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.updateGasSponsor=(e,t)=>this.fetch(this.url("UpdateGasSponsor"),bs(e,t)).then((e=>Es(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.reportGasSponsorUsage=(e,t)=>this.fetch(this.url("ReportGasSponsorUsage"),bs(e,t)).then((e=>Es(e).then((e=>({gasSponsorUsage:e.gasSponsorUsage}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const bs=(e={},t={})=>({method:"POST",headers:rs({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),Es=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));var Cs=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"752f4f4274ca80d2fd974b5b44ed8245dfe40554",get ETHTxnStatus(){return fs},get TransferType(){return ms},get FeeTokenType(){return ws},get SortOrder(){return ys},Relayer:vs});const Is=[fs.DROPPED,fs.SUCCEEDED,fs.PARTIALLY_FAILED,fs.FAILED],ks=[fs.DROPPED,fs.PARTIALLY_FAILED,fs.FAILED];function As(e){return void 0!==e.url&&"string"==typeof e.url}const Ts="object"==typeof n.g?n.g.fetch:window.fetch;class _s extends cs{constructor(e){super(e),this.service=void 0,this.service=new vs(e.url,Ts)}async waitReceipt(e,t=1e3,n=5,i){"string"!=typeof e&&(qe.info("computing id",e.config,e.context,e.chainId,...e.transactions),e=pi(Bt(e.config,e.context),e.chainId,...e.transactions)),qe.info(`[rpc-relayer/waitReceipt] waiting for ${e}`);let s=0;for(;void 0===i||!i();){try{const{receipt:t}=await this.service.getMetaTxnReceipt({metaTxID:e});if(t&&t.txnReceipt&&"null"!==t.txnReceipt&&Is.includes(t.status))return{receipt:t}}catch(e){if(s++,s===n)throw e}void 0!==i&&i()||await new Promise((e=>setTimeout(e,t)))}throw new Error(`Cancelled waiting for transaction receipt ${e}`)}async simulate(e,...t){const n=be.D.encode([ci],[Ei(t)]);return(await this.service.simulate({wallet:e,transactions:n})).results}async getFeeOptions(e,t,...n){const i=await this.service.feeTokens();if(i.isFeeRequired){const s=i.tokens.map((e=>e.symbol)).join(", ");qe.info(`[rpc-relayer/getFeeOptions] relayer fees are required, accepted tokens are ${s}`);const r=Bt(e,t);let a=bi(...n);if(void 0===a&&(a=await this.getNonce(e,t)),!this.provider)throw qe.warn("[rpc-relayer/getFeeOptions] provider not set, needed for stub signature"),new Error("provider is not set");const{to:o,execute:c}=await this.prependWalletDeploy({config:e,context:t,transactions:n,nonce:a,signature:on(this.provider,e)}),l=new rt.KA(m.mainModule.abi),h=l.encodeFunctionData(l.getFunction("execute"),[Ei(c.transactions),c.nonce,c.signature]),{options:d,quote:u}=await this.service.feeOptions({wallet:r,to:o,data:h});return qe.info(`[rpc-relayer/getFeeOptions] got refund options ${JSON.stringify(d)}`),{options:d,quote:{_tag:"FeeQuote",_quote:u}}}return qe.info("[rpc-relayer/getFeeOptions] relayer fees are not required"),{options:[]}}async gasRefundOptions(e,t,...n){const{options:i}=await this.getFeeOptions(e,t,...n);return i}async getNonce(e,t,n){const i=Bt(e,t);qe.info(`[rpc-relayer/getNonce] get nonce for wallet ${i} space: ${n}`);const s=void 0!==n?we.gH.from(n).toHexString():void 0,r=await this.service.getMetaTxnNonce({walletContractAddress:i,space:s}),a=we.gH.from(r.nonce),[o,c]=Ti(a);return qe.info(`[rpc-relayer/getNonce] got next nonce for wallet ${i} ${c} space: ${o}`),a}async relay(e,t,n=!0){var i=this;let s;if(qe.info(`[rpc-relayer/relay] relaying signed meta-transactions ${JSON.stringify(e)} with quote ${JSON.stringify(t)}`),void 0!==t&&("string"==typeof t._quote?s=t._quote:qe.warn("[rpc-relayer/relay] ignoring invalid fee quote")),!this.provider)throw qe.warn("[rpc-relayer/relay] provider not set, failed relay"),new Error("provider is not set");const{to:r,execute:a}=await this.prependWalletDeploy(e),o=Bt(e.config,e.context),c=new rt.KA(m.mainModule.abi),l=c.encodeFunctionData(c.getFunction("execute"),[Ei(a.transactions),a.nonce,a.signature]),h=await this.service.sendMetaTxn({call:{walletAddress:o,contract:r,input:l},quote:s});if(qe.info(`[rpc-relayer/relay] got relay result ${JSON.stringify(h)}`),n)return this.wait(h.txnHash);{const e={hash:h.txnHash,confirmations:0,from:o,wait:e=>Promise.reject(new Error("impossible"))},t=async function(t){var n;if(!i.provider)throw new Error("cannot wait for receipt, relayer has no provider set");const s=await i.wait(h.txnHash),r=null==(n=s.receipt)?void 0:n.transactionHash;if(!r)throw new Error("cannot wait for receipt, unknown native transaction hash");return Object.assign(e,s),i.provider.waitForTransaction(r,t)};return e.wait=t,e}}async wait(e,t,n=1e3,i=5){var s=this;let r=!1;const{receipt:a}=await(void 0!==t?Promise.race([this.waitReceipt(e,n,i,(()=>r)),new Promise(((n,i)=>setTimeout((()=>{r=!0,i(`Timeout waiting for transaction receipt ${e}`)}),t)))]):this.waitReceipt(e,n,i));if(!a.txnReceipt||ks.includes(a.status))throw new Ss(a);const o=JSON.parse(a.txnReceipt);return{blockHash:o.blockHash,blockNumber:we.gH.from(o.blockNumber).toNumber(),confirmations:1,from:"string"==typeof e?void 0:Bt(e.config,e.context),hash:o.transactionHash,raw:a.txnReceipt,receipt:o,wait:async function(e){return s.provider.waitForTransaction(o.transactionHash,e)}}}}class Ss{constructor(e){this.receipt=e}}function Ns(e){return"object"==typeof e&&"function"==typeof e.simulate&&"function"==typeof e.getFeeOptions&&"function"==typeof e.gasRefundOptions&&"function"==typeof e.getNonce&&"function"==typeof e.relay&&"function"==typeof e.wait}function Os(){return Os=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Os.apply(this,arguments)}class xs extends me.l{static isSequenceSigner(e){return Rs(e)}}function Rs(e){const t=e;return t&&void 0!==t.updateConfig&&void 0!==t.publishConfig&&void 0!==t.getWalletContext&&void 0!==t.getWalletConfig}class Ms extends Error{}class Us extends me.l{signMessage(e,t){return this.signMessageWithData(e)}sendTransaction(e){throw new Error("sendTransaction method is not supported in RemoteSigner")}signTransaction(e){throw new Error("signTransaction method is not supported in RemoteSigner")}connect(e){throw new Error("connect method is not supported in RemoteSigner")}static signMessageWithData(e,t,n,i){return this.isRemoteSigner(e)?e.signMessageWithData(t,n,i):e.signMessage(t)}static isRemoteSigner(e){return void 0!==e.signMessageWithData}}async function Bs(e){return Array.isArray(e)?Promise.all(e.map((e=>ii.resolveProperties(e)))):ii.resolveProperties(e)}"object"==typeof n.g?n.g.fetch:window.fetch;class Ps extends xs{constructor(e,...t){super(),this.context=void 0,this.config=void 0,this._signers=void 0,this.provider=void 0,this.sender=void 0,this.relayer=void 0,this.chainId=void 0;const{config:n,context:i,strict:s}=e;if(this.context=Os({},i||Fi),!0===s?this.context.nonStrict=void 0:!1===s&&(this.context.nonStrict=!0),!this.context.nonStrict&&!Mt(n))throw new Error("wallet config is not usable (strict mode)");this.config=Lt(n),this._signers=t.map((e=>me.l.isSigner(e)?e:new U.Wallet(e))),this.imageHash}useConfig(e,t){return new Ps({config:e,context:this.context,strict:t},...this._signers).setProvider(this.provider,this.chainId).setRelayer(this.relayer)}useSigners(...e){return new Ps({config:this.config,context:this.context},...e).setProvider(this.provider,this.chainId).setRelayer(this.relayer)}connect(e,t){if(Vi(e))return new Ps({config:this.config,context:this.context},...this._signers).setProvider(e,this.chainId).setRelayer(t);throw new Error("Wallet provider argument is expected to be a JsonRpcProvider")}setProvider(e,t){if(void 0===e)return this;if(si.Kq.isProvider(e))this.provider=e,this.sender=new $i(e);else{const n=new zi(e,{chainId:t,blockCache:!0});this.provider=n,this.sender=new $i(n)}return this.chainId=t,this}setRelayer(e){return void 0===e||(this.relayer=e),this}async getProvider(e){return e&&await this.getChainIdNumber(e),this.provider}async getRelayer(e){return e&&await this.getChainIdNumber(e),this.relayer}async getWalletContext(){return this.context}async getWalletConfig(e){return e=await this.getChainIdNumber(e),[Os({},this.config,{chainId:e})]}async getWalletState(e){const[t,n,i]=await Promise.all([this.getAddress(),this.getChainId(),this.isDeployed()]);return[{context:this.context,config:this.config,address:t,chainId:n,deployed:i,imageHash:this.imageHash,lastImageHash:i?await Gs(this):void 0}]}get connected(){return void 0!==this.sender}get address(){return Bt(this.config,this.context)}get imageHash(){return Pt(this.config)}async getAddress(){return this.address}async getSigners(){return this._signers&&0!==this._signers.length?Promise.all(this._signers.map((e=>e.getAddress().then((e=>N.getAddress(e)))))):[]}async getChainId(){if(this.chainId)return this.chainId;if(!this.provider)throw new Error("provider is not set, first connect a provider");return this.chainId=(await this.provider.getNetwork()).chainId,this.chainId}async getNetworks(){return[{chainId:await this.getChainId(),name:"",rpcUrl:""}]}async getNonce(e,t){return this.relayer.getNonce(this.config,this.context,t,e)}async getTransactionCount(e){const t=await this.getNonce(e,0),[n,i]=Ti(t);return we.gH.from(i).toNumber()}async sendTransaction(e,t,n,i,s,r){const a=await this.signTransactions(e,t,n);return s&&s(a,pi(Bt(a.config,a.context),a.chainId,...a.transactions)),this.relayer.relay(a,i,r)}async sendTransactionBatch(e,t,n=!0,i,s,r){return this.sendTransaction(e,t,n,i,s,r)}async signTransactions(e,t,n){const i=await this.getChainIdNumber(t),s=await Bs(e);if(!this.provider)throw new Error("missing provider");if(!this.relayer)throw new Error("missing relayer");let r=await Si(this.context,this.address,s);if(r.some((e=>void 0===e.gasLimit))){const e=await this.relayer.simulate(this.address,...r);for(const t in r)void 0===r[t].gasLimit&&(r[t].gasLimit=e[t].gasLimit)}const a=bi(...r)||await this.getNonce();r=Ci(r,a);const o=ui(a,...r);return{digest:o,chainId:i,context:this.context,config:this.config,transactions:r,nonce:a,signature:await this.sign(o,!0,t,n)}}async sendSignedTransactions(e,t,n){if(!this.relayer)throw new Error("relayer is not set, first connect a relayer");return await this.getChainIdNumber(t),this.relayer.relay(e,n)}async signMessage(e,t,n,i=!1){const s="string"!=typeof e||e.startsWith("0x")?e:Ie.YW(e);return this.sign(s,i,t,n)}async signTypedData(e,t,n,i,s){const r=await this.getChainIdNumber(i),a=e.chainId?we.gH.from(e.chainId).toNumber():void 0;if(a&&a!==r)throw new Error(`signTypedData: domain.chainId (${e.chainId}) is expected to be ${r}`);const o=ze({domain:e,types:t,message:n});return this.sign(o,!0,r,s)}async _signTypedData(e,t,n,i,s){return this.signTypedData(e,t,n,i,s)}async subDigest(e,t){const n=await this.getChainIdNumber(t);return x.arrayify(Re(this.address,n,e))}async sign(e,t=!0,n,i){var s=this;const r=await this.getChainIdNumber(n),a=t?e:R.keccak256(e),o=await this.subDigest(a,n),c=async function(e,t){const n=await Promise.all(e.map((e=>e.getAddress()))),a=await Promise.all(s.config.signers.map((async function(a){try{const c=e[n.indexOf(a.address)];if(!c)return a;if(Rs(c)){if(c===s)throw Error("Can't sign transactions for self");return Os({},a,{signature:await c.signMessage(o,r,i,!0)+"03"})}if(Us.isRemoteSigner(c)){const e=await c.signMessageWithData(o,t,r);try{if(en(o,{weight:a.weight,signature:e})===a.address)return{weight:a.weight,signature:e}}catch(e){}return Os({},a,{signature:e})}return{weight:a.weight,signature:await c.signMessage(o)+"02"}}catch(e){if(i)throw e;return console.warn(`Skipped signer ${a.address}`),a}})));return{threshold:s.config.threshold,signers:a}},l=this._signers.filter((e=>!Us.isRemoteSigner(e))),h=await c(l,this.packMsgAndSig(a,[],r));if(h.signers.filter($t).reduce(((e,t)=>e+t.weight),0)>=this.config.threshold)return sn(h);const d=this._signers.filter((e=>Us.isRemoteSigner(e))),u=await c(d,this.packMsgAndSig(a,sn(h),r));return sn(tn(h,u))}async signWeight(){return(await this.getSigners()).reduce(((e,t)=>{const n=this.config.signers.find((e=>e.address===t));return n?e.add(n.weight):e}),ye.XK)}async isDeployed(e){await this.getChainIdNumber(e);const t=await this.provider.getCode(this.address);return!!t&&"0x"!==t}async updateConfig(e,t,n=!1,i,s,r,a){e||(e=this.config);const[o,c]=await Promise.all([this.buildUpdateConfigTransaction(e,n,i),null!=t?t:this.getNonce()]);return[Os({address:this.address},e),await this.sendTransaction(Ci(o,c),void 0,void 0,s,r,a)]}async publishConfig(e,t,n=[],i,s,r){return this.sendTransaction(this.config.address?this.buildPublishConfigTransaction(this.config,e,t):await this.buildPublishSignersTransaction(e,t,n),void 0,void 0,i,s,r)}async buildUpdateConfigTransaction(e,t=!1,n){var i=this;if(!this.context.nonStrict&&!Mt(e))throw new Error("wallet config is not usable (strict mode)");const s=await async function(){try{const e=await i.provider.getStorageAt(i.address,be.D.encode(["address"],[i.address]));return 0===qt(e,i.context.mainModuleUpgradable)}catch(e){return!1}}(),r=new rt.KA(m.mainModule.abi),a=2*(1e5+1800*e.signers.length),o=s?[]:[{delegateCall:!1,revertOnError:!0,gasLimit:ye.XK,to:this.address,value:ye.XK,data:r.encodeFunctionData(r.getFunction("updateImplementation"),[this.context.mainModuleUpgradable])}],c=new rt.KA(m.mainModuleUpgradable.abi),l=[...o,{delegateCall:!1,revertOnError:!0,gasLimit:ye.XK,to:this.address,value:ye.XK,data:c.encodeFunctionData(c.getFunction("updateImageHash"),[Pt(e)])},...t?await this.buildPublishConfigTransaction(e,n):[]];return 1===l.length?l:[{delegateCall:!1,revertOnError:!1,gasLimit:a,to:this.address,value:ye.XK,data:r.encodeFunctionData(r.getFunction("selfExecute"),[Ei(l)])}]}buildPublishConfigTransaction(e,t=!0,n){const i=new rt.KA(m.sequenceUtils.abi);return[{delegateCall:!1,revertOnError:!0,gasLimit:ye.XK,to:this.context.sequenceUtils,value:ye.XK,nonce:n,data:i.encodeFunctionData(i.getFunction("publishConfig"),[this.address,e.threshold,Lt(e).signers.map((e=>({weight:e.weight,signer:e.address}))),t])}]}async buildPublishSignersTransaction(e=!0,t,n=[]){var i;const s=new rt.KA(m.sequenceUtils.abi),r=new rt.KA(m.requireFreshSigner.abi),a=ri.p(32),o=await this.signMessage(a,this.chainId,!1),c=Zt(o),l=sn({threshold:c.threshold,signers:c.signers.map(((e,t)=>{if(Yt(e)){const e=this.config.signers[t];return{weight:e.weight,address:e.address}}return e}))}),h=null==(i=this.context.libs)?void 0:i.requireFreshSigner;if(n.length>0&&void 0===h)throw Error("requireFreshSigners missing library");return[...n.map((e=>({delegateCall:!1,revertOnError:!0,gasLimit:ye.XK,to:h,value:ye.XK,nonce:t,data:r.encodeFunctionData(r.getFunction("requireFreshSigner"),[e])}))),{delegateCall:!1,revertOnError:!0,gasLimit:ye.XK,to:this.context.sequenceUtils,value:ye.XK,nonce:t,data:s.encodeFunctionData(s.getFunction("publishInitialSigners"),[this.address,R.keccak256(a),this.config.signers.length,l,e])}]}async getChainIdNumber(e){if(!e)return await this.getChainId();const t=Oi(e);if(this.context.nonStrict)return t;const n=await this.getChainId();if(n!==t)throw new Error(`the specified chainId ${t} does not match the wallet's connected chainId ${n}`);return n}packMsgAndSig(e,t,n){return be.D.encode(["address","uint256","bytes","bytes"],[this.address,n,e,t])}signTransaction(e){throw new Error("signTransaction method is not supported in Wallet, please use signTransactions(...)")}static async singleOwner(e,t){const n=me.l.isSigner(e)?e:new U.Wallet(e),i={threshold:1,signers:[{weight:1,address:N.getAddress(await n.getAddress())}]};return new Ps({config:i,context:t},n)}async hasEnoughSigners(e){return e&&await this.getChainIdNumber(e),(await this.signWeight()).gte(this.config.threshold)}}class Ls extends xs{constructor(e,...t){super(),this.options=void 0,this._wallets=void 0,this._signers=void 0,this.provider=void 0,this._chainId=void 0,this.options=e,this._signers=t,e.context||(this.options.context=Os({},Fi)),this.options.networks?this.setNetworks(this.options.networks):this.setNetworks([...Gi])}useSigners(...e){return this._signers=e,this._wallets.forEach((t=>{t.wallet=t.wallet.useSigners(...e)})),this}async getWalletContext(){return this.options.context}getConfigFinder(){return this.options.configFinder?this.options.configFinder:new Vt(this.authWallet().wallet.provider)}async getWalletConfig(e){let t=[];if(e){const n=this.getWalletByNetwork(e);n&&t.push(n)}else t=this._wallets;return(await Promise.all(t.map((e=>e.wallet.getWalletConfig())))).flat()}async getWalletState(e){let t=[];if(e){const n=this.getWalletByNetwork(e);n&&t.push(n)}else t=this._wallets;const n=Promise.all(t.map((e=>this.getConfigFinder().findCurrentConfig({address:e.wallet.address,provider:e.wallet.provider,context:e.wallet.context,knownConfigs:[e.wallet.config]})))),i=(await Promise.all(t.map((e=>e.wallet.getWalletState())))).flat(),s=i.findIndex((e=>e.chainId===this.getAuthChainId()));s>=0&&(i[s].config=await this.currentConfig(t[s].wallet));const r=await n;return i.map(((e,t)=>{var n;return Os({},e,{config:null==(n=r[t])?void 0:n.config})}))}get address(){return this._wallets[0].wallet.address}getAddress(){return this._wallets[0].wallet.getAddress()}async getSigners(){return this._wallets[0].wallet.getSigners()}async getProvider(e){var t,n;return e?null==(n=this._wallets.find((t=>t.network.chainId===e)))?void 0:n.wallet.getProvider():null==(t=this.mainWallet())?void 0:t.wallet.getProvider()}async getRelayer(e){var t,n;return e?null==(n=this._wallets.find((t=>t.network.chainId===e)))?void 0:n.wallet.getRelayer():null==(t=this.mainWallet())?void 0:t.wallet.getRelayer()}async getNetworks(){return this.options.networks}async getChainId(){if(this._chainId)return this._chainId;const e=await this.provider.getNetwork();return this._chainId=e.chainId,this._chainId}getAuthChainId(){try{return this.options.networks.find((e=>e.isAuthChain)).chainId}catch(e){throw new Error("no auth network")}}async signMessage(e,t,n=!0,i=!1){var s=this;let{wallet:r}=await async function(){if(!t)return s.mainWallet();if(t.address){const e=await t.getChainId();return s.getWalletByNetwork(e)}return s.getWalletByNetwork(t)}(),a=await this.currentConfig(r);a=a||this._wallets[0].wallet.config,r=r.useConfig(a);const o=await r.signWeight();if(o.lt(r.config.threshold)&&!1!==n)throw new Ms(`Sign message - wallet combined weight ${o.toString()} below required ${r.config.threshold.toString()}`);return r.signMessage(e,void 0,n,i)}async signAuthMessage(e,t=!0,n=!1){var i;return this.signMessage(e,null==(i=this.authWallet())?void 0:i.wallet,t,n)}async signTypedData(e,t,n,i,s=!0){const r=i?this.getWalletByNetwork(i).wallet:this.mainWallet().wallet,a=ze({domain:e,types:t,message:n});return this.signMessage(a,r,s,!0)}async _signTypedData(e,t,n,i,s=!0){return this.signTypedData(e,t,n,i,s)}async hasEnoughSigners(e){const t=e?this.getWalletByNetwork(e).wallet:this.mainWallet().wallet,n=await this.currentConfig(t);return t.useConfig(n).hasEnoughSigners()}async getFeeOptions(e,t,n=!0){const i=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,s=this.options.context;if(!s)throw new Error("missing wallet context");const[r,a]=await Promise.all([this.currentConfig(i),this.prependConfigUpdate(e,t,n,!0)]);if(!r)throw new Error(`missing current config for chain ${t}`);const o=await Si(s,this.address,a);return i.relayer.getFeeOptions(r,s,...o)}async sendTransaction(e,t,n=!0,i,s){const r=await this.signTransactions(e,t,n);return s&&s(r,pi(Bt(r.config,r.context),r.chainId,...r.transactions)),(t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet).sendSignedTransactions(r,t,i)}async sendTransactionBatch(e,t,n=!0,i,s){return this.sendTransaction(e,t,n,i,s)}async signTransactions(e,t,n){const i=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet;let s=await this.currentConfig(i);if(!s&&(s=await this.currentConfig(),!s))throw new Error("missing auth chain config");const r=await this.prependConfigUpdate(e,t,n);return i.useConfig(s).signTransactions(r)}async prependConfigUpdate(e,t,n,i){const s=await Bs(e),r=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,[a,o]=await Promise.all([this.currentConfig(r),this.currentConfig()]);if(!i){const e=await r.useConfig(a).signWeight();if(e.lt(a.threshold)&&n)throw new Ms(`wallet combined weight ${e.toString()} below required threshold ${a.threshold.toString()}`)}if(await r.isDeployed()&&Dt(o,a))return s;const c=Array.isArray(s)?s:[s];return[...await r.buildUpdateConfigTransaction(o,!1),...c]}async sendSignedTransactions(e,t,n){return(t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet).sendSignedTransactions(e,void 0,n)}async updateConfig(e,t,n,i){const s=this.authWallet().wallet;if(e=e?Lt(e):s.config,Dt(s.config,e)&&!await this.isDeployed())return await s.updateConfig(e,void 0,!0,t,n,i);const r=await this.currentConfig();if(Dt(r,e))return[Os({},r,{address:this.address}),void 0];const[a,o]=await s.useConfig(r).updateConfig(e,void 0,!0,t,n,i);return[Os({},e,{address:this.address}),o]}publishConfig(e,t=[],n,i){return this.authWallet().wallet.publishConfig(e,void 0,t,n,i)}async isDeployed(e){return(()=>e?e.address?e:this.getWalletByNetwork(e).wallet:this.authWallet().wallet)().isDeployed()}async currentConfig(e){const t=(()=>e?e.address?e:this.getWalletByNetwork(e).wallet:this.authWallet().wallet)();return(await this.getConfigFinder().findCurrentConfig({address:this.address,provider:t.provider,context:t.context,knownConfigs:[t.config]})).config}getWallets(){return this._wallets}getWalletByNetwork(e){const t=Oi(e),n=this._wallets.find((e=>e.network.chainId===t));if(!n)throw new Error(`network ${e} not found in wallets list`);return n}mainWallet(){const e=this._wallets.find((e=>e.network.isDefaultChain));if(!e)throw new Error("mainWallet not found");return e}authWallet(){const e=this._wallets.find((e=>e.network.isAuthChain));if(!e)throw new Error("authChain wallet not found");return e}setNetworks(e,t=[],n){let i=[];if(this._chainId=void 0,n){const s=parseInt(n),r=e.find((e=>e.name===n||e.chainId===s)),a=t.find((e=>e.name===n||e.chainId===s));if(!r&&!a)throw new Error(`unable to set default network as chain '${n}' does not exist`);r?(e.forEach((e=>e.isDefaultChain=!1)),r.isDefaultChain=!0,i=e):a&&(t.forEach((e=>e.isDefaultChain=!1)),a.isDefaultChain=!0,i=t)}else i=e;return this.options.networks=xi(Mi(i)),this._wallets=this.options.networks.map((e=>{const t=new Ps({config:this.options.initialConfig,context:this.options.context},...this._signers);if(e.provider)t.setProvider(e.provider,e.chainId);else{if(!e.rpcUrl||""===e.rpcUrl)throw new Error(`network config is missing provider settings for chainId ${e.chainId}`);t.setProvider(e.rpcUrl,e.chainId)}if(Ns(e.relayer))t.setRelayer(e.relayer);else{if(!As(e.relayer))throw new Error(`network config is missing relayer settings for chainId ${e.chainId}`);t.setRelayer(new _s(Os({provider:t.provider},e.relayer)))}return e.isDefaultChain&&(this._chainId=e.chainId,this.provider=t.provider),{network:e,wallet:t}})),this.options.networks.find((e=>e.isDefaultChain)).chainId}connect(e){throw new Error("connect method is not supported in MultiWallet")}signTransaction(e){throw new Error("signTransaction method is not supported in MultiWallet, please use signTransactions(...)")}}async function Ds(e,t,n,i,s,r){if(function(e,t,n){try{return 0===qt(Ce.recoverAddress(t,x.splitSignature(n)),e)}catch(e){return!1}}(e,t,n)||function(e,t,n){try{const i=R.keccak256(ve.pack(["string","bytes32"],["Ethereum Signed Message:\n32",t]));return 0===qt(Ce.recoverAddress(i,x.splitSignature(n)),e)}catch(e){return!1}}(e,t,n))return!0;const a=await async function(e,t,n,i){if(i)try{if("0x"===await i.getCode(e))return;const s=new O.NZ(e,m.erc1271.abi,i),r=await s.isValidSignature(t,n);return m.erc1271.returns.isValidSignatureBytes32===r}catch(e){return!1}}(e,t,n,i);return void 0===a?!!await qs(e,t,n,s,i,r):a}async function qs(e,t,n,i,s,r){if((s||r)&&i)try{const a=r||(await s.getNetwork()).chainId,o=Zt(n),c=x.arrayify(R.keccak256(xe(e,a,t))),l=await Fs(c,o,s,i,r,!0),h=o.signers.reduce(((e,t)=>Kt(t)||Yt(t)?e+t.weight:e),0);return 0===qt(Bt(l,i),e)&&h>=o.threshold}catch(e){return!1}}const Gs=async e=>{const t=await e.getAddress(),n=new O.NZ(t,m.mainModuleUpgradable.abi,await e.getProvider()),i=await n.functions.imageHash.call([]).catch((()=>[]));return i&&i.length>0?i[0]:""},Fs=async(e,t,n,i,s,r)=>{const a=void 0!==t.threshold?t:Zt(t),o=await Promise.all(a.signers.map((async t=>{if(Kt(t))return{weight:t.weight,address:en(e,t)};if(jt(t))return{weight:t.weight,address:N.getAddress(t.address)};if(Yt(t)){if(r&&!await Ds(t.address,x.arrayify(e),x.hexlify(t.signature),n,i,s))throw Error("Invalid signature");return{weight:t.weight,address:t.address}}throw Error("Uknown signature type")})));return{threshold:a.threshold,signers:o}};function Ws(){return Ws=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ws.apply(this,arguments)}const Hs=604800,Vs=3e7;class js{constructor(e,t,n,i,s,r,a,o,c){var l;this.sequenceApiUrl=e,this.sequenceMetadataUrl=t,this.networks=n,this.config=i,this.context=s,this.account=r,this.metadata=a,this.authProvider=o,this._initialAuthRequest=void 0,this._jwt=void 0,this.proofStrings=new Map,this.onAuthCallbacks=[],this.apiClient=void 0,this.metadataClient=void 0,this.indexerClients=new Map,c&&(this._jwt={token:Promise.resolve(c.token),expiration:null!=(l=c.expiration)?l:Ks(c.token)})}get name(){return this.metadata.name}get expiration(){return this.metadata.expiration?Math.max(this.metadata.expiration,120):Hs}onAuth(e){this.onAuthCallbacks.push(e)}setAccount(e){this.account=e}setConfig(e){this.config=e}async auth(e=5){const t=this.sequenceApiUrl;if(!t)throw Error("No sequence api url");let n;for(let t=0;;t++)try{n=(await this.getJWT(!0)).token;break}catch(n){if(t===e-1)throw console.error(`couldn't authenticate after ${e} attempts`,n),n}return new S(t,n)}get isTestnetMode(){if(this.networks&&0!==this.networks.length)return!!this.networks[0].testnet}async getAPIClient(e=!0){if(!this.apiClient){const t=this.sequenceApiUrl;if(!t)throw Error("No chaind url");const n=(await this.getJWT(e)).token;this.apiClient=new S(t,n)}return this.apiClient}getMetadataClient(){return this.metadataClient||(this.metadataClient=new Ln(this.sequenceMetadataUrl)),this.metadataClient}async getIndexerClient(e){const t=((e,t)=>{if("string"==typeof t){if(t.startsWith("0x")){const n=we.gH.from(t).toNumber();return e.find((e=>e.chainId===n))}return e.find((e=>e.name===t))}return"number"==typeof t?e.find((e=>e.chainId===t)):t.chainId?e.find((e=>e.chainId===t.chainId)):void 0})(this.networks,e);if(!t)throw Error(`No network for chain ${e}`);if(!this.indexerClients.has(t.chainId))if(t.indexer)this.indexerClients.set(t.chainId,t.indexer);else{if(!t.indexerUrl)throw Error(`No indexer url for chain ${e}`);this.indexerClients.set(t.chainId,new kn(t.indexerUrl))}return this.indexerClients.get(t.chainId)}async getJWT(e){var t=this;const n=this.sequenceApiUrl;if(!n)throw Error("No chaind url");if(this._jwt){const e=this._jwt,t=await e.token;if(this.now()<e.expiration)return{token:t,expiration:e.expiration};this._jwt=void 0}if(!e)throw new Error("no auth token in memory");const i=this.getProofStringKey(),{proofString:s,expiration:r}=this.getProofString(i),a={token:s.then((async function(e){const s=new S(n),r=await s.getAuthToken({ewtString:e,testnetMode:t.isTestnetMode});if(!0===(null==r?void 0:r.status)&&0!==r.jwtToken.length)return r.jwtToken;throw await t.isProofStringValid(e)||t.proofStrings.delete(i),new Error("no auth token from server")})).catch((e=>{throw this._jwt=void 0,e})),expiration:r};return this._jwt=a,a.token.then((()=>{this.onAuthCallbacks.forEach((e=>{try{e({status:"fulfilled",value:void 0})}catch(e){}}))})).catch((e=>{this.onAuthCallbacks.forEach((t=>{try{t({status:"rejected",reason:e})}catch(e){}}))})),{token:await a.token,expiration:r}}getProofString(e){if(this.proofStrings.has(e)){const t=this.proofStrings.get(e);if(this.now()<t.expiration)return t;this.proofStrings.delete(e)}const t=new oe({address:this.account.address});t.claims.app=this.name,"object"==typeof window&&(t.claims.ogn=window.location.origin),t.setExpiryIn(this.expiration);const n=new fe,i=new Vt(this.authProvider),s=this.account.authWallet(),r=this.now()+this.expiration-60,a={proofString:i.findCurrentConfig({address:s.wallet.address,provider:this.authProvider,context:s.wallet.context,knownConfigs:[s.wallet.config]}).then((e=>{if(!e.config)throw Error("Can't find latest config");return s.wallet.useConfig(e.config).sign(t.messageDigest()).then((e=>{const i=Zt(e),s=i.signers.filter($t).reduce(((e,t)=>e+t.weight),0);if(s<i.threshold)throw Error(`insufficient signing power, need ${i.threshold}, have ${s}`);return t.signature=e,n.encodeProof(t,!0)}))})).catch((t=>{throw this.proofStrings.delete(e),t})),expiration:r};return this.proofStrings.set(e,a),a}getProofStringKey(){return`${this.account.address} - ${this.name}`}async isProofStringValid(e){try{const t=new fe;return t.provider=this.authProvider,await t.decodeProof(e),!0}catch(e){return!1}}async dump(){let e;if(this._jwt)try{const t=this._jwt.expiration;e={token:await this._jwt.token,expiration:t}}catch(e){}return{config:this.config,context:this.context,metadata:this.metadata,jwt:e}}now(){return Math.floor((new Date).getTime()/1e3)}static async open(e){const{sequenceApiUrl:t,sequenceMetadataUrl:n,context:i,networks:s,referenceSigner:r,signers:a,threshold:o,deepSearch:c,knownConfigs:l,noIndex:h,metadata:d}=e,u=$s(s),p=e.configFinder?e.configFinder:new Vt(u),g=Promise.all(a.map((async function(e){return Ws({},e,{address:"string"==typeof e.signer?e.signer:await e.signer.getAddress()})}))),f=a.filter((e=>"string"!=typeof e.signer)).map((e=>e.signer)),m=(await p.findLastWalletOfInitialSigner({signer:r,context:i,provider:u,requireIndex:!c})).wallet;if(m){const e=(await p.findCurrentConfig({address:m,provider:u,context:i,knownConfigs:l})).config;if(!e)throw Error("Wallet config not found");const r=new Ls({initialConfig:e,networks:s,context:i},...f),a=new js(t,n,s,e,i,r,d,u),[c]=await r.updateConfig(Gt(e,{threshold:o,set:await g}),!h);return a.setConfig(c),a.setAccount(new Ls({initialConfig:c,networks:s,context:i},...f)),a._initialAuthRequest=t?a.auth():Promise.reject("no sequence api url"),a}{const e=Ft(o,await g),a=new Ls({initialConfig:e,networks:s,context:i},...f);await a.publishConfig(!h,[r]);const c=new js(t,n,s,e,i,a,d,u);return c._initialAuthRequest=t?c.auth():Promise.reject("no sequence api url"),c}}static load(e){const{sequenceApiUrl:t,sequenceMetadataUrl:n,dump:i,signers:s,networks:r}=e;return new js(t,n,r,i.config,i.context,new Ls({initialConfig:i.config,context:i.context,networks:r},...s),i.metadata,$s(r),i.jwt)}}function $s(e){var t;const n=(e=>e.find((e=>e.isAuthChain)))(e);if(!n)throw Error("Auth chain not found");return null!=(t=n.provider)?t:new ti(n.rpcUrl,{chainId:n.chainId,blockCache:!0})}function Ks(e){return Be(e).exp}const Js=async(e,t)=>{const n=await e.getChainId(),i=N.getAddress(await e.getAddress());if(!i||""===i||"0x"===i)throw zs;const s=new oe;if(s.address=i,!t||!t.app||""===t.app)throw new Ys("authorization options requires app to be set");s.claims.app=t.app,s.claims.ogn=t.origin,s.setExpiryIn(t.expiry?Math.max(t.expiry,200):Hs);const r=s.messageTypedData();s.signature=await e.signTypedData(r.domain,r.types,r.message,n);const a=new fe;return{typedData:r,proofString:await a.encodeProof(s,!0)}};class Ys extends Error{constructor(e){super(e),this.name="AuthError"}}const zs=new Ys("auth error: account address is empty"),Zs=async(e,t,n)=>{if(!e||void 0===e||void 0===t)return{isValid:!1};const i=n.messageDigest(),s=await e.getCode(n.address);if("0x"===s||s.length<=2)throw new Error("ValidateSequenceDeployedWalletProof failed. unable to fetch wallet contract code");const r=new O.NZ(n.address,["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],e);return await r.isValidSignature(i,x.arrayify(n.signature))===de?{isValid:!0}:{isValid:!1}},Xs=e=>async(t,n,i)=>{if(!t||void 0===t||void 0===n)return{isValid:!1};if(0!==x.arrayify(await t.getCode(i.address)).length)return{isValid:!1};const s=i.messageDigest(),r=x.arrayify(R.keccak256(s));return{isValid:!!await qs(i.address,r,i.signature,e||Kn,t,n)}};function Qs(){return Qs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Qs.apply(this,arguments)}function er(e){return e&&void 0!==e.chainId&&void 0!==e.name&&void 0!==e.rpcUrl&&void 0!==e.relayer}const tr=e=>"number"==typeof e?e:e.chainId?e.chainId:we.gH.from(e).toNumber(),nr=e=>{if(e)return tr(e)},ir=e=>e.find((e=>e.isAuthChain)),sr=(e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const a=i.map((e=>e.name)).sort(),o=a.filter(((e,t)=>a.indexOf(e)!==t));if(o.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${o}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l){if(t)throw new Error("invalid network config: AuthChain must be set");return!1}return!0},rr=(e,t=!1)=>(sr(e,!0,t),e),ar=(e,t=!0)=>{const n=e.map((e=>e.chainId)).sort(),i=n.filter(((e,t)=>n.indexOf(e)!==t));if(i.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${i}`);return!1}return!0},or=(e,t)=>{if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}},cr=e=>rr(ur(e)),lr=(e,t)=>{if("string"==typeof t){if(t.startsWith("0x")){const n=we.gH.from(t).toNumber();return e.find((e=>e.chainId===n))}return e.find((e=>e.name===t))}return"number"==typeof t?e.find((e=>e.chainId===t)):t.chainId?e.find((e=>e.chainId===t.chainId)):void 0},hr=(e,t)=>!!e&&(e.name===t||e.chainId===t),dr=e=>{const t={};for(let n=0;n<e.length;n++)t[e[n].name]=e[n];return t},ur=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},pr=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let gr;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(gr||(gr={}));const fr=e=>pr("https://${network}-indexer.sequence.app",{network:e}),mr=e=>pr("https://${network}-relayer.sequence.app",{network:e}),wr=e=>pr("https://nodes.sequence.app/${network}",{network:e}),yr={[gr.MAINNET]:{chainId:gr.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[gr.ROPSTEN]:{chainId:gr.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[gr.RINKEBY]:{chainId:gr.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[gr.GOERLI]:{chainId:gr.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[gr.KOVAN]:{chainId:gr.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[gr.POLYGON]:{chainId:gr.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[gr.POLYGON_MUMBAI]:{chainId:gr.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[gr.POLYGON_ZKEVM]:{chainId:gr.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[gr.BSC]:{chainId:gr.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[gr.BSC_TESTNET]:{chainId:gr.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[gr.OPTIMISM]:{chainId:gr.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[gr.OPTIMISM_TESTNET]:{chainId:gr.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[gr.ARBITRUM]:{chainId:gr.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[gr.ARBITRUM_GOERLI]:{chainId:gr.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[gr.ARBITRUM_NOVA]:{chainId:gr.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[gr.AVALANCHE]:{chainId:gr.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[gr.AVALANCHE_TESTNET]:{chainId:gr.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[gr.FANTOM]:{chainId:gr.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[gr.FANTOM_TESTNET]:{chainId:gr.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[gr.GNOSIS]:{chainId:gr.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[gr.AURORA]:{chainId:gr.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[gr.AURORA_TESTNET]:{chainId:gr.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[gr.BASE_GOERLI]:{chainId:gr.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},vr=cr([Qs({},yr[gr.MAINNET],{rpcUrl:wr("mainnet"),relayer:{url:mr("mainnet")},indexerUrl:fr("mainnet")}),Qs({},yr[gr.POLYGON],{rpcUrl:wr("polygon"),relayer:{url:mr("polygon")},indexerUrl:fr("polygon"),isDefaultChain:!0,isAuthChain:!0}),Qs({},yr[gr.BSC],{rpcUrl:wr("bsc"),indexerUrl:fr("bsc"),relayer:{url:mr("bsc")}}),Qs({},yr[gr.AVALANCHE],{rpcUrl:wr("avalanche"),indexerUrl:fr("avalanche"),relayer:{url:mr("avalanche")}}),Qs({},yr[gr.ARBITRUM],{rpcUrl:wr("arbitrum"),indexerUrl:fr("arbitrum"),relayer:{url:mr("arbitrum")}}),Qs({},yr[gr.ARBITRUM_NOVA],{rpcUrl:wr("arbitrum-nova"),indexerUrl:fr("arbitrum-nova"),relayer:{url:mr("arbitrum-nova")}}),Qs({},yr[gr.OPTIMISM],{rpcUrl:wr("optimism"),indexerUrl:fr("optimism"),relayer:{url:mr("optimism")}}),Qs({},yr[gr.POLYGON_ZKEVM],{rpcUrl:wr("polygon-zkevm"),indexerUrl:fr("polygon-zkevm"),relayer:{url:mr("polygon-zkevm")}}),Qs({},yr[gr.GNOSIS],{rpcUrl:wr("gnosis"),indexerUrl:fr("gnosis"),relayer:{url:mr("gnosis")}})]),br=cr([Qs({},yr[gr.RINKEBY],{rpcUrl:wr("rinkeby"),relayer:{url:mr("rinkeby")},indexerUrl:fr("rinkeby")}),Qs({},yr[gr.GOERLI],{rpcUrl:wr("goerli"),relayer:{url:mr("goerli")},indexerUrl:fr("goerli")}),Qs({},yr[gr.POLYGON_MUMBAI],{rpcUrl:wr("mumbai"),relayer:{url:mr("mumbai")},indexerUrl:fr("mumbai"),isDefaultChain:!0,isAuthChain:!0}),Qs({},yr[gr.BSC_TESTNET],{rpcUrl:wr("bsc-testnet"),relayer:{url:mr("bsc-testnet")},indexerUrl:fr("bsc-testnet")}),Qs({},yr[gr.ARBITRUM_GOERLI],{rpcUrl:wr("arbitrum-goerli"),relayer:{url:mr("arbitrum-goerli")},indexerUrl:fr("arbitrum-goerli")}),Qs({},yr[gr.BASE_GOERLI],{rpcUrl:wr("base-goerli"),relayer:{url:mr("base-goerli")},indexerUrl:fr("base-goerli")})]),Er={factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}},Cr="2.0";class Ir{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=kr(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const kr=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};function Ar(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}function Tr(e){return void 0!==e&&void 0!==e.sendAsync}let _r=0;class Sr{constructor(e,t){this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,Ar(e)?this.send=e.send.bind(e):Tr(e)?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:Cr,id:++_r,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class Nr{constructor(e){this.provider=e,this.sendAsync=(e,t)=>{this.provider.send(e.method,e.params).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.send=this.sendAsync}}class Or{constructor(e){this.sendAsyncMiddleware=void 0,this.isAllowedFunc=void 0,this.isAllowedFunc=e||(e=>!0),this.sendAsyncMiddleware=xr(this.isAllowedFunc)}setIsAllowedFunc(e){this.isAllowedFunc=e,this.sendAsyncMiddleware=xr(this.isAllowedFunc)}}const xr=e=>t=>(n,i,s)=>{if(!e(n))throw new Error("allowProvider middleware precondition is unmet.");t(n,i,s)};class Rr{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class Mr{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}const Ur=e=>(t,n,i)=>{e(t,((e,t)=>{if(!e&&t&&t.error)throw"string"==typeof t.error?new Error(t.error):new Error(t.error.message);n(e,t)}),i)},Br=e=>(t,n,i)=>{const s=i?` chainId:${i}`:"";qe.info(`[provider request]${s} id:${t.id} method:${t.method} params:`,t.params),e(t,((e,i)=>{e?qe.warn(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"error:",e):qe.info(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"response:",i),n(e,i)}),i)},Pr=e=>t=>(n,i,s)=>{const r=e(n),{id:a,method:o}=n;switch(o){case"net_version":return void i(void 0,{jsonrpc:"2.0",id:a,result:`${r}`});case"eth_chainId":return void i(void 0,{jsonrpc:"2.0",id:a,result:x.hexlify(r)})}t(n,i,s)},Lr=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];class Dr{constructor(e){this.provider=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{Lr.includes(t.method)?this.provider.sendAsync(t,n,i):e(t,n,i)},this.provider=e}}class qr{constructor(e){this.privateJsonRpcMethods=["net_version","eth_chainId","eth_accounts",...Lr],this.provider=void 0,this.rpcUrl=void 0,this.sendAsyncMiddleware=e=>(t,n)=>{!this.provider||this.privateJsonRpcMethods.includes(t.method)?(qe.debug("[public-provider] sending request to signer window",t.method),e(t,n)):this.provider.send(t.method,t.params).then((e=>{n(void 0,{jsonrpc:"2.0",id:t.id,result:e})})).catch((e=>n(e)))},e&&this.setRpcUrl(e)}getRpcUrl(){return this.rpcUrl}setRpcUrl(e){e&&""!==e?(this.rpcUrl=e,this.provider=new B.F(e)):(this.rpcUrl=void 0,this.provider=void 0)}}class Gr{constructor(){this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(!this.singleflightJsonRpcMethods.includes(t.method))return void e(t,n,i);const s=this.requestKey(t.method,t.params||[],i);this.inflight[s]?this.inflight[s].push({id:t.id,callback:n}):(this.inflight[s]=[],e(t,((e,t,i)=>{n(e,t);for(let n=0;n<this.inflight[s].length;n++){const i=this.inflight[s][n];e?i.callback(e,t):t&&i.callback(void 0,{jsonrpc:"2.0",id:i.id,result:t.result})}delete this.inflight[s]}),i))},this.requestKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.inflight={}}}class Fr extends B.F{constructor(e,t){super(e,null==t?void 0:t.chainId),this._chainId=void 0,this._sender=void 0,this.send=(e,t)=>this._sender.send(e,t),this.fetch=(e,t)=>{const n={method:e,params:t,id:this._nextId++,jsonrpc:"2.0"};return ot.fetchJson(this.connection,JSON.stringify(n),Wr).then((e=>e),(e=>{throw e}))};const n=null==t?void 0:t.chainId,i=null==t?void 0:t.middlewares,s=null==t?void 0:t.blockCache;this._chainId=n;const r=new Ir(null!=i?i:[new Mr({chainId:n}),new Gr,new Rr({defaultChainId:n,blockCache:s})],new Sr(this.fetch,n));this._sender=new Sr(r,n)}async getNetwork(){const e=this._chainId;if(e){const t=yr[e];return{name:(null==t?void 0:t.name)||"",chainId:e,ensAddress:null==t?void 0:t.ensAddress}}{const e=await this.send("eth_chainId",[]);return this._chainId=we.gH.from(e).toNumber(),this.getNetwork()}}}function Wr(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}var Hr=n(39902),Vr=n(39039);function jr(){return jr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},jr.apply(this,arguments)}const $r=e=>{if(e)return(e=>"number"==typeof e?e:e.chainId?e.chainId:we.gH.from(e).toNumber())(e)},Kr=(e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const a=i.map((e=>e.name)).sort(),o=a.filter(((e,t)=>a.indexOf(e)!==t));if(o.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${o}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l){if(t)throw new Error("invalid network config: AuthChain must be set")}})(e,!0,t),e),Jr=e=>Kr(zr(e)),Yr=(e,t)=>{if("string"==typeof t){if(t.startsWith("0x")){const n=we.gH.from(t).toNumber();return e.find((e=>e.chainId===n))}return e.find((e=>e.name===t))}return"number"==typeof t?e.find((e=>e.chainId===t)):t.chainId?e.find((e=>e.chainId===t.chainId)):void 0},zr=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},Zr=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let Xr;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(Xr||(Xr={}));const Qr=e=>Zr("https://${network}-indexer.sequence.app",{network:e}),ea=e=>Zr("https://${network}-relayer.sequence.app",{network:e}),ta=e=>Zr("https://nodes.sequence.app/${network}",{network:e}),na={[Xr.MAINNET]:{chainId:Xr.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Xr.ROPSTEN]:{chainId:Xr.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Xr.RINKEBY]:{chainId:Xr.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[Xr.GOERLI]:{chainId:Xr.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Xr.KOVAN]:{chainId:Xr.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[Xr.POLYGON]:{chainId:Xr.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[Xr.POLYGON_MUMBAI]:{chainId:Xr.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[Xr.POLYGON_ZKEVM]:{chainId:Xr.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[Xr.BSC]:{chainId:Xr.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[Xr.BSC_TESTNET]:{chainId:Xr.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[Xr.OPTIMISM]:{chainId:Xr.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[Xr.OPTIMISM_TESTNET]:{chainId:Xr.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[Xr.ARBITRUM]:{chainId:Xr.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[Xr.ARBITRUM_GOERLI]:{chainId:Xr.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[Xr.ARBITRUM_NOVA]:{chainId:Xr.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[Xr.AVALANCHE]:{chainId:Xr.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[Xr.AVALANCHE_TESTNET]:{chainId:Xr.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[Xr.FANTOM]:{chainId:Xr.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[Xr.FANTOM_TESTNET]:{chainId:Xr.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[Xr.GNOSIS]:{chainId:Xr.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[Xr.AURORA]:{chainId:Xr.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[Xr.AURORA_TESTNET]:{chainId:Xr.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[Xr.BASE_GOERLI]:{chainId:Xr.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}};Jr([jr({},na[Xr.MAINNET],{rpcUrl:ta("mainnet"),relayer:{url:ea("mainnet")},indexerUrl:Qr("mainnet")}),jr({},na[Xr.POLYGON],{rpcUrl:ta("polygon"),relayer:{url:ea("polygon")},indexerUrl:Qr("polygon"),isDefaultChain:!0,isAuthChain:!0}),jr({},na[Xr.BSC],{rpcUrl:ta("bsc"),indexerUrl:Qr("bsc"),relayer:{url:ea("bsc")}}),jr({},na[Xr.AVALANCHE],{rpcUrl:ta("avalanche"),indexerUrl:Qr("avalanche"),relayer:{url:ea("avalanche")}}),jr({},na[Xr.ARBITRUM],{rpcUrl:ta("arbitrum"),indexerUrl:Qr("arbitrum"),relayer:{url:ea("arbitrum")}}),jr({},na[Xr.ARBITRUM_NOVA],{rpcUrl:ta("arbitrum-nova"),indexerUrl:Qr("arbitrum-nova"),relayer:{url:ea("arbitrum-nova")}}),jr({},na[Xr.OPTIMISM],{rpcUrl:ta("optimism"),indexerUrl:Qr("optimism"),relayer:{url:ea("optimism")}}),jr({},na[Xr.POLYGON_ZKEVM],{rpcUrl:ta("polygon-zkevm"),indexerUrl:Qr("polygon-zkevm"),relayer:{url:ea("polygon-zkevm")}}),jr({},na[Xr.GNOSIS],{rpcUrl:ta("gnosis"),indexerUrl:Qr("gnosis"),relayer:{url:ea("gnosis")}})]),Jr([jr({},na[Xr.RINKEBY],{rpcUrl:ta("rinkeby"),relayer:{url:ea("rinkeby")},indexerUrl:Qr("rinkeby")}),jr({},na[Xr.GOERLI],{rpcUrl:ta("goerli"),relayer:{url:ea("goerli")},indexerUrl:Qr("goerli")}),jr({},na[Xr.POLYGON_MUMBAI],{rpcUrl:ta("mumbai"),relayer:{url:ea("mumbai")},indexerUrl:Qr("mumbai"),isDefaultChain:!0,isAuthChain:!0}),jr({},na[Xr.BSC_TESTNET],{rpcUrl:ta("bsc-testnet"),relayer:{url:ea("bsc-testnet")},indexerUrl:Qr("bsc-testnet")}),jr({},na[Xr.ARBITRUM_GOERLI],{rpcUrl:ta("arbitrum-goerli"),relayer:{url:ea("arbitrum-goerli")},indexerUrl:Qr("arbitrum-goerli")}),jr({},na[Xr.BASE_GOERLI],{rpcUrl:ta("base-goerli"),relayer:{url:ea("base-goerli")},indexerUrl:Qr("base-goerli")})]);class ia{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=sa(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const sa=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};let ra=0;class aa{constructor(e,t){var n;this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,void 0!==(n=e)&&void 0!==n.send&&void 0!==n.constructor.defaultUrl&&void 0!==n.detectNetwork&&void 0!==n.getSigner&&void 0!==n.perform?this.send=e.send.bind(e):function(e){return void 0!==e&&void 0!==e.sendAsync}(e)?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:"2.0",id:++ra,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class oa{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class ca{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}const la=e=>(t,n,i)=>{e(t,((e,t)=>{if(!e&&t&&t.error)throw"string"==typeof t.error?new Error(t.error):new Error(t.error.message);n(e,t)}),i)},ha=e=>(t,n,i)=>{const s=i?` chainId:${i}`:"";qe.info(`[provider request]${s} id:${t.id} method:${t.method} params:`,t.params),e(t,((e,i)=>{e?qe.warn(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"error:",e):qe.info(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"response:",i),n(e,i)}),i)},da=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];class ua{constructor(e){this.provider=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{da.includes(t.method)?this.provider.sendAsync(t,n,i):e(t,n,i)},this.provider=e}}function pa(){return pa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},pa.apply(this,arguments)}B.F;class ga extends URLSearchParams{static new(e){return new URLSearchParams(e)}}let fa,ma,wa;!function(e){e.OPEN="open",e.CLOSE="close",e.MESSAGE="message",e.CONNECT="connect",e.DISCONNECT="disconnect",e.ACCOUNTS_CHANGED="accountsChanged",e.CHAIN_CHANGED="chainChanged",e.NETWORKS="networks",e.WALLET_CONTEXT="walletContext",e.INIT="init",e.DEBUG="_debug"}(fa||(fa={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.OPENING=1]="OPENING",e[e.OPENED=2]="OPENED"}(ma||(ma={})),function(e){e[e.NIL=0]="NIL",e[e.SENT_NONCE=1]="SENT_NONCE",e[e.OK=2]="OK"}(wa||(wa={}));class ya extends Error{constructor(e){super(e),this.name="ProviderError"}}const va=new ya("Wallet is not signed in. Connect a wallet and try again."),ba=3e4;let Ea=0;const Ca=()=>++Ea;class Ia{constructor(){var e=this;this.pendingMessageRequests=[],this.responseCallbacks=new Map,this.state=void 0,this.confirmationOnly=!1,this.events=new Hr.EventEmitter2,this.openPayload=void 0,this.connectPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this._sessionId=void 0,this._init=void 0,this._registered=void 0,this.sendAsync=async function(t,n,i){e.state===ma.CLOSED&&(e.confirmationOnly=!0),e.openWallet(void 0,{type:"jsonRpcRequest",method:t.method},i);try{e.isOpened()||await e.waitUntilOpened(),n(void 0,(await e.sendMessageRequest({idx:Ca(),type:fa.MESSAGE,data:t,chainId:i})).data)}catch(e){n(e)}},this.sendMessageRequest=async function(t){return new Promise(((n,i)=>{(!t.idx||t.idx<=0)&&"init"!==t.type&&i(new Error("message idx not set"));const s=t.idx;e.responseCallbacks.get(s)?i(new Error("duplicate message idx, should never happen")):e.responseCallbacks.set(s,((e,t)=>{if(e)i(e);else{if(!t)throw new Error("no valid response to return");n(t)}})),e.isOpened()?e.sendMessage(t):(qe.debug("pushing to pending requests",t),e.pendingMessageRequests.push(t))}))},this.waitUntilOpened=async function(t=ba){let n=!1;return Promise.race([new Promise(((i,s)=>{const r=setTimeout((()=>{clearTimeout(r),n||(e.state=ma.CLOSED,e.events.emit("close",{code:1005,message:"opening wallet timed out"})),s(new Error("opening wallet timed out"))}),t)})),new Promise((t=>{var i;if(e.isOpened())return n=!0,void t(null==(i=e.openPayload)?void 0:i.session);e.events.once("open",(i=>{e.openPayload=i,n=!0,t(i.session)}))}))])},this.waitUntilConnected=async function(){await e.waitUntilOpened();const t=new Promise((t=>{e.connectPayload?t(e.connectPayload):e.events.once("connect",(n=>{e.connectPayload=n,t(n)}))})),n=new Promise(((t,n)=>{e.events.once("close",(e=>{n(e?new Error(`wallet closed due to ${JSON.stringify(e)}`):new Error("user closed the wallet"))}))}));return Promise.race([t,n])},this.state=ma.CLOSED,this._registered=!1,this._init=wa.NIL}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}openWallet(e,t,n){throw new Error("abstract method")}closeWallet(){throw new Error("abstract method")}isOpened(){return this.registered&&this.state===ma.OPENED}isConnected(){var e;const t=null==(e=this.openPayload)?void 0:e.session;return this.registered&&void 0!==t&&!!t.accountAddress&&42===t.accountAddress.length&&!!t.networks&&t.networks.length>0}handleMessage(e){var t=this;if(e.type===fa.INIT){qe.debug("MessageProvider, received INIT message",e);const{nonce:t}=e.data;if(!t||0==t.length)return void qe.error("invalid init nonce");this._init=wa.OK,this.sendMessage({idx:-1,type:fa.INIT,data:{sessionId:this._sessionId,nonce:t}})}if(this._init!==wa.OK)return;qe.debug("RECEIVED MESSAGE FROM WALLET",e.idx,e);const n=e.idx,i=this.responseCallbacks.get(n);if(n&&this.responseCallbacks.delete(n),e.type!==fa.OPEN||this.isOpened()){if(e.type===fa.MESSAGE){if(this.confirmationOnly&&setTimeout((()=>{0===this.responseCallbacks.size&&this.closeWallet()}),500),!i)throw new Error("impossible state");if(i)return this.events.emit("message",e),void i(e.data.error,e)}if(e.type===fa.ACCOUNTS_CHANGED)return this.accountsChangedPayload={accounts:[]},void(e.data&&e.data.length>0?(this.accountsChangedPayload={accounts:[N.getAddress(e.data[0])],origin:e.origin},this.events.emit("accountsChanged",this.accountsChangedPayload.accounts,this.accountsChangedPayload.origin)):this.events.emit("accountsChanged",[],e.origin));if(e.type!==fa.CHAIN_CHANGED){if(e.type===fa.NETWORKS)return this.networksPayload=e.data,void this.events.emit("networks",this.networksPayload);if(e.type===fa.WALLET_CONTEXT)return this.walletContextPayload=e.data,void this.events.emit("walletContext",this.walletContextPayload);e.type===fa.CLOSE&&this.state!==ma.CLOSED&&this.close(e.data),e.type===fa.CONNECT&&(this.connectPayload=e.data,this.events.emit("connect",this.connectPayload)),e.type===fa.DISCONNECT&&this.isConnected()&&(this.events.emit("disconnect",e.data),this.close())}else this.events.emit("chainChanged",e.data)}else{var s,r;if(this._sessionId&&this._sessionId!==(null==(s=e.data)?void 0:s.sessionId))return void qe.debug("open event received from wallet, but does not match sessionId",this._sessionId);if(null!=(r=e.data)&&r.error){var a;const t=new Error(`opening wallet failed: received ${null==(a=e.data)?void 0:a.error}`);throw qe.error(t),this.close(),t}this.state=ma.OPENED,this.openPayload=e.data,this.events.emit("open",this.openPayload),0!==this.pendingMessageRequests.length&&this.pendingMessageRequests.splice(0,this.pendingMessageRequests.length).forEach((async function(e){t.sendMessage(e)}))}}sendMessage(e){throw new Error("abstract method")}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}emit(e,...t){return this.events.emit(e,...t)}close(e){this.state!==ma.CLOSED&&(this.state=ma.CLOSED,this.confirmationOnly=!1,this._sessionId=void 0,qe.info("closing wallet and flushing!"),this.pendingMessageRequests.length=0,this.responseCallbacks.forEach((e=>{e(pa({},new Error("wallet closed"),{code:4001}))})),this.responseCallbacks.clear(),this.connectPayload=void 0,this.openPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this.events.emit("close",e))}}class ka{constructor(e,t,n,i=[]){var s=this;this.signer=void 0,this.signerReadyCallbacks=[],this.prompter=void 0,this.mainnetNetworks=void 0,this.testnetNetworks=void 0,this._openIntent=void 0,this._connectOptions=void 0,this._defaultNetworkId=void 0,this._chainId=void 0,this.events=new Hr.EventEmitter2,this.onConnectOptionsChange=void 0,this.promptConnect=async function(e){if(!e&&!s._connectOptions)throw new Error("prompter connect options are empty");if(!s.prompter)return s.connect(e);const t=await s.prompter.promptConnect(e||s._connectOptions).catch((e=>({connected:!1}))),n=t;return n.connected&&!n.session&&(n.session=await s.walletSession()),t},this.sendAsync=async function(e,t,n){const i={jsonrpc:"2.0",id:e.id,result:null};await s.getSigner();try{if(!(s.signer&&null!==s.signer||Aa.includes(e.method)))throw va;const t=s.signer;if(!t)throw new Error("WalletRequestHandler: wallet signer is not configured");const r=await t.getProvider(n);if(!r)throw new Error(`WalletRequestHandler: wallet provider is not configured for chainId ${n}`);switch(e.method){case"net_version":{const e=await r.send("net_version",[]);i.result=e;break}case"eth_chainId":{const e=await r.send("eth_chainId",[]);i.result=e;break}case"eth_accounts":{const e=await t.getAddress();i.result=[e];break}case"eth_getBalance":{const[t,n]=e.params,s=await r.getBalance(t,n);i.result=s.toHexString();break}case"personal_sign":case"eth_sign":{let r;if("personal_sign"===e.method){const[t,n]=e.params;r=t}else{const[t,n]=e.params;r=n}let a="";const o=Da(r);if(null===s.prompter?a=await t.signMessage(o,n):await s.handleConfirmWalletDeployPrompt(s.prompter,t,n)&&(a=await s.prompter.promptSignMessage({chainId:n,message:o},s.connectOptions)),!(a&&a.length>0))throw new Error("declined by user");i.result=a;break}case"eth_signTypedData":case"eth_signTypedData_v4":{const[r,a]=e.params;let o;if("string"==typeof a)try{o=JSON.parse(a)}catch(e){}else o=a;if(!(o&&o.domain&&o.types&&o.message))throw new Error("invalid typedData object");let c="";if(null===s.prompter?c=await t.signTypedData(o.domain,o.types,o.message,n):await s.handleConfirmWalletDeployPrompt(s.prompter,t,n)&&(c=await s.prompter.promptSignMessage({chainId:n,typedData:o},s.connectOptions)),!(c&&c.length>0))throw new Error("declined by user");i.result=c;break}case"eth_sendTransaction":{const[r]=e.params;"gas"in r&&void 0===r.gasLimit&&(r.gasLimit=r.gas,delete r.gas);let a="";if(a=null===s.prompter?(await t.sendTransaction(r,n)).hash:await s.prompter.promptSendTransaction(r,n,s.connectOptions),!a)throw new Error("declined by user");i.result=a;break}case"eth_signTransaction":{const[r]=e.params;if(N.getAddress(r.from)!==await t.getAddress())throw new Error("sender address does not match wallet");null===s.prompter?i.result=await t.signTransactions(r,n):i.result=await s.prompter.promptSignTransaction(r,n,s.connectOptions);break}case"eth_sendRawTransaction":if(_i(e.params[0])){const n=we.gH.from(e.params[0].chainId).toNumber(),s=await(await t.getRelayer(n)).relay(e.params[0]);i.result=(await s).hash}else{const t=await r.sendTransaction(e.params[0]);i.result=t.hash}break;case"eth_getTransactionCount":{const n=N.getAddress(e.params[0]),s=e.params[1];if(n===N.getAddress(await t.getAddress())){const e=await t.getTransactionCount(s);i.result=we.gH.from(e).toHexString()}else{const e=await r.getTransactionCount(n,s);i.result=we.gH.from(e).toHexString()}break}case"eth_blockNumber":i.result=await r.getBlockNumber();break;case"eth_getBlockByNumber":case"eth_getBlockByHash":i.result=await r.getBlock(e.params[0]);break;case"eth_getTransactionByHash":i.result=await r.getTransaction(e.params[0]);break;case"eth_call":{const[t,n]=e.params;i.result=await r.call(t,n);break}case"eth_getCode":{const[t,n]=e.params;i.result=await r.getCode(t,n);break}case"eth_estimateGas":{const[t]=e.params;i.result=await r.estimateGas(t);break}case"eth_gasPrice":{const e=await r.getGasPrice();i.result=e.toHexString();break}case"wallet_switchEthereumChain":{const[t]=e.params;if(!t.chainId||0===t.chainId.length)throw new Error("invalid chainId");const n=we.gH.from(t.chainId);if(!await s.setDefaultNetwork(n.toString(),!0))throw new Error(`unable to set chainId ${n}`);i.result=null;break}case"sequence_getWalletContext":i.result=await t.getWalletContext();break;case"sequence_getWalletConfig":{const[n]=e.params;i.result=await t.getWalletConfig(n);break}case"sequence_getWalletState":{const[n]=e.params;i.result=await t.getWalletState(n);break}case"sequence_getNetworks":i.result=await s.getNetworks(!0);break;case"sequence_isSequence":i.result=!0;break;case"sequence_updateConfig":throw new Error("sequence_updateConfig method is not allowed from a dapp");case"sequence_publishConfig":throw new Error("sequence_publishConfig method is not allowed from a dapp");case"sequence_gasRefundOptions":case"sequence_getNonce":case"sequence_relay":break;case"sequence_setDefaultNetwork":{const[t]=e.params;if(!t)throw new Error("invalid request, method argument defaultNetworkId cannot be empty");if(!await s.setDefaultNetwork(t))throw new Error(`unable to set default network ${t}`);i.result=await s.getNetworks(!0);break}default:{const t=await r.send(e.method,e.params);i.result=t}}}catch(e){qe.error(e),i.result=null,i.error=pa({},new Error(e),{code:4001})}t(void 0,i)},this.isSignedIn=async function(){return await s.signerReady(),!!s.signer},this.getSigner=async function(){if(await s.signerReady(),void 0===s.signer)throw new Error("signerReady failed resolve");return s.signer},this.signer=e,this.prompter=t,this.mainnetNetworks=n,this.testnetNetworks=i}async signIn(e,t={}){this.setSigner(e);const{connect:n,mainnetNetworks:i,testnetNetworks:s,defaultNetworkId:r}=t;if(i&&i.length>0&&(this.mainnetNetworks=i),s&&s.length>0&&(this.testnetNetworks=s),!(this.mainnetNetworks&&0!==this.mainnetNetworks.length||this.testnetNetworks&&0!==this.testnetNetworks.length))throw new Error("signIn failed as network configuration is empty");const a=r||this._defaultNetworkId;if(a&&!await this.setDefaultNetwork(a,!1))throw new Error(`WalletRequestHandler setup unable to set defaultNetworkId ${a}`);if(n){const e=this._connectOptions;let t;var o;t=null!==this.prompter?await(null==(o=this.prompter)?void 0:o.promptSignInConnect(e)):await this.connect(e),this.notifyConnect(t),e&&!0===e.keepWalletOpened||this.notifyClose()}}signOut(){this.setSigner(null)}signerReset(){this.signer=void 0}signerReady(e=1e4){return new Promise(((t,n)=>{void 0!==this.signer?t():(setTimeout((()=>{void 0===this.signer&&(this.signerReadyCallbacks=[],n("signerReady timed out"))}),e),this.signerReadyCallbacks.push(t))}))}async connect(e){if(!this.signer)return{connected:!1,chainId:"0x0",error:"unable to connect without signed in account"};const t={connected:!0,chainId:x.hexlify(await this.getChainId())};if(e&&e.authorize){const n={app:e.app,origin:e.origin,expiry:e.expiry};try{t.proof=await Js(this.signer,n)}catch(t){return qe.warn(`connect, signAuthorization failed for options: ${JSON.stringify(e)}, due to: ${t.message}`),{connected:!1,chainId:"0x0",error:`signAuthorization failed: ${t.message}`}}}return t.session=await this.walletSession(),t}sendMessageRequest(e){return new Promise((t=>{this.sendAsync(e.data,((n,i)=>{const s=pa({},e,{data:i});t(s)}),e.chainId)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}async getAddress(){return this.signer?this.signer.getAddress():""}async getChainId(){return this.signer?(this._chainId||(this._chainId=await this.signer.getChainId()),this._chainId):0}get openIntent(){return this._openIntent}setOpenIntent(e){this._openIntent=e}get connectOptions(){return this._connectOptions}setConnectOptions(e){var t;this._connectOptions=e,null==(t=this.onConnectOptionsChange)||t.call(this,e)}get defaultNetworkId(){return this._defaultNetworkId}async setDefaultNetwork(e,t=!0){if(e&&(this._defaultNetworkId=e,this._chainId=void 0,this.signer&&this.signer.setNetworks)){const n=this.signer.setNetworks(this.mainnetNetworks,this.testnetNetworks,e);return n&&t&&await this.notifyNetworks(),n}}async getNetworks(e){if(!this.signer)return qe.warn("signer not set: getNetworks is returning an empty list"),[];const t=await this.signer.getNetworks();return e?t.map((e=>{const t=pa({},e);return t.provider=void 0,t.relayer=void 0,t})):t}async walletSession(){return this.signer?{walletContext:await this.signer.getWalletContext(),accountAddress:await this.signer.getAddress(),networks:await this.getNetworks(!0)}:void 0}notifyConnect(e,t){var n,i;this.events.emit("connect",e),null!=(n=e.session)&&n.accountAddress&&this.events.emit("accountsChanged",[null==(i=e.session)?void 0:i.accountAddress],t)}notifyDisconnect(e){this.events.emit("accountsChanged",[],e),this.events.emit("disconnect")}async notifyNetworks(e){const t=e||await this.getNetworks(!0);if(this.events.emit("networks",t),t.length>0){const e=t.find((e=>e.isDefaultChain));e&&this.events.emit("chainChanged",x.hexlify(e.chainId))}else this.events.emit("chainChanged","0x0")}async notifyWalletContext(){if(!this.signer)return void qe.warn("signer not set: skipping to notify wallet context");const e=await this.signer.getWalletContext();this.events.emit("walletContext",e)}notifyClose(e){this.events.emit("close",e)}setSigner(e){if(this.signer=e,void 0!==e){for(let e=0;e<this.signerReadyCallbacks.length;e++)this.signerReadyCallbacks[e]();this.signerReadyCallbacks=[]}}async handleConfirmWalletDeployPrompt(e,t,n){return!n||(!!await ja(t,n)||!!await e.promptConfirmWalletDeploy(n,this.connectOptions)&&(!!await ja(t,n)||(qe.error("WalletRequestHandler: result for promptConfirmWalletDeploy is not correct"),!1)))}}const Aa=["net_version","eth_chainId","eth_getBalance","eth_getTransactionCount","eth_blockNumber","eth_getBlockByNumber","eth_getBlockByHash","eth_getTransactionByHash","eth_getCode","eth_estimateGas","eth_gasPrice","sequence_getWalletContext","sequence_getNetworks","sequence_setDefaultNetwork"];class Ta extends Vr.j{static isSequenceProvider(e){return _a(e)}constructor(e,t){const n=new aa(e,$r(t));super(e=n,"any"),this._sender=void 0,this._isSequenceProvider=void 0,this._defaultChainId=void 0,this._sender=n,this._isSequenceProvider=!0,this._defaultChainId=$r(t)}sendAsync(e,t,n){this._sender.sendAsync(e,t,n)}send(e,t,n){return this._sender.send(e,t,n)}request(e){return this.send(e.method,e.params||[],e.chainId)}getSigner(){return new Na(this,this._defaultChainId)}async getChainId(){const e=await this.send("eth_chainId",[]),t=we.gH.from(e).toNumber();if(this._defaultChainId&&this._defaultChainId!==t)throw new Error(`provider chainId (${t}) does not match provider-bound chainId ${this._defaultChainId}`);return t}}function _a(e){const t=e;return t&&void 0!==t.send&&!0===t._isSequenceProvider}class Sa extends Ta{constructor(e,t){super(new ka(e,null,t||[]))}}class Na extends xs{constructor(e,t){super(),this.provider=void 0,this.defaultChainId=void 0,this._address=void 0,this._index=void 0,this._context=void 0,this._networks=void 0,this._providers={},this.provider=e,this.defaultChainId=t}async getAddress(){if(this._address)return this._address;const e=await this.provider.send("eth_accounts",[]);return this._address=e[0],this._index=0,N.getAddress(this._address)}signTransaction(e){throw new Error("signTransaction is unsupported, use signTransactions instead")}connect(e){throw new Error("unsupported: cannot alter JSON-RPC Signer connection")}async getProvider(e){if(e){const t=await this.getChainId();if(t!==e)throw new Error(`signer is attempting to access chain ${e}, but is already bound to chain ${t}`)}return this.provider}async getSender(e){return!e||e&&e===this.defaultChainId?this.provider:(this._providers[e]||(this._providers[e]=new Ta(new aa(this.provider,e),e)),this._providers[e])}getRelayer(e){throw new Error("TODO")}async getWalletContext(){return this._context||(this._context=await this.provider.send("sequence_getWalletContext",[])),this._context}async getWalletConfig(e){return await this.provider.send("sequence_getWalletConfig",[$r(e)],$r(e)||this.defaultChainId)}async getWalletState(e){return await this.provider.send("sequence_getWalletState",[$r(e)],$r(e)||this.defaultChainId)}async getNetworks(){return this._networks||(this._networks=await this.provider.send("sequence_getNetworks",[])),this._networks}async getSigners(){const e=(await this.getNetworks()).find((e=>e.isAuthChain));if(!e)throw new Error("authChainId could not be determined from network list");const t=await this.getWalletConfig(e);if(!t||0===t.length)throw new Error("walletConfig returned zero results for authChainId {authChainId}");return t[0].signers.map((e=>e.address))}async signMessage(e,t,n){const i=await this.getSender($r(t)||this.defaultChainId),s="string"==typeof e?Ie.YW(e):e,r=await this.getAddress();return await i.send("personal_sign",[x.hexlify(s),r])}async signTypedData(e,t,n,i,s){return await this.provider.send("eth_signTypedData_v4",[await this.getAddress(),M.z.getPayload(e,t,n)],$r(i)||this.defaultChainId)}async sendTransaction(e,t,n){const i=await this.getSender($r(t)||this.defaultChainId);return this.sendUncheckedTransaction(e,t).then((e=>ot.poll((()=>i.getTransaction(e).then((t=>{if(null!==t)return i._wrapTransaction(t,e)}))),{onceBlock:this.provider}).catch((t=>{throw t.transactionHash=e,t}))))}async sendTransactionBatch(e,t,n){const i=await Bs(e);if(!i||0===i.length)throw new Error("cannot send empty batch");if(i.find((e=>void 0!==e.wait&&null!==e.wait)))throw new Error("transaction request expected for sendTransactionBatch, transaction response found");const s=pa({},i[0]);return i.length>1&&(s.auxiliary=i.splice(1)),this.sendTransaction(s,t,n)}signTransactions(e,t,n){return e=tt(e),this.provider.send("eth_signTransaction",[e],$r(t)||this.defaultChainId)}sendSignedTransactions(e,t){throw new Error("TODO")}async updateConfig(e){const[t,n]=await this.provider.send("sequence_updateConfig",[e],this.defaultChainId);return null===n?[t,void 0]:[t,(await this.getSender(this.defaultChainId))._wrapTransaction(n,n.hash)]}async publishConfig(){const e=await this.getSender(this.defaultChainId),t=await e.send("sequence_publishConfig",[]);if(null!==t)return e._wrapTransaction(t,t.hash)}async isDeployed(e){const t=await this.getSender($r(e)),n=await t.getCode(await this.getAddress());return!!n&&"0x"!==n}async _legacySignMessage(e,t,n){const i=await this.getSender($r(t)||this.defaultChainId),s="string"==typeof e?Ie.YW(e):e,r=await this.getAddress();return await i.send("eth_sign",[r,x.hexlify(s)])}async _signTypedData(e,t,n,i,s){return this.signTypedData(e,t,n,i,s)}async sendUncheckedTransaction(e,t){e=tt(e);const n=this.getAddress(),i=await this.getSender($r(t)||this.defaultChainId);return Qe({tx:Qe(e),sender:await n}).then((({tx:t,sender:n})=>{if(null!=t.from){if(N.getAddress(t.from)!==n)throw new Error(`from address mismatch for transaction ${e}`)}else t.from=n;const s=xa(t);return i.send("eth_sendTransaction",[s]).then((e=>e),(e=>{throw e}))}))}connectUnchecked(){return new Ra(this.provider,this.defaultChainId)}async unlock(e){const t=await this.getAddress();return this.provider.send("personal_unlockAccount",[t,e,null])}}const Oa={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0,from:!0,auxiliary:!0,expiration:!0,afterNonce:!0,delegateCall:!0,revertOnError:!0},xa=(e,t)=>{const n=tt(Oa);if(t)for(const e in t)t[e]&&(n[e]=!0);ii.checkProperties(e,n);const i={};["gasLimit","gasPrice","nonce","value"].forEach((t=>{const n=e[t];if(null==n)return;const s=x.hexValue(n);"gasLimit"===t&&(t="gas"),i[t]=s})),["from","to","data"].forEach((t=>{e[t]&&(i[t]=x.hexlify(e[t]))})),["delegateCall","revertOnError"].forEach((t=>{const n=e[t];null!=n&&(i[t]=n)}));const s=e.auxiliary;return s&&s.length>0&&(i.auxiliary=[],s.forEach((e=>{i.auxiliary.push(xa(e))}))),i};class Ra extends Na{sendTransaction(e){return this.sendUncheckedTransaction(e).then((e=>({chainId:0,confirmations:0,data:"",from:"",gasLimit:ye.XK,gasPrice:ye.XK,hash:e,nonce:0,value:ye.XK,wait:t=>this.provider.waitForTransaction(e,t)})))}}const Ma=[{name:"Decentraland Exception",predicate:function(e){try{const t=Ie._v(e);return Ua.test(t)}catch(e){return!1}}},{name:"0x v3 Exception",predicate:function(e){const t=new rt.KA(Ba);try{return t.decodeFunctionData("OrderWithHash",e),!0}catch(e){return!1}}}],Ua=/^Decentraland Login\nEphemeral address: 0x[a-fA-F0-9]{40}\nExpiration: (\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)((-(\d{2}):(\d{2})|Z)?)$/,Ba=[{inputs:[{components:[{internalType:"address",name:"makerAddress",type:"address"},{internalType:"address",name:"takerAddress",type:"address"},{internalType:"address",name:"feeRecipientAddress",type:"address"},{internalType:"address",name:"senderAddress",type:"address"},{internalType:"uint256",name:"makerAssetAmount",type:"uint256"},{internalType:"uint256",name:"takerAssetAmount",type:"uint256"},{internalType:"uint256",name:"makerFee",type:"uint256"},{internalType:"uint256",name:"takerFee",type:"uint256"},{internalType:"uint256",name:"expirationTimeSeconds",type:"uint256"},{internalType:"uint256",name:"salt",type:"uint256"},{internalType:"bytes",name:"makerAssetData",type:"bytes"},{internalType:"bytes",name:"takerAssetData",type:"bytes"},{internalType:"bytes",name:"makerFeeAssetData",type:"bytes"},{internalType:"bytes",name:"takerFeeAssetData",type:"bytes"}],internalType:"struct IEIP1271Data.Order",name:"order",type:"tuple"},{internalType:"bytes32",name:"orderHash",type:"bytes32"}],name:"OrderWithHash",outputs:[],stateMutability:"pure",type:"function"}],Pa=Ie.YW("Ethereum Signed Message:\n"),La=e=>x.isBytes(e)||x.isHexString(e)?x.arrayify(e):Ie.YW(e),Da=e=>{const t=La(e);return function(e){return Ma.some((t=>t.predicate(e)))}(t)?t:x.concat([Pa,Ie.YW(String(t.length)),t])},qa=async(e,t,n,i,s,r)=>{var a;return s||(s=null==(a=await i.getNetwork())?void 0:a.chainId),!r&&Ta.isSequenceProvider(i)&&(r=await i.getSigner().getWalletContext()),Ds(e,t,n,i,r,s)},Ga=async(e,t,n,i,s,r)=>{const a=Da(t),o=Oe(a);return qa(e,o,n,i,s,r)},Fa=(e,t,n,i,s,r)=>qa(e,ze(t),n,i,s,r),Wa=async(e,t,n,i,s)=>{const r=xe(e,i,t),a=await(async(e,t,n,i,s,r)=>{const a=x.arrayify(R.keccak256(e));return Fs(a,t,void 0,void 0,void 0,void 0)})(r,n);if(s){const e=Bt(a,s);if(a.address&&a.address!==e)throw new Error("recovered address does not match the WalletConfig address, check the WalletContext");a.address=e}return a},Ha=()=>"chrome-extension:"===window.location.protocol||"moz-extension:"===window.location.protocol,Va=()=>!!navigator.userAgent.match(/UnitySequence/i),ja=async(e,t)=>{var n;const i=await e.getWalletState(),s=await e.getNetworks(),r=i.find((e=>e.chainId===t));if(!r)throw new Error(`WalletRequestHandler: could not find wallet state for chainId ${t}`);const a=r.deployed;if(!s)throw new Error("isWalletUpToDate util: could not get networks from signer");const o=s.find((e=>e.isAuthChain));if(!o)throw new Error("isWalletUpToDate util: could not get auth chain network information");const c=o.chainId,l=null==(n=i.find((e=>e.chainId===c)))?void 0:n.config;if(!l)throw new Error("isWalletUpToDate util: could not get auth chain config");const h=r.config;if(!h)throw new Error(`isWalletUpToDate util: could not get config for chainId ${t}`);const d=Dt(l,h);return a&&d};class $a{constructor(){}static getInstance(){return"object"==typeof window?$a._instance||($a._instance={getItem:e=>Promise.resolve(window.localStorage.getItem(e)),setItem:(e,t)=>Promise.resolve(window.localStorage.setItem(e,t)),removeItem:e=>Promise.resolve(window.localStorage.removeItem(e))}):$a._instance||($a._instance={getItem:e=>Promise.resolve(null),setItem:(e,t)=>Promise.resolve(),removeItem:e=>Promise.resolve()}),this._instance}static use(e){$a._instance=e}}$a._instance=void 0;class Ka{constructor(e,t){this.def=t,this.key=void 0,this.key=e}async get(){const e=await $a.getInstance().getItem(this.key);if(null===e)return this.def;try{return JSON.parse(e)}catch(e){console.error(e)}}set(e){e?$a.getInstance().setItem(this.key,JSON.stringify(e)):$a.getInstance().removeItem(this.key)}del(){$a.getInstance().removeItem(this.key)}}const Ja="@sequence.transportSession";class Ya{constructor(e){var t=this;this.walletRequestHandler=void 0,this._sessionId=void 0,this._registered=void 0,this._init=void 0,this._initNonce=void 0,this._initCallback=void 0,this.appOrigin=void 0,this.sendAsync=async function(e,t,n){throw new Error("abstract method")},this.handleMessage=async function(e){const n=e;if(t._init===wa.OK)switch(n.type){case fa.OPEN:{if(t._init!==wa.OK)return;const e={sessionId:n.data.sessionId,intent:n.data.intent,networkId:n.data.networkId};return void await t.open(e)}case fa.CLOSE:return t._init,void wa.OK;case fa.MESSAGE:{const e=await t.walletRequestHandler.sendMessageRequest(n);return t.sendMessage(e),void e.data.error}default:qe.error(`unexpected payload type ${n.type}`)}else if(n.type===fa.INIT){if(!t.isValidInitAck(e))return void(t._initCallback&&t._initCallback("invalid init"));t._initCallback&&t._initCallback()}},this.sendMessageRequest=async function(e){return t.walletRequestHandler.sendMessageRequest(e)},this.open=async function({sessionId:e,intent:n,networkId:i}){if(e&&(t._sessionId=je(e),t.saveTransportSession({sessionId:e,intent:n,networkId:i})),t.walletRequestHandler.setOpenIntent(n),await t.init(),n&&"connect"===n.type&&n.options){const e=n.options,s=e;if(t.appOrigin&&null!=s&&s.origin){if(!Ha()&&s.origin!==t.appOrigin)throw new Error("origin is invalid")}else!t.appOrigin&&null!=s&&s.origin?e.origin=Ke(s.origin):t.appOrigin&&(e.origin=t.appOrigin);e.app&&(e.app=$e(e.app)),t.walletRequestHandler.setConnectOptions(e),e.networkId?i=e.networkId:i&&(e.networkId=i)}else t.walletRequestHandler.setConnectOptions(void 0);if(await t.walletRequestHandler.getSigner(),!await t.walletRequestHandler.isSignedIn())return t.notifyOpen({sessionId:t._sessionId}),!0;if(n&&"connect"===n.type){let e;try{e=i?await t.walletRequestHandler.setDefaultNetwork(i,!1):await t.walletRequestHandler.getChainId()}catch(e){console.error(e)}(!e||e<=0)&&console.log("Failed to set default network on open"),t.notifyOpen({sessionId:t._sessionId});try{const e=await t.walletRequestHandler.promptConnect(n.options);e.connected&&t.walletRequestHandler.notifyConnect(e)}catch(e){qe.warn("promptConnect not connected:",e)}finally{n.options&&!0===n.options.keepWalletOpened||t.notifyClose()}}else{let e;try{e=i?await t.walletRequestHandler.setDefaultNetwork(i,!1):await t.walletRequestHandler.getChainId()}catch(e){console.error(e)}if(!e||e<=0)return t.notifyOpen({sessionId:t._sessionId,error:`failed to open wallet on network ${i}`}),!1;t.notifyOpen({sessionId:t._sessionId,chainId:`${e}`,session:await t.walletRequestHandler.walletSession()})}return!0},this.saveTransportSession=e=>{$a.getInstance().setItem(Ja,JSON.stringify(e))},this.getCachedTransportSession=async function(){const e=await $a.getInstance().getItem(Ja);try{return e?JSON.parse(e):null}catch(t){return console.error(`unable to parse transport session: ${e}`),null}},this.walletRequestHandler=e,this._init=wa.NIL,this.walletRequestHandler.on("connect",(e=>{this.registered&&this.notifyConnect(e)})),this.walletRequestHandler.on("disconnect",(e=>{this.registered&&this.notifyDisconnect(e)})),this.walletRequestHandler.on("accountsChanged",((e,t)=>{this.registered&&this.notifyAccountsChanged(e,t)})),this.walletRequestHandler.on("networks",(e=>{this.registered&&(this.notifyNetworks(e),e&&0!==e.length?this.notifyChainChanged(x.hexlify(e.find((e=>e.isDefaultChain)).chainId)):this.notifyChainChanged("0x0"))})),this.walletRequestHandler.on("walletContext",(e=>{this.registered&&e&&this.notifyWalletContext(e)})),this.walletRequestHandler.on("close",(e=>{this.registered&&this.notifyClose(e)}))}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}sendMessage(e){throw new Error("abstract method")}notifyOpen(e){const{chainId:t,sessionId:n,session:i,error:s}=e;this.sendMessage({idx:-1,type:fa.OPEN,data:{chainId:t,sessionId:n,session:i,error:s}})}notifyClose(e){this.sendMessage({idx:-1,type:fa.CLOSE,data:e?{error:e}:null})}notifyConnect(e){this.sendMessage({idx:-1,type:fa.CONNECT,data:e})}notifyDisconnect(e){this.sendMessage({idx:-1,type:fa.DISCONNECT,data:e?{error:e}:null})}notifyAccountsChanged(e,t){this.sendMessage({idx:-1,type:fa.ACCOUNTS_CHANGED,data:e,origin:t})}notifyChainChanged(e){this.sendMessage({idx:-1,type:fa.CHAIN_CHANGED,data:e})}notifyNetworks(e){this.sendMessage({idx:-1,type:fa.NETWORKS,data:e})}notifyWalletContext(e){this.sendMessage({idx:-1,type:fa.WALLET_CONTEXT,data:e})}isValidInitAck(e){if(this._init===wa.OK)return qe.warn("isValidInitAck, already in init'd state, so inquiry is invalid."),!1;if(e.type!==fa.INIT)return qe.warn("isValidInitAck, invalid message type, expecting init"),!1;const{sessionId:t,nonce:n}=e.data;return t&&0!==t.length&&n&&0!==n.length?t===this._sessionId&&n===this._initNonce||(qe.error("invalid init ack match"),!1):(qe.error("invalid init ack"),!1)}init(){return new Promise(((e,t)=>{if(this._init===wa.OK)return void e();if(this._init!==wa.NIL||this._initCallback)return void t("transport init is in progress");const n=setTimeout((()=>{qe.warn("transport init timed out"),this._initCallback&&this._initCallback("transport init timed out")}),ba/2);this._initCallback=i=>{this._initCallback=void 0,clearTimeout(n),i?t(i):(this._init=wa.OK,e())},this._initNonce=`${performance.now()}`,this.sendMessage({idx:-1,type:fa.INIT,data:{nonce:this._initNonce}}),this._init=wa.SENT_NONCE}))}}class za{constructor(){this.app=void 0,this.wallet=void 0;const e=new Za,t=new Za;e.conn=t,t.conn=e,this.app=e,this.wallet=t}}class Za{constructor(){this.conn=void 0,this.events=new Hr.EventEmitter2,this.handleMessage=e=>{throw new Error("ProxyMessageChannelPort is not registered")},this.sendMessage=e=>{this.conn.handleMessage(e),"open"===e.type&&this.events.emit("open",e),"close"===e.type&&this.events.emit("close",e),"connect"===e.type&&this.events.emit("connect",e),"disconnect"===e.type&&this.events.emit("disconnect",e)}}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}}class Xa extends Ia{constructor(e){if(super(),this.port=void 0,this.register=()=>{this.port.handleMessage=e=>{this.handleMessage(e)},this.on("open",((...e)=>{this.port.events.emit("open",...e)})),this.on("close",((...e)=>{this.port.events.emit("close",...e)})),this.on("connect",((...e)=>{this.port.events.emit("connect",...e)})),this.on("disconnect",((...e)=>{this.port.events.emit("disconnect",...e)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),this.events.removeAllListeners(),this.port.handleMessage=void 0},this.openWallet=(e,t,n)=>{if(this.state===ma.CLOSED){this.state=ma.OPENING;const i=`${performance.now()}`;this._sessionId=i,this.sendMessage({idx:-1,type:fa.OPEN,data:{path:e,intent:t,networkId:n,sessionId:i}})}},this.state=ma.CLOSED,this.port=e,!e)throw new Error("port argument cannot be empty");this._init=wa.OK}closeWallet(){this.sendMessage({idx:-1,type:fa.CLOSE,data:null}),this.close()}sendMessage(e){if(!e.idx)throw new Error("message idx is empty");this.port.sendMessage(e)}}class Qa extends Ya{constructor(e,t){super(e),this.port=void 0,this.port=t,this._init=wa.OK}register(){this.port.handleMessage=e=>{this.handleMessage(e)},this._registered=!0}async restoreSession(){const e=await this.getCachedTransportSession();e&&this.open(e)}unregister(){this.port.handleMessage=void 0,this._registered=!1}sendMessage(e){this.port.sendMessage(e)}}class eo{constructor(...e){var t=this;this.messageProviders=void 0,this.provider=void 0,this.register=()=>{if(1===this.messageProviders.length)return this.provider=this.messageProviders[0],void this.provider.register();this.messageProviders.forEach((e=>{e.register(),e.once("open",(()=>{this.provider||(this.provider=e,this.messageProviders.forEach((e=>{this.provider!==e&&e.unregister()})))}))}))},this.unregister=()=>{this.messageProviders.forEach((e=>e.unregister())),this.provider=void 0},this.openWallet=(e,t,n)=>{this.provider?this.provider.openWallet(e,t,n):this.messageProviders.forEach((i=>i.openWallet(e,t,n)))},this.sendAsync=async function(e,n,i){if(!t.provider)throw new Error("impossible state, wallet must be opened first");t.provider.sendAsync(e,n,i)},this.sendMessageRequest=async function(e){if(t.provider)return t.provider.sendMessageRequest(e);throw new Error("impossible state, wallet must be opened first")},this.waitUntilOpened=async function(){return t.provider?t.provider.waitUntilOpened():Promise.race(t.messageProviders.map((e=>e.waitUntilOpened())))},this.waitUntilConnected=async function(){if(t.provider)return t.provider.waitUntilConnected();throw new Error("impossible state, wallet must be opened first")},this.messageProviders=e,this.provider=void 0}add(...e){this.messageProviders.push(...e)}closeWallet(){this.provider&&this.provider.closeWallet()}isOpened(){return!!this.provider&&this.provider.isOpened()}isConnected(){return!!this.provider&&this.provider.isConnected()}on(e,t){this.provider?this.provider.on(e,t):this.messageProviders.forEach((n=>{n.on(e,t)}))}once(e,t){this.provider?this.provider.once(e,t):this.messageProviders.forEach((n=>{n.once(e,t)}))}emit(e,...t){if(this.provider)return this.provider.emit(e,...t);for(let n=0;n<this.messageProviders.length;n++)this.messageProviders[n].emit(e,...t);return!0}sendMessage(e){if(!e.idx||e.idx<=0)throw new Error("message idx is empty");if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.sendMessage(e)}handleMessage(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.handleMessage(e)}}let to;class no extends Ia{constructor(e){super(),this.walletURL=void 0,this.walletWindow=void 0,this.register=()=>{to&&(to.unregister(),to=this),window.addEventListener("message",this.onWindowEvent),to=this,this.on("open",(()=>{const e=this.walletWindow,t=setInterval((()=>{e&&e.closed&&(clearInterval(t),this.close())}),500)})),this.on("close",(()=>{this.walletWindow&&(this.walletWindow.close(),this.walletWindow=null)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),to===this&&(to=void 0),window.removeEventListener("message",this.onWindowEvent),this.events.removeAllListeners()},this.openWallet=(e,t,n)=>{if(this.walletWindow&&this.isOpened())return void this.walletWindow.focus();const i=new URL(this.walletURL.href),s=new ga;let r,a;e&&""!==e&&(i.pathname=e.toLowerCase()),this._init=wa.NIL,this._sessionId=`${performance.now()}`,s.set("sid",this._sessionId),t&&("connect"===t.type&&(t.options||(t.options={}),Ha()||Va()||(t.options.origin=window.location.origin)),s.set("intent",_e(t))),n&&s.set("net",`${n}`),Ha()?(r=[450,750],a=[Math.abs(window.screen.width/2-r[0]/2),Math.abs(window.screen.height/2-r[1]/2)]):(r=[450,750],a=[Math.abs(window.screenX+window.innerWidth/2-r[0]/2),Math.abs(window.screenY+window.innerHeight/2-r[1]/2)]);const o=`toolbar=0,location=0,menubar=0,scrollbars=yes,status=yes,width=${r[0]},height=${r[1]},left=${a[0]},top=${a[1]}`;i.search=s.toString(),this.walletWindow=window.open(i.href,"sequence.app",o)},this.onWindowEvent=e=>{if(e.origin!==this.walletURL.origin)return;let t;try{t=JSON.parse(e.data)}catch(e){return}if(!t)throw new Error("ProviderMessage object is empty");this.handleMessage(t)},this.walletURL=new URL(e)}closeWallet(){var e;this.close(),null==(e=this.walletWindow)||e.close()}sendMessage(e){if(!this.walletWindow)return void qe.warn("WindowMessageProvider: sendMessage failed as walletWindow is unavailable");const t="string"!=typeof e?JSON.stringify(e):e;this.walletWindow.postMessage(t,this.walletURL.origin)}}class io extends Ya{constructor(e){var t;super(e),t=this,this.parentWindow=void 0,this._isPopup=!1,this.onWindowEvent=async function(e){if(!e.origin||""===e.origin)return;if(t.appOrigin&&e.origin!==t.appOrigin)return;let n;try{n=JSON.parse(e.data)}catch(e){return}qe.debug("RECEIVED MESSAGE",n),t._init!==wa.OK&&t.isValidInitAck(n)&&(t.appOrigin=e.origin),t._init!==wa.OK||t.appOrigin&&!(t.appOrigin.length<8)?t.handleMessage(n):qe.error("impossible state, init.OK and appOrigin required")},this.getWindowTransportSession=e=>{const t=new ga(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:Ne(t.get("intent"))}},this._init=wa.NIL}async register(e){const t=null!==parent.window.opener;if(this._isPopup=t,!0!==t)return;const{pathname:n,search:i}=new URL(e||window.location.href);let s=this.getWindowTransportSession(i);!!s.sessionId||(s=await this.getCachedTransportSession()),s?(this.parentWindow=parent.window.opener,window.addEventListener("message",this.onWindowEvent,!1),this._registered=!0,this.open(s).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=s)?void 0:t.networkId}`;qe.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const n=`failed to open to network ${null==(t=s)?void 0:t.networkId}, due to: ${e}`;qe.error(n),this.notifyClose({message:n}),window.close()}))):qe.error("window session is undefined")}unregister(){window.removeEventListener("message",this.onWindowEvent),this._registered=!1}sendMessage(e){const t=JSON.stringify(e);e.type===fa.INIT?this.postMessage(t,!0):this.postMessage(t)}get isPopup(){return this._isPopup}postMessage(e,t=!1){!0===t||this._init===wa.OK?t?this.parentWindow.postMessage(e,"*"):this.appOrigin&&this.appOrigin.length>4?this.parentWindow.postMessage(e,this.appOrigin):qe.error("unable to postMessage as parentOrigin is invalid"):qe.error("impossible state, should not be calling postMessage until inited")}}const so="sequence-extension-message-handler";class ro extends Ya{constructor(e,t){super(e),this.runtime=t,this.port=void 0,this._init=wa.OK}register(){this._registered=!0,this.port=this.runtime.connect({name:so})}sendMessage(e){qe.info("[ExtensionMessageHandler send]",e),this.port.postMessage(e)}}class ao extends Ia{constructor(e){super(),this.register=()=>{this._registered=!0},e.onConnect.addListener((e=>{e.name===so&&(this._init=wa.OK,e.onMessage.addListener((e=>{this.handleMessage(e)})))}))}sendMessage(e){}unregister(){}openWallet(e,t,n){}closeWallet(){}}class oo extends Hr.EventEmitter2{constructor(e){var t;super(),t=this,this.stream=e,this.responseCallbacks=new Map,this._messageIdx=0,this.nextMessageIdx=()=>++this._messageIdx,this.handleMessage=e=>{if(!e.type||!e.data)return;qe.info("[received message]",e);const t=e.idx,n=this.responseCallbacks.get(t);switch(t&&this.responseCallbacks.delete(t),e.type){case fa.MESSAGE:if(!n)throw new Error("impossible state");this.emit(fa.MESSAGE,e),n(e.data.error,e);break;case fa.DISCONNECT:case fa.ACCOUNTS_CHANGED:case fa.CHAIN_CHANGED:this.emit(e.type,e.data);break;default:console.error("unknown message type",e)}},this.sendMessageRequest=async function(e){return new Promise(((n,i)=>{(!e.idx||e.idx<=0)&&i(new Error("message idx not set"));const{idx:s}=e;t.responseCallbacks.get(s)?i(new Error("duplicate message idx, should never happen")):t.responseCallbacks.set(s,((e,t)=>{if(e)i(e);else{if(!t)throw new Error("no valid response to return");n(t)}})),t.sendMessage(e)}))},this.stream.on("data",this.handleMessage)}sendMessage(e){this.stream.writable||console.error("window post message stream is not writable"),this.stream.write(e)}}function co(e){var t;if(null!=(t=window.ue)&&t.sequencewallettransport&&!window.logsOverriddenForUnreal){var n;const t=null==(n=window.ue)?void 0:n.sequencewallettransport;console.log=(...n)=>{t.logfromjs(`${e}: ${lo(n)}`)},console.warn=(...n)=>{t.warnfromjs(`${e}: ${lo(n)}`)},console.error=(...n)=>{t.errorfromjs(`${e}: ${lo(n)}`)},window.logsOverriddenForUnreal=!0}}function lo(e){return e.map((e=>"object"==typeof e?e instanceof Error?e.message:JSON.stringify(e):String(e))).join(" ")}let ho;class uo extends Ia{constructor(e){super(),this.walletURL=void 0,this.register=()=>{var e;co("dapp"),ho&&(ho.unregister(),ho=this),null!=(e=window.ue)&&e.sequencewallettransport&&(window.ue.sequencewallettransport.onmessagefromwallet=this.onUnrealCallback),ho=this,this._registered=!0,console.log("registering transport!")},this.unregister=()=>{var e,t;this._registered=!1,this.closeWallet(),ho===this&&(ho=void 0),(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromwallet)===this.onUnrealCallback&&delete window.ue.sequencewallettransport.onmessagefromwallet,this.events.removeAllListeners()},this.openWallet=(e,t,n)=>{if(this.isOpened())return void console.log("wallet already open!");console.log("opening wallet!");const i=new URL(this.walletURL.href),s=new ga;e&&(i.pathname=e.toLowerCase()),this._init=wa.NIL,this._sessionId=`${performance.now()}`,s.set("sid",this._sessionId),t&&s.set("intent",_e(t)),n&&s.set("net",`${n}`),i.search=s.toString(),console.log("opening wallet to",i.href),window.open(i.href)},this.onUnrealCallback=e=>{if(!e)throw new Error("ProviderMessage object is empty");this.handleMessage(e)},this.walletURL=new URL(e)}closeWallet(){this.close()}sendMessage(e){var t,n;const i="string"!=typeof e?JSON.stringify(e):e;console.log("Sending message to wallet:",i),null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetowallet(i)}}class po extends Ya{constructor(e){super(e),this.onMessageFromUnreal=e=>{qe.debug("RECEIVED MESSAGE",e),this.handleMessage(e)},this.getUnrealTransportSession=e=>{const t=new ga(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:Ne(t.get("intent"))}},this._init=wa.NIL}async register(e){var t;if(void 0===(null==(t=window.ue)?void 0:t.sequencewallettransport))return;co("wallet");const{search:n}=new URL(e||window.location.href);let i=this.getUnrealTransportSession(n);!!i.sessionId||(i=await this.getCachedTransportSession()),i?(window.ue.sequencewallettransport.onmessagefromsequencejs=this.onMessageFromUnreal,this._registered=!0,this.open(i).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=i)?void 0:t.networkId}`;qe.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const n=`failed to open to network ${null==(t=i)?void 0:t.networkId}, due to: ${e}`;qe.error(n),this.notifyClose({message:n}),window.close()}))):qe.error("unreal session is undefined")}unregister(){var e,t;(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromsequencejs)===this.onMessageFromUnreal&&delete window.ue.sequencewallettransport.onmessagefromsequencejs,this._registered=!1}sendMessage(e){var t,n;if(e.type!==fa.INIT&&this._init!==wa.OK)return void qe.error("impossible state, should not be calling postMessage until inited");const i=JSON.stringify(e);null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetosequencejs(i)}}class go{constructor(e){var t=this;this.wallet=void 0,this.recoverWalletConfig=async function(e,n,i,s,r){return r=r||await t.wallet.getWalletContext(),Wa(e,n,i,s,r)},this.recoverWalletConfigFromMessage=async function(e,n,i,s,r){return r=r||await t.wallet.getWalletContext(),Wa(e,Oe(Da(n)),i,s,r)},this.recoverWalletConfigFromTypedData=async function(e,n,i,s,r){return r=r||await t.wallet.getWalletContext(),Wa(e,ze(n),i,s,r)},this.wallet=e}signMessage(e,t,n){const i=this.wallet.getSigner();if(!i)throw new Error("unable to get signer");return i.signMessage(e,t,n)}async signAuthMessage(e,t){const n=await this.wallet.getAuthSigner();if(!n)throw new Error("unable to get AuthChain signer");return n.signMessage(e,await n.getChainId(),t)}signTypedData(e,t,n,i,s){const r=this.wallet.getSigner();if(!r)throw new Error("unable to get signer");return r.signTypedData(e,t,n,i,s)}async signAuthTypedData(e,t,n,i){const s=await this.wallet.getAuthSigner();if(!s)throw new Error("unable to get AuthChain signer");return s.signTypedData(e,t,n,await s.getChainId(),i)}async isValidSignature(e,t,n,i,s){const r=this.wallet.getProvider(i);if(!r)throw new Error(`unable to get provider for chainId ${i}`);return qa(e,t,n,r,i,s)}async isValidMessageSignature(e,t,n,i,s){const r=this.wallet.getProvider(i);if(!r)throw new Error(`unable to get provider for chainId ${i}`);const a=Da(t),o=Oe(a);return qa(e,o,n,r,i,s)}isValidTypedDataSignature(e,t,n,i,s){return this.isValidSignature(e,ze(t),n,i,s)}}class fo{constructor(e,t){var n=this;this.utils=void 0,this.config=void 0,this.session=void 0,this.connectedSites=void 0,this.transport=void 0,this.networks=void 0,this.providers=void 0,this.init=()=>{var e,t,n,i,s,r,a,o,c,l;this.transport.provider||(this.transport.messageProvider=new eo,null!=(e=this.config.transports)&&null!=(t=e.windowTransport)&&t.enabled&&"object"==typeof window&&(this.transport.windowMessageProvider=new no(this.config.walletAppURL),this.transport.messageProvider.add(this.transport.windowMessageProvider)),null!=(n=this.config.transports)&&null!=(i=n.proxyTransport)&&i.enabled&&(this.transport.proxyMessageProvider=new Xa(this.config.transports.proxyTransport.appPort),this.transport.messageProvider.add(this.transport.proxyMessageProvider)),null!=(s=this.config.transports)&&null!=(r=s.extensionTransport)&&r.enabled&&(this.transport.extensionMessageProvider=new ao(this.config.transports.extensionTransport.runtime),this.transport.messageProvider.add(this.transport.extensionMessageProvider)),null!=(a=this.config.transports)&&null!=(o=a.unrealTransport)&&o.enabled&&(this.transport.unrealMessageProvider=new uo(this.config.walletAppURL),this.transport.messageProvider.add(this.transport.unrealMessageProvider)),this.transport.messageProvider.register(),this.transport.allowProvider=(l=e=>{if("sequence_setDefaultNetwork"===e.method)return!0;const t=this.isConnected();if(!t)throw new Error("Sequence: wallet not connected");return t},e=>(t,n,i)=>{if(!l(t))throw new Error("allowProvider middleware precondition is unmet.");e(t,n,i)}),this.transport.networkProvider=(c=e=>this.networks&&0!==this.networks.length?this.networks.find((e=>e.isDefaultChain)).chainId:0,e=>(t,n,i)=>{const s=c(),{id:r,method:a}=t;switch(a){case"net_version":return void n(void 0,{jsonrpc:"2.0",id:r,result:`${s}`});case"eth_chainId":return void n(void 0,{jsonrpc:"2.0",id:r,result:x.hexlify(s)})}e(t,n,i)}),this.transport.cachedProvider=new oa,this.transport.cachedProvider.onUpdate((()=>{this.session||(this.session={providerCache:{}}),this.session.providerCache=this.transport.cachedProvider.getCache(),this.saveSession(this.session)})),this.transport.router=new ia([ha,this.transport.networkProvider,this.transport.allowProvider,la,this.transport.cachedProvider],this.transport.messageProvider),this.transport.provider=new Ta(this.transport.router),this.transport.messageProvider.on("open",(e=>{const{session:t}=e;t?this.useSession(t,!0):(this.session&&this.session.accountAddress&&this.transport.messageProvider.emit("disconnect"),this.clearSession())})),this.transport.messageProvider.on("accountsChanged",((e,t)=>{t?e.length>0&&this.useSession({accountAddress:e[0]},!0):e&&0!==e.length&&""!==e[0]?this.useSession({accountAddress:e[0]},!0):this.clearSession()})),this.transport.messageProvider.on("networks",(e=>{this.useSession({networks:e},!0)})),this.transport.messageProvider.on("walletContext",(e=>{this.useSession({walletContext:e},!0)})))},this.loadSession=async function(e){const t=await $a.getInstance().getItem("@sequence.session");if(t&&""!==t)try{const s=JSON.parse(t);if(s){if(void 0!==e){var i;const t="string"==typeof e?parseInt(e):e,n=n=>n.name===e||n.chainId===t,r=null==(i=s.networks)?void 0:i.find(n),a=null==r?void 0:r.isDefaultChain;if(s.networks&&r&&!a){const e=s.networks.map((e=>pa({},e,{isDefaultChain:n(e)})));s.networks=zr(e),s.providerCache=void 0}}n.useSession(s,!0)}return s}catch(e){return void qe.warn("loadSession failed, unable to parse session payload from storage.")}},this.connect=async function(e){if(!0===(null==e?void 0:e.refresh)&&n.disconnect(),n.isConnected()&&await n.isSiteConnected(null==e?void 0:e.origin)&&n.session&&(null==e||!e.authorize)&&(null==e||!e.askForEmail))return{connected:!0,session:n.session,chainId:x.hexlify(await n.getChainId())};if(e&&e.authorize&&(!e.app||""===e.app))throw new Error("connecting with 'authorize' option also requires 'app' to be set");await n.openWallet(void 0,{type:"connect",options:e});const t=await n.transport.messageProvider.waitUntilConnected().catch((e=>e instanceof Error?{connected:!1,error:e.message}:{connected:!1,error:JSON.stringify(e)}));if(t.connected){if(!t.session)throw new Error("impossible state, connect response is missing session");n.useSession(t.session,!0),n.addConnectedSite(null==e?void 0:e.origin)}return t},this.authorize=async function(e){return n.connect(pa({},e,{authorize:!0}))},this.getSession=()=>{if(this.isConnected())return this.session},this.getAddress=async function(){if(!n.isConnected())throw new Error("connect first");return n.getSession().accountAddress},this.getNetworks=async function(e){if(!n.isConnected()||!n.networks)throw new Error("connect first");if(e){const t=Yr(n.networks,e);return t?[t]:[]}return n.networks},this.getChainId=async function(){if(!n.networks||n.networks.length<1)throw new Error("networks have not been set by session. connect first.");const e=n.networks.find((e=>e.isDefaultChain));if(!e)throw new Error("networks must have a default chain specified");return e.chainId},this.getAuthChainId=async function(){if(!n.networks||n.networks.length<1)throw new Error("networks have not been set by session. connect first.");const e=n.networks.find((e=>e.isAuthChain));if(!e)throw new Error("networks must have an auth chain specified");return e.chainId},this.openWallet=async function(e,t,i){if("connect"!==(null==t?void 0:t.type)&&!n.isConnected())throw new Error("connect first");let s;return s=!n.networks||n.networks.length<1?n.config.defaultNetworkId:await n.getChainId(),n.transport.messageProvider.openWallet(e,t,i||s),await n.transport.messageProvider.waitUntilOpened(),!0},this.closeWallet=()=>{this.transport.messageProvider.closeWallet()},this.unregister=()=>{var e;this.disconnect(),null==(e=this.transport.messageProvider)||e.unregister()},this.saveSession=async function(e){qe.debug("wallet provider: saving session");const t=JSON.stringify(e);await $a.getInstance().setItem("@sequence.session",t)},this.useSession=async function(e,t=!0){n.session||(n.session={}),n.config.walletContext?n.session.walletContext=n.config.walletContext:e.walletContext&&(n.session.walletContext=e.walletContext),e.accountAddress&&n.useAccountAddress(e.accountAddress),e.networks&&n.useNetworks(e.networks),e.providerCache?n.transport.cachedProvider.setCache(e.providerCache):n.transport.cachedProvider.clearCache(),t&&n.saveSession(n.session)},this.config=pa({},mo),t&&(this.config=pa({},this.config,t)),e?this.config.defaultNetworkId=e:this.config.defaultNetworkId||(this.config.defaultNetworkId="mainnet"),null!=t&&t.localStorage&&$a.use(t.localStorage),this.transport={},this.networks=[],this.providers={},this.connectedSites=new Ka("@sequence.connectedSites",[]),this.utils=new go(this),this.init()}async addConnectedSite(e){e=e||window.location.origin;const t=await this.connectedSites.get();if(t){if(t.includes(e))return;this.connectedSites.set([...t,e])}else this.connectedSites.set([e])}async removeConnectedSite(e){const t=await this.connectedSites.get();t&&this.connectedSites.set(t.filter((t=>t!==e)))}getConnectedSites(){return this.connectedSites.get()}async isSiteConnected(e){const t=await this.connectedSites.get();return!!t&&t.includes(e||window.location.origin)}disconnect(){this.isOpened()&&this.closeWallet(),this.clearSession()}getProviderConfig(){return this.config}isOpened(){return this.transport.messageProvider.isOpened()}isConnected(){return void 0!==this.session&&void 0!==this.session.networks&&this.session.networks.length>0&&void 0!==this.networks&&this.networks.length>0&&!!this.session.accountAddress&&this.session.accountAddress.startsWith("0x")}getProvider(e){if(!this.isConnected()){if(e)throw new Error("session is empty. connect and try again.");return this.transport.provider}let t,n=this.networks.find((e=>e.isDefaultChain));if(e&&(n=Yr(this.networks,e),!n))throw new Error(`network ${e} is not in the network list`);if(this.providers[n.chainId])return this.providers[n.chainId];const i=n.provider?n.provider:new B.F(n.rpcUrl,n.chainId);if(n.isDefaultChain){const e=new ia([ha,la,new ca({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext}),new ua(this.transport.provider),this.transport.cachedProvider],new aa(i));t=new Ta(e,n.chainId)}else{const e=new ia([ha,la,new ca({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext,chainId:n.chainId}),new ua(this.transport.provider),new oa({defaultChainId:n.chainId})],new aa(i));t=new Ta(e,n.chainId)}return this.providers[n.chainId]=t,t}async getAuthProvider(){return this.getProvider((await this.getAuthNetwork()).chainId)}async getAuthNetwork(){return(await this.getNetworks()).find((e=>e.isAuthChain))}getAllProviders(){return this.providers}getSigner(e){return this.getProvider(e).getSigner()}async getAuthSigner(){return(await this.getAuthProvider()).getSigner()}getWalletConfig(e){return this.getSigner().getWalletConfig(e)}getWalletState(e){return this.getSigner().getWalletState(e)}getWalletContext(){return this.getSigner().getWalletContext()}isDeployed(e){return this.getSigner(e).isDeployed()}on(e,t){this.transport.messageProvider.on(e,t)}once(e,t){this.transport.messageProvider.once(e,t)}useAccountAddress(e){this.session||(this.session={}),this.session.accountAddress=N.getAddress(e)}useNetworks(e){if(this.session||(this.session={}),this.session.networks=e,this.session.networks&&0!==this.session.networks.length)if(this.config.networks||this.config.networkRpcUrl){if(this.networks=e,this.config.networks&&(this.networks=e.map((e=>pa({},e))),this.config.networks.forEach((e=>{const t=Yr(this.networks,e.chainId||e.name);t&&((e,t)=>{if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}})(e,t)})),Kr(this.networks,!0)),this.config.networkRpcUrl){const e=this.networks.find((e=>e.isDefaultChain));e&&(e.rpcUrl=this.config.networkRpcUrl)}}else this.networks=e}clearSession(){var e;qe.debug("wallet provider: clearing session"),$a.getInstance().removeItem("@sequence.session"),this.session=void 0,this.networks=[],this.providers={},null==(e=this.transport.cachedProvider)||e.clearCache()}}const mo={walletAppURL:"https://sequence.app",transports:{windowTransport:{enabled:!0},proxyTransport:{enabled:!1}}};let wo;const yo=async(e,t)=>wo||(wo=new fo(e,t),await wo.loadSession(e),wo),vo=()=>{wo&&(wo.closeWallet(),wo.unregister())},bo=()=>{if(!wo)throw new Error("Wallet has not been initialized, call sequence.initWallet(network, config) first.");return wo};function Eo(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var Co=Eo({__proto__:null},[i]),Io=Eo({__proto__:null},[s]),ko=Eo({__proto__:null},[p]),Ao=Eo({__proto__:null},[o]),To=Eo({__proto__:null},[d]),_o=Eo({__proto__:null},[c]),So=Eo({__proto__:null},[l]),No=Eo({__proto__:null},[a]),Oo=Eo({__proto__:null},[g]),xo=Eo({__proto__:null},[f]),Ro=Eo({__proto__:null},[u]),Mo=Eo({__proto__:null},[h]),Uo=Eo({__proto__:null,isValidSignature:qa,isValidMessageSignature:Ga,isValidTypedDataSignature:Fa,recoverWalletConfig:Wa,isWalletUpToDate:ja},[r]),Bo=Object.freeze({__proto__:null,abi:Co,api:Io,auth:ko,config:Ao,guard:To,indexer:_o,metadata:So,multicall:No,network:Oo,provider:xo,relayer:Ro,transactions:Mo,utils:Uo,initWallet:yo,getWallet:bo,Wallet:fo})},80639:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AbiCoder:()=>i.y,ConstructorFragment:()=>s.Pw,ErrorFragment:()=>s.bp,EventFragment:()=>s.Zp,FormatTypes:()=>s.$o,Fragment:()=>s.FK,FunctionFragment:()=>s.hc,HDNode:()=>f.HDNode,Indexed:()=>a.wu,Interface:()=>a.KA,LogDescription:()=>a.FW,Logger:()=>y.Logger,ParamType:()=>s.aX,RLP:()=>k,SigningKey:()=>A.SigningKey,SupportedAlgorithm:()=>M.q,TransactionDescription:()=>a.dJ,TransactionTypes:()=>N.TransactionTypes,UnicodeNormalizationForm:()=>_.dz,Utf8ErrorFuncs:()=>_.d5,Utf8ErrorReason:()=>_._E,_TypedDataEncoder:()=>g.z,_fetchData:()=>R._fetchData,_toEscapedUtf8String:()=>_.Wj,accessListify:()=>N.accessListify,arrayify:()=>h.arrayify,base58:()=>l.Base58,base64:()=>c,checkProperties:()=>I.checkProperties,checkResultErrors:()=>r.$v,commify:()=>O.commify,computeAddress:()=>N.computeAddress,computeHmac:()=>v.L5,computePublicKey:()=>A.computePublicKey,concat:()=>h.concat,deepCopy:()=>I.deepCopy,defaultAbiCoder:()=>i.D,defaultPath:()=>f.defaultPath,defineReadOnly:()=>I.defineReadOnly,dnsEncode:()=>d.Wh,entropyToMnemonic:()=>f.entropyToMnemonic,fetchJson:()=>R.fetchJson,formatBytes32String:()=>S.R,formatEther:()=>O.formatEther,formatUnits:()=>O.formatUnits,getAccountPath:()=>f.getAccountPath,getAddress:()=>o.getAddress,getContractAddress:()=>o.getContractAddress,getCreate2Address:()=>o.getCreate2Address,getIcapAddress:()=>o.getIcapAddress,getJsonWalletAddress:()=>m.cZ,getStatic:()=>I.getStatic,hashMessage:()=>u.A,hexConcat:()=>h.hexConcat,hexDataLength:()=>h.hexDataLength,hexDataSlice:()=>h.hexDataSlice,hexStripZeros:()=>h.hexStripZeros,hexValue:()=>h.hexValue,hexZeroPad:()=>h.hexZeroPad,hexlify:()=>h.hexlify,id:()=>p.id,isAddress:()=>o.isAddress,isBytes:()=>h.isBytes,isBytesLike:()=>h.isBytesLike,isHexString:()=>h.isHexString,isValidMnemonic:()=>f.isValidMnemonic,isValidName:()=>d.uV,joinSignature:()=>h.joinSignature,keccak256:()=>w.keccak256,mnemonicToEntropy:()=>f.mnemonicToEntropy,mnemonicToSeed:()=>f.mnemonicToSeed,namehash:()=>d.kM,nameprep:()=>T.j9,parseBytes32String:()=>S.V,parseEther:()=>O.parseEther,parseTransaction:()=>N.parse,parseUnits:()=>O.parseUnits,poll:()=>R.poll,randomBytes:()=>E.p,recoverAddress:()=>N.recoverAddress,recoverPublicKey:()=>A.recoverPublicKey,resolveProperties:()=>I.resolveProperties,ripemd160:()=>v.HE,serializeTransaction:()=>N.serialize,sha256:()=>v.sc,sha512:()=>v.Zf,shallowCopy:()=>I.shallowCopy,shuffled:()=>C.A,solidityKeccak256:()=>b.keccak256,solidityPack:()=>b.pack,soliditySha256:()=>b.sha256,splitSignature:()=>h.splitSignature,stripZeros:()=>h.stripZeros,toUtf8Bytes:()=>_.YW,toUtf8CodePoints:()=>_.dg,toUtf8String:()=>_._v,verifyMessage:()=>x.verifyMessage,verifyTypedData:()=>x.verifyTypedData,zeroPad:()=>h.zeroPad});var i=n(26596),s=n(3521),r=n(20297),a=n(87699),o=n(71277),c=n(57423),l=n(6593),h=n(5372),d=n(84324),u=n(82623),p=n(31507),g=n(37273),f=n(11559),m=n(64209),w=n(89729),y=n(27587),v=n(5465),b=n(58981),E=n(24495),C=n(10414),I=n(52428),k=n(19967),A=n(40379),T=n(14),_=n(97867),S=n(96330),N=n(57808),O=n(67387),x=n(53117),R=n(83546),M=n(41013)},39902:(e,t,n)=>{var i,s=n(39907);!function(r){var a=Object.hasOwnProperty,o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},c="object"==typeof s&&"function"==typeof s.nextTick,l="function"==typeof Symbol,h="object"==typeof Reflect,d="function"==typeof setImmediate?setImmediate:setTimeout,u=l?h&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function p(){this._events={},this._conf&&g.call(this,this._conf)}function g(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function f(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),void 0!==s&&s.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=e,s.emitWarning(i)}else console.error(n),console.trace&&console.trace()}var m=function(e,t,n){var i=arguments.length;switch(i){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var s=new Array(i);i--;)s[i]=arguments[i];return s}};function w(e,t){for(var n={},i=e.length,s=t?t.length:0,a=0;a<i;a++)n[e[a]]=a<s?t[a]:r;return n}function y(e,t,n){var i,s;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(i=n.on,s=n.off),t.addEventListener?(i=t.addEventListener,s=t.removeEventListener):t.addListener?(i=t.addListener,s=t.removeListener):t.on&&(i=t.on,s=t.off),!i&&!s)throw Error("target does not implement any known event API");if("function"!=typeof i)throw TypeError("on method must be a function");if("function"!=typeof s)throw TypeError("off method must be a function");this._on=i,this._off=s;var r=e._observers;r?r.push(this):e._observers=[this]}function v(e,t,n,i){var s=Object.assign({},t);if(!e)return s;if("object"!=typeof e)throw TypeError("options must be an object");var o,c,l,h=Object.keys(e),d=h.length;function u(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<d;p++){if(o=h[p],!i&&!a.call(t,o))throw Error('Unknown "'+o+'" option');(c=e[o])!==r&&(l=n[o],s[o]=l?l(c,u):c)}return s}function b(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function E(e){var t="value must be type of "+e.join("|"),n=e.length,i=e[0],s=e[1];return 1===n?function(e,n){if(typeof e===i)return e;n(t)}:2===n?function(e,n){var r=typeof e;if(r===i||r===s)return e;n(t)}:function(i,s){for(var r=typeof i,a=n;a-- >0;)if(r===e[a])return i;s(t)}}Object.assign(y.prototype,{subscribe:function(e,t,n){var i=this,s=this._target,r=this._emitter,a=this._listeners,o=function(){var i=m.apply(null,arguments),a={data:i,name:t,original:e};n?!1!==n.call(s,a)&&r.emit.apply(r,[a.name].concat(i)):r.emit.apply(r,[t].concat(i))};if(a[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,r._newListener&&r._removeListener&&!i._onNewListener?(this._onNewListener=function(n){n===t&&null===a[e]&&(a[e]=o,i._on.call(s,e,o))},r.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!r.hasListeners(n)&&a[e]&&(a[e]=null,i._off.call(s,e,o))},a[e]=null,r.on("removeListener",this._onRemoveListener)):(a[e]=o,i._on.call(s,e,o))},unsubscribe:function(e){var t,n,i,s=this,r=this._listeners,a=this._emitter,o=this._off,c=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function l(){s._onNewListener&&(a.off("newListener",s._onNewListener),a.off("removeListener",s._onRemoveListener),s._onNewListener=null,s._onRemoveListener=null);var e=A.call(a,s);a._observers.splice(e,1)}if(e){if(!(t=r[e]))return;o.call(c,e,t),delete r[e],--this._listenersCount||l()}else{for(i=(n=u(r)).length;i-- >0;)e=n[i],o.call(c,e,r[e]);this._listeners={},this._listenersCount=0,l()}}});var C=E(["function"]),I=E(["object","function"]);function k(e,t,n){var i,s,r,a=0,o=new e((function(c,l,h){function d(){s&&(s=null),a&&(clearTimeout(a),a=0)}n=v(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),i=!n.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof h;var u=function(e){d(),c(e)},p=function(e){d(),l(e)};i?t(u,p,h):(s=[function(e){p(e||Error("canceled"))}],t(u,p,(function(e){if(r)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");s.push(e)})),r=!0),n.timeout>0&&(a=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",a=0,o.cancel(e),l(e)}),n.timeout))}));return i||(o.cancel=function(e){if(s){for(var t=s.length,n=1;n<t;n++)s[n](e);s[0](e),s=null}}),o}function A(e){var t=this._observers;if(!t)return-1;for(var n=t.length,i=0;i<n;i++)if(t[i]._target===e)return i;return-1}function T(e,t,n,i,s){if(!n)return null;if(0===i){var r=typeof t;if("string"===r){var a,o,c=0,l=0,h=this.delimiter,d=h.length;if(-1!==(o=t.indexOf(h))){a=new Array(5);do{a[c++]=t.slice(l,o),l=o+d}while(-1!==(o=t.indexOf(h,l)));a[c++]=t.slice(l),t=a,s=c}else t=[t],s=1}else"object"===r?s=t.length:(t=[t],s=1)}var p,g,f,m,w,y,v,b=null,E=t[i],C=t[i+1];if(i===s)n._listeners&&("function"==typeof n._listeners?(e&&e.push(n._listeners),b=[n]):(e&&e.push.apply(e,n._listeners),b=[n]));else{if("*"===E){for(o=(y=u(n)).length;o-- >0;)"_listeners"!==(p=y[o])&&(v=T(e,t,n[p],i+1,s))&&(b?b.push.apply(b,v):b=v);return b}if("**"===E){for((w=i+1===s||i+2===s&&"*"===C)&&n._listeners&&(b=T(e,t,n,s,s)),o=(y=u(n)).length;o-- >0;)"_listeners"!==(p=y[o])&&("*"===p||"**"===p?(n[p]._listeners&&!w&&(v=T(e,t,n[p],s,s))&&(b?b.push.apply(b,v):b=v),v=T(e,t,n[p],i,s)):v=T(e,t,n[p],p===C?i+2:i,s),v&&(b?b.push.apply(b,v):b=v));return b}n[E]&&(b=T(e,t,n[E],i+1,s))}if((g=n["*"])&&T(e,t,g,i+1,s),f=n["**"])if(i<s)for(f._listeners&&T(e,t,f,s,s),o=(y=u(f)).length;o-- >0;)"_listeners"!==(p=y[o])&&(p===C?T(e,t,f[p],i+2,s):p===E?T(e,t,f[p],i+1,s):((m={})[p]=f[p],T(e,t,{"**":m},i+1,s)));else f._listeners?T(e,t,f,s,s):f["*"]&&f["*"]._listeners&&T(e,t,f["*"],s,s);return b}function _(e,t,n){var i,s,r=0,a=0,o=this.delimiter,c=o.length;if("string"==typeof e)if(-1!==(i=e.indexOf(o))){s=new Array(5);do{s[r++]=e.slice(a,i),a=i+c}while(-1!==(i=e.indexOf(o,a)));s[r++]=e.slice(a)}else s=[e],r=1;else s=e,r=e.length;if(r>1)for(i=0;i+1<r;i++)if("**"===s[i]&&"**"===s[i+1])return;var l,h=this.listenerTree;for(i=0;i<r;i++)if(h=h[l=s[i]]||(h[l]={}),i===r-1)return h._listeners?("function"==typeof h._listeners&&(h._listeners=[h._listeners]),n?h._listeners.unshift(t):h._listeners.push(t),!h._listeners.warned&&this._maxListeners>0&&h._listeners.length>this._maxListeners&&(h._listeners.warned=!0,f.call(this,h._listeners.length,l))):h._listeners=t,!0;return!0}function S(e,t,n,i){for(var s,r,a,o,c=u(e),l=c.length,h=e._listeners;l-- >0;)s=e[r=c[l]],a="_listeners"===r?n:n?n.concat(r):[r],o=i||"symbol"==typeof r,h&&t.push(o?a:a.join(this.delimiter)),"object"==typeof s&&S.call(this,s,t,a,o);return t}function N(e){for(var t,n,i,s=u(e),r=s.length;r-- >0;)(t=e[n=s[r]])&&(i=!0,"_listeners"===n||N(t)||delete e[n]);return i}function O(e,t,n){this.emitter=e,this.event=t,this.listener=n}function x(e,t,n){if(!0===n)a=!0;else if(!1===n)i=!0;else{if(!n||"object"!=typeof n)throw TypeError("options should be an object or true");var i=n.async,a=n.promisify,o=n.nextTick,l=n.objectify}if(i||o||a){var h=t,u=t._origin||t;if(o&&!c)throw Error("process.nextTick is not supported");a===r&&(a="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,n=this.event;return a?o?Promise.resolve():new Promise((function(e){d(e)})).then((function(){return t.event=n,h.apply(t,e)})):(o?s.nextTick:d)((function(){t.event=n,h.apply(t,e)}))},t._async=!0,t._origin=u}return[t,l?new O(this,e,t):this]}function R(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,g.call(this,e)}O.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},R.EventEmitter2=R,R.prototype.listenTo=function(e,t,n){if("object"!=typeof e)throw TypeError("target musts be an object");var i=this;function s(t){if("object"!=typeof t)throw TypeError("events must be an object");var s,r=n.reducers,a=A.call(i,e);s=-1===a?new y(i,e,n):i._observers[a];for(var o,c=u(t),l=c.length,h="function"==typeof r,d=0;d<l;d++)o=c[d],s.subscribe(o,t[o]||o,h?r:r&&r[o])}return n=v(n,{on:r,off:r,reducers:r},{on:C,off:C,reducers:I}),o(t)?s(w(t)):s("string"==typeof t?w(t.split(/\s+/)):t),this},R.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var i,s=n.length,r=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;s-- >0;)i=n[s],e&&i._target!==e||(i.unsubscribe(t),r=!0);return r},R.prototype.delimiter=".",R.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},R.prototype.getMaxListeners=function(){return this._maxListeners},R.prototype.event="",R.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},R.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},R.prototype._once=function(e,t,n,i){return this._many(e,1,t,n,i)},R.prototype.many=function(e,t,n,i){return this._many(e,t,n,!1,i)},R.prototype.prependMany=function(e,t,n,i){return this._many(e,t,n,!0,i)},R.prototype._many=function(e,t,n,i,s){var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function a(){return 0==--t&&r.off(e,a),n.apply(this,arguments)}return a._origin=n,this._on(e,a,i,s)},R.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var e,t,n,i,s,r,a=arguments[0],o=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return!1;if(o&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(n=a.length,l)for(i=0;i<n;i++)if("symbol"==typeof a[i]){r=!0;break}r||(a=a.join(this.delimiter))}var c,h=arguments.length;if(this._all&&this._all.length)for(i=0,n=(c=this._all.slice()).length;i<n;i++)switch(this.event=a,h){case 1:c[i].call(this,a);break;case 2:c[i].call(this,a,arguments[1]);break;case 3:c[i].call(this,a,arguments[1],arguments[2]);break;default:c[i].apply(this,arguments)}if(o)c=[],T.call(this,c,e,this.listenerTree,0,n);else{if("function"==typeof(c=this._events[a])){switch(this.event=a,h){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(h-1),s=1;s<h;s++)t[s-1]=arguments[s];c.apply(this,t)}return!0}c&&(c=c.slice())}if(c&&c.length){if(h>3)for(t=new Array(h-1),s=1;s<h;s++)t[s-1]=arguments[s];for(i=0,n=c.length;i<n;i++)switch(this.event=a,h){case 1:c[i].call(this);break;case 2:c[i].call(this,arguments[1]);break;case 3:c[i].call(this,arguments[1],arguments[2]);break;default:c[i].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===a)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},R.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var e,t,n,i,s,r,a=arguments[0],o=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(o&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(i=a.length,l)for(s=0;s<i;s++)if("symbol"==typeof a[s]){t=!0;break}t||(a=a.join(this.delimiter))}var c,h=[],d=arguments.length;if(this._all)for(s=0,i=this._all.length;s<i;s++)switch(this.event=a,d){case 1:h.push(this._all[s].call(this,a));break;case 2:h.push(this._all[s].call(this,a,arguments[1]));break;case 3:h.push(this._all[s].call(this,a,arguments[1],arguments[2]));break;default:h.push(this._all[s].apply(this,arguments))}if(o?(c=[],T.call(this,c,e,this.listenerTree,0)):c=this._events[a],"function"==typeof c)switch(this.event=a,d){case 1:h.push(c.call(this));break;case 2:h.push(c.call(this,arguments[1]));break;case 3:h.push(c.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(d-1),r=1;r<d;r++)n[r-1]=arguments[r];h.push(c.apply(this,n))}else if(c&&c.length){if(c=c.slice(),d>3)for(n=new Array(d-1),r=1;r<d;r++)n[r-1]=arguments[r];for(s=0,i=c.length;s<i;s++)switch(this.event=a,d){case 1:h.push(c[s].call(this));break;case 2:h.push(c[s].call(this,arguments[1]));break;case 3:h.push(c[s].call(this,arguments[1],arguments[2]));break;default:h.push(c[s].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===a)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(h)},R.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},R.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},R.prototype.onAny=function(e){return this._onAny(e,!1)},R.prototype.prependAny=function(e){return this._onAny(e,!0)},R.prototype.addListener=R.prototype.on,R.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},R.prototype._on=function(e,t,n,i){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");this._events||p.call(this);var s,a=this;return i!==r&&(t=(s=x.call(this,e,t,i))[0],a=s[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(_.call(this,e,t,n),a):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,f.call(this,this._events[e].length,e))):this._events[e]=t,a)},R.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();if(!(i=T.call(this,null,s,this.listenerTree,0)))return this}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var r=0;r<i.length;r++){var a=i[r];if(n=a._listeners,o(n)){for(var c=-1,l=0,h=n.length;l<h;l++)if(n[l]===t||n[l].listener&&n[l].listener===t||n[l]._origin&&n[l]._origin===t){c=l;break}if(c<0)continue;return this.wildcard?a._listeners.splice(c,1):this._events[e].splice(c,1),0===n.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&N(this.listenerTree),this},R.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(n=0,i=(t=this._all).length;n<i;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,i=t.length;n<i;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},R.prototype.removeListener=R.prototype.off,R.prototype.removeAllListeners=function(e){if(e===r)return!this._events||p.call(this),this;if(this.wildcard){var t,n=T.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&N(this.listenerTree)}else this._events&&(this._events[e]=null);return this},R.prototype.listeners=function(e){var t,n,i,s,a,o=this._events;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(s=(t=u(o)).length,i=[];s-- >0;)"function"==typeof(n=o[t[s]])?i.push(n):i.push.apply(i,n);return i}if(this.wildcard){if(!(a=this.listenerTree))return[];var c=[],l="string"==typeof e?e.split(this.delimiter):e.slice();return T.call(this,c,l,a,0),c}return o&&(n=o[e])?"function"==typeof n?[n]:n:[]},R.prototype.eventNames=function(e){var t=this._events;return this.wildcard?S.call(this,this.listenerTree,[],null,e):t?u(t):[]},R.prototype.listenerCount=function(e){return this.listeners(e).length},R.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return T.call(this,t,n,this.listenerTree,0),t.length>0}var i=this._events,s=this._all;return!!(s&&s.length||i&&(e===r?u(i).length:i[e]))},R.prototype.listenersAny=function(){return this._all?this._all:[]},R.prototype.waitFor=function(e,t){var n=this,i=typeof t;return"number"===i?t={timeout:t}:"function"===i&&(t={filter:t}),k((t=v(t,{timeout:0,filter:r,handleError:!1,Promise,overload:!1},{filter:C,Promise:b})).Promise,(function(i,s,r){function a(){var r=t.filter;if(!r||r.apply(n,arguments))if(n.off(e,a),t.handleError){var o=arguments[0];o?s(o):i(m.apply(null,arguments).slice(1))}else i(m.apply(null,arguments))}r((function(){n.off(e,a)})),n._on(e,a,!1)}),{timeout:t.timeout,overload:t.overload})};var M=R.prototype;Object.defineProperties(R,{defaultMaxListeners:{get:function(){return M._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");M._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return k((n=v(n,{Promise,timeout:0,overload:!1},{Promise:b})).Promise,(function(n,i,s){var r;if("function"==typeof e.addEventListener)return r=function(){n(m.apply(null,arguments))},s((function(){e.removeEventListener(t,r)})),void e.addEventListener(t,r,{once:!0});var a,o=function(){a&&e.removeListener("error",a),n(m.apply(null,arguments))};"error"!==t&&(a=function(n){e.removeListener(t,o),i(n)},e.once("error",a)),s((function(){a&&e.removeListener("error",a),e.removeListener(t,o)})),e.once(t,o)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(M,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(i=function(){return R}.call(t,n,t,e))===r||(e.exports=i)}()}}]);