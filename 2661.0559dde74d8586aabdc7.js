(("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect=("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect||[]).push([[2661],{48e3:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Account:()=>D,AddressLookupTableAccount:()=>te,AddressLookupTableInstruction:()=>Qi,AddressLookupTableProgram:()=>tr,Authorized:()=>lr,BLOCKHASH_CACHE_TIMEOUT_MS:()=>oe,BPF_LOADER_DEPRECATED_PROGRAM_ID:()=>U,BPF_LOADER_PROGRAM_ID:()=>Ut,BpfLoader:()=>jt,COMPUTE_BUDGET_INSTRUCTION_LAYOUTS:()=>ir,ComputeBudgetInstruction:()=>er,ComputeBudgetProgram:()=>rr,Connection:()=>Gi,Ed25519Program:()=>sr,Enum:()=>C,EpochSchedule:()=>Zt,FeeCalculatorLayout:()=>xt,Keypair:()=>Zi,LAMPORTS_PER_SOL:()=>Nr,LOOKUP_TABLE_INSTRUCTION_LAYOUTS:()=>Xi,Loader:()=>Dt,Lockup:()=>dr,MAX_SEED_LENGTH:()=>z,Message:()=>ct,MessageAccountKeys:()=>G,MessageV0:()=>ut,NONCE_ACCOUNT_LENGTH:()=>Ct,NonceAccount:()=>Wt,PACKET_DATA_SIZE:()=>j,PUBLIC_KEY_LENGTH:()=>K,PublicKey:()=>q,SIGNATURE_LENGTH_IN_BYTES:()=>$,SOLANA_SCHEMA:()=>W,STAKE_CONFIG_ID:()=>hr,STAKE_INSTRUCTION_LAYOUTS:()=>fr,SYSTEM_INSTRUCTION_LAYOUTS:()=>Kt,SYSVAR_CLOCK_PUBKEY:()=>yt,SYSVAR_EPOCH_SCHEDULE_PUBKEY:()=>bt,SYSVAR_INSTRUCTIONS_PUBKEY:()=>wt,SYSVAR_RECENT_BLOCKHASHES_PUBKEY:()=>vt,SYSVAR_RENT_PUBKEY:()=>kt,SYSVAR_REWARDS_PUBKEY:()=>St,SYSVAR_SLOT_HASHES_PUBKEY:()=>It,SYSVAR_SLOT_HISTORY_PUBKEY:()=>At,SYSVAR_STAKE_HISTORY_PUBKEY:()=>_t,Secp256k1Program:()=>cr,SendTransactionError:()=>Et,SolanaJSONRPCError:()=>Mt,SolanaJSONRPCErrorCode:()=>Pt,StakeAuthorizationLayout:()=>gr,StakeInstruction:()=>pr,StakeProgram:()=>mr,Struct:()=>N,SystemInstruction:()=>zt,SystemProgram:()=>Yt,Transaction:()=>ft,TransactionExpiredBlockheightExceededError:()=>V,TransactionExpiredNonceInvalidError:()=>J,TransactionExpiredTimeoutError:()=>F,TransactionInstruction:()=>pt,TransactionMessage:()=>gt,TransactionStatus:()=>lt,VALIDATOR_INFO_KEY:()=>Sr,VERSION_PREFIX_MASK:()=>H,VOTE_PROGRAM_ID:()=>_r,ValidatorInfo:()=>Ar,VersionedMessage:()=>ht,VersionedTransaction:()=>mt,VoteAccount:()=>Pr,VoteAuthorizationLayout:()=>vr,VoteInit:()=>yr,VoteInstruction:()=>br,VoteProgram:()=>kr,clusterApiUrl:()=>Or,sendAndConfirmRawTransaction:()=>xr,sendAndConfirmTransaction:()=>Tt});var r=i(1048),n=i(57622),s=i(78404),o=i.n(s),a=i(39216),c=i.n(a),u=i(52001),h=i(81818),l=i(78918);function d(t){return Array.isArray(t)?"%5B"+t.map(d).join("%2C%20")+"%5D":"bigint"==typeof t?`${t}n`:encodeURIComponent(String(null!=t&&null===Object.getPrototypeOf(t)?{...t}:t))}function p([t,e]){return`${t}=${d(e)}`}var f=class extends Error{cause=this.cause;context;constructor(...[t,e]){let i,r;if(e){const{cause:t,...n}=e;t&&(r={cause:t}),Object.keys(n).length>0&&(i=n)}super(function(t,e={}){{let i=`Solana error #${t}; Decode this error by running \`npx @solana/errors decode -- ${t}`;return Object.keys(e).length&&(i+=` '${function(t){const e=Object.entries(t).map(p).join("&");return btoa(e)}(e)}'`),`${i}\``}}(t,i),r),this.context={__code:t,...i},this.name="SolanaError"}};function g(t){return"fixedSize"in t&&"number"==typeof t.fixedSize}function m(t){return 1!==t?.endian}function y(t){return e={fixedSize:t.size,write(e,i,r){t.range&&function(t,e,i,r){if(r<e||r>i)throw new f(8078011,{codecDescription:t,max:i,min:e,value:r})}(t.name,t.range[0],t.range[1],e);const n=new ArrayBuffer(t.size);return t.set(new DataView(n),e,m(t.config)),i.set(new Uint8Array(n),r),r+t.size}},Object.freeze({...e,encode:t=>{const i=new Uint8Array(function(t,e){return"fixedSize"in e?e.fixedSize:e.getSizeFromValue(t)}(t,e));return e.write(t,i,0),i}});var e}function b(t){return e={fixedSize:t.size,read(e,i=0){!function(t,e,i=0){if(e.length-i<=0)throw new f(8078e3,{codecDescription:t})}(t.name,e,i),function(t,e,i,r=0){const n=i.length-r;if(n<e)throw new f(8078001,{bytesLength:n,codecDescription:t,expected:e})}(t.name,t.size,e,i);const r=new DataView(function(t,e,i){const r=t.byteOffset+(e??0),n=i??t.byteLength;return t.buffer.slice(r,r+n)}(e,i,t.size));return[t.get(r,m(t.config)),i+t.size]}},Object.freeze({...e,decode:(t,i=0)=>e.read(t,i)[0]});var e}var w=(t={})=>y({config:t,name:"u64",range:[0n,BigInt("0xffffffffffffffff")],set:(t,e,i)=>t.setBigUint64(0,BigInt(e),i),size:8}),v=(t={})=>function(t,e){if(g(t)!==g(e))throw new f(8078004);if(g(t)&&g(e)&&t.fixedSize!==e.fixedSize)throw new f(8078005,{decoderFixedSize:e.fixedSize,encoderFixedSize:t.fixedSize});if(!g(t)&&!g(e)&&t.maxSize!==e.maxSize)throw new f(8078006,{decoderMaxSize:e.maxSize,encoderMaxSize:t.maxSize});return{...e,...t,decode:e.decode,encode:t.encode,read:e.read,write:t.write}}(w(t),((t={})=>b({config:t,get:(t,e)=>t.getBigUint64(0,e),name:"u64",size:8}))(t)),k=i(57251),S=i(59499),I=i.n(S),A=i(96396),_=i(30113),E=i(72896);const P=n.ev.utils.randomPrivateKey,M=()=>{const t=n.ev.utils.randomPrivateKey(),e=T(t),i=new Uint8Array(64);return i.set(t),i.set(e,32),{publicKey:e,secretKey:i}},T=n.ev.getPublicKey;function B(t){try{return n.ev.ExtendedPoint.fromHex(t),!0}catch{return!1}}const R=(t,e)=>n.ev.sign(t,e.slice(0,32)),O=n.ev.verify,x=t=>r.Buffer.isBuffer(t)?t:t instanceof Uint8Array?r.Buffer.from(t.buffer,t.byteOffset,t.byteLength):r.Buffer.from(t);class N{constructor(t){Object.assign(this,t)}encode(){return r.Buffer.from((0,h.serialize)(W,this))}static decode(t){return(0,h.deserialize)(W,this,t)}static decodeUnchecked(t){return(0,h.deserializeUnchecked)(W,this,t)}}class C extends N{constructor(t){if(super(t),this.enum="",1!==Object.keys(t).length)throw new Error("Enum can only take single value");Object.keys(t).map(t=>{this.enum=t})}}const W=new Map;var L;const z=32,K=32;let Y=1;class q extends N{constructor(t){if(super({}),this._bn=void 0,function(t){return void 0!==t._bn}(t))this._bn=t._bn;else{if("string"==typeof t){const e=c().decode(t);if(e.length!=K)throw new Error("Invalid public key input");this._bn=new(o())(e)}else this._bn=new(o())(t);if(this._bn.byteLength()>K)throw new Error("Invalid public key input")}}static unique(){const t=new q(Y);return Y+=1,new q(t.toBuffer())}equals(t){return this._bn.eq(t._bn)}toBase58(){return c().encode(this.toBytes())}toJSON(){return this.toBase58()}toBytes(){const t=this.toBuffer();return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}toBuffer(){const t=this._bn.toArrayLike(r.Buffer);if(t.length===K)return t;const e=r.Buffer.alloc(32);return t.copy(e,32-t.length),e}get[Symbol.toStringTag](){return`PublicKey(${this.toString()})`}toString(){return this.toBase58()}static async createWithSeed(t,e,i){const n=r.Buffer.concat([t.toBuffer(),r.Buffer.from(e),i.toBuffer()]),s=(0,u.sc)(n);return new q(s)}static createProgramAddressSync(t,e){let i=r.Buffer.alloc(0);t.forEach(function(t){if(t.length>z)throw new TypeError("Max seed length exceeded");i=r.Buffer.concat([i,x(t)])}),i=r.Buffer.concat([i,e.toBuffer(),r.Buffer.from("ProgramDerivedAddress")]);const n=(0,u.sc)(i);if(B(n))throw new Error("Invalid seeds, address must fall off the curve");return new q(n)}static async createProgramAddress(t,e){return this.createProgramAddressSync(t,e)}static findProgramAddressSync(t,e){let i,n=255;for(;0!=n;){try{const s=t.concat(r.Buffer.from([n]));i=this.createProgramAddressSync(s,e)}catch(t){if(t instanceof TypeError)throw t;n--;continue}return[i,n]}throw new Error("Unable to find a viable program address nonce")}static async findProgramAddress(t,e){return this.findProgramAddressSync(t,e)}static isOnCurve(t){return B(new q(t).toBytes())}}L=q,q.default=new L("11111111111111111111111111111111"),W.set(q,{kind:"struct",fields:[["_bn","u256"]]});class D{constructor(t){if(this._publicKey=void 0,this._secretKey=void 0,t){const e=x(t);if(64!==t.length)throw new Error("bad secret key size");this._publicKey=e.slice(32,64),this._secretKey=e.slice(0,32)}else this._secretKey=x(P()),this._publicKey=x(T(this._secretKey))}get publicKey(){return new q(this._publicKey)}get secretKey(){return r.Buffer.concat([this._secretKey,this._publicKey],64)}}const U=new q("BPFLoader1111111111111111111111111111111111"),j=1232,H=127,$=64;class V extends Error{constructor(t){super(`Signature ${t} has expired: block height exceeded.`),this.signature=void 0,this.signature=t}}Object.defineProperty(V.prototype,"name",{value:"TransactionExpiredBlockheightExceededError"});class F extends Error{constructor(t,e){super(`Transaction was not confirmed in ${e.toFixed(2)} seconds. It is unknown if it succeeded or failed. Check signature ${t} using the Solana Explorer or CLI tools.`),this.signature=void 0,this.signature=t}}Object.defineProperty(F.prototype,"name",{value:"TransactionExpiredTimeoutError"});class J extends Error{constructor(t){super(`Signature ${t} has expired: the nonce is no longer valid.`),this.signature=void 0,this.signature=t}}Object.defineProperty(J.prototype,"name",{value:"TransactionExpiredNonceInvalidError"});class G{constructor(t,e){this.staticAccountKeys=void 0,this.accountKeysFromLookups=void 0,this.staticAccountKeys=t,this.accountKeysFromLookups=e}keySegments(){const t=[this.staticAccountKeys];return this.accountKeysFromLookups&&(t.push(this.accountKeysFromLookups.writable),t.push(this.accountKeysFromLookups.readonly)),t}get(t){for(const e of this.keySegments()){if(t<e.length)return e[t];t-=e.length}}get length(){return this.keySegments().flat().length}compileInstructions(t){if(this.length>256)throw new Error("Account index overflow encountered during compilation");const e=new Map;this.keySegments().flat().forEach((t,i)=>{e.set(t.toBase58(),i)});const i=t=>{const i=e.get(t.toBase58());if(void 0===i)throw new Error("Encountered an unknown instruction account key during compilation");return i};return t.map(t=>({programIdIndex:i(t.programId),accountKeyIndexes:t.keys.map(t=>i(t.pubkey)),data:t.data}))}}const Z=(t="publicKey")=>l.av(32,t),X=(t="signature")=>l.av(64,t),Q=(t="string")=>{const e=l.w3([l.DH("length"),l.DH("lengthPadding"),l.av(l.cY(l.DH(),-8),"chars")],t),i=e.decode.bind(e),n=e.encode.bind(e),s=e;return s.decode=(t,e)=>i(t,e).chars.toString(),s.encode=(t,e,i)=>{const s={chars:r.Buffer.from(t,"utf8")};return n(s,e,i)},s.alloc=t=>l.DH().span+l.DH().span+r.Buffer.from(t,"utf8").length,s};function tt(t,e){const i=t=>{if(t.span>=0)return t.span;if("function"==typeof t.alloc)return t.alloc(e[t.property]);if("count"in t&&"elementLayout"in t){const r=e[t.property];if(Array.isArray(r))return r.length*i(t.elementLayout)}else if("fields"in t)return tt({layout:t},e[t.property]);return 0};let r=0;return t.layout.fields.forEach(t=>{r+=i(t)}),r}function et(t){let e=0,i=0;for(;;){let r=t.shift();if(e|=(127&r)<<7*i,i+=1,!(128&r))break}return e}function it(t,e){let i=e;for(;;){let e=127&i;if(i>>=7,0==i){t.push(e);break}e|=128,t.push(e)}}function rt(t,e){if(!t)throw new Error(e||"Assertion failed")}class nt{constructor(t,e){this.payer=void 0,this.keyMetaMap=void 0,this.payer=t,this.keyMetaMap=e}static compile(t,e){const i=new Map,r=t=>{const e=t.toBase58();let r=i.get(e);return void 0===r&&(r={isSigner:!1,isWritable:!1,isInvoked:!1},i.set(e,r)),r},n=r(e);n.isSigner=!0,n.isWritable=!0;for(const e of t){r(e.programId).isInvoked=!0;for(const t of e.keys){const e=r(t.pubkey);e.isSigner||=t.isSigner,e.isWritable||=t.isWritable}}return new nt(e,i)}getMessageComponents(){const t=[...this.keyMetaMap.entries()];rt(t.length<=256,"Max static account keys length exceeded");const e=t.filter(([,t])=>t.isSigner&&t.isWritable),i=t.filter(([,t])=>t.isSigner&&!t.isWritable),r=t.filter(([,t])=>!t.isSigner&&t.isWritable),n=t.filter(([,t])=>!t.isSigner&&!t.isWritable),s={numRequiredSignatures:e.length+i.length,numReadonlySignedAccounts:i.length,numReadonlyUnsignedAccounts:n.length};{rt(e.length>0,"Expected at least one writable signer key");const[t]=e[0];rt(t===this.payer.toBase58(),"Expected first writable signer key to be the fee payer")}return[s,[...e.map(([t])=>new q(t)),...i.map(([t])=>new q(t)),...r.map(([t])=>new q(t)),...n.map(([t])=>new q(t))]]}extractTableLookup(t){const[e,i]=this.drainKeysFoundInLookupTable(t.state.addresses,t=>!t.isSigner&&!t.isInvoked&&t.isWritable),[r,n]=this.drainKeysFoundInLookupTable(t.state.addresses,t=>!t.isSigner&&!t.isInvoked&&!t.isWritable);if(0!==e.length||0!==r.length)return[{accountKey:t.key,writableIndexes:e,readonlyIndexes:r},{writable:i,readonly:n}]}drainKeysFoundInLookupTable(t,e){const i=new Array,r=new Array;for(const[n,s]of this.keyMetaMap.entries())if(e(s)){const e=new q(n),s=t.findIndex(t=>t.equals(e));s>=0&&(rt(s<256,"Max lookup table index exceeded"),i.push(s),r.push(e),this.keyMetaMap.delete(n))}return[i,r]}}const st="Reached end of buffer unexpectedly";function ot(t){if(0===t.length)throw new Error(st);return t.shift()}function at(t,...e){const[i]=e;if(2===e.length?i+(e[1]??0)>t.length:i>=t.length)throw new Error(st);return t.splice(...e)}class ct{constructor(t){this.header=void 0,this.accountKeys=void 0,this.recentBlockhash=void 0,this.instructions=void 0,this.indexToProgramIds=new Map,this.header=t.header,this.accountKeys=t.accountKeys.map(t=>new q(t)),this.recentBlockhash=t.recentBlockhash,this.instructions=t.instructions,this.instructions.forEach(t=>this.indexToProgramIds.set(t.programIdIndex,this.accountKeys[t.programIdIndex]))}get version(){return"legacy"}get staticAccountKeys(){return this.accountKeys}get compiledInstructions(){return this.instructions.map(t=>({programIdIndex:t.programIdIndex,accountKeyIndexes:t.accounts,data:c().decode(t.data)}))}get addressTableLookups(){return[]}getAccountKeys(){return new G(this.staticAccountKeys)}static compile(t){const e=nt.compile(t.instructions,t.payerKey),[i,r]=e.getMessageComponents(),n=new G(r).compileInstructions(t.instructions).map(t=>({programIdIndex:t.programIdIndex,accounts:t.accountKeyIndexes,data:c().encode(t.data)}));return new ct({header:i,accountKeys:r,recentBlockhash:t.recentBlockhash,instructions:n})}isAccountSigner(t){return t<this.header.numRequiredSignatures}isAccountWritable(t){const e=this.header.numRequiredSignatures;return t>=this.header.numRequiredSignatures?t-e<this.accountKeys.length-e-this.header.numReadonlyUnsignedAccounts:t<e-this.header.numReadonlySignedAccounts}isProgramId(t){return this.indexToProgramIds.has(t)}programIds(){return[...this.indexToProgramIds.values()]}nonProgramIds(){return this.accountKeys.filter((t,e)=>!this.isProgramId(e))}serialize(){const t=this.accountKeys.length;let e=[];it(e,t);const i=this.instructions.map(t=>{const{accounts:e,programIdIndex:i}=t,n=Array.from(c().decode(t.data));let s=[];it(s,e.length);let o=[];return it(o,n.length),{programIdIndex:i,keyIndicesCount:r.Buffer.from(s),keyIndices:e,dataLength:r.Buffer.from(o),data:n}});let n=[];it(n,i.length);let s=r.Buffer.alloc(j);r.Buffer.from(n).copy(s);let o=n.length;i.forEach(t=>{const e=l.w3([l.u8("programIdIndex"),l.av(t.keyIndicesCount.length,"keyIndicesCount"),l.O6(l.u8("keyIndex"),t.keyIndices.length,"keyIndices"),l.av(t.dataLength.length,"dataLength"),l.O6(l.u8("userdatum"),t.data.length,"data")]).encode(t,s,o);o+=e}),s=s.slice(0,o);const a=l.w3([l.av(1,"numRequiredSignatures"),l.av(1,"numReadonlySignedAccounts"),l.av(1,"numReadonlyUnsignedAccounts"),l.av(e.length,"keyCount"),l.O6(Z("key"),t,"keys"),Z("recentBlockhash")]),u={numRequiredSignatures:r.Buffer.from([this.header.numRequiredSignatures]),numReadonlySignedAccounts:r.Buffer.from([this.header.numReadonlySignedAccounts]),numReadonlyUnsignedAccounts:r.Buffer.from([this.header.numReadonlyUnsignedAccounts]),keyCount:r.Buffer.from(e),keys:this.accountKeys.map(t=>x(t.toBytes())),recentBlockhash:c().decode(this.recentBlockhash)};let h=r.Buffer.alloc(2048);const d=a.encode(u,h);return s.copy(h,d),h.slice(0,d+s.length)}static from(t){let e=[...t];const i=ot(e);if(i!==(i&H))throw new Error("Versioned messages must be deserialized with VersionedMessage.deserialize()");const n=ot(e),s=ot(e),o=et(e);let a=[];for(let t=0;t<o;t++){const t=at(e,0,K);a.push(new q(r.Buffer.from(t)))}const u=at(e,0,K),h=et(e);let l=[];for(let t=0;t<h;t++){const t=ot(e),i=at(e,0,et(e)),n=at(e,0,et(e)),s=c().encode(r.Buffer.from(n));l.push({programIdIndex:t,accounts:i,data:s})}const d={header:{numRequiredSignatures:i,numReadonlySignedAccounts:n,numReadonlyUnsignedAccounts:s},recentBlockhash:c().encode(r.Buffer.from(u)),accountKeys:a,instructions:l};return new ct(d)}}class ut{constructor(t){this.header=void 0,this.staticAccountKeys=void 0,this.recentBlockhash=void 0,this.compiledInstructions=void 0,this.addressTableLookups=void 0,this.header=t.header,this.staticAccountKeys=t.staticAccountKeys,this.recentBlockhash=t.recentBlockhash,this.compiledInstructions=t.compiledInstructions,this.addressTableLookups=t.addressTableLookups}get version(){return 0}get numAccountKeysFromLookups(){let t=0;for(const e of this.addressTableLookups)t+=e.readonlyIndexes.length+e.writableIndexes.length;return t}getAccountKeys(t){let e;if(t&&"accountKeysFromLookups"in t&&t.accountKeysFromLookups){if(this.numAccountKeysFromLookups!=t.accountKeysFromLookups.writable.length+t.accountKeysFromLookups.readonly.length)throw new Error("Failed to get account keys because of a mismatch in the number of account keys from lookups");e=t.accountKeysFromLookups}else if(t&&"addressLookupTableAccounts"in t&&t.addressLookupTableAccounts)e=this.resolveAddressTableLookups(t.addressLookupTableAccounts);else if(this.addressTableLookups.length>0)throw new Error("Failed to get account keys because address table lookups were not resolved");return new G(this.staticAccountKeys,e)}isAccountSigner(t){return t<this.header.numRequiredSignatures}isAccountWritable(t){const e=this.header.numRequiredSignatures,i=this.staticAccountKeys.length;return t>=i?t-i<this.addressTableLookups.reduce((t,e)=>t+e.writableIndexes.length,0):t>=this.header.numRequiredSignatures?t-e<i-e-this.header.numReadonlyUnsignedAccounts:t<e-this.header.numReadonlySignedAccounts}resolveAddressTableLookups(t){const e={writable:[],readonly:[]};for(const i of this.addressTableLookups){const r=t.find(t=>t.key.equals(i.accountKey));if(!r)throw new Error(`Failed to find address lookup table account for table key ${i.accountKey.toBase58()}`);for(const t of i.writableIndexes){if(!(t<r.state.addresses.length))throw new Error(`Failed to find address for index ${t} in address lookup table ${i.accountKey.toBase58()}`);e.writable.push(r.state.addresses[t])}for(const t of i.readonlyIndexes){if(!(t<r.state.addresses.length))throw new Error(`Failed to find address for index ${t} in address lookup table ${i.accountKey.toBase58()}`);e.readonly.push(r.state.addresses[t])}}return e}static compile(t){const e=nt.compile(t.instructions,t.payerKey),i=new Array,r={writable:new Array,readonly:new Array},n=t.addressLookupTableAccounts||[];for(const t of n){const n=e.extractTableLookup(t);if(void 0!==n){const[t,{writable:e,readonly:s}]=n;i.push(t),r.writable.push(...e),r.readonly.push(...s)}}const[s,o]=e.getMessageComponents(),a=new G(o,r).compileInstructions(t.instructions);return new ut({header:s,staticAccountKeys:o,recentBlockhash:t.recentBlockhash,compiledInstructions:a,addressTableLookups:i})}serialize(){const t=Array();it(t,this.staticAccountKeys.length);const e=this.serializeInstructions(),i=Array();it(i,this.compiledInstructions.length);const r=this.serializeAddressTableLookups(),n=Array();it(n,this.addressTableLookups.length);const s=l.w3([l.u8("prefix"),l.w3([l.u8("numRequiredSignatures"),l.u8("numReadonlySignedAccounts"),l.u8("numReadonlyUnsignedAccounts")],"header"),l.av(t.length,"staticAccountKeysLength"),l.O6(Z(),this.staticAccountKeys.length,"staticAccountKeys"),Z("recentBlockhash"),l.av(i.length,"instructionsLength"),l.av(e.length,"serializedInstructions"),l.av(n.length,"addressTableLookupsLength"),l.av(r.length,"serializedAddressTableLookups")]),o=new Uint8Array(j),a=s.encode({prefix:128,header:this.header,staticAccountKeysLength:new Uint8Array(t),staticAccountKeys:this.staticAccountKeys.map(t=>t.toBytes()),recentBlockhash:c().decode(this.recentBlockhash),instructionsLength:new Uint8Array(i),serializedInstructions:e,addressTableLookupsLength:new Uint8Array(n),serializedAddressTableLookups:r},o);return o.slice(0,a)}serializeInstructions(){let t=0;const e=new Uint8Array(j);for(const i of this.compiledInstructions){const r=Array();it(r,i.accountKeyIndexes.length);const n=Array();it(n,i.data.length),t+=l.w3([l.u8("programIdIndex"),l.av(r.length,"encodedAccountKeyIndexesLength"),l.O6(l.u8(),i.accountKeyIndexes.length,"accountKeyIndexes"),l.av(n.length,"encodedDataLength"),l.av(i.data.length,"data")]).encode({programIdIndex:i.programIdIndex,encodedAccountKeyIndexesLength:new Uint8Array(r),accountKeyIndexes:i.accountKeyIndexes,encodedDataLength:new Uint8Array(n),data:i.data},e,t)}return e.slice(0,t)}serializeAddressTableLookups(){let t=0;const e=new Uint8Array(j);for(const i of this.addressTableLookups){const r=Array();it(r,i.writableIndexes.length);const n=Array();it(n,i.readonlyIndexes.length),t+=l.w3([Z("accountKey"),l.av(r.length,"encodedWritableIndexesLength"),l.O6(l.u8(),i.writableIndexes.length,"writableIndexes"),l.av(n.length,"encodedReadonlyIndexesLength"),l.O6(l.u8(),i.readonlyIndexes.length,"readonlyIndexes")]).encode({accountKey:i.accountKey.toBytes(),encodedWritableIndexesLength:new Uint8Array(r),writableIndexes:i.writableIndexes,encodedReadonlyIndexesLength:new Uint8Array(n),readonlyIndexes:i.readonlyIndexes},e,t)}return e.slice(0,t)}static deserialize(t){let e=[...t];const i=ot(e),r=i&H;rt(i!==r,"Expected versioned message but received legacy message"),rt(0===r,`Expected versioned message with version 0 but found version ${r}`);const n={numRequiredSignatures:ot(e),numReadonlySignedAccounts:ot(e),numReadonlyUnsignedAccounts:ot(e)},s=[],o=et(e);for(let t=0;t<o;t++)s.push(new q(at(e,0,K)));const a=c().encode(at(e,0,K)),u=et(e),h=[];for(let t=0;t<u;t++){const t=ot(e),i=at(e,0,et(e)),r=et(e),n=new Uint8Array(at(e,0,r));h.push({programIdIndex:t,accountKeyIndexes:i,data:n})}const l=et(e),d=[];for(let t=0;t<l;t++){const t=new q(at(e,0,K)),i=at(e,0,et(e)),r=at(e,0,et(e));d.push({accountKey:t,writableIndexes:i,readonlyIndexes:r})}return new ut({header:n,staticAccountKeys:s,recentBlockhash:a,compiledInstructions:h,addressTableLookups:d})}}const ht={deserializeMessageVersion(t){const e=t[0],i=e&H;return i===e?"legacy":i},deserialize:t=>{const e=ht.deserializeMessageVersion(t);if("legacy"===e)return ct.from(t);if(0===e)return ut.deserialize(t);throw new Error(`Transaction message version ${e} deserialization is not supported`)}};let lt=function(t){return t[t.BLOCKHEIGHT_EXCEEDED=0]="BLOCKHEIGHT_EXCEEDED",t[t.PROCESSED=1]="PROCESSED",t[t.TIMED_OUT=2]="TIMED_OUT",t[t.NONCE_INVALID=3]="NONCE_INVALID",t}({});const dt=r.Buffer.alloc($).fill(0);class pt{constructor(t){this.keys=void 0,this.programId=void 0,this.data=r.Buffer.alloc(0),this.programId=t.programId,this.keys=t.keys,t.data&&(this.data=t.data)}toJSON(){return{keys:this.keys.map(({pubkey:t,isSigner:e,isWritable:i})=>({pubkey:t.toJSON(),isSigner:e,isWritable:i})),programId:this.programId.toJSON(),data:[...this.data]}}}class ft{get signature(){return this.signatures.length>0?this.signatures[0].signature:null}constructor(t){if(this.signatures=[],this.feePayer=void 0,this.instructions=[],this.recentBlockhash=void 0,this.lastValidBlockHeight=void 0,this.nonceInfo=void 0,this.minNonceContextSlot=void 0,this._message=void 0,this._json=void 0,t)if(t.feePayer&&(this.feePayer=t.feePayer),t.signatures&&(this.signatures=t.signatures),Object.prototype.hasOwnProperty.call(t,"nonceInfo")){const{minContextSlot:e,nonceInfo:i}=t;this.minNonceContextSlot=e,this.nonceInfo=i}else if(Object.prototype.hasOwnProperty.call(t,"lastValidBlockHeight")){const{blockhash:e,lastValidBlockHeight:i}=t;this.recentBlockhash=e,this.lastValidBlockHeight=i}else{const{recentBlockhash:e,nonceInfo:i}=t;i&&(this.nonceInfo=i),this.recentBlockhash=e}}toJSON(){return{recentBlockhash:this.recentBlockhash||null,feePayer:this.feePayer?this.feePayer.toJSON():null,nonceInfo:this.nonceInfo?{nonce:this.nonceInfo.nonce,nonceInstruction:this.nonceInfo.nonceInstruction.toJSON()}:null,instructions:this.instructions.map(t=>t.toJSON()),signers:this.signatures.map(({publicKey:t})=>t.toJSON())}}add(...t){if(0===t.length)throw new Error("No instructions");return t.forEach(t=>{"instructions"in t?this.instructions=this.instructions.concat(t.instructions):"data"in t&&"programId"in t&&"keys"in t?this.instructions.push(t):this.instructions.push(new pt(t))}),this}compileMessage(){if(this._message&&JSON.stringify(this.toJSON())===JSON.stringify(this._json))return this._message;let t,e,i;if(this.nonceInfo?(t=this.nonceInfo.nonce,e=this.instructions[0]!=this.nonceInfo.nonceInstruction?[this.nonceInfo.nonceInstruction,...this.instructions]:this.instructions):(t=this.recentBlockhash,e=this.instructions),!t)throw new Error("Transaction recentBlockhash required");if(e.length<1&&console.warn("No instructions provided"),this.feePayer)i=this.feePayer;else{if(!(this.signatures.length>0&&this.signatures[0].publicKey))throw new Error("Transaction fee payer required");i=this.signatures[0].publicKey}for(let t=0;t<e.length;t++)if(void 0===e[t].programId)throw new Error(`Transaction instruction index ${t} has undefined program id`);const r=[],n=[];e.forEach(t=>{t.keys.forEach(t=>{n.push({...t})});const e=t.programId.toString();r.includes(e)||r.push(e)}),r.forEach(t=>{n.push({pubkey:new q(t),isSigner:!1,isWritable:!1})});const s=[];n.forEach(t=>{const e=t.pubkey.toString(),i=s.findIndex(t=>t.pubkey.toString()===e);i>-1?(s[i].isWritable=s[i].isWritable||t.isWritable,s[i].isSigner=s[i].isSigner||t.isSigner):s.push(t)}),s.sort(function(t,e){return t.isSigner!==e.isSigner?t.isSigner?-1:1:t.isWritable!==e.isWritable?t.isWritable?-1:1:t.pubkey.toBase58().localeCompare(e.pubkey.toBase58(),"en",{localeMatcher:"best fit",usage:"sort",sensitivity:"variant",ignorePunctuation:!1,numeric:!1,caseFirst:"lower"})});const o=s.findIndex(t=>t.pubkey.equals(i));if(o>-1){const[t]=s.splice(o,1);t.isSigner=!0,t.isWritable=!0,s.unshift(t)}else s.unshift({pubkey:i,isSigner:!0,isWritable:!0});for(const t of this.signatures){const e=s.findIndex(e=>e.pubkey.equals(t.publicKey));if(!(e>-1))throw new Error(`unknown signer: ${t.publicKey.toString()}`);s[e].isSigner||(s[e].isSigner=!0,console.warn("Transaction references a signature that is unnecessary, only the fee payer and instruction signer accounts should sign a transaction. This behavior is deprecated and will throw an error in the next major version release."))}let a=0,u=0,h=0;const l=[],d=[];s.forEach(({pubkey:t,isSigner:e,isWritable:i})=>{e?(l.push(t.toString()),a+=1,i||(u+=1)):(d.push(t.toString()),i||(h+=1))});const p=l.concat(d),f=e.map(t=>{const{data:e,programId:i}=t;return{programIdIndex:p.indexOf(i.toString()),accounts:t.keys.map(t=>p.indexOf(t.pubkey.toString())),data:c().encode(e)}});return f.forEach(t=>{rt(t.programIdIndex>=0),t.accounts.forEach(t=>rt(t>=0))}),new ct({header:{numRequiredSignatures:a,numReadonlySignedAccounts:u,numReadonlyUnsignedAccounts:h},accountKeys:p,recentBlockhash:t,instructions:f})}_compile(){const t=this.compileMessage(),e=t.accountKeys.slice(0,t.header.numRequiredSignatures);return this.signatures.length===e.length&&this.signatures.every((t,i)=>e[i].equals(t.publicKey))||(this.signatures=e.map(t=>({signature:null,publicKey:t}))),t}serializeMessage(){return this._compile().serialize()}async getEstimatedFee(t){return(await t.getFeeForMessage(this.compileMessage())).value}setSigners(...t){if(0===t.length)throw new Error("No signers");const e=new Set;this.signatures=t.filter(t=>{const i=t.toString();return!e.has(i)&&(e.add(i),!0)}).map(t=>({signature:null,publicKey:t}))}sign(...t){if(0===t.length)throw new Error("No signers");const e=new Set,i=[];for(const r of t){const t=r.publicKey.toString();e.has(t)||(e.add(t),i.push(r))}this.signatures=i.map(t=>({signature:null,publicKey:t.publicKey}));const r=this._compile();this._partialSign(r,...i)}partialSign(...t){if(0===t.length)throw new Error("No signers");const e=new Set,i=[];for(const r of t){const t=r.publicKey.toString();e.has(t)||(e.add(t),i.push(r))}const r=this._compile();this._partialSign(r,...i)}_partialSign(t,...e){const i=t.serialize();e.forEach(t=>{const e=R(i,t.secretKey);this._addSignature(t.publicKey,x(e))})}addSignature(t,e){this._compile(),this._addSignature(t,e)}_addSignature(t,e){rt(64===e.length);const i=this.signatures.findIndex(e=>t.equals(e.publicKey));if(i<0)throw new Error(`unknown signer: ${t.toString()}`);this.signatures[i].signature=r.Buffer.from(e)}verifySignatures(t=!0){return!this._getMessageSignednessErrors(this.serializeMessage(),t)}_getMessageSignednessErrors(t,e){const i={};for(const{signature:r,publicKey:n}of this.signatures)null===r?e&&(i.missing||=[]).push(n):O(r,t,n.toBytes())||(i.invalid||=[]).push(n);return i.invalid||i.missing?i:void 0}serialize(t){const{requireAllSignatures:e,verifySignatures:i}=Object.assign({requireAllSignatures:!0,verifySignatures:!0},t),r=this.serializeMessage();if(i){const t=this._getMessageSignednessErrors(r,e);if(t){let e="Signature verification failed.";throw t.invalid&&(e+=`\nInvalid signature for public key${1===t.invalid.length?"":"(s)"} [\`${t.invalid.map(t=>t.toBase58()).join("`, `")}\`].`),t.missing&&(e+=`\nMissing signature for public key${1===t.missing.length?"":"(s)"} [\`${t.missing.map(t=>t.toBase58()).join("`, `")}\`].`),new Error(e)}}return this._serialize(r)}_serialize(t){const{signatures:e}=this,i=[];it(i,e.length);const n=i.length+64*e.length+t.length,s=r.Buffer.alloc(n);return rt(e.length<256),r.Buffer.from(i).copy(s,0),e.forEach(({signature:t},e)=>{null!==t&&(rt(64===t.length,"signature has invalid length"),r.Buffer.from(t).copy(s,i.length+64*e))}),t.copy(s,i.length+64*e.length),rt(s.length<=j,`Transaction too large: ${s.length} > ${j}`),s}get keys(){return rt(1===this.instructions.length),this.instructions[0].keys.map(t=>t.pubkey)}get programId(){return rt(1===this.instructions.length),this.instructions[0].programId}get data(){return rt(1===this.instructions.length),this.instructions[0].data}static from(t){let e=[...t];const i=et(e);let n=[];for(let t=0;t<i;t++){const t=at(e,0,$);n.push(c().encode(r.Buffer.from(t)))}return ft.populate(ct.from(e),n)}static populate(t,e=[]){const i=new ft;return i.recentBlockhash=t.recentBlockhash,t.header.numRequiredSignatures>0&&(i.feePayer=t.accountKeys[0]),e.forEach((e,r)=>{const n={signature:e==c().encode(dt)?null:c().decode(e),publicKey:t.accountKeys[r]};i.signatures.push(n)}),t.instructions.forEach(e=>{const r=e.accounts.map(e=>{const r=t.accountKeys[e];return{pubkey:r,isSigner:i.signatures.some(t=>t.publicKey.toString()===r.toString())||t.isAccountSigner(e),isWritable:t.isAccountWritable(e)}});i.instructions.push(new pt({keys:r,programId:t.accountKeys[e.programIdIndex],data:c().decode(e.data)}))}),i._message=t,i._json=i.toJSON(),i}}class gt{constructor(t){this.payerKey=void 0,this.instructions=void 0,this.recentBlockhash=void 0,this.payerKey=t.payerKey,this.instructions=t.instructions,this.recentBlockhash=t.recentBlockhash}static decompile(t,e){const{header:i,compiledInstructions:r,recentBlockhash:n}=t,{numRequiredSignatures:s,numReadonlySignedAccounts:o,numReadonlyUnsignedAccounts:a}=i,c=s-o;rt(c>0,"Message header is invalid");const u=t.staticAccountKeys.length-s-a;rt(u>=0,"Message header is invalid");const h=t.getAccountKeys(e),l=h.get(0);if(void 0===l)throw new Error("Failed to decompile message because no account keys were found");const d=[];for(const t of r){const e=[];for(const r of t.accountKeyIndexes){const t=h.get(r);if(void 0===t)throw new Error(`Failed to find key for account key index ${r}`);let n;n=r<s?r<c:r<h.staticAccountKeys.length?r-s<u:r-h.staticAccountKeys.length<h.accountKeysFromLookups.writable.length,e.push({pubkey:t,isSigner:r<i.numRequiredSignatures,isWritable:n})}const r=h.get(t.programIdIndex);if(void 0===r)throw new Error(`Failed to find program id for program id index ${t.programIdIndex}`);d.push(new pt({programId:r,data:x(t.data),keys:e}))}return new gt({payerKey:l,instructions:d,recentBlockhash:n})}compileToLegacyMessage(){return ct.compile({payerKey:this.payerKey,recentBlockhash:this.recentBlockhash,instructions:this.instructions})}compileToV0Message(t){return ut.compile({payerKey:this.payerKey,recentBlockhash:this.recentBlockhash,instructions:this.instructions,addressLookupTableAccounts:t})}}class mt{get version(){return this.message.version}constructor(t,e){if(this.signatures=void 0,this.message=void 0,void 0!==e)rt(e.length===t.header.numRequiredSignatures,"Expected signatures length to be equal to the number of required signatures"),this.signatures=e;else{const e=[];for(let i=0;i<t.header.numRequiredSignatures;i++)e.push(new Uint8Array($));this.signatures=e}this.message=t}serialize(){const t=this.message.serialize(),e=Array();it(e,this.signatures.length);const i=l.w3([l.av(e.length,"encodedSignaturesLength"),l.O6(X(),this.signatures.length,"signatures"),l.av(t.length,"serializedMessage")]),r=new Uint8Array(2048),n=i.encode({encodedSignaturesLength:new Uint8Array(e),signatures:this.signatures,serializedMessage:t},r);return r.slice(0,n)}static deserialize(t){let e=[...t];const i=[],r=et(e);for(let t=0;t<r;t++)i.push(new Uint8Array(at(e,0,$)));const n=ht.deserialize(new Uint8Array(e));return new mt(n,i)}sign(t){const e=this.message.serialize(),i=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures);for(const r of t){const t=i.findIndex(t=>t.equals(r.publicKey));rt(t>=0,`Cannot sign with non signer key ${r.publicKey.toBase58()}`),this.signatures[t]=R(e,r.secretKey)}}addSignature(t,e){rt(64===e.byteLength,"Signature must be 64 bytes long");const i=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures).findIndex(e=>e.equals(t));rt(i>=0,`Can not add signature; \`${t.toBase58()}\` is not required to sign this transaction`),this.signatures[i]=e}}const yt=new q("SysvarC1ock11111111111111111111111111111111"),bt=new q("SysvarEpochSchedu1e111111111111111111111111"),wt=new q("Sysvar1nstructions1111111111111111111111111"),vt=new q("SysvarRecentB1ockHashes11111111111111111111"),kt=new q("SysvarRent111111111111111111111111111111111"),St=new q("SysvarRewards111111111111111111111111111111"),It=new q("SysvarS1otHashes111111111111111111111111111"),At=new q("SysvarS1otHistory11111111111111111111111111"),_t=new q("SysvarStakeHistory1111111111111111111111111");class Et extends Error{constructor({action:t,signature:e,transactionMessage:i,logs:r}){const n=r?`Logs: \n${JSON.stringify(r.slice(-10),null,2)}. `:"",s="\nCatch the `SendTransactionError` and call `getLogs()` on it for full details.";let o;switch(t){case"send":o=`Transaction ${e} resulted in an error. \n${i}. `+n+s;break;case"simulate":o=`Simulation failed. \nMessage: ${i}. \n`+n+s;break;default:o=`Unknown action '${t}'`}super(o),this.signature=void 0,this.transactionMessage=void 0,this.transactionLogs=void 0,this.signature=e,this.transactionMessage=i,this.transactionLogs=r||void 0}get transactionError(){return{message:this.transactionMessage,logs:Array.isArray(this.transactionLogs)?this.transactionLogs:void 0}}get logs(){const t=this.transactionLogs;if(null==t||"object"!=typeof t||!("then"in t))return t}async getLogs(t){return Array.isArray(this.transactionLogs)||(this.transactionLogs=new Promise((e,i)=>{t.getTransaction(this.signature).then(t=>{if(t&&t.meta&&t.meta.logMessages){const i=t.meta.logMessages;this.transactionLogs=i,e(i)}else i(new Error("Log messages not found"))}).catch(i)})),await this.transactionLogs}}const Pt={JSON_RPC_SERVER_ERROR_BLOCK_CLEANED_UP:-32001,JSON_RPC_SERVER_ERROR_SEND_TRANSACTION_PREFLIGHT_FAILURE:-32002,JSON_RPC_SERVER_ERROR_TRANSACTION_SIGNATURE_VERIFICATION_FAILURE:-32003,JSON_RPC_SERVER_ERROR_BLOCK_NOT_AVAILABLE:-32004,JSON_RPC_SERVER_ERROR_NODE_UNHEALTHY:-32005,JSON_RPC_SERVER_ERROR_TRANSACTION_PRECOMPILE_VERIFICATION_FAILURE:-32006,JSON_RPC_SERVER_ERROR_SLOT_SKIPPED:-32007,JSON_RPC_SERVER_ERROR_NO_SNAPSHOT:-32008,JSON_RPC_SERVER_ERROR_LONG_TERM_STORAGE_SLOT_SKIPPED:-32009,JSON_RPC_SERVER_ERROR_KEY_EXCLUDED_FROM_SECONDARY_INDEX:-32010,JSON_RPC_SERVER_ERROR_TRANSACTION_HISTORY_NOT_AVAILABLE:-32011,JSON_RPC_SCAN_ERROR:-32012,JSON_RPC_SERVER_ERROR_TRANSACTION_SIGNATURE_LEN_MISMATCH:-32013,JSON_RPC_SERVER_ERROR_BLOCK_STATUS_NOT_AVAILABLE_YET:-32014,JSON_RPC_SERVER_ERROR_UNSUPPORTED_TRANSACTION_VERSION:-32015,JSON_RPC_SERVER_ERROR_MIN_CONTEXT_SLOT_NOT_REACHED:-32016};class Mt extends Error{constructor({code:t,message:e,data:i},r){super(null!=r?`${r}: ${e}`:e),this.code=void 0,this.data=void 0,this.code=t,this.data=i,this.name="SolanaJSONRPCError"}}async function Tt(t,e,i,r){const n=r&&{skipPreflight:r.skipPreflight,preflightCommitment:r.preflightCommitment||r.commitment,maxRetries:r.maxRetries,minContextSlot:r.minContextSlot},s=await t.sendTransaction(e,i,n);let o;if(null!=e.recentBlockhash&&null!=e.lastValidBlockHeight)o=(await t.confirmTransaction({abortSignal:r?.abortSignal,signature:s,blockhash:e.recentBlockhash,lastValidBlockHeight:e.lastValidBlockHeight},r&&r.commitment)).value;else if(null!=e.minNonceContextSlot&&null!=e.nonceInfo){const{nonceInstruction:i}=e.nonceInfo,n=i.keys[0].pubkey;o=(await t.confirmTransaction({abortSignal:r?.abortSignal,minContextSlot:e.minNonceContextSlot,nonceAccountPubkey:n,nonceValue:e.nonceInfo.nonce,signature:s},r&&r.commitment)).value}else null!=r?.abortSignal&&console.warn("sendAndConfirmTransaction(): A transaction with a deprecated confirmation strategy was supplied along with an `abortSignal`. Only transactions having `lastValidBlockHeight` or a combination of `nonceInfo` and `minNonceContextSlot` are abortable."),o=(await t.confirmTransaction(s,r&&r.commitment)).value;if(o.err){if(null!=s)throw new Et({action:"send",signature:s,transactionMessage:`Status: (${JSON.stringify(o)})`});throw new Error(`Transaction ${s} failed (${JSON.stringify(o)})`)}return s}function Bt(t){return new Promise(e=>setTimeout(e,t))}function Rt(t,e){const i=t.layout.span>=0?t.layout.span:tt(t,e),n=r.Buffer.alloc(i),s=Object.assign({instruction:t.index},e);return t.layout.encode(s,n),n}function Ot(t,e){let i;try{i=t.layout.decode(e)}catch(t){throw new Error("invalid instruction; "+t)}if(i.instruction!==t.index)throw new Error(`invalid instruction; instruction index mismatch ${i.instruction} != ${t.index}`);return i}const xt=l.I0("lamportsPerSignature"),Nt=l.w3([l.DH("version"),l.DH("state"),Z("authorizedPubkey"),Z("nonce"),l.w3([xt],"feeCalculator")]),Ct=Nt.span;class Wt{constructor(t){this.authorizedPubkey=void 0,this.nonce=void 0,this.feeCalculator=void 0,this.authorizedPubkey=t.authorizedPubkey,this.nonce=t.nonce,this.feeCalculator=t.feeCalculator}static fromAccountData(t){const e=Nt.decode(x(t),0);return new Wt({authorizedPubkey:new q(e.authorizedPubkey),nonce:new q(e.nonce).toString(),feeCalculator:e.feeCalculator})}}function Lt(t){const e=(0,l.av)(8,t),i=e.decode.bind(e),r=e.encode.bind(e),n=e,s=v();return n.decode=(t,e)=>{const r=i(t,e);return s.decode(r)},n.encode=(t,e,i)=>{const n=s.encode(t);return r(n,e,i)},n}class zt{constructor(){}static decodeInstructionType(t){this.checkProgramId(t.programId);const e=l.DH("instruction").decode(t.data);let i;for(const[t,r]of Object.entries(Kt))if(r.index==e){i=t;break}if(!i)throw new Error("Instruction type incorrect; not a SystemInstruction");return i}static decodeCreateAccount(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,2);const{lamports:e,space:i,programId:r}=Ot(Kt.Create,t.data);return{fromPubkey:t.keys[0].pubkey,newAccountPubkey:t.keys[1].pubkey,lamports:e,space:i,programId:new q(r)}}static decodeTransfer(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,2);const{lamports:e}=Ot(Kt.Transfer,t.data);return{fromPubkey:t.keys[0].pubkey,toPubkey:t.keys[1].pubkey,lamports:e}}static decodeTransferWithSeed(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3);const{lamports:e,seed:i,programId:r}=Ot(Kt.TransferWithSeed,t.data);return{fromPubkey:t.keys[0].pubkey,basePubkey:t.keys[1].pubkey,toPubkey:t.keys[2].pubkey,lamports:e,seed:i,programId:new q(r)}}static decodeAllocate(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,1);const{space:e}=Ot(Kt.Allocate,t.data);return{accountPubkey:t.keys[0].pubkey,space:e}}static decodeAllocateWithSeed(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,1);const{base:e,seed:i,space:r,programId:n}=Ot(Kt.AllocateWithSeed,t.data);return{accountPubkey:t.keys[0].pubkey,basePubkey:new q(e),seed:i,space:r,programId:new q(n)}}static decodeAssign(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,1);const{programId:e}=Ot(Kt.Assign,t.data);return{accountPubkey:t.keys[0].pubkey,programId:new q(e)}}static decodeAssignWithSeed(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,1);const{base:e,seed:i,programId:r}=Ot(Kt.AssignWithSeed,t.data);return{accountPubkey:t.keys[0].pubkey,basePubkey:new q(e),seed:i,programId:new q(r)}}static decodeCreateWithSeed(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,2);const{base:e,seed:i,lamports:r,space:n,programId:s}=Ot(Kt.CreateWithSeed,t.data);return{fromPubkey:t.keys[0].pubkey,newAccountPubkey:t.keys[1].pubkey,basePubkey:new q(e),seed:i,lamports:r,space:n,programId:new q(s)}}static decodeNonceInitialize(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3);const{authorized:e}=Ot(Kt.InitializeNonceAccount,t.data);return{noncePubkey:t.keys[0].pubkey,authorizedPubkey:new q(e)}}static decodeNonceAdvance(t){return this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3),Ot(Kt.AdvanceNonceAccount,t.data),{noncePubkey:t.keys[0].pubkey,authorizedPubkey:t.keys[2].pubkey}}static decodeNonceWithdraw(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,5);const{lamports:e}=Ot(Kt.WithdrawNonceAccount,t.data);return{noncePubkey:t.keys[0].pubkey,toPubkey:t.keys[1].pubkey,authorizedPubkey:t.keys[4].pubkey,lamports:e}}static decodeNonceAuthorize(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,2);const{authorized:e}=Ot(Kt.AuthorizeNonceAccount,t.data);return{noncePubkey:t.keys[0].pubkey,authorizedPubkey:t.keys[1].pubkey,newAuthorizedPubkey:new q(e)}}static checkProgramId(t){if(!t.equals(Yt.programId))throw new Error("invalid instruction; programId is not SystemProgram")}static checkKeyLength(t,e){if(t.length<e)throw new Error(`invalid instruction; found ${t.length} keys, expected at least ${e}`)}}const Kt=Object.freeze({Create:{index:0,layout:l.w3([l.DH("instruction"),l.Wg("lamports"),l.Wg("space"),Z("programId")])},Assign:{index:1,layout:l.w3([l.DH("instruction"),Z("programId")])},Transfer:{index:2,layout:l.w3([l.DH("instruction"),Lt("lamports")])},CreateWithSeed:{index:3,layout:l.w3([l.DH("instruction"),Z("base"),Q("seed"),l.Wg("lamports"),l.Wg("space"),Z("programId")])},AdvanceNonceAccount:{index:4,layout:l.w3([l.DH("instruction")])},WithdrawNonceAccount:{index:5,layout:l.w3([l.DH("instruction"),l.Wg("lamports")])},InitializeNonceAccount:{index:6,layout:l.w3([l.DH("instruction"),Z("authorized")])},AuthorizeNonceAccount:{index:7,layout:l.w3([l.DH("instruction"),Z("authorized")])},Allocate:{index:8,layout:l.w3([l.DH("instruction"),l.Wg("space")])},AllocateWithSeed:{index:9,layout:l.w3([l.DH("instruction"),Z("base"),Q("seed"),l.Wg("space"),Z("programId")])},AssignWithSeed:{index:10,layout:l.w3([l.DH("instruction"),Z("base"),Q("seed"),Z("programId")])},TransferWithSeed:{index:11,layout:l.w3([l.DH("instruction"),Lt("lamports"),Q("seed"),Z("programId")])},UpgradeNonceAccount:{index:12,layout:l.w3([l.DH("instruction")])}});class Yt{constructor(){}static createAccount(t){const e=Rt(Kt.Create,{lamports:t.lamports,space:t.space,programId:x(t.programId.toBuffer())});return new pt({keys:[{pubkey:t.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:t.newAccountPubkey,isSigner:!0,isWritable:!0}],programId:this.programId,data:e})}static transfer(t){let e,i;return"basePubkey"in t?(e=Rt(Kt.TransferWithSeed,{lamports:BigInt(t.lamports),seed:t.seed,programId:x(t.programId.toBuffer())}),i=[{pubkey:t.fromPubkey,isSigner:!1,isWritable:!0},{pubkey:t.basePubkey,isSigner:!0,isWritable:!1},{pubkey:t.toPubkey,isSigner:!1,isWritable:!0}]):(e=Rt(Kt.Transfer,{lamports:BigInt(t.lamports)}),i=[{pubkey:t.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:t.toPubkey,isSigner:!1,isWritable:!0}]),new pt({keys:i,programId:this.programId,data:e})}static assign(t){let e,i;return"basePubkey"in t?(e=Rt(Kt.AssignWithSeed,{base:x(t.basePubkey.toBuffer()),seed:t.seed,programId:x(t.programId.toBuffer())}),i=[{pubkey:t.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:t.basePubkey,isSigner:!0,isWritable:!1}]):(e=Rt(Kt.Assign,{programId:x(t.programId.toBuffer())}),i=[{pubkey:t.accountPubkey,isSigner:!0,isWritable:!0}]),new pt({keys:i,programId:this.programId,data:e})}static createAccountWithSeed(t){const e=Rt(Kt.CreateWithSeed,{base:x(t.basePubkey.toBuffer()),seed:t.seed,lamports:t.lamports,space:t.space,programId:x(t.programId.toBuffer())});let i=[{pubkey:t.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:t.newAccountPubkey,isSigner:!1,isWritable:!0}];return t.basePubkey.equals(t.fromPubkey)||i.push({pubkey:t.basePubkey,isSigner:!0,isWritable:!1}),new pt({keys:i,programId:this.programId,data:e})}static createNonceAccount(t){const e=new ft;"basePubkey"in t&&"seed"in t?e.add(Yt.createAccountWithSeed({fromPubkey:t.fromPubkey,newAccountPubkey:t.noncePubkey,basePubkey:t.basePubkey,seed:t.seed,lamports:t.lamports,space:Ct,programId:this.programId})):e.add(Yt.createAccount({fromPubkey:t.fromPubkey,newAccountPubkey:t.noncePubkey,lamports:t.lamports,space:Ct,programId:this.programId}));const i={noncePubkey:t.noncePubkey,authorizedPubkey:t.authorizedPubkey};return e.add(this.nonceInitialize(i)),e}static nonceInitialize(t){const e=Rt(Kt.InitializeNonceAccount,{authorized:x(t.authorizedPubkey.toBuffer())}),i={keys:[{pubkey:t.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1}],programId:this.programId,data:e};return new pt(i)}static nonceAdvance(t){const e=Rt(Kt.AdvanceNonceAccount),i={keys:[{pubkey:t.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:t.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:e};return new pt(i)}static nonceWithdraw(t){const e=Rt(Kt.WithdrawNonceAccount,{lamports:t.lamports});return new pt({keys:[{pubkey:t.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:t.toPubkey,isSigner:!1,isWritable:!0},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:t.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:e})}static nonceAuthorize(t){const e=Rt(Kt.AuthorizeNonceAccount,{authorized:x(t.newAuthorizedPubkey.toBuffer())});return new pt({keys:[{pubkey:t.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:t.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:e})}static allocate(t){let e,i;return"basePubkey"in t?(e=Rt(Kt.AllocateWithSeed,{base:x(t.basePubkey.toBuffer()),seed:t.seed,space:t.space,programId:x(t.programId.toBuffer())}),i=[{pubkey:t.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:t.basePubkey,isSigner:!0,isWritable:!1}]):(e=Rt(Kt.Allocate,{space:t.space}),i=[{pubkey:t.accountPubkey,isSigner:!0,isWritable:!0}]),new pt({keys:i,programId:this.programId,data:e})}}Yt.programId=new q("11111111111111111111111111111111");const qt=j-300;class Dt{constructor(){}static getMinNumSignatures(t){return 2*(Math.ceil(t/Dt.chunkSize)+1+1)}static async load(t,e,i,n,s){{const r=await t.getMinimumBalanceForRentExemption(s.length),o=await t.getAccountInfo(i.publicKey,"confirmed");let a=null;if(null!==o){if(o.executable)return console.error("Program load failed, account is already executable"),!1;o.data.length!==s.length&&(a=a||new ft,a.add(Yt.allocate({accountPubkey:i.publicKey,space:s.length}))),o.owner.equals(n)||(a=a||new ft,a.add(Yt.assign({accountPubkey:i.publicKey,programId:n}))),o.lamports<r&&(a=a||new ft,a.add(Yt.transfer({fromPubkey:e.publicKey,toPubkey:i.publicKey,lamports:r-o.lamports})))}else a=(new ft).add(Yt.createAccount({fromPubkey:e.publicKey,newAccountPubkey:i.publicKey,lamports:r>0?r:1,space:s.length,programId:n}));null!==a&&await Tt(t,a,[e,i],{commitment:"confirmed"})}const o=l.w3([l.DH("instruction"),l.DH("offset"),l.DH("bytesLength"),l.DH("bytesLengthPadding"),l.O6(l.u8("byte"),l.cY(l.DH(),-8),"bytes")]),a=Dt.chunkSize;let c=0,u=s,h=[];for(;u.length>0;){const s=u.slice(0,a),l=r.Buffer.alloc(a+16);o.encode({instruction:0,offset:c,bytes:s,bytesLength:0,bytesLengthPadding:0},l);const d=(new ft).add({keys:[{pubkey:i.publicKey,isSigner:!0,isWritable:!0}],programId:n,data:l});if(h.push(Tt(t,d,[e,i],{commitment:"confirmed"})),t._rpcEndpoint.includes("solana.com")){const t=4;await Bt(1e3/t)}c+=a,u=u.slice(a)}await Promise.all(h);{const s=l.w3([l.DH("instruction")]),o=r.Buffer.alloc(s.span);s.encode({instruction:1},o);const a=(new ft).add({keys:[{pubkey:i.publicKey,isSigner:!0,isWritable:!0},{pubkey:kt,isSigner:!1,isWritable:!1}],programId:n,data:o}),c="processed",u=await t.sendTransaction(a,[e,i],{preflightCommitment:c}),{context:h,value:d}=await t.confirmTransaction({signature:u,lastValidBlockHeight:a.lastValidBlockHeight,blockhash:a.recentBlockhash},c);if(d.err)throw new Error(`Transaction ${u} failed (${JSON.stringify(d)})`);for(;;){try{if(await t.getSlot({commitment:c})>h.slot)break}catch{}await new Promise(t=>setTimeout(t,Math.round(200)))}}return!0}}Dt.chunkSize=qt;const Ut=new q("BPFLoader2111111111111111111111111111111111");class jt{static getMinNumSignatures(t){return Dt.getMinNumSignatures(t)}static load(t,e,i,r,n){return Dt.load(t,e,i,n,r)}}function Ht(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $t,Vt;function Ft(){if(Vt)return $t;Vt=1;var t=Object.prototype.toString,e=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};function i(r,n){var s,o,a,c,u,h,l;if(!0===r)return"true";if(!1===r)return"false";switch(typeof r){case"object":if(null===r)return null;if(r.toJSON&&"function"==typeof r.toJSON)return i(r.toJSON(),n);if("[object Array]"===(l=t.call(r))){for(a="[",o=r.length-1,s=0;s<o;s++)a+=i(r[s],!0)+",";return o>-1&&(a+=i(r[s],!0)),a+"]"}if("[object Object]"===l){for(o=(c=e(r).sort()).length,a="",s=0;s<o;)void 0!==(h=i(r[u=c[s]],!1))&&(a&&(a+=","),a+=JSON.stringify(u)+":"+h),s++;return"{"+a+"}"}return JSON.stringify(r);case"function":case"undefined":return n?null:void 0;case"string":return JSON.stringify(r);default:return isFinite(r)?r:null}}return $t=function(t){var e=i(t,!1);if(void 0!==e)return""+e}}var Jt=Ht(Ft());function Gt(t){let e=0;for(;t>1;)t/=2,e++;return e}class Zt{constructor(t,e,i,r,n){this.slotsPerEpoch=void 0,this.leaderScheduleSlotOffset=void 0,this.warmup=void 0,this.firstNormalEpoch=void 0,this.firstNormalSlot=void 0,this.slotsPerEpoch=t,this.leaderScheduleSlotOffset=e,this.warmup=i,this.firstNormalEpoch=r,this.firstNormalSlot=n}getEpoch(t){return this.getEpochAndSlotIndex(t)[0]}getEpochAndSlotIndex(t){if(t<this.firstNormalSlot){const i=Gt(0===(e=t+32+1)?1:(e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,1+(e|=e>>32)))-Gt(32)-1;return[i,t-(this.getSlotsInEpoch(i)-32)]}{const e=t-this.firstNormalSlot,i=Math.floor(e/this.slotsPerEpoch);return[this.firstNormalEpoch+i,e%this.slotsPerEpoch]}var e}getFirstSlotInEpoch(t){return t<=this.firstNormalEpoch?32*(Math.pow(2,t)-1):(t-this.firstNormalEpoch)*this.slotsPerEpoch+this.firstNormalSlot}getLastSlotInEpoch(t){return this.getFirstSlotInEpoch(t)+this.getSlotsInEpoch(t)-1}getSlotsInEpoch(t){return t<this.firstNormalEpoch?Math.pow(2,t+Gt(32)):this.slotsPerEpoch}}var Xt=globalThis.fetch;class Qt extends A.vE{constructor(t,e,i){super(t=>{const i=(0,A.kb)(t,{autoconnect:!0,max_reconnects:5,reconnect:!0,reconnect_interval:1e3,...e});return this.underlyingSocket="socket"in i?i.socket:i,i},t,e,i),this.underlyingSocket=void 0}call(...t){const e=this.underlyingSocket?.readyState;return 1===e?super.call(...t):Promise.reject(new Error("Tried to call a JSON-RPC method `"+t[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+e+")"))}notify(...t){const e=this.underlyingSocket?.readyState;return 1===e?super.notify(...t):Promise.reject(new Error("Tried to send a JSON-RPC notification `"+t[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+e+")"))}}class te{constructor(t){this.key=void 0,this.state=void 0,this.key=t.key,this.state=t.state}isActive(){const t=BigInt("0xffffffffffffffff");return this.state.deactivationSlot===t}static deserialize(t){const e=function(t,e){let i;try{i=t.layout.decode(e)}catch(t){throw new Error("invalid instruction; "+t)}if(i.typeIndex!==t.index)throw new Error(`invalid account data; account type mismatch ${i.typeIndex} != ${t.index}`);return i}(ee,t),i=t.length-56;rt(i>=0,"lookup table is invalid"),rt(i%32==0,"lookup table is invalid");const r=i/32,{addresses:n}=l.w3([l.O6(Z(),r,"addresses")]).decode(t.slice(56));return{deactivationSlot:e.deactivationSlot,lastExtendedSlot:e.lastExtendedSlot,lastExtendedSlotStartIndex:e.lastExtendedStartIndex,authority:0!==e.authority.length?new q(e.authority[0]):void 0,addresses:n.map(t=>new q(t))}}}const ee={index:1,layout:l.w3([l.DH("typeIndex"),Lt("deactivationSlot"),l.I0("lastExtendedSlot"),l.u8("lastExtendedStartIndex"),l.u8(),l.O6(Z(),l.cY(l.u8(),-1),"authority")])},ie=/^[^:]+:\/\/([^:[]+|\[[^\]]+\])(:\d+)?(.*)/i,re=(0,k.au)((0,k.KJ)(q),(0,k.Yj)(),t=>new q(t)),ne=(0,k.PV)([(0,k.Yj)(),(0,k.eu)("base64")]),se=(0,k.au)((0,k.KJ)(r.Buffer),ne,t=>r.Buffer.from(t[0],"base64")),oe=3e4;function ae(t){let e,i;if("string"==typeof t)e=t;else if(t){const{commitment:r,...n}=t;e=r,i=n}return{commitment:e,config:i}}function ce(t){return t.map(t=>"memcmp"in t?{...t,memcmp:{...t.memcmp,encoding:t.memcmp.encoding??"base58"}}:t)}function ue(t){return(0,k.KC)([(0,k.NW)({jsonrpc:(0,k.eu)("2.0"),id:(0,k.Yj)(),result:t}),(0,k.NW)({jsonrpc:(0,k.eu)("2.0"),id:(0,k.Yj)(),error:(0,k.NW)({code:(0,k.L5)(),message:(0,k.Yj)(),data:(0,k.lq)((0,k.bz)())})})])}const he=ue((0,k.L5)());function le(t){return(0,k.au)(ue(t),he,e=>"error"in e?e:{...e,result:(0,k.vt)(e.result,t)})}function de(t){return le((0,k.NW)({context:(0,k.NW)({slot:(0,k.ai)()}),value:t}))}function pe(t){return(0,k.NW)({context:(0,k.NW)({slot:(0,k.ai)()}),value:t})}function fe(t,e){return 0===t?new ut({header:e.header,staticAccountKeys:e.accountKeys.map(t=>new q(t)),recentBlockhash:e.recentBlockhash,compiledInstructions:e.instructions.map(t=>({programIdIndex:t.programIdIndex,accountKeyIndexes:t.accounts,data:c().decode(t.data)})),addressTableLookups:e.addressTableLookups}):new ct(e)}const ge=(0,k.NW)({foundation:(0,k.ai)(),foundationTerm:(0,k.ai)(),initial:(0,k.ai)(),taper:(0,k.ai)(),terminal:(0,k.ai)()}),me=le((0,k.YO)((0,k.me)((0,k.NW)({epoch:(0,k.ai)(),effectiveSlot:(0,k.ai)(),amount:(0,k.ai)(),postBalance:(0,k.ai)(),commission:(0,k.lq)((0,k.me)((0,k.ai)()))})))),ye=(0,k.YO)((0,k.NW)({slot:(0,k.ai)(),prioritizationFee:(0,k.ai)()})),be=(0,k.NW)({total:(0,k.ai)(),validator:(0,k.ai)(),foundation:(0,k.ai)(),epoch:(0,k.ai)()}),we=(0,k.NW)({epoch:(0,k.ai)(),slotIndex:(0,k.ai)(),slotsInEpoch:(0,k.ai)(),absoluteSlot:(0,k.ai)(),blockHeight:(0,k.lq)((0,k.ai)()),transactionCount:(0,k.lq)((0,k.ai)())}),ve=(0,k.NW)({slotsPerEpoch:(0,k.ai)(),leaderScheduleSlotOffset:(0,k.ai)(),warmup:(0,k.zM)(),firstNormalEpoch:(0,k.ai)(),firstNormalSlot:(0,k.ai)()}),ke=(0,k.g1)((0,k.Yj)(),(0,k.YO)((0,k.ai)())),Se=(0,k.me)((0,k.KC)([(0,k.NW)({}),(0,k.Yj)()])),Ie=(0,k.NW)({err:Se}),Ae=(0,k.eu)("receivedSignature"),_e=(0,k.NW)({"solana-core":(0,k.Yj)(),"feature-set":(0,k.lq)((0,k.ai)())}),Ee=(0,k.NW)({program:(0,k.Yj)(),programId:re,parsed:(0,k.L5)()}),Pe=(0,k.NW)({programId:re,accounts:(0,k.YO)(re),data:(0,k.Yj)()}),Me=de((0,k.NW)({err:(0,k.me)((0,k.KC)([(0,k.NW)({}),(0,k.Yj)()])),logs:(0,k.me)((0,k.YO)((0,k.Yj)())),accounts:(0,k.lq)((0,k.me)((0,k.YO)((0,k.me)((0,k.NW)({executable:(0,k.zM)(),owner:(0,k.Yj)(),lamports:(0,k.ai)(),data:(0,k.YO)((0,k.Yj)()),rentEpoch:(0,k.lq)((0,k.ai)())}))))),unitsConsumed:(0,k.lq)((0,k.ai)()),returnData:(0,k.lq)((0,k.me)((0,k.NW)({programId:(0,k.Yj)(),data:(0,k.PV)([(0,k.Yj)(),(0,k.eu)("base64")])}))),innerInstructions:(0,k.lq)((0,k.me)((0,k.YO)((0,k.NW)({index:(0,k.ai)(),instructions:(0,k.YO)((0,k.KC)([Ee,Pe]))}))))})),Te=de((0,k.NW)({byIdentity:(0,k.g1)((0,k.Yj)(),(0,k.YO)((0,k.ai)())),range:(0,k.NW)({firstSlot:(0,k.ai)(),lastSlot:(0,k.ai)()})})),Be=le(ge),Re=le(be),Oe=le(ye),xe=le(we),Ne=le(ve),Ce=le(ke),We=le((0,k.ai)()),Le=de((0,k.NW)({total:(0,k.ai)(),circulating:(0,k.ai)(),nonCirculating:(0,k.ai)(),nonCirculatingAccounts:(0,k.YO)(re)})),ze=(0,k.NW)({amount:(0,k.Yj)(),uiAmount:(0,k.me)((0,k.ai)()),decimals:(0,k.ai)(),uiAmountString:(0,k.lq)((0,k.Yj)())}),Ke=de((0,k.YO)((0,k.NW)({address:re,amount:(0,k.Yj)(),uiAmount:(0,k.me)((0,k.ai)()),decimals:(0,k.ai)(),uiAmountString:(0,k.lq)((0,k.Yj)())}))),Ye=de((0,k.YO)((0,k.NW)({pubkey:re,account:(0,k.NW)({executable:(0,k.zM)(),owner:re,lamports:(0,k.ai)(),data:se,rentEpoch:(0,k.ai)()})}))),qe=(0,k.NW)({program:(0,k.Yj)(),parsed:(0,k.L5)(),space:(0,k.ai)()}),De=de((0,k.YO)((0,k.NW)({pubkey:re,account:(0,k.NW)({executable:(0,k.zM)(),owner:re,lamports:(0,k.ai)(),data:qe,rentEpoch:(0,k.ai)()})}))),Ue=de((0,k.YO)((0,k.NW)({lamports:(0,k.ai)(),address:re}))),je=(0,k.NW)({executable:(0,k.zM)(),owner:re,lamports:(0,k.ai)(),data:se,rentEpoch:(0,k.ai)()}),He=(0,k.NW)({pubkey:re,account:je}),$e=(0,k.au)((0,k.KC)([(0,k.KJ)(r.Buffer),qe]),(0,k.KC)([ne,qe]),t=>Array.isArray(t)?(0,k.vt)(t,se):t),Ve=(0,k.NW)({executable:(0,k.zM)(),owner:re,lamports:(0,k.ai)(),data:$e,rentEpoch:(0,k.ai)()}),Fe=(0,k.NW)({pubkey:re,account:Ve}),Je=(0,k.NW)({state:(0,k.KC)([(0,k.eu)("active"),(0,k.eu)("inactive"),(0,k.eu)("activating"),(0,k.eu)("deactivating")]),active:(0,k.ai)(),inactive:(0,k.ai)()}),Ge=le((0,k.YO)((0,k.NW)({signature:(0,k.Yj)(),slot:(0,k.ai)(),err:Se,memo:(0,k.me)((0,k.Yj)()),blockTime:(0,k.lq)((0,k.me)((0,k.ai)()))}))),Ze=le((0,k.YO)((0,k.NW)({signature:(0,k.Yj)(),slot:(0,k.ai)(),err:Se,memo:(0,k.me)((0,k.Yj)()),blockTime:(0,k.lq)((0,k.me)((0,k.ai)()))}))),Xe=(0,k.NW)({subscription:(0,k.ai)(),result:pe(je)}),Qe=(0,k.NW)({pubkey:re,account:je}),ti=(0,k.NW)({subscription:(0,k.ai)(),result:pe(Qe)}),ei=(0,k.NW)({parent:(0,k.ai)(),slot:(0,k.ai)(),root:(0,k.ai)()}),ii=(0,k.NW)({subscription:(0,k.ai)(),result:ei}),ri=(0,k.KC)([(0,k.NW)({type:(0,k.KC)([(0,k.eu)("firstShredReceived"),(0,k.eu)("completed"),(0,k.eu)("optimisticConfirmation"),(0,k.eu)("root")]),slot:(0,k.ai)(),timestamp:(0,k.ai)()}),(0,k.NW)({type:(0,k.eu)("createdBank"),parent:(0,k.ai)(),slot:(0,k.ai)(),timestamp:(0,k.ai)()}),(0,k.NW)({type:(0,k.eu)("frozen"),slot:(0,k.ai)(),timestamp:(0,k.ai)(),stats:(0,k.NW)({numTransactionEntries:(0,k.ai)(),numSuccessfulTransactions:(0,k.ai)(),numFailedTransactions:(0,k.ai)(),maxTransactionsPerEntry:(0,k.ai)()})}),(0,k.NW)({type:(0,k.eu)("dead"),slot:(0,k.ai)(),timestamp:(0,k.ai)(),err:(0,k.Yj)()})]),ni=(0,k.NW)({subscription:(0,k.ai)(),result:ri}),si=(0,k.NW)({subscription:(0,k.ai)(),result:pe((0,k.KC)([Ie,Ae]))}),oi=(0,k.NW)({subscription:(0,k.ai)(),result:(0,k.ai)()}),ai=(0,k.NW)({pubkey:(0,k.Yj)(),gossip:(0,k.me)((0,k.Yj)()),tpu:(0,k.me)((0,k.Yj)()),rpc:(0,k.me)((0,k.Yj)()),version:(0,k.me)((0,k.Yj)())}),ci=(0,k.NW)({votePubkey:(0,k.Yj)(),nodePubkey:(0,k.Yj)(),activatedStake:(0,k.ai)(),epochVoteAccount:(0,k.zM)(),epochCredits:(0,k.YO)((0,k.PV)([(0,k.ai)(),(0,k.ai)(),(0,k.ai)()])),commission:(0,k.ai)(),lastVote:(0,k.ai)(),rootSlot:(0,k.me)((0,k.ai)())}),ui=le((0,k.NW)({current:(0,k.YO)(ci),delinquent:(0,k.YO)(ci)})),hi=(0,k.KC)([(0,k.eu)("processed"),(0,k.eu)("confirmed"),(0,k.eu)("finalized")]),li=(0,k.NW)({slot:(0,k.ai)(),confirmations:(0,k.me)((0,k.ai)()),err:Se,confirmationStatus:(0,k.lq)(hi)}),di=de((0,k.YO)((0,k.me)(li))),pi=le((0,k.ai)()),fi=(0,k.NW)({accountKey:re,writableIndexes:(0,k.YO)((0,k.ai)()),readonlyIndexes:(0,k.YO)((0,k.ai)())}),gi=(0,k.NW)({signatures:(0,k.YO)((0,k.Yj)()),message:(0,k.NW)({accountKeys:(0,k.YO)((0,k.Yj)()),header:(0,k.NW)({numRequiredSignatures:(0,k.ai)(),numReadonlySignedAccounts:(0,k.ai)(),numReadonlyUnsignedAccounts:(0,k.ai)()}),instructions:(0,k.YO)((0,k.NW)({accounts:(0,k.YO)((0,k.ai)()),data:(0,k.Yj)(),programIdIndex:(0,k.ai)()})),recentBlockhash:(0,k.Yj)(),addressTableLookups:(0,k.lq)((0,k.YO)(fi))})}),mi=(0,k.NW)({pubkey:re,signer:(0,k.zM)(),writable:(0,k.zM)(),source:(0,k.lq)((0,k.KC)([(0,k.eu)("transaction"),(0,k.eu)("lookupTable")]))}),yi=(0,k.NW)({accountKeys:(0,k.YO)(mi),signatures:(0,k.YO)((0,k.Yj)())}),bi=(0,k.NW)({parsed:(0,k.L5)(),program:(0,k.Yj)(),programId:re}),wi=(0,k.NW)({accounts:(0,k.YO)(re),data:(0,k.Yj)(),programId:re}),vi=(0,k.KC)([wi,bi]),ki=(0,k.KC)([(0,k.NW)({parsed:(0,k.L5)(),program:(0,k.Yj)(),programId:(0,k.Yj)()}),(0,k.NW)({accounts:(0,k.YO)((0,k.Yj)()),data:(0,k.Yj)(),programId:(0,k.Yj)()})]),Si=(0,k.au)(vi,ki,t=>"accounts"in t?(0,k.vt)(t,wi):(0,k.vt)(t,bi)),Ii=(0,k.NW)({signatures:(0,k.YO)((0,k.Yj)()),message:(0,k.NW)({accountKeys:(0,k.YO)(mi),instructions:(0,k.YO)(Si),recentBlockhash:(0,k.Yj)(),addressTableLookups:(0,k.lq)((0,k.me)((0,k.YO)(fi)))})}),Ai=(0,k.NW)({accountIndex:(0,k.ai)(),mint:(0,k.Yj)(),owner:(0,k.lq)((0,k.Yj)()),programId:(0,k.lq)((0,k.Yj)()),uiTokenAmount:ze}),_i=(0,k.NW)({writable:(0,k.YO)(re),readonly:(0,k.YO)(re)}),Ei=(0,k.NW)({err:Se,fee:(0,k.ai)(),innerInstructions:(0,k.lq)((0,k.me)((0,k.YO)((0,k.NW)({index:(0,k.ai)(),instructions:(0,k.YO)((0,k.NW)({accounts:(0,k.YO)((0,k.ai)()),data:(0,k.Yj)(),programIdIndex:(0,k.ai)()}))})))),preBalances:(0,k.YO)((0,k.ai)()),postBalances:(0,k.YO)((0,k.ai)()),logMessages:(0,k.lq)((0,k.me)((0,k.YO)((0,k.Yj)()))),preTokenBalances:(0,k.lq)((0,k.me)((0,k.YO)(Ai))),postTokenBalances:(0,k.lq)((0,k.me)((0,k.YO)(Ai))),loadedAddresses:(0,k.lq)(_i),computeUnitsConsumed:(0,k.lq)((0,k.ai)()),costUnits:(0,k.lq)((0,k.ai)())}),Pi=(0,k.NW)({err:Se,fee:(0,k.ai)(),innerInstructions:(0,k.lq)((0,k.me)((0,k.YO)((0,k.NW)({index:(0,k.ai)(),instructions:(0,k.YO)(Si)})))),preBalances:(0,k.YO)((0,k.ai)()),postBalances:(0,k.YO)((0,k.ai)()),logMessages:(0,k.lq)((0,k.me)((0,k.YO)((0,k.Yj)()))),preTokenBalances:(0,k.lq)((0,k.me)((0,k.YO)(Ai))),postTokenBalances:(0,k.lq)((0,k.me)((0,k.YO)(Ai))),loadedAddresses:(0,k.lq)(_i),computeUnitsConsumed:(0,k.lq)((0,k.ai)()),costUnits:(0,k.lq)((0,k.ai)())}),Mi=(0,k.KC)([(0,k.eu)(0),(0,k.eu)("legacy")]),Ti=(0,k.NW)({pubkey:(0,k.Yj)(),lamports:(0,k.ai)(),postBalance:(0,k.me)((0,k.ai)()),rewardType:(0,k.me)((0,k.Yj)()),commission:(0,k.lq)((0,k.me)((0,k.ai)()))}),Bi=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),transactions:(0,k.YO)((0,k.NW)({transaction:gi,meta:(0,k.me)(Ei),version:(0,k.lq)(Mi)})),rewards:(0,k.lq)((0,k.YO)(Ti)),blockTime:(0,k.me)((0,k.ai)()),blockHeight:(0,k.me)((0,k.ai)())}))),Ri=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),rewards:(0,k.lq)((0,k.YO)(Ti)),blockTime:(0,k.me)((0,k.ai)()),blockHeight:(0,k.me)((0,k.ai)())}))),Oi=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),transactions:(0,k.YO)((0,k.NW)({transaction:yi,meta:(0,k.me)(Ei),version:(0,k.lq)(Mi)})),rewards:(0,k.lq)((0,k.YO)(Ti)),blockTime:(0,k.me)((0,k.ai)()),blockHeight:(0,k.me)((0,k.ai)())}))),xi=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),transactions:(0,k.YO)((0,k.NW)({transaction:Ii,meta:(0,k.me)(Pi),version:(0,k.lq)(Mi)})),rewards:(0,k.lq)((0,k.YO)(Ti)),blockTime:(0,k.me)((0,k.ai)()),blockHeight:(0,k.me)((0,k.ai)())}))),Ni=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),transactions:(0,k.YO)((0,k.NW)({transaction:yi,meta:(0,k.me)(Pi),version:(0,k.lq)(Mi)})),rewards:(0,k.lq)((0,k.YO)(Ti)),blockTime:(0,k.me)((0,k.ai)()),blockHeight:(0,k.me)((0,k.ai)())}))),Ci=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),rewards:(0,k.lq)((0,k.YO)(Ti)),blockTime:(0,k.me)((0,k.ai)()),blockHeight:(0,k.me)((0,k.ai)())}))),Wi=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),transactions:(0,k.YO)((0,k.NW)({transaction:gi,meta:(0,k.me)(Ei)})),rewards:(0,k.lq)((0,k.YO)(Ti)),blockTime:(0,k.me)((0,k.ai)())}))),Li=le((0,k.me)((0,k.NW)({blockhash:(0,k.Yj)(),previousBlockhash:(0,k.Yj)(),parentSlot:(0,k.ai)(),signatures:(0,k.YO)((0,k.Yj)()),blockTime:(0,k.me)((0,k.ai)())}))),zi=le((0,k.me)((0,k.NW)({slot:(0,k.ai)(),meta:(0,k.me)(Ei),blockTime:(0,k.lq)((0,k.me)((0,k.ai)())),transaction:gi,version:(0,k.lq)(Mi)}))),Ki=le((0,k.me)((0,k.NW)({slot:(0,k.ai)(),transaction:Ii,meta:(0,k.me)(Pi),blockTime:(0,k.lq)((0,k.me)((0,k.ai)())),version:(0,k.lq)(Mi)}))),Yi=de((0,k.NW)({blockhash:(0,k.Yj)(),lastValidBlockHeight:(0,k.ai)()})),qi=de((0,k.zM)()),Di=(0,k.NW)({slot:(0,k.ai)(),numTransactions:(0,k.ai)(),numSlots:(0,k.ai)(),samplePeriodSecs:(0,k.ai)()}),Ui=le((0,k.YO)(Di)),ji=de((0,k.me)((0,k.NW)({feeCalculator:(0,k.NW)({lamportsPerSignature:(0,k.ai)()})}))),Hi=le((0,k.Yj)()),$i=le((0,k.Yj)()),Vi=(0,k.NW)({err:Se,logs:(0,k.YO)((0,k.Yj)()),signature:(0,k.Yj)()}),Fi=(0,k.NW)({result:pe(Vi),subscription:(0,k.ai)()}),Ji={"solana-client":"js/1.0.0-maintenance"};class Gi{constructor(t,e){let i,r,n,s,o,a;var c;this._commitment=void 0,this._confirmTransactionInitialTimeout=void 0,this._rpcEndpoint=void 0,this._rpcWsEndpoint=void 0,this._rpcClient=void 0,this._rpcRequest=void 0,this._rpcBatchRequest=void 0,this._rpcWebSocket=void 0,this._rpcWebSocketConnected=!1,this._rpcWebSocketHeartbeat=null,this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketGeneration=0,this._disableBlockhashCaching=!1,this._pollingBlockhash=!1,this._blockhashInfo={latestBlockhash:null,lastFetch:0,transactionSignatures:[],simulatedSignatures:[]},this._nextClientSubscriptionId=0,this._subscriptionDisposeFunctionsByClientSubscriptionId={},this._subscriptionHashByClientSubscriptionId={},this._subscriptionStateChangeCallbacksByHash={},this._subscriptionCallbacksByServerSubscriptionId={},this._subscriptionsByHash={},this._subscriptionsAutoDisposedByRpc=new Set,this.getBlockHeight=(()=>{const t={};return async e=>{const{commitment:i,config:r}=ae(e),n=this._buildArgs([],i,void 0,r),s=Jt(n);return t[s]=t[s]??(async()=>{try{const t=await this._rpcRequest("getBlockHeight",n),e=(0,k.vt)(t,le((0,k.ai)()));if("error"in e)throw new Mt(e.error,"failed to get block height information");return e.result}finally{delete t[s]}})(),await t[s]}})(),e&&"string"==typeof e?this._commitment=e:e&&(this._commitment=e.commitment,this._confirmTransactionInitialTimeout=e.confirmTransactionInitialTimeout,i=e.wsEndpoint,r=e.httpHeaders,n=e.fetch,s=e.fetchMiddleware,o=e.disableRetryOnRateLimit,a=e.httpAgent),this._rpcEndpoint=function(t){if(!1===/^https?:/.test(t))throw new TypeError("Endpoint URL must start with `http:` or `https:`.");return t}(t),this._rpcWsEndpoint=i||function(t){const e=t.match(ie);if(null==e)throw TypeError(`Failed to validate endpoint URL \`${t}\``);const[i,r,n,s]=e,o=t.startsWith("https:")?"wss:":"ws:",a=null==n?null:parseInt(n.slice(1),10);return`${o}//${r}${null==a?"":`:${a+1}`}${s}`}(t),this._rpcClient=function(t,e,i,r,n,s){const o=i||Xt;let a;return null!=s&&console.warn("You have supplied an `httpAgent` when creating a `Connection` in a browser environment.It has been ignored; `httpAgent` is only used in Node environments."),r&&(a=async(t,e)=>{const i=await new Promise((i,n)=>{try{r(t,e,(t,e)=>i([t,e]))}catch(t){n(t)}});return await o(...i)}),new(I())(async(i,r)=>{const s={method:"POST",body:i,agent:void 0,headers:Object.assign({"Content-Type":"application/json"},e||{},Ji)};try{let e,i=5,c=500;for(;e=a?await a(t,s):await o(t,s),429===e.status&&!0!==n&&(i-=1,0!==i);)console.error(`Server responded with ${e.status} ${e.statusText}.  Retrying after ${c}ms delay...`),await Bt(c),c*=2;const u=await e.text();e.ok?r(null,u):r(new Error(`${e.status} ${e.statusText}: ${u}`))}catch(t){t instanceof Error&&r(t)}},{})}(t,r,n,s,o,a),this._rpcRequest=(c=this._rpcClient,(t,e)=>new Promise((i,r)=>{c.request(t,e,(t,e)=>{t?r(t):i(e)})})),this._rpcBatchRequest=function(t){return e=>new Promise((i,r)=>{0===e.length&&i([]);const n=e.map(e=>t.request(e.methodName,e.args));t.request(n,(t,e)=>{t?r(t):i(e)})})}(this._rpcClient),this._rpcWebSocket=new Qt(this._rpcWsEndpoint,{autoconnect:!1,max_reconnects:1/0}),this._rpcWebSocket.on("open",this._wsOnOpen.bind(this)),this._rpcWebSocket.on("error",this._wsOnError.bind(this)),this._rpcWebSocket.on("close",this._wsOnClose.bind(this)),this._rpcWebSocket.on("accountNotification",this._wsOnAccountNotification.bind(this)),this._rpcWebSocket.on("programNotification",this._wsOnProgramAccountNotification.bind(this)),this._rpcWebSocket.on("slotNotification",this._wsOnSlotNotification.bind(this)),this._rpcWebSocket.on("slotsUpdatesNotification",this._wsOnSlotUpdatesNotification.bind(this)),this._rpcWebSocket.on("signatureNotification",this._wsOnSignatureNotification.bind(this)),this._rpcWebSocket.on("rootNotification",this._wsOnRootNotification.bind(this)),this._rpcWebSocket.on("logsNotification",this._wsOnLogsNotification.bind(this))}get commitment(){return this._commitment}get rpcEndpoint(){return this._rpcEndpoint}async getBalanceAndContext(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgs([t.toBase58()],i,void 0,r),s=await this._rpcRequest("getBalance",n),o=(0,k.vt)(s,de((0,k.ai)()));if("error"in o)throw new Mt(o.error,`failed to get balance for ${t.toBase58()}`);return o.result}async getBalance(t,e){return await this.getBalanceAndContext(t,e).then(t=>t.value).catch(e=>{throw new Error("failed to get balance of account "+t.toBase58()+": "+e)})}async getBlockTime(t){const e=await this._rpcRequest("getBlockTime",[t]),i=(0,k.vt)(e,le((0,k.me)((0,k.ai)())));if("error"in i)throw new Mt(i.error,`failed to get block time for slot ${t}`);return i.result}async getMinimumLedgerSlot(){const t=await this._rpcRequest("minimumLedgerSlot",[]),e=(0,k.vt)(t,le((0,k.ai)()));if("error"in e)throw new Mt(e.error,"failed to get minimum ledger slot");return e.result}async getFirstAvailableBlock(){const t=await this._rpcRequest("getFirstAvailableBlock",[]),e=(0,k.vt)(t,We);if("error"in e)throw new Mt(e.error,"failed to get first available block");return e.result}async getSupply(t){let e={};e="string"==typeof t?{commitment:t}:t?{...t,commitment:t&&t.commitment||this.commitment}:{commitment:this.commitment};const i=await this._rpcRequest("getSupply",[e]),r=(0,k.vt)(i,Le);if("error"in r)throw new Mt(r.error,"failed to get supply");return r.result}async getTokenSupply(t,e){const i=this._buildArgs([t.toBase58()],e),r=await this._rpcRequest("getTokenSupply",i),n=(0,k.vt)(r,de(ze));if("error"in n)throw new Mt(n.error,"failed to get token supply");return n.result}async getTokenAccountBalance(t,e){const i=this._buildArgs([t.toBase58()],e),r=await this._rpcRequest("getTokenAccountBalance",i),n=(0,k.vt)(r,de(ze));if("error"in n)throw new Mt(n.error,"failed to get token account balance");return n.result}async getTokenAccountsByOwner(t,e,i){const{commitment:r,config:n}=ae(i);let s=[t.toBase58()];"mint"in e?s.push({mint:e.mint.toBase58()}):s.push({programId:e.programId.toBase58()});const o=this._buildArgs(s,r,"base64",n),a=await this._rpcRequest("getTokenAccountsByOwner",o),c=(0,k.vt)(a,Ye);if("error"in c)throw new Mt(c.error,`failed to get token accounts owned by account ${t.toBase58()}`);return c.result}async getParsedTokenAccountsByOwner(t,e,i){let r=[t.toBase58()];"mint"in e?r.push({mint:e.mint.toBase58()}):r.push({programId:e.programId.toBase58()});const n=this._buildArgs(r,i,"jsonParsed"),s=await this._rpcRequest("getTokenAccountsByOwner",n),o=(0,k.vt)(s,De);if("error"in o)throw new Mt(o.error,`failed to get token accounts owned by account ${t.toBase58()}`);return o.result}async getLargestAccounts(t){const e={...t,commitment:t&&t.commitment||this.commitment},i=e.filter||e.commitment?[e]:[],r=await this._rpcRequest("getLargestAccounts",i),n=(0,k.vt)(r,Ue);if("error"in n)throw new Mt(n.error,"failed to get largest accounts");return n.result}async getTokenLargestAccounts(t,e){const i=this._buildArgs([t.toBase58()],e),r=await this._rpcRequest("getTokenLargestAccounts",i),n=(0,k.vt)(r,Ke);if("error"in n)throw new Mt(n.error,"failed to get token largest accounts");return n.result}async getAccountInfoAndContext(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgs([t.toBase58()],i,"base64",r),s=await this._rpcRequest("getAccountInfo",n),o=(0,k.vt)(s,de((0,k.me)(je)));if("error"in o)throw new Mt(o.error,`failed to get info about account ${t.toBase58()}`);return o.result}async getParsedAccountInfo(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgs([t.toBase58()],i,"jsonParsed",r),s=await this._rpcRequest("getAccountInfo",n),o=(0,k.vt)(s,de((0,k.me)(Ve)));if("error"in o)throw new Mt(o.error,`failed to get info about account ${t.toBase58()}`);return o.result}async getAccountInfo(t,e){try{return(await this.getAccountInfoAndContext(t,e)).value}catch(e){throw new Error("failed to get info about account "+t.toBase58()+": "+e)}}async getMultipleParsedAccounts(t,e){const{commitment:i,config:r}=ae(e),n=t.map(t=>t.toBase58()),s=this._buildArgs([n],i,"jsonParsed",r),o=await this._rpcRequest("getMultipleAccounts",s),a=(0,k.vt)(o,de((0,k.YO)((0,k.me)(Ve))));if("error"in a)throw new Mt(a.error,`failed to get info for accounts ${n}`);return a.result}async getMultipleAccountsInfoAndContext(t,e){const{commitment:i,config:r}=ae(e),n=t.map(t=>t.toBase58()),s=this._buildArgs([n],i,"base64",r),o=await this._rpcRequest("getMultipleAccounts",s),a=(0,k.vt)(o,de((0,k.YO)((0,k.me)(je))));if("error"in a)throw new Mt(a.error,`failed to get info for accounts ${n}`);return a.result}async getMultipleAccountsInfo(t,e){return(await this.getMultipleAccountsInfoAndContext(t,e)).value}async getStakeActivation(t,e,i){const{commitment:r,config:n}=ae(e),s=this._buildArgs([t.toBase58()],r,void 0,{...n,epoch:null!=i?i:n?.epoch}),o=await this._rpcRequest("getStakeActivation",s),a=(0,k.vt)(o,le(Je));if("error"in a)throw new Mt(a.error,`failed to get Stake Activation ${t.toBase58()}`);return a.result}async getProgramAccounts(t,e){const{commitment:i,config:r}=ae(e),{encoding:n,...s}=r||{},o=this._buildArgs([t.toBase58()],i,n||"base64",{...s,...s.filters?{filters:ce(s.filters)}:null}),a=await this._rpcRequest("getProgramAccounts",o),c=(0,k.YO)(He),u=!0===s.withContext?(0,k.vt)(a,de(c)):(0,k.vt)(a,le(c));if("error"in u)throw new Mt(u.error,`failed to get accounts owned by program ${t.toBase58()}`);return u.result}async getParsedProgramAccounts(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgs([t.toBase58()],i,"jsonParsed",r),s=await this._rpcRequest("getProgramAccounts",n),o=(0,k.vt)(s,le((0,k.YO)(Fe)));if("error"in o)throw new Mt(o.error,`failed to get accounts owned by program ${t.toBase58()}`);return o.result}async confirmTransaction(t,e){let i,r;if("string"==typeof t)i=t;else{const e=t;if(e.abortSignal?.aborted)return Promise.reject(e.abortSignal.reason);i=e.signature}try{r=c().decode(i)}catch(t){throw new Error("signature must be base58 encoded: "+i)}return rt(64===r.length,"signature has invalid length"),"string"==typeof t?await this.confirmTransactionUsingLegacyTimeoutStrategy({commitment:e||this.commitment,signature:i}):"lastValidBlockHeight"in t?await this.confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:e||this.commitment,strategy:t}):await this.confirmTransactionUsingDurableNonceStrategy({commitment:e||this.commitment,strategy:t})}getCancellationPromise(t){return new Promise((e,i)=>{null!=t&&(t.aborted?i(t.reason):t.addEventListener("abort",()=>{i(t.reason)}))})}getTransactionConfirmationPromise({commitment:t,signature:e}){let i,r,n=!1;return{abortConfirmation:()=>{r&&(r(),r=void 0),null!=i&&(this.removeSignatureListener(i),i=void 0)},confirmationPromise:new Promise((s,o)=>{try{i=this.onSignature(e,(t,e)=>{i=void 0;const r={context:e,value:t};s({__type:lt.PROCESSED,response:r})},t);const a=new Promise(t=>{null==i?t():r=this._onSubscriptionStateChange(i,e=>{"subscribed"===e&&t()})});(async()=>{if(await a,n)return;const i=await this.getSignatureStatus(e);if(n)return;if(null==i)return;const{context:r,value:c}=i;if(null!=c)if(c?.err)o(c.err);else{switch(t){case"confirmed":case"single":case"singleGossip":if("processed"===c.confirmationStatus)return;break;case"finalized":case"max":case"root":if("processed"===c.confirmationStatus||"confirmed"===c.confirmationStatus)return}n=!0,s({__type:lt.PROCESSED,response:{context:r,value:c}})}})()}catch(t){o(t)}})}}async confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:t,strategy:{abortSignal:e,lastValidBlockHeight:i,signature:r}}){let n=!1;const s=new Promise(e=>{const r=async()=>{try{return await this.getBlockHeight(t)}catch(t){return-1}};(async()=>{let t=await r();if(!n){for(;t<=i;){if(await Bt(1e3),n)return;if(t=await r(),n)return}e({__type:lt.BLOCKHEIGHT_EXCEEDED})}})()}),{abortConfirmation:o,confirmationPromise:a}=this.getTransactionConfirmationPromise({commitment:t,signature:r}),c=this.getCancellationPromise(e);let u;try{const t=await Promise.race([c,a,s]);if(t.__type!==lt.PROCESSED)throw new V(r);u=t.response}finally{n=!0,o()}return u}async confirmTransactionUsingDurableNonceStrategy({commitment:t,strategy:{abortSignal:e,minContextSlot:i,nonceAccountPubkey:r,nonceValue:n,signature:s}}){let o=!1;const a=new Promise(e=>{let s=n,a=null;const c=async()=>{try{const{context:e,value:n}=await this.getNonceAndContext(r,{commitment:t,minContextSlot:i});return a=e.slot,n?.nonce}catch(t){return s}};(async()=>{if(s=await c(),!o)for(;;){if(n!==s)return void e({__type:lt.NONCE_INVALID,slotInWhichNonceDidAdvance:a});if(await Bt(2e3),o)return;if(s=await c(),o)return}})()}),{abortConfirmation:c,confirmationPromise:u}=this.getTransactionConfirmationPromise({commitment:t,signature:s}),h=this.getCancellationPromise(e);let l;try{const e=await Promise.race([h,u,a]);if(e.__type===lt.PROCESSED)l=e.response;else{let r;for(;;){const t=await this.getSignatureStatus(s);if(null==t)break;if(!(t.context.slot<(e.slotInWhichNonceDidAdvance??i))){r=t;break}await Bt(400)}if(!r?.value)throw new J(s);{const e=t||"finalized",{confirmationStatus:i}=r.value;switch(e){case"processed":case"recent":if("processed"!==i&&"confirmed"!==i&&"finalized"!==i)throw new J(s);break;case"confirmed":case"single":case"singleGossip":if("confirmed"!==i&&"finalized"!==i)throw new J(s);break;case"finalized":case"max":case"root":if("finalized"!==i)throw new J(s)}l={context:r.context,value:{err:r.value.err}}}}}finally{o=!0,c()}return l}async confirmTransactionUsingLegacyTimeoutStrategy({commitment:t,signature:e}){let i;const r=new Promise(e=>{let r=this._confirmTransactionInitialTimeout||6e4;switch(t){case"processed":case"recent":case"single":case"confirmed":case"singleGossip":r=this._confirmTransactionInitialTimeout||3e4}i=setTimeout(()=>e({__type:lt.TIMED_OUT,timeoutMs:r}),r)}),{abortConfirmation:n,confirmationPromise:s}=this.getTransactionConfirmationPromise({commitment:t,signature:e});let o;try{const t=await Promise.race([s,r]);if(t.__type!==lt.PROCESSED)throw new F(e,t.timeoutMs/1e3);o=t.response}finally{clearTimeout(i),n()}return o}async getClusterNodes(){const t=await this._rpcRequest("getClusterNodes",[]),e=(0,k.vt)(t,le((0,k.YO)(ai)));if("error"in e)throw new Mt(e.error,"failed to get cluster nodes");return e.result}async getVoteAccounts(t){const e=this._buildArgs([],t),i=await this._rpcRequest("getVoteAccounts",e),r=(0,k.vt)(i,ui);if("error"in r)throw new Mt(r.error,"failed to get vote accounts");return r.result}async getSlot(t){const{commitment:e,config:i}=ae(t),r=this._buildArgs([],e,void 0,i),n=await this._rpcRequest("getSlot",r),s=(0,k.vt)(n,le((0,k.ai)()));if("error"in s)throw new Mt(s.error,"failed to get slot");return s.result}async getSlotLeader(t){const{commitment:e,config:i}=ae(t),r=this._buildArgs([],e,void 0,i),n=await this._rpcRequest("getSlotLeader",r),s=(0,k.vt)(n,le((0,k.Yj)()));if("error"in s)throw new Mt(s.error,"failed to get slot leader");return s.result}async getSlotLeaders(t,e){const i=[t,e],r=await this._rpcRequest("getSlotLeaders",i),n=(0,k.vt)(r,le((0,k.YO)(re)));if("error"in n)throw new Mt(n.error,"failed to get slot leaders");return n.result}async getSignatureStatus(t,e){const{context:i,value:r}=await this.getSignatureStatuses([t],e);return rt(1===r.length),{context:i,value:r[0]}}async getSignatureStatuses(t,e){const i=[t];e&&i.push(e);const r=await this._rpcRequest("getSignatureStatuses",i),n=(0,k.vt)(r,di);if("error"in n)throw new Mt(n.error,"failed to get signature status");return n.result}async getTransactionCount(t){const{commitment:e,config:i}=ae(t),r=this._buildArgs([],e,void 0,i),n=await this._rpcRequest("getTransactionCount",r),s=(0,k.vt)(n,le((0,k.ai)()));if("error"in s)throw new Mt(s.error,"failed to get transaction count");return s.result}async getTotalSupply(t){return(await this.getSupply({commitment:t,excludeNonCirculatingAccountsList:!0})).value.total}async getInflationGovernor(t){const e=this._buildArgs([],t),i=await this._rpcRequest("getInflationGovernor",e),r=(0,k.vt)(i,Be);if("error"in r)throw new Mt(r.error,"failed to get inflation");return r.result}async getInflationReward(t,e,i){const{commitment:r,config:n}=ae(i),s=this._buildArgs([t.map(t=>t.toBase58())],r,void 0,{...n,epoch:null!=e?e:n?.epoch}),o=await this._rpcRequest("getInflationReward",s),a=(0,k.vt)(o,me);if("error"in a)throw new Mt(a.error,"failed to get inflation reward");return a.result}async getInflationRate(){const t=await this._rpcRequest("getInflationRate",[]),e=(0,k.vt)(t,Re);if("error"in e)throw new Mt(e.error,"failed to get inflation rate");return e.result}async getEpochInfo(t){const{commitment:e,config:i}=ae(t),r=this._buildArgs([],e,void 0,i),n=await this._rpcRequest("getEpochInfo",r),s=(0,k.vt)(n,xe);if("error"in s)throw new Mt(s.error,"failed to get epoch info");return s.result}async getEpochSchedule(){const t=await this._rpcRequest("getEpochSchedule",[]),e=(0,k.vt)(t,Ne);if("error"in e)throw new Mt(e.error,"failed to get epoch schedule");const i=e.result;return new Zt(i.slotsPerEpoch,i.leaderScheduleSlotOffset,i.warmup,i.firstNormalEpoch,i.firstNormalSlot)}async getLeaderSchedule(){const t=await this._rpcRequest("getLeaderSchedule",[]),e=(0,k.vt)(t,Ce);if("error"in e)throw new Mt(e.error,"failed to get leader schedule");return e.result}async getMinimumBalanceForRentExemption(t,e){const i=this._buildArgs([t],e),r=await this._rpcRequest("getMinimumBalanceForRentExemption",i),n=(0,k.vt)(r,pi);return"error"in n?(console.warn("Unable to fetch minimum balance for rent exemption"),0):n.result}async getRecentBlockhashAndContext(t){const{context:e,value:{blockhash:i}}=await this.getLatestBlockhashAndContext(t);return{context:e,value:{blockhash:i,feeCalculator:{get lamportsPerSignature(){throw new Error("The capability to fetch `lamportsPerSignature` using the `getRecentBlockhash` API is no longer offered by the network. Use the `getFeeForMessage` API to obtain the fee for a given message.")},toJSON:()=>({})}}}}async getRecentPerformanceSamples(t){const e=await this._rpcRequest("getRecentPerformanceSamples",t?[t]:[]),i=(0,k.vt)(e,Ui);if("error"in i)throw new Mt(i.error,"failed to get recent performance samples");return i.result}async getFeeCalculatorForBlockhash(t,e){const i=this._buildArgs([t],e),r=await this._rpcRequest("getFeeCalculatorForBlockhash",i),n=(0,k.vt)(r,ji);if("error"in n)throw new Mt(n.error,"failed to get fee calculator");const{context:s,value:o}=n.result;return{context:s,value:null!==o?o.feeCalculator:null}}async getFeeForMessage(t,e){const i=x(t.serialize()).toString("base64"),r=this._buildArgs([i],e),n=await this._rpcRequest("getFeeForMessage",r),s=(0,k.vt)(n,de((0,k.me)((0,k.ai)())));if("error"in s)throw new Mt(s.error,"failed to get fee for message");if(null===s.result)throw new Error("invalid blockhash");return s.result}async getRecentPrioritizationFees(t){const e=t?.lockedWritableAccounts?.map(t=>t.toBase58()),i=e?.length?[e]:[],r=await this._rpcRequest("getRecentPrioritizationFees",i),n=(0,k.vt)(r,Oe);if("error"in n)throw new Mt(n.error,"failed to get recent prioritization fees");return n.result}async getRecentBlockhash(t){try{return(await this.getRecentBlockhashAndContext(t)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhash(t){try{return(await this.getLatestBlockhashAndContext(t)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhashAndContext(t){const{commitment:e,config:i}=ae(t),r=this._buildArgs([],e,void 0,i),n=await this._rpcRequest("getLatestBlockhash",r),s=(0,k.vt)(n,Yi);if("error"in s)throw new Mt(s.error,"failed to get latest blockhash");return s.result}async isBlockhashValid(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgs([t],i,void 0,r),s=await this._rpcRequest("isBlockhashValid",n),o=(0,k.vt)(s,qi);if("error"in o)throw new Mt(o.error,"failed to determine if the blockhash `"+t+"`is valid");return o.result}async getVersion(){const t=await this._rpcRequest("getVersion",[]),e=(0,k.vt)(t,le(_e));if("error"in e)throw new Mt(e.error,"failed to get version");return e.result}async getGenesisHash(){const t=await this._rpcRequest("getGenesisHash",[]),e=(0,k.vt)(t,le((0,k.Yj)()));if("error"in e)throw new Mt(e.error,"failed to get genesis hash");return e.result}async getBlock(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgsAtLeastConfirmed([t],i,void 0,r),s=await this._rpcRequest("getBlock",n);try{switch(r?.transactionDetails){case"accounts":{const t=(0,k.vt)(s,Oi);if("error"in t)throw t.error;return t.result}case"none":{const t=(0,k.vt)(s,Ri);if("error"in t)throw t.error;return t.result}default:{const t=(0,k.vt)(s,Bi);if("error"in t)throw t.error;const{result:e}=t;return e?{...e,transactions:e.transactions.map(({transaction:t,meta:e,version:i})=>({meta:e,transaction:{...t,message:fe(i,t.message)},version:i}))}:null}}}catch(t){throw new Mt(t,"failed to get confirmed block")}}async getParsedBlock(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgsAtLeastConfirmed([t],i,"jsonParsed",r),s=await this._rpcRequest("getBlock",n);try{switch(r?.transactionDetails){case"accounts":{const t=(0,k.vt)(s,Ni);if("error"in t)throw t.error;return t.result}case"none":{const t=(0,k.vt)(s,Ci);if("error"in t)throw t.error;return t.result}default:{const t=(0,k.vt)(s,xi);if("error"in t)throw t.error;return t.result}}}catch(t){throw new Mt(t,"failed to get block")}}async getBlockProduction(t){let e,i;if("string"==typeof t)i=t;else if(t){const{commitment:r,...n}=t;i=r,e=n}const r=this._buildArgs([],i,"base64",e),n=await this._rpcRequest("getBlockProduction",r),s=(0,k.vt)(n,Te);if("error"in s)throw new Mt(s.error,"failed to get block production information");return s.result}async getTransaction(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgsAtLeastConfirmed([t],i,void 0,r),s=await this._rpcRequest("getTransaction",n),o=(0,k.vt)(s,zi);if("error"in o)throw new Mt(o.error,"failed to get transaction");const a=o.result;return a?{...a,transaction:{...a.transaction,message:fe(a.version,a.transaction.message)}}:a}async getParsedTransaction(t,e){const{commitment:i,config:r}=ae(e),n=this._buildArgsAtLeastConfirmed([t],i,"jsonParsed",r),s=await this._rpcRequest("getTransaction",n),o=(0,k.vt)(s,Ki);if("error"in o)throw new Mt(o.error,"failed to get transaction");return o.result}async getParsedTransactions(t,e){const{commitment:i,config:r}=ae(e),n=t.map(t=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([t],i,"jsonParsed",r)}));return(await this._rpcBatchRequest(n)).map(t=>{const e=(0,k.vt)(t,Ki);if("error"in e)throw new Mt(e.error,"failed to get transactions");return e.result})}async getTransactions(t,e){const{commitment:i,config:r}=ae(e),n=t.map(t=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([t],i,void 0,r)}));return(await this._rpcBatchRequest(n)).map(t=>{const e=(0,k.vt)(t,zi);if("error"in e)throw new Mt(e.error,"failed to get transactions");const i=e.result;return i?{...i,transaction:{...i.transaction,message:fe(i.version,i.transaction.message)}}:i})}async getConfirmedBlock(t,e){const i=this._buildArgsAtLeastConfirmed([t],e),r=await this._rpcRequest("getBlock",i),n=(0,k.vt)(r,Wi);if("error"in n)throw new Mt(n.error,"failed to get confirmed block");const s=n.result;if(!s)throw new Error("Confirmed block "+t+" not found");const o={...s,transactions:s.transactions.map(({transaction:t,meta:e})=>{const i=new ct(t.message);return{meta:e,transaction:{...t,message:i}}})};return{...o,transactions:o.transactions.map(({transaction:t,meta:e})=>({meta:e,transaction:ft.populate(t.message,t.signatures)}))}}async getBlocks(t,e,i){const r=this._buildArgsAtLeastConfirmed(void 0!==e?[t,e]:[t],i),n=await this._rpcRequest("getBlocks",r),s=(0,k.vt)(n,le((0,k.YO)((0,k.ai)())));if("error"in s)throw new Mt(s.error,"failed to get blocks");return s.result}async getBlockSignatures(t,e){const i=this._buildArgsAtLeastConfirmed([t],e,void 0,{transactionDetails:"signatures",rewards:!1}),r=await this._rpcRequest("getBlock",i),n=(0,k.vt)(r,Li);if("error"in n)throw new Mt(n.error,"failed to get block");const s=n.result;if(!s)throw new Error("Block "+t+" not found");return s}async getConfirmedBlockSignatures(t,e){const i=this._buildArgsAtLeastConfirmed([t],e,void 0,{transactionDetails:"signatures",rewards:!1}),r=await this._rpcRequest("getBlock",i),n=(0,k.vt)(r,Li);if("error"in n)throw new Mt(n.error,"failed to get confirmed block");const s=n.result;if(!s)throw new Error("Confirmed block "+t+" not found");return s}async getConfirmedTransaction(t,e){const i=this._buildArgsAtLeastConfirmed([t],e),r=await this._rpcRequest("getTransaction",i),n=(0,k.vt)(r,zi);if("error"in n)throw new Mt(n.error,"failed to get transaction");const s=n.result;if(!s)return s;const o=new ct(s.transaction.message),a=s.transaction.signatures;return{...s,transaction:ft.populate(o,a)}}async getParsedConfirmedTransaction(t,e){const i=this._buildArgsAtLeastConfirmed([t],e,"jsonParsed"),r=await this._rpcRequest("getTransaction",i),n=(0,k.vt)(r,Ki);if("error"in n)throw new Mt(n.error,"failed to get confirmed transaction");return n.result}async getParsedConfirmedTransactions(t,e){const i=t.map(t=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([t],e,"jsonParsed")}));return(await this._rpcBatchRequest(i)).map(t=>{const e=(0,k.vt)(t,Ki);if("error"in e)throw new Mt(e.error,"failed to get confirmed transactions");return e.result})}async getConfirmedSignaturesForAddress(t,e,i){let r={},n=await this.getFirstAvailableBlock();for(;!("until"in r)&&!(--e<=0||e<n);)try{const t=await this.getConfirmedBlockSignatures(e,"finalized");t.signatures.length>0&&(r.until=t.signatures[t.signatures.length-1].toString())}catch(t){if(t instanceof Error&&t.message.includes("skipped"))continue;throw t}let s=await this.getSlot("finalized");for(;!("before"in r||++i>s);)try{const t=await this.getConfirmedBlockSignatures(i);t.signatures.length>0&&(r.before=t.signatures[t.signatures.length-1].toString())}catch(t){if(t instanceof Error&&t.message.includes("skipped"))continue;throw t}return(await this.getConfirmedSignaturesForAddress2(t,r)).map(t=>t.signature)}async getConfirmedSignaturesForAddress2(t,e,i){const r=this._buildArgsAtLeastConfirmed([t.toBase58()],i,void 0,e),n=await this._rpcRequest("getConfirmedSignaturesForAddress2",r),s=(0,k.vt)(n,Ge);if("error"in s)throw new Mt(s.error,"failed to get confirmed signatures for address");return s.result}async getSignaturesForAddress(t,e,i){const r=this._buildArgsAtLeastConfirmed([t.toBase58()],i,void 0,e),n=await this._rpcRequest("getSignaturesForAddress",r),s=(0,k.vt)(n,Ze);if("error"in s)throw new Mt(s.error,"failed to get signatures for address");return s.result}async getAddressLookupTable(t,e){const{context:i,value:r}=await this.getAccountInfoAndContext(t,e);let n=null;return null!==r&&(n=new te({key:t,state:te.deserialize(r.data)})),{context:i,value:n}}async getNonceAndContext(t,e){const{context:i,value:r}=await this.getAccountInfoAndContext(t,e);let n=null;return null!==r&&(n=Wt.fromAccountData(r.data)),{context:i,value:n}}async getNonce(t,e){return await this.getNonceAndContext(t,e).then(t=>t.value).catch(e=>{throw new Error("failed to get nonce for account "+t.toBase58()+": "+e)})}async requestAirdrop(t,e){const i=await this._rpcRequest("requestAirdrop",[t.toBase58(),e]),r=(0,k.vt)(i,Hi);if("error"in r)throw new Mt(r.error,`airdrop to ${t.toBase58()} failed`);return r.result}async _blockhashWithExpiryBlockHeight(t){if(!t){for(;this._pollingBlockhash;)await Bt(100);const t=Date.now()-this._blockhashInfo.lastFetch>=oe;if(null!==this._blockhashInfo.latestBlockhash&&!t)return this._blockhashInfo.latestBlockhash}return await this._pollNewBlockhash()}async _pollNewBlockhash(){this._pollingBlockhash=!0;try{const t=Date.now(),e=this._blockhashInfo.latestBlockhash,i=e?e.blockhash:null;for(let t=0;t<50;t++){const t=await this.getLatestBlockhash("finalized");if(i!==t.blockhash)return this._blockhashInfo={latestBlockhash:t,lastFetch:Date.now(),transactionSignatures:[],simulatedSignatures:[]},t;await Bt(200)}throw new Error(`Unable to obtain a new blockhash after ${Date.now()-t}ms`)}finally{this._pollingBlockhash=!1}}async getStakeMinimumDelegation(t){const{commitment:e,config:i}=ae(t),r=this._buildArgs([],e,"base64",i),n=await this._rpcRequest("getStakeMinimumDelegation",r),s=(0,k.vt)(n,de((0,k.ai)()));if("error"in s)throw new Mt(s.error,"failed to get stake minimum delegation");return s.result}async simulateTransaction(t,e,i){if("message"in t){const n=t.serialize(),s=r.Buffer.from(n).toString("base64");if(Array.isArray(e)||void 0!==i)throw new Error("Invalid arguments");const o=e||{};o.encoding="base64","commitment"in o||(o.commitment=this.commitment),e&&"object"==typeof e&&"innerInstructions"in e&&(o.innerInstructions=e.innerInstructions);const a=[s,o],c=await this._rpcRequest("simulateTransaction",a),u=(0,k.vt)(c,Me);if("error"in u)throw new Error("failed to simulate transaction: "+u.error.message);return u.result}let n;if(t instanceof ft){let e=t;n=new ft,n.feePayer=e.feePayer,n.instructions=t.instructions,n.nonceInfo=e.nonceInfo,n.signatures=e.signatures}else n=ft.populate(t),n._message=n._json=void 0;if(void 0!==e&&!Array.isArray(e))throw new Error("Invalid arguments");const s=e;if(n.nonceInfo&&s)n.sign(...s);else{let t=this._disableBlockhashCaching;for(;;){const e=await this._blockhashWithExpiryBlockHeight(t);if(n.lastValidBlockHeight=e.lastValidBlockHeight,n.recentBlockhash=e.blockhash,!s)break;if(n.sign(...s),!n.signature)throw new Error("!signature");const i=n.signature.toString("base64");if(!this._blockhashInfo.simulatedSignatures.includes(i)&&!this._blockhashInfo.transactionSignatures.includes(i)){this._blockhashInfo.simulatedSignatures.push(i);break}t=!0}}const o=n._compile(),a=o.serialize(),c=n._serialize(a).toString("base64"),u={encoding:"base64",commitment:this.commitment};if(i){const t=(Array.isArray(i)?i:o.nonProgramIds()).map(t=>t.toBase58());u.accounts={encoding:"base64",addresses:t}}s&&(u.sigVerify=!0),e&&"object"==typeof e&&"innerInstructions"in e&&(u.innerInstructions=e.innerInstructions);const h=[c,u],l=await this._rpcRequest("simulateTransaction",h),d=(0,k.vt)(l,Me);if("error"in d){let t;if("data"in d.error&&(t=d.error.data.logs,t&&Array.isArray(t))){const e="\n    ",i=e+t.join(e);console.error(d.error.message,i)}throw new Et({action:"simulate",signature:"",transactionMessage:d.error.message,logs:t})}return d.result}async sendTransaction(t,e,i){if("version"in t){if(e&&Array.isArray(e))throw new Error("Invalid arguments");const i=t.serialize();return await this.sendRawTransaction(i,e)}if(void 0===e||!Array.isArray(e))throw new Error("Invalid arguments");const r=e;if(t.nonceInfo)t.sign(...r);else{let e=this._disableBlockhashCaching;for(;;){const i=await this._blockhashWithExpiryBlockHeight(e);if(t.lastValidBlockHeight=i.lastValidBlockHeight,t.recentBlockhash=i.blockhash,t.sign(...r),!t.signature)throw new Error("!signature");const n=t.signature.toString("base64");if(!this._blockhashInfo.transactionSignatures.includes(n)){this._blockhashInfo.transactionSignatures.push(n);break}e=!0}}const n=t.serialize();return await this.sendRawTransaction(n,i)}async sendRawTransaction(t,e){const i=x(t).toString("base64");return await this.sendEncodedTransaction(i,e)}async sendEncodedTransaction(t,e){const i={encoding:"base64"},r=e&&e.skipPreflight,n=!0===r?"processed":e&&e.preflightCommitment||this.commitment;e&&null!=e.maxRetries&&(i.maxRetries=e.maxRetries),e&&null!=e.minContextSlot&&(i.minContextSlot=e.minContextSlot),r&&(i.skipPreflight=r),n&&(i.preflightCommitment=n);const s=[t,i],o=await this._rpcRequest("sendTransaction",s),a=(0,k.vt)(o,$i);if("error"in a){let t;throw"data"in a.error&&(t=a.error.data.logs),new Et({action:r?"send":"simulate",signature:"",transactionMessage:a.error.message,logs:t})}return a.result}_wsOnOpen(){this._rpcWebSocketConnected=!0,this._rpcWebSocketHeartbeat=setInterval(()=>{(async()=>{try{await this._rpcWebSocket.notify("ping")}catch{}})()},5e3),this._updateSubscriptions()}_wsOnError(t){this._rpcWebSocketConnected=!1,console.error("ws error:",t.message)}_wsOnClose(t){this._rpcWebSocketConnected=!1,this._rpcWebSocketGeneration=(this._rpcWebSocketGeneration+1)%Number.MAX_SAFE_INTEGER,this._rpcWebSocketIdleTimeout&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null),this._rpcWebSocketHeartbeat&&(clearInterval(this._rpcWebSocketHeartbeat),this._rpcWebSocketHeartbeat=null),1e3!==t?(this._subscriptionCallbacksByServerSubscriptionId={},Object.entries(this._subscriptionsByHash).forEach(([t,e])=>{this._setSubscription(t,{...e,state:"pending"})})):this._updateSubscriptions()}_setSubscription(t,e){const i=this._subscriptionsByHash[t]?.state;if(this._subscriptionsByHash[t]=e,i!==e.state){const i=this._subscriptionStateChangeCallbacksByHash[t];i&&i.forEach(t=>{try{t(e.state)}catch{}})}}_onSubscriptionStateChange(t,e){const i=this._subscriptionHashByClientSubscriptionId[t];if(null==i)return()=>{};const r=this._subscriptionStateChangeCallbacksByHash[i]||=new Set;return r.add(e),()=>{r.delete(e),0===r.size&&delete this._subscriptionStateChangeCallbacksByHash[i]}}async _updateSubscriptions(){if(0===Object.keys(this._subscriptionsByHash).length)return void(this._rpcWebSocketConnected&&(this._rpcWebSocketConnected=!1,this._rpcWebSocketIdleTimeout=setTimeout(()=>{this._rpcWebSocketIdleTimeout=null;try{this._rpcWebSocket.close()}catch(t){t instanceof Error&&console.log(`Error when closing socket connection: ${t.message}`)}},500)));if(null!==this._rpcWebSocketIdleTimeout&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketConnected=!0),!this._rpcWebSocketConnected)return void this._rpcWebSocket.connect();const t=this._rpcWebSocketGeneration,e=()=>t===this._rpcWebSocketGeneration;await Promise.all(Object.keys(this._subscriptionsByHash).map(async t=>{const i=this._subscriptionsByHash[t];if(void 0!==i)switch(i.state){case"pending":case"unsubscribed":if(0===i.callbacks.size)return delete this._subscriptionsByHash[t],"unsubscribed"===i.state&&delete this._subscriptionCallbacksByServerSubscriptionId[i.serverSubscriptionId],void await this._updateSubscriptions();await(async()=>{const{args:r,method:n}=i;try{this._setSubscription(t,{...i,state:"subscribing"});const e=await this._rpcWebSocket.call(n,r);this._setSubscription(t,{...i,serverSubscriptionId:e,state:"subscribed"}),this._subscriptionCallbacksByServerSubscriptionId[e]=i.callbacks,await this._updateSubscriptions()}catch(s){if(console.error(`Received ${s instanceof Error?"":"JSON-RPC "}error calling \`${n}\``,{args:r,error:s}),!e())return;this._setSubscription(t,{...i,state:"pending"}),await this._updateSubscriptions()}})();break;case"subscribed":0===i.callbacks.size&&await(async()=>{const{serverSubscriptionId:r,unsubscribeMethod:n}=i;if(this._subscriptionsAutoDisposedByRpc.has(r))this._subscriptionsAutoDisposedByRpc.delete(r);else{this._setSubscription(t,{...i,state:"unsubscribing"}),this._setSubscription(t,{...i,state:"unsubscribing"});try{await this._rpcWebSocket.call(n,[r])}catch(r){if(r instanceof Error&&console.error(`${n} error:`,r.message),!e())return;return this._setSubscription(t,{...i,state:"subscribed"}),void await this._updateSubscriptions()}}this._setSubscription(t,{...i,state:"unsubscribed"}),await this._updateSubscriptions()})()}}))}_handleServerNotification(t,e){const i=this._subscriptionCallbacksByServerSubscriptionId[t];void 0!==i&&i.forEach(t=>{try{t(...e)}catch(t){console.error(t)}})}_wsOnAccountNotification(t){const{result:e,subscription:i}=(0,k.vt)(t,Xe);this._handleServerNotification(i,[e.value,e.context])}_makeSubscription(t,e){const i=this._nextClientSubscriptionId++,r=Jt([t.method,e]),n=this._subscriptionsByHash[r];return void 0===n?this._subscriptionsByHash[r]={...t,args:e,callbacks:new Set([t.callback]),state:"pending"}:n.callbacks.add(t.callback),this._subscriptionHashByClientSubscriptionId[i]=r,this._subscriptionDisposeFunctionsByClientSubscriptionId[i]=async()=>{delete this._subscriptionDisposeFunctionsByClientSubscriptionId[i],delete this._subscriptionHashByClientSubscriptionId[i];const e=this._subscriptionsByHash[r];rt(void 0!==e,`Could not find a \`Subscription\` when tearing down client subscription #${i}`),e.callbacks.delete(t.callback),await this._updateSubscriptions()},this._updateSubscriptions(),i}onAccountChange(t,e,i){const{commitment:r,config:n}=ae(i),s=this._buildArgs([t.toBase58()],r||this._commitment||"finalized","base64",n);return this._makeSubscription({callback:e,method:"accountSubscribe",unsubscribeMethod:"accountUnsubscribe"},s)}async removeAccountChangeListener(t){await this._unsubscribeClientSubscription(t,"account change")}_wsOnProgramAccountNotification(t){const{result:e,subscription:i}=(0,k.vt)(t,ti);this._handleServerNotification(i,[{accountId:e.value.pubkey,accountInfo:e.value.account},e.context])}onProgramAccountChange(t,e,i,r){const{commitment:n,config:s}=ae(i),o=this._buildArgs([t.toBase58()],n||this._commitment||"finalized","base64",s||(r?{filters:ce(r)}:void 0));return this._makeSubscription({callback:e,method:"programSubscribe",unsubscribeMethod:"programUnsubscribe"},o)}async removeProgramAccountChangeListener(t){await this._unsubscribeClientSubscription(t,"program account change")}onLogs(t,e,i){const r=this._buildArgs(["object"==typeof t?{mentions:[t.toString()]}:t],i||this._commitment||"finalized");return this._makeSubscription({callback:e,method:"logsSubscribe",unsubscribeMethod:"logsUnsubscribe"},r)}async removeOnLogsListener(t){await this._unsubscribeClientSubscription(t,"logs")}_wsOnLogsNotification(t){const{result:e,subscription:i}=(0,k.vt)(t,Fi);this._handleServerNotification(i,[e.value,e.context])}_wsOnSlotNotification(t){const{result:e,subscription:i}=(0,k.vt)(t,ii);this._handleServerNotification(i,[e])}onSlotChange(t){return this._makeSubscription({callback:t,method:"slotSubscribe",unsubscribeMethod:"slotUnsubscribe"},[])}async removeSlotChangeListener(t){await this._unsubscribeClientSubscription(t,"slot change")}_wsOnSlotUpdatesNotification(t){const{result:e,subscription:i}=(0,k.vt)(t,ni);this._handleServerNotification(i,[e])}onSlotUpdate(t){return this._makeSubscription({callback:t,method:"slotsUpdatesSubscribe",unsubscribeMethod:"slotsUpdatesUnsubscribe"},[])}async removeSlotUpdateListener(t){await this._unsubscribeClientSubscription(t,"slot update")}async _unsubscribeClientSubscription(t,e){const i=this._subscriptionDisposeFunctionsByClientSubscriptionId[t];i?await i():console.warn(`Ignored unsubscribe request because an active subscription with id \`${t}\` for '${e}' events could not be found.`)}_buildArgs(t,e,i,r){const n=e||this._commitment;if(n||i||r){let e={};i&&(e.encoding=i),n&&(e.commitment=n),r&&(e=Object.assign(e,r)),t.push(e)}return t}_buildArgsAtLeastConfirmed(t,e,i,r){const n=e||this._commitment;if(n&&!["confirmed","finalized"].includes(n))throw new Error("Using Connection with default commitment: `"+this._commitment+"`, but method requires at least `confirmed`");return this._buildArgs(t,e,i,r)}_wsOnSignatureNotification(t){const{result:e,subscription:i}=(0,k.vt)(t,si);"receivedSignature"!==e.value&&this._subscriptionsAutoDisposedByRpc.add(i),this._handleServerNotification(i,"receivedSignature"===e.value?[{type:"received"},e.context]:[{type:"status",result:e.value},e.context])}onSignature(t,e,i){const r=this._buildArgs([t],i||this._commitment||"finalized"),n=this._makeSubscription({callback:(t,i)=>{if("status"===t.type){e(t.result,i);try{this.removeSignatureListener(n)}catch(t){}}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},r);return n}onSignatureWithOptions(t,e,i){const{commitment:r,...n}={...i,commitment:i&&i.commitment||this._commitment||"finalized"},s=this._buildArgs([t],r,void 0,n),o=this._makeSubscription({callback:(t,i)=>{e(t,i);try{this.removeSignatureListener(o)}catch(t){}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},s);return o}async removeSignatureListener(t){await this._unsubscribeClientSubscription(t,"signature result")}_wsOnRootNotification(t){const{result:e,subscription:i}=(0,k.vt)(t,oi);this._handleServerNotification(i,[e])}onRootChange(t){return this._makeSubscription({callback:t,method:"rootSubscribe",unsubscribeMethod:"rootUnsubscribe"},[])}async removeRootChangeListener(t){await this._unsubscribeClientSubscription(t,"root change")}}class Zi{constructor(t){this._keypair=void 0,this._keypair=t??M()}static generate(){return new Zi(M())}static fromSecretKey(t,e){if(64!==t.byteLength)throw new Error("bad secret key size");const i=t.slice(32,64);if(!e||!e.skipValidation){const e=t.slice(0,32),r=T(e);for(let t=0;t<32;t++)if(i[t]!==r[t])throw new Error("provided secretKey is invalid")}return new Zi({publicKey:i,secretKey:t})}static fromSeed(t){const e=T(t),i=new Uint8Array(64);return i.set(t),i.set(e,32),new Zi({publicKey:e,secretKey:i})}get publicKey(){return new q(this._keypair.publicKey)}get secretKey(){return new Uint8Array(this._keypair.secretKey)}}const Xi=Object.freeze({CreateLookupTable:{index:0,layout:l.w3([l.DH("instruction"),Lt("recentSlot"),l.u8("bumpSeed")])},FreezeLookupTable:{index:1,layout:l.w3([l.DH("instruction")])},ExtendLookupTable:{index:2,layout:l.w3([l.DH("instruction"),Lt(),l.O6(Z(),l.cY(l.DH(),-8),"addresses")])},DeactivateLookupTable:{index:3,layout:l.w3([l.DH("instruction")])},CloseLookupTable:{index:4,layout:l.w3([l.DH("instruction")])}});class Qi{constructor(){}static decodeInstructionType(t){this.checkProgramId(t.programId);const e=l.DH("instruction").decode(t.data);let i;for(const[t,r]of Object.entries(Xi))if(r.index==e){i=t;break}if(!i)throw new Error("Invalid Instruction. Should be a LookupTable Instruction");return i}static decodeCreateLookupTable(t){this.checkProgramId(t.programId),this.checkKeysLength(t.keys,4);const{recentSlot:e}=Ot(Xi.CreateLookupTable,t.data);return{authority:t.keys[1].pubkey,payer:t.keys[2].pubkey,recentSlot:Number(e)}}static decodeExtendLookupTable(t){if(this.checkProgramId(t.programId),t.keys.length<2)throw new Error(`invalid instruction; found ${t.keys.length} keys, expected at least 2`);const{addresses:e}=Ot(Xi.ExtendLookupTable,t.data);return{lookupTable:t.keys[0].pubkey,authority:t.keys[1].pubkey,payer:t.keys.length>2?t.keys[2].pubkey:void 0,addresses:e.map(t=>new q(t))}}static decodeCloseLookupTable(t){return this.checkProgramId(t.programId),this.checkKeysLength(t.keys,3),{lookupTable:t.keys[0].pubkey,authority:t.keys[1].pubkey,recipient:t.keys[2].pubkey}}static decodeFreezeLookupTable(t){return this.checkProgramId(t.programId),this.checkKeysLength(t.keys,2),{lookupTable:t.keys[0].pubkey,authority:t.keys[1].pubkey}}static decodeDeactivateLookupTable(t){return this.checkProgramId(t.programId),this.checkKeysLength(t.keys,2),{lookupTable:t.keys[0].pubkey,authority:t.keys[1].pubkey}}static checkProgramId(t){if(!t.equals(tr.programId))throw new Error("invalid instruction; programId is not AddressLookupTable Program")}static checkKeysLength(t,e){if(t.length<e)throw new Error(`invalid instruction; found ${t.length} keys, expected at least ${e}`)}}class tr{constructor(){}static createLookupTable(t){const[e,i]=q.findProgramAddressSync([t.authority.toBuffer(),w().encode(t.recentSlot)],this.programId),r=Rt(Xi.CreateLookupTable,{recentSlot:BigInt(t.recentSlot),bumpSeed:i}),n=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t.authority,isSigner:!0,isWritable:!1},{pubkey:t.payer,isSigner:!0,isWritable:!0},{pubkey:Yt.programId,isSigner:!1,isWritable:!1}];return[new pt({programId:this.programId,keys:n,data:r}),e]}static freezeLookupTable(t){const e=Rt(Xi.FreezeLookupTable),i=[{pubkey:t.lookupTable,isSigner:!1,isWritable:!0},{pubkey:t.authority,isSigner:!0,isWritable:!1}];return new pt({programId:this.programId,keys:i,data:e})}static extendLookupTable(t){const e=Rt(Xi.ExtendLookupTable,{addresses:t.addresses.map(t=>t.toBytes())}),i=[{pubkey:t.lookupTable,isSigner:!1,isWritable:!0},{pubkey:t.authority,isSigner:!0,isWritable:!1}];return t.payer&&i.push({pubkey:t.payer,isSigner:!0,isWritable:!0},{pubkey:Yt.programId,isSigner:!1,isWritable:!1}),new pt({programId:this.programId,keys:i,data:e})}static deactivateLookupTable(t){const e=Rt(Xi.DeactivateLookupTable),i=[{pubkey:t.lookupTable,isSigner:!1,isWritable:!0},{pubkey:t.authority,isSigner:!0,isWritable:!1}];return new pt({programId:this.programId,keys:i,data:e})}static closeLookupTable(t){const e=Rt(Xi.CloseLookupTable),i=[{pubkey:t.lookupTable,isSigner:!1,isWritable:!0},{pubkey:t.authority,isSigner:!0,isWritable:!1},{pubkey:t.recipient,isSigner:!1,isWritable:!0}];return new pt({programId:this.programId,keys:i,data:e})}}tr.programId=new q("AddressLookupTab1e1111111111111111111111111");class er{constructor(){}static decodeInstructionType(t){this.checkProgramId(t.programId);const e=l.u8("instruction").decode(t.data);let i;for(const[t,r]of Object.entries(ir))if(r.index==e){i=t;break}if(!i)throw new Error("Instruction type incorrect; not a ComputeBudgetInstruction");return i}static decodeRequestUnits(t){this.checkProgramId(t.programId);const{units:e,additionalFee:i}=Ot(ir.RequestUnits,t.data);return{units:e,additionalFee:i}}static decodeRequestHeapFrame(t){this.checkProgramId(t.programId);const{bytes:e}=Ot(ir.RequestHeapFrame,t.data);return{bytes:e}}static decodeSetComputeUnitLimit(t){this.checkProgramId(t.programId);const{units:e}=Ot(ir.SetComputeUnitLimit,t.data);return{units:e}}static decodeSetComputeUnitPrice(t){this.checkProgramId(t.programId);const{microLamports:e}=Ot(ir.SetComputeUnitPrice,t.data);return{microLamports:e}}static checkProgramId(t){if(!t.equals(rr.programId))throw new Error("invalid instruction; programId is not ComputeBudgetProgram")}}const ir=Object.freeze({RequestUnits:{index:0,layout:l.w3([l.u8("instruction"),l.DH("units"),l.DH("additionalFee")])},RequestHeapFrame:{index:1,layout:l.w3([l.u8("instruction"),l.DH("bytes")])},SetComputeUnitLimit:{index:2,layout:l.w3([l.u8("instruction"),l.DH("units")])},SetComputeUnitPrice:{index:3,layout:l.w3([l.u8("instruction"),Lt("microLamports")])}});class rr{constructor(){}static requestUnits(t){const e=Rt(ir.RequestUnits,t);return new pt({keys:[],programId:this.programId,data:e})}static requestHeapFrame(t){const e=Rt(ir.RequestHeapFrame,t);return new pt({keys:[],programId:this.programId,data:e})}static setComputeUnitLimit(t){const e=Rt(ir.SetComputeUnitLimit,t);return new pt({keys:[],programId:this.programId,data:e})}static setComputeUnitPrice(t){const e=Rt(ir.SetComputeUnitPrice,{microLamports:BigInt(t.microLamports)});return new pt({keys:[],programId:this.programId,data:e})}}rr.programId=new q("ComputeBudget111111111111111111111111111111");const nr=l.w3([l.u8("numSignatures"),l.u8("padding"),l.NX("signatureOffset"),l.NX("signatureInstructionIndex"),l.NX("publicKeyOffset"),l.NX("publicKeyInstructionIndex"),l.NX("messageDataOffset"),l.NX("messageDataSize"),l.NX("messageInstructionIndex")]);class sr{constructor(){}static createInstructionWithPublicKey(t){const{publicKey:e,message:i,signature:n,instructionIndex:s}=t;rt(32===e.length,`Public Key must be 32 bytes but received ${e.length} bytes`),rt(64===n.length,`Signature must be 64 bytes but received ${n.length} bytes`);const o=nr.span,a=o+e.length,c=a+n.length,u=r.Buffer.alloc(c+i.length),h=null==s?65535:s;return nr.encode({numSignatures:1,padding:0,signatureOffset:a,signatureInstructionIndex:h,publicKeyOffset:o,publicKeyInstructionIndex:h,messageDataOffset:c,messageDataSize:i.length,messageInstructionIndex:h},u),u.fill(e,o),u.fill(n,a),u.fill(i,c),new pt({keys:[],programId:sr.programId,data:u})}static createInstructionWithPrivateKey(t){const{privateKey:e,message:i,instructionIndex:r}=t;rt(64===e.length,`Private key must be 64 bytes but received ${e.length} bytes`);try{const t=Zi.fromSecretKey(e),n=t.publicKey.toBytes(),s=R(i,t.secretKey);return this.createInstructionWithPublicKey({publicKey:n,message:i,signature:s,instructionIndex:r})}catch(t){throw new Error(`Error creating instruction; ${t}`)}}}sr.programId=new q("Ed25519SigVerify111111111111111111111111111"),E.bI.utils.isValidPrivateKey;const or=E.bI.getPublicKey,ar=l.w3([l.u8("numSignatures"),l.NX("signatureOffset"),l.u8("signatureInstructionIndex"),l.NX("ethAddressOffset"),l.u8("ethAddressInstructionIndex"),l.NX("messageDataOffset"),l.NX("messageDataSize"),l.u8("messageInstructionIndex"),l.av(20,"ethAddress"),l.av(64,"signature"),l.u8("recoveryId")]);class cr{constructor(){}static publicKeyToEthAddress(t){rt(64===t.length,`Public key must be 64 bytes but received ${t.length} bytes`);try{return r.Buffer.from((0,_.lY)(x(t))).slice(-20)}catch(t){throw new Error(`Error constructing Ethereum address: ${t}`)}}static createInstructionWithPublicKey(t){const{publicKey:e,message:i,signature:r,recoveryId:n,instructionIndex:s}=t;return cr.createInstructionWithEthAddress({ethAddress:cr.publicKeyToEthAddress(e),message:i,signature:r,recoveryId:n,instructionIndex:s})}static createInstructionWithEthAddress(t){const{ethAddress:e,message:i,signature:n,recoveryId:s,instructionIndex:o=0}=t;let a;a="string"==typeof e?e.startsWith("0x")?r.Buffer.from(e.substr(2),"hex"):r.Buffer.from(e,"hex"):e,rt(20===a.length,`Address must be 20 bytes but received ${a.length} bytes`);const c=12+a.length,u=c+n.length+1,h=r.Buffer.alloc(ar.span+i.length);return ar.encode({numSignatures:1,signatureOffset:c,signatureInstructionIndex:o,ethAddressOffset:12,ethAddressInstructionIndex:o,messageDataOffset:u,messageDataSize:i.length,messageInstructionIndex:o,signature:x(n),ethAddress:x(a),recoveryId:s},h),h.fill(x(i),ar.span),new pt({keys:[],programId:cr.programId,data:h})}static createInstructionWithPrivateKey(t){const{privateKey:e,message:i,instructionIndex:n}=t;rt(32===e.length,`Private key must be 32 bytes but received ${e.length} bytes`);try{const t=x(e),s=or(t,!1).slice(1),o=r.Buffer.from((0,_.lY)(x(i))),[a,c]=((t,e)=>{const i=E.bI.sign(t,e);return[i.toCompactRawBytes(),i.recovery]})(o,t);return this.createInstructionWithPublicKey({publicKey:s,message:i,signature:a,recoveryId:c,instructionIndex:n})}catch(t){throw new Error(`Error creating instruction; ${t}`)}}}var ur;cr.programId=new q("KeccakSecp256k11111111111111111111111111111");const hr=new q("StakeConfig11111111111111111111111111111111");class lr{constructor(t,e){this.staker=void 0,this.withdrawer=void 0,this.staker=t,this.withdrawer=e}}class dr{constructor(t,e,i){this.unixTimestamp=void 0,this.epoch=void 0,this.custodian=void 0,this.unixTimestamp=t,this.epoch=e,this.custodian=i}}ur=dr,dr.default=new ur(0,0,q.default);class pr{constructor(){}static decodeInstructionType(t){this.checkProgramId(t.programId);const e=l.DH("instruction").decode(t.data);let i;for(const[t,r]of Object.entries(fr))if(r.index==e){i=t;break}if(!i)throw new Error("Instruction type incorrect; not a StakeInstruction");return i}static decodeInitialize(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,2);const{authorized:e,lockup:i}=Ot(fr.Initialize,t.data);return{stakePubkey:t.keys[0].pubkey,authorized:new lr(new q(e.staker),new q(e.withdrawer)),lockup:new dr(i.unixTimestamp,i.epoch,new q(i.custodian))}}static decodeDelegate(t){return this.checkProgramId(t.programId),this.checkKeyLength(t.keys,6),Ot(fr.Delegate,t.data),{stakePubkey:t.keys[0].pubkey,votePubkey:t.keys[1].pubkey,authorizedPubkey:t.keys[5].pubkey}}static decodeAuthorize(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3);const{newAuthorized:e,stakeAuthorizationType:i}=Ot(fr.Authorize,t.data),r={stakePubkey:t.keys[0].pubkey,authorizedPubkey:t.keys[2].pubkey,newAuthorizedPubkey:new q(e),stakeAuthorizationType:{index:i}};return t.keys.length>3&&(r.custodianPubkey=t.keys[3].pubkey),r}static decodeAuthorizeWithSeed(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,2);const{newAuthorized:e,stakeAuthorizationType:i,authoritySeed:r,authorityOwner:n}=Ot(fr.AuthorizeWithSeed,t.data),s={stakePubkey:t.keys[0].pubkey,authorityBase:t.keys[1].pubkey,authoritySeed:r,authorityOwner:new q(n),newAuthorizedPubkey:new q(e),stakeAuthorizationType:{index:i}};return t.keys.length>3&&(s.custodianPubkey=t.keys[3].pubkey),s}static decodeSplit(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3);const{lamports:e}=Ot(fr.Split,t.data);return{stakePubkey:t.keys[0].pubkey,splitStakePubkey:t.keys[1].pubkey,authorizedPubkey:t.keys[2].pubkey,lamports:e}}static decodeMerge(t){return this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3),Ot(fr.Merge,t.data),{stakePubkey:t.keys[0].pubkey,sourceStakePubKey:t.keys[1].pubkey,authorizedPubkey:t.keys[4].pubkey}}static decodeWithdraw(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,5);const{lamports:e}=Ot(fr.Withdraw,t.data),i={stakePubkey:t.keys[0].pubkey,toPubkey:t.keys[1].pubkey,authorizedPubkey:t.keys[4].pubkey,lamports:e};return t.keys.length>5&&(i.custodianPubkey=t.keys[5].pubkey),i}static decodeDeactivate(t){return this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3),Ot(fr.Deactivate,t.data),{stakePubkey:t.keys[0].pubkey,authorizedPubkey:t.keys[2].pubkey}}static checkProgramId(t){if(!t.equals(mr.programId))throw new Error("invalid instruction; programId is not StakeProgram")}static checkKeyLength(t,e){if(t.length<e)throw new Error(`invalid instruction; found ${t.length} keys, expected at least ${e}`)}}const fr=Object.freeze({Initialize:{index:0,layout:l.w3([l.DH("instruction"),((t="authorized")=>l.w3([Z("staker"),Z("withdrawer")],t))(),((t="lockup")=>l.w3([l.Wg("unixTimestamp"),l.Wg("epoch"),Z("custodian")],t))()])},Authorize:{index:1,layout:l.w3([l.DH("instruction"),Z("newAuthorized"),l.DH("stakeAuthorizationType")])},Delegate:{index:2,layout:l.w3([l.DH("instruction")])},Split:{index:3,layout:l.w3([l.DH("instruction"),l.Wg("lamports")])},Withdraw:{index:4,layout:l.w3([l.DH("instruction"),l.Wg("lamports")])},Deactivate:{index:5,layout:l.w3([l.DH("instruction")])},Merge:{index:7,layout:l.w3([l.DH("instruction")])},AuthorizeWithSeed:{index:8,layout:l.w3([l.DH("instruction"),Z("newAuthorized"),l.DH("stakeAuthorizationType"),Q("authoritySeed"),Z("authorityOwner")])}}),gr=Object.freeze({Staker:{index:0},Withdrawer:{index:1}});class mr{constructor(){}static initialize(t){const{stakePubkey:e,authorized:i,lockup:r}=t,n=r||dr.default,s=Rt(fr.Initialize,{authorized:{staker:x(i.staker.toBuffer()),withdrawer:x(i.withdrawer.toBuffer())},lockup:{unixTimestamp:n.unixTimestamp,epoch:n.epoch,custodian:x(n.custodian.toBuffer())}}),o={keys:[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:kt,isSigner:!1,isWritable:!1}],programId:this.programId,data:s};return new pt(o)}static createAccountWithSeed(t){const e=new ft;e.add(Yt.createAccountWithSeed({fromPubkey:t.fromPubkey,newAccountPubkey:t.stakePubkey,basePubkey:t.basePubkey,seed:t.seed,lamports:t.lamports,space:this.space,programId:this.programId}));const{stakePubkey:i,authorized:r,lockup:n}=t;return e.add(this.initialize({stakePubkey:i,authorized:r,lockup:n}))}static createAccount(t){const e=new ft;e.add(Yt.createAccount({fromPubkey:t.fromPubkey,newAccountPubkey:t.stakePubkey,lamports:t.lamports,space:this.space,programId:this.programId}));const{stakePubkey:i,authorized:r,lockup:n}=t;return e.add(this.initialize({stakePubkey:i,authorized:r,lockup:n}))}static delegate(t){const{stakePubkey:e,authorizedPubkey:i,votePubkey:r}=t,n=Rt(fr.Delegate);return(new ft).add({keys:[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:hr,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1}],programId:this.programId,data:n})}static authorize(t){const{stakePubkey:e,authorizedPubkey:i,newAuthorizedPubkey:r,stakeAuthorizationType:n,custodianPubkey:s}=t,o=Rt(fr.Authorize,{newAuthorized:x(r.toBuffer()),stakeAuthorizationType:n.index}),a=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1}];return s&&a.push({pubkey:s,isSigner:!0,isWritable:!1}),(new ft).add({keys:a,programId:this.programId,data:o})}static authorizeWithSeed(t){const{stakePubkey:e,authorityBase:i,authoritySeed:r,authorityOwner:n,newAuthorizedPubkey:s,stakeAuthorizationType:o,custodianPubkey:a}=t,c=Rt(fr.AuthorizeWithSeed,{newAuthorized:x(s.toBuffer()),stakeAuthorizationType:o.index,authoritySeed:r,authorityOwner:x(n.toBuffer())}),u=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1}];return a&&u.push({pubkey:a,isSigner:!0,isWritable:!1}),(new ft).add({keys:u,programId:this.programId,data:c})}static splitInstruction(t){const{stakePubkey:e,authorizedPubkey:i,splitStakePubkey:r,lamports:n}=t,s=Rt(fr.Split,{lamports:n});return new pt({keys:[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1}],programId:this.programId,data:s})}static split(t,e){const i=new ft;return i.add(Yt.createAccount({fromPubkey:t.authorizedPubkey,newAccountPubkey:t.splitStakePubkey,lamports:e,space:this.space,programId:this.programId})),i.add(this.splitInstruction(t))}static splitWithSeed(t,e){const{stakePubkey:i,authorizedPubkey:r,splitStakePubkey:n,basePubkey:s,seed:o,lamports:a}=t,c=new ft;return c.add(Yt.allocate({accountPubkey:n,basePubkey:s,seed:o,space:this.space,programId:this.programId})),e&&e>0&&c.add(Yt.transfer({fromPubkey:t.authorizedPubkey,toPubkey:n,lamports:e})),c.add(this.splitInstruction({stakePubkey:i,authorizedPubkey:r,splitStakePubkey:n,lamports:a}))}static merge(t){const{stakePubkey:e,sourceStakePubKey:i,authorizedPubkey:r}=t,n=Rt(fr.Merge);return(new ft).add({keys:[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1}],programId:this.programId,data:n})}static withdraw(t){const{stakePubkey:e,authorizedPubkey:i,toPubkey:r,lamports:n,custodianPubkey:s}=t,o=Rt(fr.Withdraw,{lamports:n}),a=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1}];return s&&a.push({pubkey:s,isSigner:!0,isWritable:!1}),(new ft).add({keys:a,programId:this.programId,data:o})}static deactivate(t){const{stakePubkey:e,authorizedPubkey:i}=t,r=Rt(fr.Deactivate);return(new ft).add({keys:[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1}],programId:this.programId,data:r})}}mr.programId=new q("Stake11111111111111111111111111111111111111"),mr.space=200;class yr{constructor(t,e,i,r){this.nodePubkey=void 0,this.authorizedVoter=void 0,this.authorizedWithdrawer=void 0,this.commission=void 0,this.nodePubkey=t,this.authorizedVoter=e,this.authorizedWithdrawer=i,this.commission=r}}class br{constructor(){}static decodeInstructionType(t){this.checkProgramId(t.programId);const e=l.DH("instruction").decode(t.data);let i;for(const[t,r]of Object.entries(wr))if(r.index==e){i=t;break}if(!i)throw new Error("Instruction type incorrect; not a VoteInstruction");return i}static decodeInitializeAccount(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,4);const{voteInit:e}=Ot(wr.InitializeAccount,t.data);return{votePubkey:t.keys[0].pubkey,nodePubkey:t.keys[3].pubkey,voteInit:new yr(new q(e.nodePubkey),new q(e.authorizedVoter),new q(e.authorizedWithdrawer),e.commission)}}static decodeAuthorize(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3);const{newAuthorized:e,voteAuthorizationType:i}=Ot(wr.Authorize,t.data);return{votePubkey:t.keys[0].pubkey,authorizedPubkey:t.keys[2].pubkey,newAuthorizedPubkey:new q(e),voteAuthorizationType:{index:i}}}static decodeAuthorizeWithSeed(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3);const{voteAuthorizeWithSeedArgs:{currentAuthorityDerivedKeyOwnerPubkey:e,currentAuthorityDerivedKeySeed:i,newAuthorized:r,voteAuthorizationType:n}}=Ot(wr.AuthorizeWithSeed,t.data);return{currentAuthorityDerivedKeyBasePubkey:t.keys[2].pubkey,currentAuthorityDerivedKeyOwnerPubkey:new q(e),currentAuthorityDerivedKeySeed:i,newAuthorizedPubkey:new q(r),voteAuthorizationType:{index:n},votePubkey:t.keys[0].pubkey}}static decodeWithdraw(t){this.checkProgramId(t.programId),this.checkKeyLength(t.keys,3);const{lamports:e}=Ot(wr.Withdraw,t.data);return{votePubkey:t.keys[0].pubkey,authorizedWithdrawerPubkey:t.keys[2].pubkey,lamports:e,toPubkey:t.keys[1].pubkey}}static checkProgramId(t){if(!t.equals(kr.programId))throw new Error("invalid instruction; programId is not VoteProgram")}static checkKeyLength(t,e){if(t.length<e)throw new Error(`invalid instruction; found ${t.length} keys, expected at least ${e}`)}}const wr=Object.freeze({InitializeAccount:{index:0,layout:l.w3([l.DH("instruction"),((t="voteInit")=>l.w3([Z("nodePubkey"),Z("authorizedVoter"),Z("authorizedWithdrawer"),l.u8("commission")],t))()])},Authorize:{index:1,layout:l.w3([l.DH("instruction"),Z("newAuthorized"),l.DH("voteAuthorizationType")])},Withdraw:{index:3,layout:l.w3([l.DH("instruction"),l.Wg("lamports")])},UpdateValidatorIdentity:{index:4,layout:l.w3([l.DH("instruction")])},AuthorizeWithSeed:{index:10,layout:l.w3([l.DH("instruction"),((t="voteAuthorizeWithSeedArgs")=>l.w3([l.DH("voteAuthorizationType"),Z("currentAuthorityDerivedKeyOwnerPubkey"),Q("currentAuthorityDerivedKeySeed"),Z("newAuthorized")],t))()])}}),vr=Object.freeze({Voter:{index:0},Withdrawer:{index:1}});class kr{constructor(){}static initializeAccount(t){const{votePubkey:e,nodePubkey:i,voteInit:r}=t,n=Rt(wr.InitializeAccount,{voteInit:{nodePubkey:x(r.nodePubkey.toBuffer()),authorizedVoter:x(r.authorizedVoter.toBuffer()),authorizedWithdrawer:x(r.authorizedWithdrawer.toBuffer()),commission:r.commission}}),s={keys:[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1}],programId:this.programId,data:n};return new pt(s)}static createAccount(t){const e=new ft;return e.add(Yt.createAccount({fromPubkey:t.fromPubkey,newAccountPubkey:t.votePubkey,lamports:t.lamports,space:this.space,programId:this.programId})),e.add(this.initializeAccount({votePubkey:t.votePubkey,nodePubkey:t.voteInit.nodePubkey,voteInit:t.voteInit}))}static authorize(t){const{votePubkey:e,authorizedPubkey:i,newAuthorizedPubkey:r,voteAuthorizationType:n}=t,s=Rt(wr.Authorize,{newAuthorized:x(r.toBuffer()),voteAuthorizationType:n.index}),o=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1}];return(new ft).add({keys:o,programId:this.programId,data:s})}static authorizeWithSeed(t){const{currentAuthorityDerivedKeyBasePubkey:e,currentAuthorityDerivedKeyOwnerPubkey:i,currentAuthorityDerivedKeySeed:r,newAuthorizedPubkey:n,voteAuthorizationType:s,votePubkey:o}=t,a=Rt(wr.AuthorizeWithSeed,{voteAuthorizeWithSeedArgs:{currentAuthorityDerivedKeyOwnerPubkey:x(i.toBuffer()),currentAuthorityDerivedKeySeed:r,newAuthorized:x(n.toBuffer()),voteAuthorizationType:s.index}}),c=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!1}];return(new ft).add({keys:c,programId:this.programId,data:a})}static withdraw(t){const{votePubkey:e,authorizedWithdrawerPubkey:i,lamports:r,toPubkey:n}=t,s=Rt(wr.Withdraw,{lamports:r}),o=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1}];return(new ft).add({keys:o,programId:this.programId,data:s})}static safeWithdraw(t,e,i){if(t.lamports>e-i)throw new Error("Withdraw will leave vote account with insufficient funds.");return kr.withdraw(t)}static updateValidatorIdentity(t){const{votePubkey:e,authorizedWithdrawerPubkey:i,nodePubkey:r}=t,n=Rt(wr.UpdateValidatorIdentity),s=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1}];return(new ft).add({keys:s,programId:this.programId,data:n})}}kr.programId=new q("Vote111111111111111111111111111111111111111"),kr.space=3762;const Sr=new q("Va1idator1nfo111111111111111111111111111111"),Ir=(0,k.NW)({name:(0,k.Yj)(),website:(0,k.lq)((0,k.Yj)()),details:(0,k.lq)((0,k.Yj)()),iconUrl:(0,k.lq)((0,k.Yj)()),keybaseUsername:(0,k.lq)((0,k.Yj)())});class Ar{constructor(t,e){this.key=void 0,this.info=void 0,this.key=t,this.info=e}static fromConfigData(t){let e=[...t];if(2!==et(e))return null;const i=[];for(let t=0;t<2;t++){const t=new q(at(e,0,K)),r=1===ot(e);i.push({publicKey:t,isSigner:r})}if(i[0].publicKey.equals(Sr)&&i[1].isSigner){const t=Q().decode(r.Buffer.from(e)),n=JSON.parse(t);return(0,k.vA)(n,Ir),new Ar(i[1].publicKey,n)}return null}}const _r=new q("Vote111111111111111111111111111111111111111"),Er=l.w3([Z("nodePubkey"),Z("authorizedWithdrawer"),l.u8("commission"),l.I0(),l.O6(l.w3([l.I0("slot"),l.DH("confirmationCount")]),l.cY(l.DH(),-8),"votes"),l.u8("rootSlotValid"),l.I0("rootSlot"),l.I0(),l.O6(l.w3([l.I0("epoch"),Z("authorizedVoter")]),l.cY(l.DH(),-8),"authorizedVoters"),l.w3([l.O6(l.w3([Z("authorizedPubkey"),l.I0("epochOfLastAuthorizedSwitch"),l.I0("targetEpoch")]),32,"buf"),l.I0("idx"),l.u8("isEmpty")],"priorVoters"),l.I0(),l.O6(l.w3([l.I0("epoch"),l.I0("credits"),l.I0("prevCredits")]),l.cY(l.DH(),-8),"epochCredits"),l.w3([l.I0("slot"),l.I0("timestamp")],"lastTimestamp")]);class Pr{constructor(t){this.nodePubkey=void 0,this.authorizedWithdrawer=void 0,this.commission=void 0,this.rootSlot=void 0,this.votes=void 0,this.authorizedVoters=void 0,this.priorVoters=void 0,this.epochCredits=void 0,this.lastTimestamp=void 0,this.nodePubkey=t.nodePubkey,this.authorizedWithdrawer=t.authorizedWithdrawer,this.commission=t.commission,this.rootSlot=t.rootSlot,this.votes=t.votes,this.authorizedVoters=t.authorizedVoters,this.priorVoters=t.priorVoters,this.epochCredits=t.epochCredits,this.lastTimestamp=t.lastTimestamp}static fromAccountData(t){const e=Er.decode(x(t),4);let i=e.rootSlot;return e.rootSlotValid||(i=null),new Pr({nodePubkey:new q(e.nodePubkey),authorizedWithdrawer:new q(e.authorizedWithdrawer),commission:e.commission,votes:e.votes,rootSlot:i,authorizedVoters:e.authorizedVoters.map(Mr),priorVoters:Br(e.priorVoters),epochCredits:e.epochCredits,lastTimestamp:e.lastTimestamp})}}function Mr({authorizedVoter:t,epoch:e}){return{epoch:e,authorizedVoter:new q(t)}}function Tr({authorizedPubkey:t,epochOfLastAuthorizedSwitch:e,targetEpoch:i}){return{authorizedPubkey:new q(t),epochOfLastAuthorizedSwitch:e,targetEpoch:i}}function Br({buf:t,idx:e,isEmpty:i}){return i?[]:[...t.slice(e+1).map(Tr),...t.slice(0,e).map(Tr)]}const Rr={http:{devnet:"http://api.devnet.solana.com",testnet:"http://api.testnet.solana.com","mainnet-beta":"http://api.mainnet-beta.solana.com/"},https:{devnet:"https://api.devnet.solana.com",testnet:"https://api.testnet.solana.com","mainnet-beta":"https://api.mainnet-beta.solana.com/"}};function Or(t,e){const i=!1===e?"http":"https";if(!t)return Rr[i].devnet;const r=Rr[i][t];if(!r)throw new Error(`Unknown ${i} cluster: ${t}`);return r}async function xr(t,e,i,r){let n,s;i&&Object.prototype.hasOwnProperty.call(i,"lastValidBlockHeight")||i&&Object.prototype.hasOwnProperty.call(i,"nonceValue")?(n=i,s=r):s=i;const o=s&&{skipPreflight:s.skipPreflight,preflightCommitment:s.preflightCommitment||s.commitment,minContextSlot:s.minContextSlot},a=await t.sendRawTransaction(e,o),c=s&&s.commitment,u=n?t.confirmTransaction(n,c):t.confirmTransaction(a,c),h=(await u).value;if(h.err){if(null!=a)throw new Et({action:o?.skipPreflight?"send":"simulate",signature:a,transactionMessage:`Status: (${JSON.stringify(h)})`});throw new Error(`Raw transaction ${a} failed (${JSON.stringify(h)})`)}return a}const Nr=1e9},72661:function(t,e,i){t.exports=function(){"use strict";function t(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}c((r=r.apply(t,e||[])).next())})}function e(t,e,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:e.get(t)}function r(t,e){if(!t)throw new Error(e)}const n={56:"https://bsc-dataseed1.binance.org",97:"https://data-seed-prebsc-1-s1.binance.org:8545",137:"https://rpc-mainnet.maticvigil.com/",80001:"https://rpc-mumbai.matic.today/",43114:"https://api.avax.network/ext/bc/C/rpc",43113:"https://api.avax-test.network/ext/bc/C/rpc",42161:"https://arb1.arbitrum.io/rpc",421613:"https://endpoints.omniatech.io/v1/arbitrum/goerli/public",10:"https://mainnet.optimism.io",420:"https://goerli.optimism.io"},s={1:"ethereum",5:"ethereum",56:"bsc",97:"bsc",137:"polygon",80001:"polygon",43114:"avalanche",43113:"avalanche",42161:"arbitrum",421613:"arbitrum",10:"optimism",420:"optimism"},o={1:"mainnet",5:"testnet",56:"mainnet",97:"testnet",137:"mainnet",80001:"testnet",43114:"mainnet",43113:"testnet",42161:"mainnet",421613:"testnet",10:"mainnet",420:"testnet"},a={1:"https://wallet-v2.blocto.app",5:"https://wallet-v2-dev.blocto.app",56:"https://wallet-v2.blocto.app",97:"https://wallet-v2-dev.blocto.app",137:"https://wallet-v2.blocto.app",80001:"https://wallet-v2-dev.blocto.app",43114:"https://wallet-v2.blocto.app",43113:"https://wallet-v2-dev.blocto.app",42161:"https://wallet-v2.blocto.app",421613:"https://wallet-v2-dev.blocto.app",10:"https://wallet-v2.blocto.app",420:"https://wallet-v2-dev.blocto.app"},c={prod:"https://wallet-v2.blocto.app",staging:"https://wallet-v2-staging.blocto.app",dev:"https://wallet-v2-dev.blocto.app"},u={devnet:"https://wallet-v2-dev.blocto.app",testnet:"https://wallet-v2-dev.blocto.app","mainnet-beta":"https://wallet-v2.blocto.app"},h=["devnet","testnet","mainnet-beta"],l={1:"https://wallet-v2.blocto.app",2:"https://wallet-v2-dev.blocto.app",3:"https://wallet-v2-dev.blocto.app",4:"https://wallet-v2-dev.blocto.app",5:"https://wallet-v2-staging.blocto.app"};var d;!function(t){t.Mainnet="mainnet",t.Testnet="testnet",t.Devnet="devnet",t.Testing="testing",t.Premainnet="premainnet"}(d||(d={}));const p={1:d.Mainnet,2:d.Testnet,3:d.Devnet,4:d.Testing,5:d.Premainnet},f={1:"https://fullnode.mainnet.aptoslabs.com/v1",2:"https://fullnode.testnet.aptoslabs.com/v1",3:"https://fullnode.devnet.aptoslabs.com/v1",4:"",5:"https://premainnet.aptosdev.com/v1"},g=["connect","disconnect","message","chainChanged","accountsChanged"],m=864e5,y="00000000-0000-0000-0000-000000000000",b="sdk.session",w="undefined"!=typeof window?window.memoryStorage:new class{constructor(){this.storage={}}getItem(t){return this[t]||null}setItem(t,e){this.storage[t]=e}removeItem(t){delete this.storage[t]}};"undefined"!=typeof window&&(window.memoryStorage=w);const v=(()=>{if("undefined"==typeof window)return!1;try{window.localStorage.setItem("local_storage_supported","1");const t=window.localStorage.getItem("local_storage_supported");return window.localStorage.removeItem("local_storage_supported"),"1"===t}catch(t){return!1}})()?window.localStorage:w,k=(t,e)=>v.setItem(t,"string"==typeof e?e:JSON.stringify(e)),S=(t,e,i)=>k(t,{value:e,expiry:(new Date).getTime()+i}),I=t=>{k(t,""),v.removeItem(t)};class A{constructor(t){this.isBlocto=!0,this.isConnecting=!1,this.eventListeners={},this.sessionKey=b,this.off=this.removeListener,this.session=t,g.forEach(t=>{this.eventListeners[t]=[]})}formatAndSetSessionAccount(t={}){this.session.accounts=Object.keys(t).reduce((e,i)=>(e[i]=[t[i]],e),{})}tryRetrieveSessionFromStorage(t){const e=((t,e=null)=>{const i=((t,e=null)=>{const i=v.getItem(t);try{return i&&JSON.parse(i)||e}catch(t){return i||e}})(t,null);return i?(new Date).getTime()>i.expiry?(I(t),e):i.value:e})(this.sessionKey,{}),i=e&&e.code,r=e&&e.address&&e.address[t];this.session.connected=Boolean(i&&r),this.session.code=i||null,this.formatAndSetSessionAccount(e?e.address:{})}request(e){return t(this,void 0,void 0,function*(){})}on(t,e){g.includes(t)&&this.eventListeners[t].push(e)}once(){}removeListener(t,e){const i=this.eventListeners[t].findIndex(t=>t===e);-1!==i&&this.eventListeners[t].splice(i,1)}}function _(t){const e=document.createElement("iframe");return e.setAttribute("src",t),e.setAttribute("style","width:100vw;height:100%;position:fixed;top:0;left:0;z-index:2147483646;border:none;box-sizing:border-box;color-scheme:light;inset:0px;display:block;"),e}function E(t){document.body.appendChild(t)}function P(t){const e=t&&t.parentNode;e&&e.removeChild instanceof Function&&e.removeChild(t)}var M=(t,e,i=window)=>{i.addEventListener(t,function r(n){e(n,()=>i.removeEventListener(t,r))})};function T(e,i){return t(this,void 0,void 0,function*(){if(403===e.status)throw i.session.code=null,I(i.sessionKey),new Error("[Blocto SDK]: Session expired!");return e.json()})}const B=t=>/\S+@\S+\.\S+/.test(t);function R(){return t(this,void 0,void 0,function*(){const{networks:t}=yield fetch("https://api.blocto.app/networks/evm").then(t=>t.json());return t.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.chain_id]:e}),{})})}var O,x,N;function C(t){return t?"number"==typeof t?t:t.startsWith("0x")?parseInt(t,16):parseInt(t,10):1}class W extends A{constructor({chainId:t,rpc:e,server:i,appId:c,session:u}){super(u),O.add(this),this.supportNetwork={},this.switchableNetwork={},r(t,"'chainId' is required"),this.chainId=C(t),this.networkId=this.chainId,this.chain=s[this.chainId],this.net=o[this.chainId],r(this.chain,`unsupported 'chainId': ${this.chainId}`),this.rpc=e||n[this.chainId]||"",r(this.rpc,"'rpc' is required for Ethereum"),this.server=i||a[this.chainId]||"",this.appId=c||y,this.switchableNetwork[this.chainId]={name:this.chain,display_name:this.chain,network_type:this.net,wallet_web_url:this.server,rpc_url:this.rpc}}loadSwitchableNetwork(i){return t(this,void 0,void 0,function*(){return R().then(t=>(this.supportNetwork=t,(null==i?void 0:i.length)&&i.forEach(({chainId:t,rpcUrls:i})=>{if(r(i,"rpcUrls is required for networksList"),!(null==i?void 0:i.length))throw new Error("Empty rpcUrls array");e(this,O,"m",x).call(this,{chainId:C(t),rpcUrls:i})}),null))})}send(e,i){return t(this,void 0,void 0,function*(){switch(!0){case i instanceof Function:return this.sendAsync(e,i);case"string"==typeof e&&Array.isArray(i):return this.sendAsync({jsonrpc:"2.0",method:e,params:i});default:return this.sendAsync(e)}})}sendAsync(e,i){return t(this,void 0,void 0,function*(){const t=new Promise(t=>{if(Array.isArray(e)){const i=e.filter(t=>"eth_sendTransaction"===t.method).map(t=>{var e;return null===(e=t.params)||void 0===e?void 0:e[0]}),r=Math.floor(1e4*Math.random()),n={method:"blocto_sendBatchTransaction",params:i},s=this.request(n),o=e.map(({method:t,params:e},i)=>"eth_sendTransaction"===t?s:this.request({id:r+i+1,jsonrpc:"2.0",method:t,params:e}));Promise.allSettled(o).then(i=>t(i.map((t,i)=>({id:String(r+i+1),jsonrpc:"2.0",method:e[i].method,result:"fulfilled"===t.status?t.value:void 0,error:"fulfilled"!==t.status?t.reason:void 0}))))}else this.request(Object.assign(Object.assign({},e),{id:Number(e.id)})).then(t)});if(!i)return t;t.then(t=>i(null,t)).catch(t=>i(t))})}request(i){var n,s,o,a,c,u,h;return t(this,void 0,void 0,function*(){const t=window.ethereum;if(t&&t.isBlocto)return t.request(i);if(!this.session.connected){const t=null===(n=null==i?void 0:i.params)||void 0===n?void 0:n[0];"eth_requestAccounts"===i.method&&B(t)?yield this.enable(t):yield this.enable()}try{let t=null,n=null;switch(i.method){case"eth_requestAccounts":yield this.fetchAccounts();case"eth_accounts":n=this.session.accounts[this.chain];break;case"eth_coinbase":n=this.session.accounts[this.chain][0];break;case"eth_chainId":n=this.chainId,n=`0x${n.toString(16)}`;break;case"net_version":n=this.networkId||this.chainId,n=`0x${n.toString(16)}`;break;case"eth_signTypedData_v3":case"eth_signTypedData":case"eth_signTypedData_v4":case"personal_sign":case"eth_sign":n=yield this.handleSign(i);break;case"wallet_disconnect":this.handleDisconnect(),n=null;break;case"blocto_sendBatchTransaction":case"eth_sendTransaction":n=yield this.handleSendTransaction(i);break;case"eth_signTransaction":case"eth_sendRawTransaction":n=null;break;case"wallet_addEthereumChain":if(!(null===(o=null===(s=null==i?void 0:i.params)||void 0===s?void 0:s[0])||void 0===o?void 0:o.chainId)||!(null===(c=null===(a=null==i?void 0:i.params)||void 0===a?void 0:a[0])||void 0===c?void 0:c.rpcUrls.length))throw new Error("Invalid params");yield R().then(t=>{var r,n,s;this.supportNetwork=t,e(this,O,"m",x).call(this,{chainId:C(null===(n=null===(r=null==i?void 0:i.params)||void 0===r?void 0:r[0])||void 0===n?void 0:n.chainId),rpcUrls:null===(s=null==i?void 0:i.params)||void 0===s?void 0:s[0].rpcUrls})}),n=null;break;case"wallet_switchEthereumChain":if(!(null===(h=null===(u=null==i?void 0:i.params)||void 0===u?void 0:u[0])||void 0===h?void 0:h.chainId))throw new Error("Invalid params");if(!this.switchableNetwork[C(i.params[0].chainId)]){const t=new Error("This chain has not been added to SDK. Please try wallet_addEthereumChain first.");throw t.code=4902,t}this.chainId=C(i.params[0].chainId),this.networkId=this.chainId,this.chain=this.switchableNetwork[this.chainId].name,this.net=this.switchableNetwork[this.chainId].network_type,r(this.chain,`unsupported 'chainId': ${this.chainId}`),this.rpc=this.switchableNetwork[this.chainId].rpc_url,r(this.rpc,"'rpc' is required"),this.server=this.switchableNetwork[this.chainId].wallet_web_url,yield this.fetchAccounts(),this.eventListeners.chainChanged.forEach(t=>t(this.chainId)),n=null;break;default:t=yield this.handleReadRequests(i)}if(t&&!t.result&&t.error){const e=t.error.message?t.error.message:"Request failed";throw new Error(e)}return t?t.result:n}catch(t){throw console.error(t),t}})}enable(e){return t(this,void 0,void 0,function*(){const t=window.ethereum;if(t&&t.isBlocto){if(parseInt(t.chainId,16)!==this.chainId)try{yield t.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${this.chainId.toString(16)}`}]}),this.session.accounts[this.chain]=[t.address]}catch(t){console.error(t)}return new Promise((e,i)=>setTimeout(()=>t.enable().then(e).catch(i),10))}return this.tryRetrieveSessionFromStorage(this.chain),new Promise((t,i)=>{if("undefined"==typeof window)return i("Currently only supported in browser");if(this.session.connected)return t(this.session.accounts[this.chain]);const r=new URLSearchParams;r.set("l6n",window.location.origin);const n=e&&B(e)?`/${e}`:"",s=_(`${this.server}/${this.appId}/${this.chain}/authn${n}?${r.toString()}`);E(s),M("message",(e,r)=>{const n=e;if(n.origin===this.server){if("ETH:FRAME:RESPONSE"===n.data.type){r(),P(s),this.session.code=n.data.code,this.session.connected=!0,this.eventListeners.connect.forEach(t=>t(this.chainId));const e=n.data.address;this.formatAndSetSessionAccount(e),S(this.sessionKey,{code:this.session.code,address:e},m),t(this.session.accounts[this.chain])}"ETH:FRAME:CLOSE"===n.data.type&&(r(),P(s),i(new Error("User declined the login request")))}})})})}fetchAccounts(){return t(this,void 0,void 0,function*(){e(this,O,"m",N).call(this);const{accounts:t}=yield fetch(`${this.server}/api/${this.chain}/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code}}).then(t=>T(t,this));return this.session.accounts[this.chain]=t,t})}handleReadRequests(i){return t(this,void 0,void 0,function*(){return e(this,O,"m",N).call(this),fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},i))}).then(t=>t.json())})}handleSign({method:i,params:r}){return t(this,void 0,void 0,function*(){let t="";if(Array.isArray(r))if("eth_sign"===i)t=r[1].slice(2);else if("personal_sign"===i)t=r[0].slice(2);else if(["eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4"].includes(i)){t=r[1];const{domain:e}=JSON.parse(t);if(C(e.chainId)!==C(this.chainId))throw new Error(`Provided chainId "${e.chainId}" must match the active chainId "${this.chainId}"`)}e(this,O,"m",N).call(this);const{signatureId:n}=yield fetch(`${this.server}/api/${this.chain}/user-signature`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify({method:i,message:t})}).then(t=>T(t,this));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const s=_(`${this.server}/${this.appId}/${this.chain}/user-signature/${n}`);return E(s),new Promise((t,e)=>M("message",(i,r)=>{const n=i;n.origin===this.server&&"ETH:FRAME:RESPONSE"===n.data.type&&("APPROVED"===n.data.status&&(r(),P(s),t(n.data.signature)),"DECLINED"===n.data.status&&(r(),P(s),e(new Error(n.data.errorMessage))))}))})}handleSendTransaction(i){return t(this,void 0,void 0,function*(){e(this,O,"m",N).call(this);const{authorizationId:t}=yield fetch(`${this.server}/api/${this.chain}/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(i.params)}).then(t=>T(t,this));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const r=_(`${this.server}/${this.appId}/${this.chain}/authz/${t}`);return E(r),new Promise((t,e)=>M("message",(i,n)=>{const s=i;s.origin===this.server&&"ETH:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(n(),P(r),t(s.data.txHash)),"DECLINED"===s.data.status&&(n(),P(r),e(new Error(s.data.errorMessage))))}))})}handleDisconnect(){return t(this,void 0,void 0,function*(){this.session.connected=!1,this.session.code=null,this.session.accounts={},I(b)})}}O=new WeakSet,x=function({chainId:t,rpcUrls:e}){const i=new URL(e[0]).hostname,{chain_id:r,name:n,display_name:s,network_type:o,blocto_service_environment:a,rpc_endpoint_domains:u}=this.supportNetwork[t];if(u.includes(i)){const t=c[a];this.switchableNetwork[r]={name:n,display_name:s,network_type:o,wallet_web_url:t,rpc_url:e[0]}}else console.warn(`The rpc url ${e[0]} is not supported.`)},N=function(){const t=window.ethereum;if(t&&t.isBlocto&&parseInt(t.chainId,16)!==this.chainId)throw new Error("Blocto SDK network mismatched")};var L=[],z=[],K="undefined"!=typeof Uint8Array?Uint8Array:Array,Y=!1;function q(){Y=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;e<64;++e)L[e]=t[e],z[t.charCodeAt(e)]=e;z["-".charCodeAt(0)]=62,z["_".charCodeAt(0)]=63}function D(t,e,i){for(var r,n,s=[],o=e;o<i;o+=3)r=(t[o]<<16)+(t[o+1]<<8)+t[o+2],s.push(L[(n=r)>>18&63]+L[n>>12&63]+L[n>>6&63]+L[63&n]);return s.join("")}function U(t){var e;Y||q();for(var i=t.length,r=i%3,n="",s=[],o=16383,a=0,c=i-r;a<c;a+=o)s.push(D(t,a,a+o>c?c:a+o));return 1===r?(e=t[i-1],n+=L[e>>2],n+=L[e<<4&63],n+="=="):2===r&&(e=(t[i-2]<<8)+t[i-1],n+=L[e>>10],n+=L[e>>4&63],n+=L[e<<2&63],n+="="),s.push(n),s.join("")}function j(t,e,i,r,n){var s,o,a=8*n-r-1,c=(1<<a)-1,u=c>>1,h=-7,l=i?n-1:0,d=i?-1:1,p=t[e+l];for(l+=d,s=p&(1<<-h)-1,p>>=-h,h+=a;h>0;s=256*s+t[e+l],l+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=256*o+t[e+l],l+=d,h-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=u}return(p?-1:1)*o*Math.pow(2,s-r)}function H(t,e,i,r,n,s){var o,a,c,u=8*s-n-1,h=(1<<u)-1,l=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,f=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+l>=1?d/c:d*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(e*c-1)*Math.pow(2,n),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(o=o<<n|a,u+=n;u>0;t[i+p]=255&o,p+=f,o/=256,u-=8);t[i+p-f]|=128*g}var $={}.toString,V=Array.isArray||function(t){return"[object Array]"==$.call(t)};function F(){return G.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function J(t,e){if(F()<e)throw new RangeError("Invalid typed array length");return G.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=G.prototype:(null===t&&(t=new G(e)),t.length=e),t}function G(t,e,i){if(!(G.TYPED_ARRAY_SUPPORT||this instanceof G))return new G(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return Q(this,t)}return Z(this,t,e,i)}function Z(t,e,i,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,r){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===i&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,i):new Uint8Array(e,i,r),G.TYPED_ARRAY_SUPPORT?(t=e).__proto__=G.prototype:t=tt(t,e),t}(t,e,i,r):"string"==typeof e?function(t,e,i){if("string"==typeof i&&""!==i||(i="utf8"),!G.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|rt(e,i),n=(t=J(t,r)).write(e,i);return n!==r&&(t=t.slice(0,n)),t}(t,e,i):function(t,e){if(it(e)){var i=0|et(e.length);return 0===(t=J(t,i)).length||e.copy(t,0,0,i),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?J(t,0):tt(t,e);if("Buffer"===e.type&&V(e.data))return tt(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function X(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function Q(t,e){if(X(e),t=J(t,e<0?0:0|et(e)),!G.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function tt(t,e){var i=e.length<0?0:0|et(e.length);t=J(t,i);for(var r=0;r<i;r+=1)t[r]=255&e[r];return t}function et(t){if(t>=F())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+F().toString(16)+" bytes");return 0|t}function it(t){return!(null==t||!t._isBuffer)}function rt(t,e){if(it(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return Bt(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return Rt(t).length;default:if(r)return Bt(t).length;e=(""+e).toLowerCase(),r=!0}}function nt(t,e,i){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return wt(this,e,i);case"utf8":case"utf-8":return gt(this,e,i);case"ascii":return yt(this,e,i);case"latin1":case"binary":return bt(this,e,i);case"base64":return ft(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return vt(this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function st(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function ot(t,e,i,r,n){if(0===t.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=G.from(e,r)),it(e))return 0===e.length?-1:at(t,e,i,r,n);if("number"==typeof e)return e&=255,G.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):at(t,[e],i,r,n);throw new TypeError("val must be string, number or Buffer")}function at(t,e,i,r,n){var s,o=1,a=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,i/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){var h=-1;for(s=i;s<a;s++)if(u(t,s)===u(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(i+c>a&&(i=a-c),s=i;s>=0;s--){for(var l=!0,d=0;d<c;d++)if(u(t,s+d)!==u(e,d)){l=!1;break}if(l)return s}return-1}function ct(t,e,i,r){i=Number(i)||0;var n=t.length-i;r?(r=Number(r))>n&&(r=n):r=n;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[i+o]=a}return o}function ut(t,e,i,r){return Ot(Bt(e,t.length-i),t,i,r)}function ht(t,e,i,r){return Ot(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,r)}function lt(t,e,i,r){return ht(t,e,i,r)}function dt(t,e,i,r){return Ot(Rt(e),t,i,r)}function pt(t,e,i,r){return Ot(function(t,e){for(var i,r,n,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=(i=t.charCodeAt(o))>>8,n=i%256,s.push(n),s.push(r);return s}(e,t.length-i),t,i,r)}function ft(t,e,i){return 0===e&&i===t.length?U(t):U(t.slice(e,i))}function gt(t,e,i){i=Math.min(t.length,i);for(var r=[],n=e;n<i;){var s,o,a,c,u=t[n],h=null,l=u>239?4:u>223?3:u>191?2:1;if(n+l<=i)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=t[n+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=t[n+1],o=t[n+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=t[n+1],o=t[n+2],a=t[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),n+=l}return function(t){var e=t.length;if(e<=mt)return String.fromCharCode.apply(String,t);for(var i="",r=0;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=mt));return i}(r)}G.TYPED_ARRAY_SUPPORT=void 0===i.g.TYPED_ARRAY_SUPPORT||i.g.TYPED_ARRAY_SUPPORT,F(),G.poolSize=8192,G._augment=function(t){return t.__proto__=G.prototype,t},G.from=function(t,e,i){return Z(null,t,e,i)},G.TYPED_ARRAY_SUPPORT&&(G.prototype.__proto__=Uint8Array.prototype,G.__proto__=Uint8Array),G.alloc=function(t,e,i){return function(t,e,i,r){return X(e),e<=0?J(t,e):void 0!==i?"string"==typeof r?J(t,e).fill(i,r):J(t,e).fill(i):J(t,e)}(null,t,e,i)},G.allocUnsafe=function(t){return Q(null,t)},G.allocUnsafeSlow=function(t){return Q(null,t)},G.isBuffer=function(t){return null!=t&&(!!t._isBuffer||xt(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&xt(t.slice(0,0))}(t))},G.compare=function(t,e){if(!it(t)||!it(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,r=e.length,n=0,s=Math.min(i,r);n<s;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0},G.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},G.concat=function(t,e){if(!V(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return G.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var r=G.allocUnsafe(e),n=0;for(i=0;i<t.length;++i){var s=t[i];if(!it(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,n),n+=s.length}return r},G.byteLength=rt,G.prototype._isBuffer=!0,G.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)st(this,e,e+1);return this},G.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)st(this,e,e+3),st(this,e+1,e+2);return this},G.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)st(this,e,e+7),st(this,e+1,e+6),st(this,e+2,e+5),st(this,e+3,e+4);return this},G.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?gt(this,0,t):nt.apply(this,arguments)},G.prototype.equals=function(t){if(!it(t))throw new TypeError("Argument must be a Buffer");return this===t||0===G.compare(this,t)},G.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},G.prototype.compare=function(t,e,i,r,n){if(!it(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||i>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=i)return 0;if(r>=n)return-1;if(e>=i)return 1;if(this===t)return 0;for(var s=(n>>>=0)-(r>>>=0),o=(i>>>=0)-(e>>>=0),a=Math.min(s,o),c=this.slice(r,n),u=t.slice(e,i),h=0;h<a;++h)if(c[h]!==u[h]){s=c[h],o=u[h];break}return s<o?-1:o<s?1:0},G.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},G.prototype.indexOf=function(t,e,i){return ot(this,t,e,i,!0)},G.prototype.lastIndexOf=function(t,e,i){return ot(this,t,e,i,!1)},G.prototype.write=function(t,e,i,r){if(void 0===e)r="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)r=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return ct(this,t,e,i);case"utf8":case"utf-8":return ut(this,t,e,i);case"ascii":return ht(this,t,e,i);case"latin1":case"binary":return lt(this,t,e,i);case"base64":return dt(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pt(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},G.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var mt=4096;function yt(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(127&t[n]);return r}function bt(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(t[n]);return r}function wt(t,e,i){var r=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>r)&&(i=r);for(var n="",s=e;s<i;++s)n+=Tt(t[s]);return n}function vt(t,e,i){for(var r=t.slice(e,i),n="",s=0;s<r.length;s+=2)n+=String.fromCharCode(r[s]+256*r[s+1]);return n}function kt(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function St(t,e,i,r,n,s){if(!it(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function It(t,e,i,r){e<0&&(e=65535+e+1);for(var n=0,s=Math.min(t.length-i,2);n<s;++n)t[i+n]=(e&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function At(t,e,i,r){e<0&&(e=4294967295+e+1);for(var n=0,s=Math.min(t.length-i,4);n<s;++n)t[i+n]=e>>>8*(r?n:3-n)&255}function _t(t,e,i,r,n,s){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function Et(t,e,i,r,n){return n||_t(t,0,i,4),H(t,e,i,r,23,4),i+4}function Pt(t,e,i,r,n){return n||_t(t,0,i,8),H(t,e,i,r,52,8),i+8}G.prototype.slice=function(t,e){var i,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),G.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=G.prototype;else{var n=e-t;i=new G(n,void 0);for(var s=0;s<n;++s)i[s]=this[s+t]}return i},G.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length);for(var r=this[t],n=1,s=0;++s<e&&(n*=256);)r+=this[t+s]*n;return r},G.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length);for(var r=this[t+--e],n=1;e>0&&(n*=256);)r+=this[t+--e]*n;return r},G.prototype.readUInt8=function(t,e){return e||kt(t,1,this.length),this[t]},G.prototype.readUInt16LE=function(t,e){return e||kt(t,2,this.length),this[t]|this[t+1]<<8},G.prototype.readUInt16BE=function(t,e){return e||kt(t,2,this.length),this[t]<<8|this[t+1]},G.prototype.readUInt32LE=function(t,e){return e||kt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},G.prototype.readUInt32BE=function(t,e){return e||kt(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},G.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length);for(var r=this[t],n=1,s=0;++s<e&&(n*=256);)r+=this[t+s]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*e)),r},G.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length);for(var r=e,n=1,s=this[t+--r];r>0&&(n*=256);)s+=this[t+--r]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*e)),s},G.prototype.readInt8=function(t,e){return e||kt(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},G.prototype.readInt16LE=function(t,e){e||kt(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},G.prototype.readInt16BE=function(t,e){e||kt(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},G.prototype.readInt32LE=function(t,e){return e||kt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},G.prototype.readInt32BE=function(t,e){return e||kt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},G.prototype.readFloatLE=function(t,e){return e||kt(t,4,this.length),j(this,t,!0,23,4)},G.prototype.readFloatBE=function(t,e){return e||kt(t,4,this.length),j(this,t,!1,23,4)},G.prototype.readDoubleLE=function(t,e){return e||kt(t,8,this.length),j(this,t,!0,52,8)},G.prototype.readDoubleBE=function(t,e){return e||kt(t,8,this.length),j(this,t,!1,52,8)},G.prototype.writeUIntLE=function(t,e,i,r){t=+t,e|=0,i|=0,r||St(this,t,e,i,Math.pow(2,8*i)-1,0);var n=1,s=0;for(this[e]=255&t;++s<i&&(n*=256);)this[e+s]=t/n&255;return e+i},G.prototype.writeUIntBE=function(t,e,i,r){t=+t,e|=0,i|=0,r||St(this,t,e,i,Math.pow(2,8*i)-1,0);var n=i-1,s=1;for(this[e+n]=255&t;--n>=0&&(s*=256);)this[e+n]=t/s&255;return e+i},G.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,1,255,0),G.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},G.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,2,65535,0),G.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):It(this,t,e,!0),e+2},G.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,2,65535,0),G.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):It(this,t,e,!1),e+2},G.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,4,4294967295,0),G.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):At(this,t,e,!0),e+4},G.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,4,4294967295,0),G.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):At(this,t,e,!1),e+4},G.prototype.writeIntLE=function(t,e,i,r){if(t=+t,e|=0,!r){var n=Math.pow(2,8*i-1);St(this,t,e,i,n-1,-n)}var s=0,o=1,a=0;for(this[e]=255&t;++s<i&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+i},G.prototype.writeIntBE=function(t,e,i,r){if(t=+t,e|=0,!r){var n=Math.pow(2,8*i-1);St(this,t,e,i,n-1,-n)}var s=i-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+i},G.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,1,127,-128),G.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},G.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,2,32767,-32768),G.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):It(this,t,e,!0),e+2},G.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,2,32767,-32768),G.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):It(this,t,e,!1),e+2},G.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,4,2147483647,-2147483648),G.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):At(this,t,e,!0),e+4},G.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||St(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),G.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):At(this,t,e,!1),e+4},G.prototype.writeFloatLE=function(t,e,i){return Et(this,t,e,!0,i)},G.prototype.writeFloatBE=function(t,e,i){return Et(this,t,e,!1,i)},G.prototype.writeDoubleLE=function(t,e,i){return Pt(this,t,e,!0,i)},G.prototype.writeDoubleBE=function(t,e,i){return Pt(this,t,e,!1,i)},G.prototype.copy=function(t,e,i,r){if(i||(i=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-i&&(r=t.length-e+i);var n,s=r-i;if(this===t&&i<e&&e<r)for(n=s-1;n>=0;--n)t[n+e]=this[n+i];else if(s<1e3||!G.TYPED_ARRAY_SUPPORT)for(n=0;n<s;++n)t[n+e]=this[n+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+s),e);return s},G.prototype.fill=function(t,e,i,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!G.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var s;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(s=e;s<i;++s)this[s]=t;else{var o=it(t)?t:Bt(new G(t,r).toString()),a=o.length;for(s=0;s<i-e;++s)this[s+e]=o[s%a]}return this};var Mt=/[^+\/0-9A-Za-z-_]/g;function Tt(t){return t<16?"0"+t.toString(16):t.toString(16)}function Bt(t,e){var i;e=e||1/0;for(var r=t.length,n=null,s=[],o=0;o<r;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function Rt(t){return function(t){var e,i,r,n,s,o;Y||q();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===t[a-2]?2:"="===t[a-1]?1:0,o=new K(3*a/4-s),r=s>0?a-4:a;var c=0;for(e=0,i=0;e<r;e+=4,i+=3)n=z[t.charCodeAt(e)]<<18|z[t.charCodeAt(e+1)]<<12|z[t.charCodeAt(e+2)]<<6|z[t.charCodeAt(e+3)],o[c++]=n>>16&255,o[c++]=n>>8&255,o[c++]=255&n;return 2===s?(n=z[t.charCodeAt(e)]<<2|z[t.charCodeAt(e+1)]>>4,o[c++]=255&n):1===s&&(n=z[t.charCodeAt(e)]<<10|z[t.charCodeAt(e+1)]<<4|z[t.charCodeAt(e+2)]>>2,o[c++]=n>>8&255,o[c++]=255&n),o}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Mt,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Ot(t,e,i,r){for(var n=0;n<r&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}function xt(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var Nt=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(function(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),i=0;i<e.length;i++)e[i]=255;for(var r=0;r<t.length;r++){var n=t.charAt(r),s=n.charCodeAt(0);if(255!==e[s])throw new TypeError(n+" is ambiguous");e[s]=r}var o=t.length,a=t.charAt(0),c=Math.log(o)/Math.log(256),u=Math.log(256)/Math.log(o);function h(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;for(var i=0,r=0,n=0;t[i]===a;)r++,i++;for(var s=(t.length-i)*c+1>>>0,u=new Uint8Array(s);t[i];){var h=e[t.charCodeAt(i)];if(255===h)return;for(var l=0,d=s-1;(0!==h||l<n)&&-1!==d;d--,l++)h+=o*u[d]>>>0,u[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");n=l,i++}for(var p=s-n;p!==s&&0===u[p];)p++;for(var f=new Uint8Array(r+(s-p)),g=r;p!==s;)f[g++]=u[p++];return f}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";for(var i=0,r=0,n=0,s=e.length;n!==s&&0===e[n];)n++,i++;for(var c=(s-n)*u+1>>>0,h=new Uint8Array(c);n!==s;){for(var l=e[n],d=0,p=c-1;(0!==l||d<r)&&-1!==p;p--,d++)l+=256*h[p]>>>0,h[p]=l%o>>>0,l=l/o>>>0;if(0!==l)throw new Error("Non-zero carry");r=d,n++}for(var f=c-r;f!==c&&0===h[f];)f++;for(var g=a.repeat(i);f<c;++f)g+=t.charAt(h[f]);return g},decodeUnsafe:h,decode:function(t){var e=h(t);if(e)return e;throw new Error("Non-base"+o+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"));let Ct;try{Ct=i(48e3)}catch(t){}class Wt extends A{constructor({net:t="mainnet-beta",server:e,appId:i,rpc:n,session:s}){if(super(s),r(t,"'net' is required"),r(h.includes(t),"unsupported net"),this.net=t,this.rpc=n||("mainnet-beta"===t?"https://free.rpcpool.com":`https://api.${t}.solana.com`),this.server=e||u[this.net]||"",this.appId=i||y,!Ct)throw new Error("No @solana/web3.js installed. Please install it to interact with Solana.")}request(e){return t(this,void 0,void 0,function*(){this.session.connected||(yield this.connect());try{let t=null,i=null;switch(e.method){case"connect":i=yield this.fetchAccounts();break;case"disconnect":this.disconnect();break;case"getAccounts":i=this.session.accounts.solana.length?this.session.accounts.solana:yield this.fetchAccounts();break;case"getAccountInfo":{const t=yield this.handleReadRequests(e),[r,n]=t.result.value.data;i=Object.assign(Object.assign({},t.result.value),{data:G.from(r,n),owner:new Ct.PublicKey(t.result.value.owner)});break}case"convertToProgramWalletTransaction":i=yield this.handleConvertTransaction(e);break;case"signAndSendTransaction":i=yield this.handleSignAndSendTransaction(e);break;case"signTransaction":case"signAllTransactions":throw new Error(`Blocto is program wallet, which doesn't support ${e.method}. Use signAndSendTransaction instead.`);default:t=yield this.handleReadRequests(e)}if(t&&!t.result&&t.error){const e=t.error.message?t.error.message:"Request failed";throw new Error(e)}return t?t.result:i}catch(t){throw console.error(t),t}})}connect(){return t(this,void 0,void 0,function*(){const t=window.solana;return t&&t.isBlocto?new Promise(e=>{t.on("connect",()=>{this.session.accounts.solana=[t.publicKey.toBase58()],e()}),t.connect()}):(this.tryRetrieveSessionFromStorage("solana"),new Promise((t,e)=>{if("undefined"==typeof window)return e("Currently only supported in browser");if(this.session.connected)return t();const i=encodeURIComponent(window.location.origin),r=_(`${this.server}/${this.appId}/solana/authn?l6n=${i}`);E(r),M("message",(i,n)=>{const s=i;if(s.origin===this.server){if("SOL:FRAME:RESPONSE"===s.data.type){n(),P(r),this.session.code=s.data.code,this.session.connected=!0,this.eventListeners.connect.forEach(t=>t(this.net));const e=s.data.address;this.formatAndSetSessionAccount(e),S(this.sessionKey,{code:this.session.code,address:e},m),t()}"SOL:FRAME:CLOSE"===s.data.type&&(n(),P(r),e(new Error("User declined the login request")))}})}))})}disconnect(){return t(this,void 0,void 0,function*(){const t=window.solana;t&&t.isBlocto?yield t.disconnect():(this.session.code=null,this.session.accounts={},this.eventListeners.disconnect.forEach(t=>t(null)),this.session.connected=!1)})}fetchAccounts(){return t(this,void 0,void 0,function*(){const{accounts:t}=yield fetch(`${this.server}/api/solana/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code}}).then(t=>t.json());return this.session.accounts.solana=t,t})}handleReadRequests(e){return t(this,void 0,void 0,function*(){return fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))}).then(t=>t.json())})}convertToProgramWalletTransaction(e){return t(this,void 0,void 0,function*(){const t=window.solana;if(t&&t.isBlocto)return t.convertToProgramWalletTransaction(e);const i=yield this.request({method:"convertToProgramWalletTransaction",params:{message:e.serializeMessage().toString("hex")}});return this.toTransaction(i,[])})}signAndSendTransaction(e,i){return t(this,void 0,void 0,function*(){const t=window.solana;if(t&&t.isBlocto)return t.signAndSendTransaction(e);const r={};if(i){i.commitment&&(r.commitment=i.commitment);const t=i?i._rpcEndpoint:null;t&&t!==this.rpc&&(this.rpc=t,this.disconnect(),yield this.connect())}return this.request({method:"signAndSendTransaction",params:Object.assign({signatures:yield this.collectSignatures(e),message:e.serializeMessage().toString("hex")},r)})})}toTransaction(e,i){return t(this,void 0,void 0,function*(){const t=Ct.Message.from(G.from(e,"hex")),r=new Ct.Transaction;return r.recentBlockhash=t.recentBlockhash,t.header.numRequiredSignatures>0&&(r.feePayer=t.accountKeys[0]),i.forEach((e,i)=>{const n={signature:e===Ct.PublicKey.default.toBase58()?null:Nt.decode(e),publicKey:t.accountKeys[i]};r.signatures.push(n)}),t.instructions.forEach(e=>{const i=e.accounts.map(e=>({pubkey:t.accountKeys[e],isSigner:e<t.header.numRequiredSignatures,isWritable:t.isAccountWritable(e)}));r.instructions.push(new Ct.TransactionInstruction({keys:i,programId:t.accountKeys[e.programIdIndex],data:Nt.decode(e.data)}))}),r})}collectSignatures(e){return t(this,void 0,void 0,function*(){return e.signatures.reduce((t,e)=>(e.signature&&(t[e.publicKey.toBase58()]=e.signature.toString("hex")),t),{})})}handleConvertTransaction(e){return t(this,void 0,void 0,function*(){return fetch(`${this.server}/api/solana/convertToWalletTx`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(e.params)}).then(t=>T(t,this))})}handleSignAndSendTransaction(e){return t(this,void 0,void 0,function*(){const{authorizationId:t}=yield fetch(`${this.server}/api/solana/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(e.params)}).then(t=>T(t,this));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const i=_(`${this.server}/${this.appId}/solana/authz/${t}`);return E(i),new Promise((t,e)=>M("message",(r,n)=>{const s=r;s.origin===this.server&&"SOL:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(n(),P(i),t(s.data.txHash)),"DECLINED"===s.data.status&&(n(),P(i),e(new Error(s.data.errorMessage))))}))})}}class Lt extends A{constructor({chainId:t,server:e,appId:i,session:n}){super(n),this.publicKey=[],this.authKey="",r(t,"'chainId' is required"),r(i,"It is necessary to interact with Blocto wallet via your app id. Please visit https://developers.blocto.app for more details."),this.chainId=t,this.networkName=p[t],this.api=f[t];const s=l[t];this.appId=i||y,this.server=e||s||""}get publicAccount(){return{address:this.session.accounts.aptos[0]||null,publicKey:this.publicKey.length?this.publicKey:null,authKey:null,minKeysRequired:2}}network(){return t(this,void 0,void 0,function*(){return{name:this.networkName,api:this.api,chainId:this.chainId.toString()}})}isConnected(){return t(this,void 0,void 0,function*(){return this.session.connected})}signTransaction(e){return t(this,void 0,void 0,function*(){const t=window.bloctoAptos;if(t)return t.signTransaction(e);if((yield this.isConnected())||(yield this.connect()),!this.session.accounts.aptos.length)throw new Error("Fail to get account");throw new Error("signTransaction method not supported.")})}disconnect(){return t(this,void 0,void 0,function*(){const t=window.bloctoAptos;t?yield t.disconnect():(this.session.code=null,this.session.accounts={},this.session.connected=!1)})}signAndSubmitTransaction(e,i={}){return t(this,void 0,void 0,function*(){const t=window.bloctoAptos;if(t)return t.signAndSubmitTransaction(e,i);if((yield this.isConnected())||(yield this.connect()),!this.session.accounts.aptos.length)throw new Error("Fail to get account");const{authorizationId:r}=yield fetch(`${this.server}/api/aptos/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(Object.assign(Object.assign({},e),i))}).then(t=>T(t,this));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const n=_(`${this.server}/${this.appId}/aptos/authz/${r}`);return E(n),new Promise((t,e)=>M("message",(i,r)=>{const s=i;s.origin===this.server&&"APTOS:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(r(),P(n),t({hash:s.data.txHash})),"DECLINED"===s.data.status&&(r(),P(n),e(new Error(s.data.errorMessage))))}))})}signMessage(e){return t(this,void 0,void 0,function*(){const t=window.bloctoAptos,i=(t=>{var e,i;const r=Object.assign({},t),{message:n,nonce:s,address:o,application:a,chainId:c}=t;return"string"!=typeof n&&(r.message=null!==(e=String(n))&&void 0!==e?e:""),"string"!=typeof s&&(r.nonce=null!==(i=String(s))&&void 0!==i?i:""),o&&"boolean"!=typeof o&&(r.address=!!o),a&&"boolean"!=typeof a&&(r.application=!!a),c&&"boolean"!=typeof c&&(r.chainId=!!c),r})(e);if(t)return t.signMessage(i);if((yield this.isConnected())||(yield this.connect()),!this.session.accounts.aptos.length)throw new Error("Fail to get account");if("undefined"==typeof window)throw new Error("Currently only supported in browser");const{signatureId:r}=yield fetch(`${this.server}/api/aptos/user-signature`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(i)}).then(t=>T(t,this)),n=_(`${this.server}/${this.appId}/aptos/user-signature/${r}`);return E(n),new Promise((t,e)=>M("message",(i,r)=>{const s=i;s.origin===this.server&&"APTOS:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(r(),P(n),t(s.data)),"DECLINED"===s.data.status&&(r(),P(n),e(new Error(s.data.errorMessage))))}))})}connect(){return t(this,void 0,void 0,function*(){const e=window.bloctoAptos;return new Promise(e?(t,i)=>setTimeout(()=>e.connect().then(t).catch(i),10):(e,i)=>{if("undefined"==typeof window)return i("Currently only supported in browser");if(this.session.connected&&this.session.accounts.aptos.length)return e({address:this.session.accounts.aptos[0],publicKey:this.publicKey,authKey:null,minKeysRequired:2});const r=encodeURIComponent(window.location.origin),n=_(`${this.server}/${this.appId}/aptos/authn?l6n=${r}`);E(n),M("message",(r,s)=>t(this,void 0,void 0,function*(){const t=r;if(t.origin===this.server){if("APTOS:FRAME:RESPONSE"===t.data.type){s(),P(n),this.session.code=t.data.code,this.session.connected=!0;const r=t.data.address;if(this.formatAndSetSessionAccount(r),S(this.sessionKey,{code:this.session.code,address:r},m),!this.session.accounts.aptos.length)return i();try{const{public_keys:t}=yield fetch(`${this.server}/blocto/aptos/accounts/${this.session.accounts.aptos[0]}`).then(t=>t.json());this.publicKey=t||[],e({address:this.session.accounts.aptos[0]||"",publicKey:this.publicKey,authKey:null,minKeysRequired:2})}catch(e){return i(t)}}"APTOS:FRAME:CLOSE"===t.data.type&&(s(),P(n),i(new Error("User declined the login request")))}}))})})}fetchAddress(){return t(this,void 0,void 0,function*(){const{accounts:t}=yield fetch(`${this.server}/api/aptos/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code}}).then(t=>T(t,this));return this.session.accounts.aptos=t||[],this.session.accounts.aptos[0]})}}const zt={connected:!1,code:null,accounts:{}};return class{constructor({appId:t,ethereum:e,solana:i,aptos:r}){e&&(this.ethereum=new W(Object.assign(Object.assign({},e),{appId:t,session:zt}))),i&&(this.solana=new Wt(Object.assign(Object.assign({},i),{appId:t,session:zt}))),r&&(this.aptos=new Lt(Object.assign(Object.assign({},r),{appId:t,session:zt})))}}}()},78404:function(t,e,i){!function(t,e){"use strict";function r(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}function s(t,e,i){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(i=e,e=10),this._init(t||0,e||10,i||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i(36262).Buffer}catch(t){}function a(t,e){var i=t.charCodeAt(e);return i>=48&&i<=57?i-48:i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:void r(!1,"Invalid character in "+t)}function c(t,e,i){var r=a(t,i);return i-1>=e&&(r|=a(t,i-1)<<4),r}function u(t,e,i,n){for(var s=0,o=0,a=Math.min(t.length,i),c=e;c<a;c++){var u=t.charCodeAt(c)-48;s*=n,o=u>=49?u-49+10:u>=17?u-17+10:u,r(u>=0&&o<n,"Invalid character"),s+=o}return s}function h(t,e){t.words=e.words,t.length=e.length,t.negative=e.negative,t.red=e.red}if(s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,i){if("number"==typeof t)return this._initNumber(t,e,i);if("object"==typeof t)return this._initArray(t,e,i);"hex"===e&&(e=16),r(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,i):(this._parseBase(t,e,n),"le"===i&&this._initArray(this.toArray(),e,i)))},s.prototype._initNumber=function(t,e,i){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(r(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),e,i)},s.prototype._initArray=function(t,e,i){if(r("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===i)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===i)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this._strip()},s.prototype._parseHex=function(t,e,i){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var n,s=0,o=0;if("be"===i)for(r=t.length-1;r>=e;r-=2)n=c(t,e,r)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(r=(t.length-e)%2==0?e+1:e;r<t.length;r+=2)n=c(t,e,r)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this._strip()},s.prototype._parseBase=function(t,e,i){this.words=[0],this.length=1;for(var r=0,n=1;n<=67108863;n*=e)r++;r--,n=n/e|0;for(var s=t.length-i,o=s%r,a=Math.min(s,s-o)+i,c=0,h=i;h<a;h+=r)c=u(t,h,h+r,e),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==o){var l=1;for(c=u(t,h,t.length,e),h=0;h<o;h++)l*=e;this.imuln(l),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this._strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype._move=function(t){h(t,this)},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=l}catch(t){s.prototype.inspect=l}else s.prototype.inspect=l;function l(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var d=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],p=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function g(t,e,i){i.negative=e.negative^t.negative;var r=t.length+e.length|0;i.length=r,r=r-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,c=o/67108864|0;i.words[0]=a;for(var u=1;u<r;u++){for(var h=c>>>26,l=67108863&c,d=Math.min(u,e.length-1),p=Math.max(0,u-t.length+1);p<=d;p++){var f=u-p|0;h+=(o=(n=0|t.words[f])*(s=0|e.words[p])+l)/67108864|0,l=67108863&o}i.words[u]=0|l,c=0|h}return 0!==c?i.words[u]=0|c:i.length--,i._strip()}s.prototype.toString=function(t,e){var i;if(e=0|e||1,16===(t=t||10)||"hex"===t){i="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],c=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),i=0!==s||o!==this.length-1?d[6-c.length]+c+i:c+i}for(0!==s&&(i=s.toString(16)+i);i.length%e!==0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(t===(0|t)&&t>=2&&t<=36){var u=p[t],h=f[t];i="";var l=this.clone();for(l.negative=0;!l.isZero();){var g=l.modrn(h).toString(t);i=(l=l.idivn(h)).isZero()?g+i:d[u-g.length]+g+i}for(this.isZero()&&(i="0"+i);i.length%e!==0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(t,e){return this.toArrayLike(o,t,e)}),s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,i){this._strip();var n=this.byteLength(),s=i||Math.max(1,n);r(n<=s,"byte array longer than desired length"),r(s>0,"Requested array length <= 0");var o=function(t,e){return t.allocUnsafe?t.allocUnsafe(e):new t(e)}(t,s);return this["_toArrayLike"+("le"===e?"LE":"BE")](o,n),o},s.prototype._toArrayLikeLE=function(t,e){for(var i=0,r=0,n=0,s=0;n<this.length;n++){var o=this.words[n]<<s|r;t[i++]=255&o,i<t.length&&(t[i++]=o>>8&255),i<t.length&&(t[i++]=o>>16&255),6===s?(i<t.length&&(t[i++]=o>>24&255),r=0,s=0):(r=o>>>24,s+=2)}if(i<t.length)for(t[i++]=r;i<t.length;)t[i++]=0},s.prototype._toArrayLikeBE=function(t,e){for(var i=t.length-1,r=0,n=0,s=0;n<this.length;n++){var o=this.words[n]<<s|r;t[i--]=255&o,i>=0&&(t[i--]=o>>8&255),i>=0&&(t[i--]=o>>16&255),6===s?(i>=0&&(t[i--]=o>>24&255),r=0,s=0):(r=o>>>24,s+=2)}if(i>=0)for(t[i--]=r;i>=0;)t[i--]=0},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,i=0;return e>=4096&&(i+=13,e>>>=13),e>=64&&(i+=7,e>>>=7),e>=8&&(i+=4,e>>>=4),e>=2&&(i+=2,e>>>=2),i+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,i=0;return 8191&e||(i+=13,e>>>=13),127&e||(i+=7,e>>>=7),15&e||(i+=4,e>>>=4),3&e||(i+=2,e>>>=2),1&e||i++,i},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var i=this._zeroBits(this.words[e]);if(t+=i,26!==i)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this._strip()},s.prototype.ior=function(t){return r(0===(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var i=0;i<e.length;i++)this.words[i]=this.words[i]&t.words[i];return this.length=e.length,this._strip()},s.prototype.iand=function(t){return r(0===(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,i;this.length>t.length?(e=this,i=t):(e=t,i=this);for(var r=0;r<i.length;r++)this.words[r]=e.words[r]^i.words[r];if(this!==e)for(;r<e.length;r++)this.words[r]=e.words[r];return this.length=e.length,this._strip()},s.prototype.ixor=function(t){return r(0===(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){r("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),i=t%26;this._expand(e),i>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this._strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){r("number"==typeof t&&t>=0);var i=t/26|0,n=t%26;return this._expand(i+1),this.words[i]=e?this.words[i]|1<<n:this.words[i]&~(1<<n),this._strip()},s.prototype.iadd=function(t){var e,i,r;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(i=this,r=t):(i=t,r=this);for(var n=0,s=0;s<r.length;s++)e=(0|i.words[s])+(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<i.length;s++)e=(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=i.length,0!==n)this.words[this.length]=n,this.length++;else if(i!==this)for(;s<i.length;s++)this.words[s]=i.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var i,r,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(i=this,r=t):(i=t,r=this);for(var s=0,o=0;o<r.length;o++)s=(e=(0|i.words[o])-(0|r.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<i.length;o++)s=(e=(0|i.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<i.length&&i!==this)for(;o<i.length;o++)this.words[o]=i.words[o];return this.length=Math.max(this.length,o),i!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var m=function(t,e,i){var r,n,s,o=t.words,a=e.words,c=i.words,u=0,h=0|o[0],l=8191&h,d=h>>>13,p=0|o[1],f=8191&p,g=p>>>13,m=0|o[2],y=8191&m,b=m>>>13,w=0|o[3],v=8191&w,k=w>>>13,S=0|o[4],I=8191&S,A=S>>>13,_=0|o[5],E=8191&_,P=_>>>13,M=0|o[6],T=8191&M,B=M>>>13,R=0|o[7],O=8191&R,x=R>>>13,N=0|o[8],C=8191&N,W=N>>>13,L=0|o[9],z=8191&L,K=L>>>13,Y=0|a[0],q=8191&Y,D=Y>>>13,U=0|a[1],j=8191&U,H=U>>>13,$=0|a[2],V=8191&$,F=$>>>13,J=0|a[3],G=8191&J,Z=J>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],it=8191&et,rt=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ct=8191&at,ut=at>>>13,ht=0|a[8],lt=8191&ht,dt=ht>>>13,pt=0|a[9],ft=8191&pt,gt=pt>>>13;i.negative=t.negative^e.negative,i.length=19;var mt=(u+(r=Math.imul(l,q))|0)+((8191&(n=(n=Math.imul(l,D))+Math.imul(d,q)|0))<<13)|0;u=((s=Math.imul(d,D))+(n>>>13)|0)+(mt>>>26)|0,mt&=67108863,r=Math.imul(f,q),n=(n=Math.imul(f,D))+Math.imul(g,q)|0,s=Math.imul(g,D);var yt=(u+(r=r+Math.imul(l,j)|0)|0)+((8191&(n=(n=n+Math.imul(l,H)|0)+Math.imul(d,j)|0))<<13)|0;u=((s=s+Math.imul(d,H)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,r=Math.imul(y,q),n=(n=Math.imul(y,D))+Math.imul(b,q)|0,s=Math.imul(b,D),r=r+Math.imul(f,j)|0,n=(n=n+Math.imul(f,H)|0)+Math.imul(g,j)|0,s=s+Math.imul(g,H)|0;var bt=(u+(r=r+Math.imul(l,V)|0)|0)+((8191&(n=(n=n+Math.imul(l,F)|0)+Math.imul(d,V)|0))<<13)|0;u=((s=s+Math.imul(d,F)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,r=Math.imul(v,q),n=(n=Math.imul(v,D))+Math.imul(k,q)|0,s=Math.imul(k,D),r=r+Math.imul(y,j)|0,n=(n=n+Math.imul(y,H)|0)+Math.imul(b,j)|0,s=s+Math.imul(b,H)|0,r=r+Math.imul(f,V)|0,n=(n=n+Math.imul(f,F)|0)+Math.imul(g,V)|0,s=s+Math.imul(g,F)|0;var wt=(u+(r=r+Math.imul(l,G)|0)|0)+((8191&(n=(n=n+Math.imul(l,Z)|0)+Math.imul(d,G)|0))<<13)|0;u=((s=s+Math.imul(d,Z)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,r=Math.imul(I,q),n=(n=Math.imul(I,D))+Math.imul(A,q)|0,s=Math.imul(A,D),r=r+Math.imul(v,j)|0,n=(n=n+Math.imul(v,H)|0)+Math.imul(k,j)|0,s=s+Math.imul(k,H)|0,r=r+Math.imul(y,V)|0,n=(n=n+Math.imul(y,F)|0)+Math.imul(b,V)|0,s=s+Math.imul(b,F)|0,r=r+Math.imul(f,G)|0,n=(n=n+Math.imul(f,Z)|0)+Math.imul(g,G)|0,s=s+Math.imul(g,Z)|0;var vt=(u+(r=r+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,r=Math.imul(E,q),n=(n=Math.imul(E,D))+Math.imul(P,q)|0,s=Math.imul(P,D),r=r+Math.imul(I,j)|0,n=(n=n+Math.imul(I,H)|0)+Math.imul(A,j)|0,s=s+Math.imul(A,H)|0,r=r+Math.imul(v,V)|0,n=(n=n+Math.imul(v,F)|0)+Math.imul(k,V)|0,s=s+Math.imul(k,F)|0,r=r+Math.imul(y,G)|0,n=(n=n+Math.imul(y,Z)|0)+Math.imul(b,G)|0,s=s+Math.imul(b,Z)|0,r=r+Math.imul(f,Q)|0,n=(n=n+Math.imul(f,tt)|0)+Math.imul(g,Q)|0,s=s+Math.imul(g,tt)|0;var kt=(u+(r=r+Math.imul(l,it)|0)|0)+((8191&(n=(n=n+Math.imul(l,rt)|0)+Math.imul(d,it)|0))<<13)|0;u=((s=s+Math.imul(d,rt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,r=Math.imul(T,q),n=(n=Math.imul(T,D))+Math.imul(B,q)|0,s=Math.imul(B,D),r=r+Math.imul(E,j)|0,n=(n=n+Math.imul(E,H)|0)+Math.imul(P,j)|0,s=s+Math.imul(P,H)|0,r=r+Math.imul(I,V)|0,n=(n=n+Math.imul(I,F)|0)+Math.imul(A,V)|0,s=s+Math.imul(A,F)|0,r=r+Math.imul(v,G)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(k,G)|0,s=s+Math.imul(k,Z)|0,r=r+Math.imul(y,Q)|0,n=(n=n+Math.imul(y,tt)|0)+Math.imul(b,Q)|0,s=s+Math.imul(b,tt)|0,r=r+Math.imul(f,it)|0,n=(n=n+Math.imul(f,rt)|0)+Math.imul(g,it)|0,s=s+Math.imul(g,rt)|0;var St=(u+(r=r+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,r=Math.imul(O,q),n=(n=Math.imul(O,D))+Math.imul(x,q)|0,s=Math.imul(x,D),r=r+Math.imul(T,j)|0,n=(n=n+Math.imul(T,H)|0)+Math.imul(B,j)|0,s=s+Math.imul(B,H)|0,r=r+Math.imul(E,V)|0,n=(n=n+Math.imul(E,F)|0)+Math.imul(P,V)|0,s=s+Math.imul(P,F)|0,r=r+Math.imul(I,G)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(A,G)|0,s=s+Math.imul(A,Z)|0,r=r+Math.imul(v,Q)|0,n=(n=n+Math.imul(v,tt)|0)+Math.imul(k,Q)|0,s=s+Math.imul(k,tt)|0,r=r+Math.imul(y,it)|0,n=(n=n+Math.imul(y,rt)|0)+Math.imul(b,it)|0,s=s+Math.imul(b,rt)|0,r=r+Math.imul(f,st)|0,n=(n=n+Math.imul(f,ot)|0)+Math.imul(g,st)|0,s=s+Math.imul(g,ot)|0;var It=(u+(r=r+Math.imul(l,ct)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ct)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,r=Math.imul(C,q),n=(n=Math.imul(C,D))+Math.imul(W,q)|0,s=Math.imul(W,D),r=r+Math.imul(O,j)|0,n=(n=n+Math.imul(O,H)|0)+Math.imul(x,j)|0,s=s+Math.imul(x,H)|0,r=r+Math.imul(T,V)|0,n=(n=n+Math.imul(T,F)|0)+Math.imul(B,V)|0,s=s+Math.imul(B,F)|0,r=r+Math.imul(E,G)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(P,G)|0,s=s+Math.imul(P,Z)|0,r=r+Math.imul(I,Q)|0,n=(n=n+Math.imul(I,tt)|0)+Math.imul(A,Q)|0,s=s+Math.imul(A,tt)|0,r=r+Math.imul(v,it)|0,n=(n=n+Math.imul(v,rt)|0)+Math.imul(k,it)|0,s=s+Math.imul(k,rt)|0,r=r+Math.imul(y,st)|0,n=(n=n+Math.imul(y,ot)|0)+Math.imul(b,st)|0,s=s+Math.imul(b,ot)|0,r=r+Math.imul(f,ct)|0,n=(n=n+Math.imul(f,ut)|0)+Math.imul(g,ct)|0,s=s+Math.imul(g,ut)|0;var At=(u+(r=r+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,r=Math.imul(z,q),n=(n=Math.imul(z,D))+Math.imul(K,q)|0,s=Math.imul(K,D),r=r+Math.imul(C,j)|0,n=(n=n+Math.imul(C,H)|0)+Math.imul(W,j)|0,s=s+Math.imul(W,H)|0,r=r+Math.imul(O,V)|0,n=(n=n+Math.imul(O,F)|0)+Math.imul(x,V)|0,s=s+Math.imul(x,F)|0,r=r+Math.imul(T,G)|0,n=(n=n+Math.imul(T,Z)|0)+Math.imul(B,G)|0,s=s+Math.imul(B,Z)|0,r=r+Math.imul(E,Q)|0,n=(n=n+Math.imul(E,tt)|0)+Math.imul(P,Q)|0,s=s+Math.imul(P,tt)|0,r=r+Math.imul(I,it)|0,n=(n=n+Math.imul(I,rt)|0)+Math.imul(A,it)|0,s=s+Math.imul(A,rt)|0,r=r+Math.imul(v,st)|0,n=(n=n+Math.imul(v,ot)|0)+Math.imul(k,st)|0,s=s+Math.imul(k,ot)|0,r=r+Math.imul(y,ct)|0,n=(n=n+Math.imul(y,ut)|0)+Math.imul(b,ct)|0,s=s+Math.imul(b,ut)|0,r=r+Math.imul(f,lt)|0,n=(n=n+Math.imul(f,dt)|0)+Math.imul(g,lt)|0,s=s+Math.imul(g,dt)|0;var _t=(u+(r=r+Math.imul(l,ft)|0)|0)+((8191&(n=(n=n+Math.imul(l,gt)|0)+Math.imul(d,ft)|0))<<13)|0;u=((s=s+Math.imul(d,gt)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,r=Math.imul(z,j),n=(n=Math.imul(z,H))+Math.imul(K,j)|0,s=Math.imul(K,H),r=r+Math.imul(C,V)|0,n=(n=n+Math.imul(C,F)|0)+Math.imul(W,V)|0,s=s+Math.imul(W,F)|0,r=r+Math.imul(O,G)|0,n=(n=n+Math.imul(O,Z)|0)+Math.imul(x,G)|0,s=s+Math.imul(x,Z)|0,r=r+Math.imul(T,Q)|0,n=(n=n+Math.imul(T,tt)|0)+Math.imul(B,Q)|0,s=s+Math.imul(B,tt)|0,r=r+Math.imul(E,it)|0,n=(n=n+Math.imul(E,rt)|0)+Math.imul(P,it)|0,s=s+Math.imul(P,rt)|0,r=r+Math.imul(I,st)|0,n=(n=n+Math.imul(I,ot)|0)+Math.imul(A,st)|0,s=s+Math.imul(A,ot)|0,r=r+Math.imul(v,ct)|0,n=(n=n+Math.imul(v,ut)|0)+Math.imul(k,ct)|0,s=s+Math.imul(k,ut)|0,r=r+Math.imul(y,lt)|0,n=(n=n+Math.imul(y,dt)|0)+Math.imul(b,lt)|0,s=s+Math.imul(b,dt)|0;var Et=(u+(r=r+Math.imul(f,ft)|0)|0)+((8191&(n=(n=n+Math.imul(f,gt)|0)+Math.imul(g,ft)|0))<<13)|0;u=((s=s+Math.imul(g,gt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,r=Math.imul(z,V),n=(n=Math.imul(z,F))+Math.imul(K,V)|0,s=Math.imul(K,F),r=r+Math.imul(C,G)|0,n=(n=n+Math.imul(C,Z)|0)+Math.imul(W,G)|0,s=s+Math.imul(W,Z)|0,r=r+Math.imul(O,Q)|0,n=(n=n+Math.imul(O,tt)|0)+Math.imul(x,Q)|0,s=s+Math.imul(x,tt)|0,r=r+Math.imul(T,it)|0,n=(n=n+Math.imul(T,rt)|0)+Math.imul(B,it)|0,s=s+Math.imul(B,rt)|0,r=r+Math.imul(E,st)|0,n=(n=n+Math.imul(E,ot)|0)+Math.imul(P,st)|0,s=s+Math.imul(P,ot)|0,r=r+Math.imul(I,ct)|0,n=(n=n+Math.imul(I,ut)|0)+Math.imul(A,ct)|0,s=s+Math.imul(A,ut)|0,r=r+Math.imul(v,lt)|0,n=(n=n+Math.imul(v,dt)|0)+Math.imul(k,lt)|0,s=s+Math.imul(k,dt)|0;var Pt=(u+(r=r+Math.imul(y,ft)|0)|0)+((8191&(n=(n=n+Math.imul(y,gt)|0)+Math.imul(b,ft)|0))<<13)|0;u=((s=s+Math.imul(b,gt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,r=Math.imul(z,G),n=(n=Math.imul(z,Z))+Math.imul(K,G)|0,s=Math.imul(K,Z),r=r+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(W,Q)|0,s=s+Math.imul(W,tt)|0,r=r+Math.imul(O,it)|0,n=(n=n+Math.imul(O,rt)|0)+Math.imul(x,it)|0,s=s+Math.imul(x,rt)|0,r=r+Math.imul(T,st)|0,n=(n=n+Math.imul(T,ot)|0)+Math.imul(B,st)|0,s=s+Math.imul(B,ot)|0,r=r+Math.imul(E,ct)|0,n=(n=n+Math.imul(E,ut)|0)+Math.imul(P,ct)|0,s=s+Math.imul(P,ut)|0,r=r+Math.imul(I,lt)|0,n=(n=n+Math.imul(I,dt)|0)+Math.imul(A,lt)|0,s=s+Math.imul(A,dt)|0;var Mt=(u+(r=r+Math.imul(v,ft)|0)|0)+((8191&(n=(n=n+Math.imul(v,gt)|0)+Math.imul(k,ft)|0))<<13)|0;u=((s=s+Math.imul(k,gt)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,r=Math.imul(z,Q),n=(n=Math.imul(z,tt))+Math.imul(K,Q)|0,s=Math.imul(K,tt),r=r+Math.imul(C,it)|0,n=(n=n+Math.imul(C,rt)|0)+Math.imul(W,it)|0,s=s+Math.imul(W,rt)|0,r=r+Math.imul(O,st)|0,n=(n=n+Math.imul(O,ot)|0)+Math.imul(x,st)|0,s=s+Math.imul(x,ot)|0,r=r+Math.imul(T,ct)|0,n=(n=n+Math.imul(T,ut)|0)+Math.imul(B,ct)|0,s=s+Math.imul(B,ut)|0,r=r+Math.imul(E,lt)|0,n=(n=n+Math.imul(E,dt)|0)+Math.imul(P,lt)|0,s=s+Math.imul(P,dt)|0;var Tt=(u+(r=r+Math.imul(I,ft)|0)|0)+((8191&(n=(n=n+Math.imul(I,gt)|0)+Math.imul(A,ft)|0))<<13)|0;u=((s=s+Math.imul(A,gt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,r=Math.imul(z,it),n=(n=Math.imul(z,rt))+Math.imul(K,it)|0,s=Math.imul(K,rt),r=r+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(W,st)|0,s=s+Math.imul(W,ot)|0,r=r+Math.imul(O,ct)|0,n=(n=n+Math.imul(O,ut)|0)+Math.imul(x,ct)|0,s=s+Math.imul(x,ut)|0,r=r+Math.imul(T,lt)|0,n=(n=n+Math.imul(T,dt)|0)+Math.imul(B,lt)|0,s=s+Math.imul(B,dt)|0;var Bt=(u+(r=r+Math.imul(E,ft)|0)|0)+((8191&(n=(n=n+Math.imul(E,gt)|0)+Math.imul(P,ft)|0))<<13)|0;u=((s=s+Math.imul(P,gt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,r=Math.imul(z,st),n=(n=Math.imul(z,ot))+Math.imul(K,st)|0,s=Math.imul(K,ot),r=r+Math.imul(C,ct)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(W,ct)|0,s=s+Math.imul(W,ut)|0,r=r+Math.imul(O,lt)|0,n=(n=n+Math.imul(O,dt)|0)+Math.imul(x,lt)|0,s=s+Math.imul(x,dt)|0;var Rt=(u+(r=r+Math.imul(T,ft)|0)|0)+((8191&(n=(n=n+Math.imul(T,gt)|0)+Math.imul(B,ft)|0))<<13)|0;u=((s=s+Math.imul(B,gt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863,r=Math.imul(z,ct),n=(n=Math.imul(z,ut))+Math.imul(K,ct)|0,s=Math.imul(K,ut),r=r+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(W,lt)|0,s=s+Math.imul(W,dt)|0;var Ot=(u+(r=r+Math.imul(O,ft)|0)|0)+((8191&(n=(n=n+Math.imul(O,gt)|0)+Math.imul(x,ft)|0))<<13)|0;u=((s=s+Math.imul(x,gt)|0)+(n>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,r=Math.imul(z,lt),n=(n=Math.imul(z,dt))+Math.imul(K,lt)|0,s=Math.imul(K,dt);var xt=(u+(r=r+Math.imul(C,ft)|0)|0)+((8191&(n=(n=n+Math.imul(C,gt)|0)+Math.imul(W,ft)|0))<<13)|0;u=((s=s+Math.imul(W,gt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863;var Nt=(u+(r=Math.imul(z,ft))|0)+((8191&(n=(n=Math.imul(z,gt))+Math.imul(K,ft)|0))<<13)|0;return u=((s=Math.imul(K,gt))+(n>>>13)|0)+(Nt>>>26)|0,Nt&=67108863,c[0]=mt,c[1]=yt,c[2]=bt,c[3]=wt,c[4]=vt,c[5]=kt,c[6]=St,c[7]=It,c[8]=At,c[9]=_t,c[10]=Et,c[11]=Pt,c[12]=Mt,c[13]=Tt,c[14]=Bt,c[15]=Rt,c[16]=Ot,c[17]=xt,c[18]=Nt,0!==u&&(c[19]=u,i.length++),i};function y(t,e,i){i.negative=e.negative^t.negative,i.length=t.length+e.length;for(var r=0,n=0,s=0;s<i.length-1;s++){var o=n;n=0;for(var a=67108863&r,c=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=c;u++){var h=s-u,l=(0|t.words[h])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}i.words[s]=a,r=o,o=n}return 0!==r?i.words[s]=r:i.length--,i._strip()}function b(t,e,i){return y(t,e,i)}function w(t,e){this.x=t,this.y=e}Math.imul||(m=g),s.prototype.mulTo=function(t,e){var i=this.length+t.length;return 10===this.length&&10===t.length?m(this,t,e):i<63?g(this,t,e):i<1024?y(this,t,e):b(this,t,e)},w.prototype.makeRBT=function(t){for(var e=new Array(t),i=s.prototype._countBits(t)-1,r=0;r<t;r++)e[r]=this.revBin(r,i,t);return e},w.prototype.revBin=function(t,e,i){if(0===t||t===i-1)return t;for(var r=0,n=0;n<e;n++)r|=(1&t)<<e-n-1,t>>=1;return r},w.prototype.permute=function(t,e,i,r,n,s){for(var o=0;o<s;o++)r[o]=e[t[o]],n[o]=i[t[o]]},w.prototype.transform=function(t,e,i,r,n,s){this.permute(s,t,e,i,r,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,c=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),h=0;h<n;h+=a)for(var l=c,d=u,p=0;p<o;p++){var f=i[h+p],g=r[h+p],m=i[h+p+o],y=r[h+p+o],b=l*m-d*y;y=l*y+d*m,m=b,i[h+p]=f+m,r[h+p]=g+y,i[h+p+o]=f-m,r[h+p+o]=g-y,p!==a&&(b=c*l-u*d,d=c*d+u*l,l=b)}},w.prototype.guessLen13b=function(t,e){var i=1|Math.max(e,t),r=1&i,n=0;for(i=i/2|0;i;i>>>=1)n++;return 1<<n+1+r},w.prototype.conjugate=function(t,e,i){if(!(i<=1))for(var r=0;r<i/2;r++){var n=t[r];t[r]=t[i-r-1],t[i-r-1]=n,n=e[r],e[r]=-e[i-r-1],e[i-r-1]=-n}},w.prototype.normalize13b=function(t,e){for(var i=0,r=0;r<e/2;r++){var n=8192*Math.round(t[2*r+1]/e)+Math.round(t[2*r]/e)+i;t[r]=67108863&n,i=n<67108864?0:n/67108864|0}return t},w.prototype.convert13b=function(t,e,i,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],i[2*o]=8191&s,s>>>=13,i[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)i[o]=0;r(0===s),r(!(-8192&s))},w.prototype.stub=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=0;return e},w.prototype.mulp=function(t,e,i){var r=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(r),s=this.stub(r),o=new Array(r),a=new Array(r),c=new Array(r),u=new Array(r),h=new Array(r),l=new Array(r),d=i.words;d.length=r,this.convert13b(t.words,t.length,o,r),this.convert13b(e.words,e.length,u,r),this.transform(o,s,a,c,r,n),this.transform(u,s,h,l,r,n);for(var p=0;p<r;p++){var f=a[p]*h[p]-c[p]*l[p];c[p]=a[p]*l[p]+c[p]*h[p],a[p]=f}return this.conjugate(a,c,r),this.transform(a,c,d,s,r,n),this.conjugate(d,s,r),this.normalize13b(d,r),i.negative=t.negative^e.negative,i.length=t.length+e.length,i._strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),b(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){var e=t<0;e&&(t=-t),r("number"==typeof t),r(t<67108864);for(var i=0,n=0;n<this.length;n++){var s=(0|this.words[n])*t,o=(67108863&s)+(67108863&i);i>>=26,i+=s/67108864|0,i+=o>>>26,this.words[n]=67108863&o}return 0!==i&&(this.words[n]=i,this.length++),this.length=0===t?1:this.length,e?this.ineg():this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),i=0;i<e.length;i++){var r=i/26|0,n=i%26;e[i]=t.words[r]>>>n&1}return e}(t);if(0===e.length)return new s(1);for(var i=this,r=0;r<e.length&&0===e[r];r++,i=i.sqr());if(++r<e.length)for(var n=i.sqr();r<e.length;r++,n=n.sqr())0!==e[r]&&(i=i.mul(n));return i},s.prototype.iushln=function(t){r("number"==typeof t&&t>=0);var e,i=t%26,n=(t-i)/26,s=67108863>>>26-i<<26-i;if(0!==i){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,c=(0|this.words[e])-a<<i;this.words[e]=c|o,o=a>>>26-i}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this._strip()},s.prototype.ishln=function(t){return r(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,i){var n;r("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,c=i;if(n-=o,n=Math.max(0,n),c){for(var u=0;u<o;u++)c.words[u]=this.words[u];c.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var h=0;for(u=this.length-1;u>=0&&(0!==h||u>=n);u--){var l=0|this.words[u];this.words[u]=h<<26-s|l>>>s,h=l&a}return c&&0!==h&&(c.words[c.length++]=h),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(t,e,i){return r(0===this.negative),this.iushrn(t,e,i)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){r("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26,n=1<<e;return!(this.length<=i||!(this.words[i]&n))},s.prototype.imaskn=function(t){r("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==e&&i++,this.length=Math.min(i,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this._strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return r("number"==typeof t),r(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<=t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(r("number"==typeof t),r(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this._strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,i){var n,s,o=t.length+i;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+i])+a;var c=(0|t.words[n])*e;a=((s-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&s}for(;n<this.length-i;n++)a=(s=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&s;if(0===a)return this._strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this._strip()},s.prototype._wordDiv=function(t,e){var i=(this.length,t.length),r=this.clone(),n=t,o=0|n.words[n.length-1];0!=(i=26-this._countBits(o))&&(n=n.ushln(i),r.iushln(i),o=0|n.words[n.length-1]);var a,c=r.length-n.length;if("mod"!==e){(a=new s(null)).length=c+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var h=r.clone()._ishlnsubmul(n,1,c);0===h.negative&&(r=h,a&&(a.words[c]=1));for(var l=c-1;l>=0;l--){var d=67108864*(0|r.words[n.length+l])+(0|r.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),r._ishlnsubmul(n,d,l);0!==r.negative;)d--,r.negative=0,r._ishlnsubmul(n,1,l),r.isZero()||(r.negative^=1);a&&(a.words[l]=d)}return a&&a._strip(),r._strip(),"div"!==e&&0!==i&&r.iushrn(i),{div:a||null,mod:r}},s.prototype.divmod=function(t,e,i){return r(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):0!==(this.negative&t.negative)?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modrn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modrn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var i=0!==e.div.negative?e.mod.isub(t):e.mod,r=t.ushrn(1),n=t.andln(1),s=i.cmp(r);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modrn=function(t){var e=t<0;e&&(t=-t),r(t<=67108863);for(var i=(1<<26)%t,n=0,s=this.length-1;s>=0;s--)n=(i*n+(0|this.words[s]))%t;return e?-n:n},s.prototype.modn=function(t){return this.modrn(t)},s.prototype.idivn=function(t){var e=t<0;e&&(t=-t),r(t<=67108863);for(var i=0,n=this.length-1;n>=0;n--){var s=(0|this.words[n])+67108864*i;this.words[n]=s/t|0,i=s%t}return this._strip(),e?this.ineg():this},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){r(0===t.negative),r(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),c=new s(1),u=0;e.isEven()&&i.isEven();)e.iushrn(1),i.iushrn(1),++u;for(var h=i.clone(),l=e.clone();!e.isZero();){for(var d=0,p=1;0===(e.words[0]&p)&&d<26;++d,p<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(h),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var f=0,g=1;0===(i.words[0]&g)&&f<26;++f,g<<=1);if(f>0)for(i.iushrn(f);f-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(h),c.isub(l)),a.iushrn(1),c.iushrn(1);e.cmp(i)>=0?(e.isub(i),n.isub(a),o.isub(c)):(i.isub(e),a.isub(n),c.isub(o))}return{a,b:c,gcd:i.iushln(u)}},s.prototype._invmp=function(t){r(0===t.negative),r(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),c=i.clone();e.cmpn(1)>0&&i.cmpn(1)>0;){for(var u=0,h=1;0===(e.words[0]&h)&&u<26;++u,h<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);for(var l=0,d=1;0===(i.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(i.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);e.cmp(i)>=0?(e.isub(i),o.isub(a)):(i.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),i=t.clone();e.negative=0,i.negative=0;for(var r=0;e.isEven()&&i.isEven();r++)e.iushrn(1),i.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;i.isEven();)i.iushrn(1);var n=e.cmp(i);if(n<0){var s=e;e=i,i=s}else if(0===n||0===i.cmpn(1))break;e.isub(i)}return i.iushln(r)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){r("number"==typeof t);var e=t%26,i=(t-e)/26,n=1<<e;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var s=n,o=i;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,i=t<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this._strip(),this.length>1)e=1;else{i&&(t=-t),r(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,i=this.length-1;i>=0;i--){var r=0|this.words[i],n=0|t.words[i];if(r!==n){r<n?e=-1:r>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new E(t)},s.prototype.toRed=function(t){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return r(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return r(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var v={k256:null,p224:null,p192:null,p25519:null};function k(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function S(){k.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function I(){k.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function A(){k.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){k.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else r(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function P(t){E.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}k.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},k.prototype.ireduce=function(t){var e,i=t;do{this.split(i,this.tmp),e=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(e>this.n);var r=e<this.n?-1:i.ucmp(this.p);return 0===r?(i.words[0]=0,i.length=1):r>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},k.prototype.split=function(t,e){t.iushrn(this.n,0,e)},k.prototype.imulK=function(t){return t.imul(this.k)},n(S,k),S.prototype.split=function(t,e){for(var i=4194303,r=Math.min(t.length,9),n=0;n<r;n++)e.words[n]=t.words[n];if(e.length=r,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&i,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&i)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},S.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,i=0;i<t.length;i++){var r=0|t.words[i];e+=977*r,t.words[i]=67108863&e,e=64*r+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(I,k),n(A,k),n(_,k),_.prototype.imulK=function(t){for(var e=0,i=0;i<t.length;i++){var r=19*(0|t.words[i])+e,n=67108863&r;r>>>=26,t.words[i]=n,e=r}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(v[t])return v[t];var e;if("k256"===t)e=new S;else if("p224"===t)e=new I;else if("p192"===t)e=new A;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return v[t]=e,e},E.prototype._verify1=function(t){r(0===t.negative,"red works only with positives"),r(t.red,"red works only with red numbers")},E.prototype._verify2=function(t,e){r(0===(t.negative|e.negative),"red works only with positives"),r(t.red&&t.red===e.red,"red works only with red numbers")},E.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):(h(t,t.umod(this.m)._forceRed(this)),t)},E.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},E.prototype.add=function(t,e){this._verify2(t,e);var i=t.add(e);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},E.prototype.iadd=function(t,e){this._verify2(t,e);var i=t.iadd(e);return i.cmp(this.m)>=0&&i.isub(this.m),i},E.prototype.sub=function(t,e){this._verify2(t,e);var i=t.sub(e);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},E.prototype.isub=function(t,e){this._verify2(t,e);var i=t.isub(e);return i.cmpn(0)<0&&i.iadd(this.m),i},E.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},E.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},E.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},E.prototype.isqr=function(t){return this.imul(t,t.clone())},E.prototype.sqr=function(t){return this.mul(t,t)},E.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(r(e%2==1),3===e){var i=this.m.add(new s(1)).iushrn(2);return this.pow(t,i)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);r(!n.isZero());var a=new s(1).toRed(this),c=a.redNeg(),u=this.m.subn(1).iushrn(1),h=this.m.bitLength();for(h=new s(2*h*h).toRed(this);0!==this.pow(h,u).cmp(c);)h.redIAdd(c);for(var l=this.pow(h,n),d=this.pow(t,n.addn(1).iushrn(1)),p=this.pow(t,n),f=o;0!==p.cmp(a);){for(var g=p,m=0;0!==g.cmp(a);m++)g=g.redSqr();r(m<f);var y=this.pow(l,new s(1).iushln(f-m-1));d=d.redMul(y),l=y.redSqr(),p=p.redMul(l),f=m}return d},E.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},E.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var i=new Array(16);i[0]=new s(1).toRed(this),i[1]=t;for(var r=2;r<i.length;r++)i[r]=this.mul(i[r-1],t);var n=i[0],o=0,a=0,c=e.bitLength()%26;for(0===c&&(c=26),r=e.length-1;r>=0;r--){for(var u=e.words[r],h=c-1;h>=0;h--){var l=u>>h&1;n!==i[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4===++a||0===r&&0===h)&&(n=this.mul(n,i[o]),a=0,o=0)):a=0}c=26}return n},E.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},E.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new P(t)},n(P,E),P.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},P.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},P.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var i=t.imul(e),r=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=i.isub(r).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},P.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var i=t.mul(e),r=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=i.isub(r).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},P.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=i.nmd(t),this)}}]);