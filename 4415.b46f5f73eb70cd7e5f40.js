(("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect=("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect||[]).push([[4415],{24415:(e,t,n)=>{"use strict";n.d(t,{sequence:()=>Da});var i={};n.r(i),n.d(i,{walletContracts:()=>m});var s={};n.r(s),n.d(s,{API:()=>k,SequenceAPIClient:()=>O,SmartRampOrderStatus:()=>E,SmartRampTxnStatus:()=>C,SortOrder:()=>I,WebRPCSchemaHash:()=>b,WebRPCSchemaVersion:()=>v,WebRPCVersion:()=>y});var r={};n.r(r),n.d(r,{Logger:()=>Ge,base64Decode:()=>Se,base64DecodeObject:()=>xe,base64Encode:()=>Oe,base64EncodeObject:()=>Ne,checkProperties:()=>nt,configureLogger:()=>We,deepCopy:()=>st,defineReadOnly:()=>Xe,encodeMessageDigest:()=>Re,encodeTypedDataDigest:()=>Qe,encodeTypedDataHash:()=>Ze,getRandomInt:()=>Ve,getStatic:()=>et,isBigNumberish:()=>ot,isBrowser:()=>Pe,isNode:()=>Be,jwtDecodeClaims:()=>Le,logger:()=>Fe,packMessageData:()=>Me,promisify:()=>$e,queryStringFromObject:()=>je,queryStringToObject:()=>He,resolveProperties:()=>tt,sanitizeAlphanumeric:()=>Ye,sanitizeHost:()=>Je,sanitizeNumberString:()=>Ke,shallowCopy:()=>it,sleep:()=>ze,subDigestOf:()=>Ue,urlClean:()=>rt});var o={};n.r(o),n.d(o,{Multicall:()=>It,providers:()=>Tt});var a={};n.r(a),n.d(a,{ConfigFinder:()=>Vt,SequenceUtilsFinder:()=>Ht,SignatureType:()=>Qt,WalletContractBytecode:()=>_t,addressOf:()=>Lt,buildStubSignature:()=>ln,compareAddr:()=>Ft,createWalletConfig:()=>Ut,decodeSignature:()=>Xt,editConfig:()=>Wt,encodeSignature:()=>on,genConfig:()=>$t,imageHash:()=>Dt,isConfigEqual:()=>Gt,isDecodedAddress:()=>Kt,isDecodedEOASigner:()=>Jt,isDecodedEOASplitSigner:()=>zt,isDecodedFullSigner:()=>Zt,isDecodedSigner:()=>Yt,isUsableConfig:()=>Bt,isValidConfigSigners:()=>Pt,joinSignatures:()=>sn,joinTwoSignatures:()=>rn,mutateSignature:()=>cn,recoverEOASigner:()=>nn,signerOf:()=>an,sortConfig:()=>qt,splitDecodedEOASigner:()=>tn});var c={};n.r(c),n.d(c,{ContractType:()=>gn,EventLogDataType:()=>mn,EventLogType:()=>fn,Indexer:()=>En,SequenceIndexerClient:()=>Tn,SequenceIndexerServices:()=>kn,SortOrder:()=>bn,TransactionStatus:()=>yn,TransactionType:()=>vn,TxnTransferType:()=>wn,WebRPCSchemaHash:()=>pn,WebRPCSchemaVersion:()=>un,WebRPCVersion:()=>dn});var l={};n.r(l),n.d(l,{ContractType:()=>xn,Metadata:()=>Bn,PropertyType:()=>Rn,SequenceMetadataClient:()=>qn,SortOrder:()=>Un,SwapType:()=>Mn,WebRPCSchemaHash:()=>Sn,WebRPCSchemaVersion:()=>Nn,WebRPCVersion:()=>On});var h={};n.r(h),n.d(h,{MetaTransactionsType:()=>hi,appendNonce:()=>ki,computeMetaTxnHash:()=>fi,decodeNonce:()=>Oi,digestOfTransactions:()=>pi,digestOfTransactionsNonce:()=>gi,encodeNonce:()=>_i,flattenAuxTransactions:()=>wi,fromTransactionish:()=>Si,hasSequenceTransactions:()=>Ei,isAsyncSendable:()=>vi,isSequenceTransaction:()=>bi,isSignedTransactions:()=>Ni,makeAfterNonce:()=>Ti,makeExpirable:()=>Ai,packMetaTransactionsData:()=>di,packMetaTransactionsNonceData:()=>ui,readSequenceNonce:()=>Ci,sequenceTxAbiEncode:()=>Ii,toSequenceTransaction:()=>yi,toSequenceTransactions:()=>mi});var d={};n.r(d),n.d(d,{BaseRelayer:()=>is,BaseRelayerDefaults:()=>ns,LocalRelayer:()=>ls,ProviderRelayer:()=>as,ProviderRelayerDefaults:()=>rs,RpcRelayer:()=>Cs,RpcRelayerProto:()=>ws,isBaseRelayerOptions:()=>ts,isLocalRelayerOptions:()=>cs,isProviderRelayerOptions:()=>os,isRelayer:()=>ks,isRpcRelayerOptions:()=>bs,proto:()=>ws});var u={};n.r(u),n.d(u,{AuthError:()=>Vs,DEFAULT_SESSION_EXPIRATION:()=>Ds,ErrAccountIsRequired:()=>js,LONG_SESSION_EXPIRATION:()=>qs,Session:()=>Gs,ValidateSequenceDeployedWalletProof:()=>Hs,ValidateSequenceUndeployedWalletProof:()=>Ks,signAuthorization:()=>$s});var p={};n.r(p),n.d(p,{Guard:()=>Qs,WebRPCSchemaHash:()=>Zs,WebRPCSchemaVersion:()=>zs,WebRPCVersion:()=>Js});var g={};n.r(g),n.d(g,{AllowProvider:()=>Mr,CachedProvider:()=>Br,ChainId:()=>wr,EagerProvider:()=>Pr,JsonRpcExternalProvider:()=>Rr,JsonRpcProvider:()=>Vr,JsonRpcRouter:()=>Tr,JsonRpcSender:()=>xr,JsonRpcVersion:()=>Ar,PublicProvider:()=>Wr,SigningProvider:()=>Fr,SingleflightMiddleware:()=>$r,allowProviderMiddleware:()=>Ur,checkNetworkConfig:()=>pr,createJsonRpcMiddlewareStack:()=>_r,ensureUniqueNetworks:()=>lr,ensureValidNetworks:()=>cr,exceptionProviderMiddleware:()=>Lr,findNetworkConfig:()=>ur,getAuthNetwork:()=>or,getChainId:()=>sr,indexerURL:()=>yr,isJsonRpcHandler:()=>Nr,isJsonRpcProvider:()=>Or,isNetworkConfig:()=>ir,isValidNetworkConfig:()=>ar,loggingProviderMiddleware:()=>Dr,mainnetNetworks:()=>Cr,maybeChainId:()=>rr,networkProviderMiddleware:()=>qr,networks:()=>Er,networksIndex:()=>gr,nodesURL:()=>br,relayerURL:()=>vr,sequenceContext:()=>kr,sortNetworks:()=>fr,stringTemplate:()=>mr,testnetNetworks:()=>Ir,updateNetworkConfig:()=>hr,validateAndSortNetworks:()=>dr});var f={};n.r(f),n.d(f,{BaseInjectedTransport:()=>da,BaseProviderTransport:()=>_o,BaseWalletTransport:()=>Xo,CHANNEL_ID:()=>ca,DefaultProviderConfig:()=>va,ErrSignedInRequired:()=>Io,EventType:()=>vo,ExtensionMessageHandler:()=>la,ExtensionMessageProvider:()=>ha,InitState:()=>Eo,LocalStorage:()=>zo,LocalStore:()=>Zo,LocalWeb3Provider:()=>Ro,MuxMessageProvider:()=>sa,OpenState:()=>bo,PROVIDER_OPEN_TIMEOUT:()=>ko,ProviderError:()=>Co,ProxyMessageChannel:()=>ea,ProxyMessageChannelPort:()=>ta,ProxyMessageHandler:()=>ia,ProxyMessageProvider:()=>na,UnrealMessageHandler:()=>ma,UnrealMessageProvider:()=>fa,Wallet:()=>ya,WalletRequestHandler:()=>Oo,Web3Provider:()=>So,Web3Signer:()=>Mo,WindowMessageHandler:()=>aa,WindowMessageProvider:()=>oa,WindowSessionParams:()=>yo,getWallet:()=>Ia,initWallet:()=>Ea,isBrowserExtension:()=>Ko,isSequenceProvider:()=>xo,isUnityPlugin:()=>Yo,isValidMessageSignature:()=>Vo,isValidSignature:()=>$o,isValidTypedDataSignature:()=>jo,isWalletUpToDate:()=>Jo,messageToBytes:()=>Fo,nextMessageIdx:()=>To,prefixEIP191Message:()=>Wo,recoverWalletConfig:()=>Ho,unregisterWallet:()=>Ca});const m={erc1271:Object.freeze({__proto__:null,abi:[{type:"function",name:"isValidSignature",constant:!0,inputs:[{type:"bytes32"},{type:"bytes"}],outputs:[{type:"bytes4"}],payable:!1,stateMutability:"view"}],returns:{isValidSignatureBytes32:"0x1626ba7e"}}),factory:Object.freeze({__proto__:null,abi:[{type:"function",name:"deploy",constant:!1,inputs:[{type:"address"},{type:"bytes32"}],outputs:[],payable:!0,stateMutability:"payable"}]}),mainModule:Object.freeze({__proto__:null,abi:[{type:"function",name:"nonce",constant:!0,inputs:[],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"readNonce",constant:!0,inputs:[{type:"uint256"}],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"updateImplementation",constant:!1,inputs:[{type:"address"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"selfExecute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"execute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"},{type:"uint256"},{type:"bytes"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"createContract",inputs:[{type:"bytes"}],payable:!0,stateMutability:"payable"}]}),mainModuleUpgradable:Object.freeze({__proto__:null,abi:[{type:"function",name:"updateImageHash",constant:!0,inputs:[{type:"bytes32"}],outputs:[],payable:!1,stateMutability:"view"},{type:"function",name:"imageHash",constant:!0,inputs:[],outputs:[{type:"bytes32"}],payable:!1,stateMutability:"view"}]}),sequenceUtils:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_mainModule",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"bytes32",name:"_imageHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"_threshold",type:"uint256"},{indexed:!1,internalType:"bytes",name:"_signers",type:"bytes"}],name:"RequiredConfig",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"address",name:"_signer",type:"address"}],name:"RequiredSigner",type:"event"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callBalanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_i",type:"uint256"}],name:"callBlockhash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"callChainId",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCode",outputs:[{internalType:"bytes",name:"code",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeHash",outputs:[{internalType:"bytes32",name:"codeHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeSize",outputs:[{internalType:"uint256",name:"size",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callCoinbase",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callDifficulty",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLeft",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLimit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callOrigin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"knownImageHashes",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"lastImageHashUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastSignerUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastWalletUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bool",name:"delegateCall",type:"bool"},{internalType:"bool",name:"revertOnError",type:"bool"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IModuleCalls.Transaction[]",name:"_txs",type:"tuple[]"}],name:"multiCall",outputs:[{internalType:"bool[]",name:"_successes",type:"bool[]"},{internalType:"bytes[]",name:"_results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_threshold",type:"uint256"},{components:[{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"address",name:"signer",type:"address"}],internalType:"struct RequireUtils.Member[]",name:"_members",type:"tuple[]"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishConfig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"uint256",name:"_sizeMembers",type:"uint256"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishInitialSigners",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_nonce",type:"uint256"}],name:"requireMinNonce",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_expiration",type:"uint256"}],name:"requireNonExpired",outputs:[],stateMutability:"view",type:"function"}]}),requireFreshSigner:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"",type:"address"}],name:"requireFreshSigner",outputs:[],stateMutability:"nonpayable",type:"function"}]})};function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},w.apply(this,arguments)}const y="v1",v="v0.4.0",b="e4aaaf3a3c07a1f339226fcac3b8addcb3120c7b";let E,C,I;!function(e){e.UNKNOWN="UNKNOWN",e.RUNNING_CHECKS="RUNNING_CHECKS",e.PROCESSING="PROCESSING",e.FAILED="FAILED",e.COMPLETE="COMPLETE"}(E||(E={})),function(e){e.UNKNOWN="UNKNOWN",e.SUCCESSFUL="SUCCESSFUL",e.FAILED="FAILED"}(C||(C={})),function(e){e.DESC="DESC",e.ASC="ASC"}(I||(I={}));class k{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/API/",this.ping=e=>this.fetch(this.url("Ping"),A({},e)).then((e=>T(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),A({},e)).then((e=>T(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),A({},e)).then((e=>T(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),A({},e)).then((e=>T(e).then((e=>({data:e.data}))))),this.getAuthToken=(e,t)=>this.fetch(this.url("GetAuthToken"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user}))))),this.sendPasswordlessLink=(e,t)=>this.fetch(this.url("SendPasswordlessLink"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.friendList=(e,t)=>this.fetch(this.url("FriendList"),A(e,t)).then((e=>T(e).then((e=>({page:e.page,friends:e.friends}))))),this.getFriendByAddress=(e,t)=>this.fetch(this.url("GetFriendByAddress"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,friend:e.friend}))))),this.searchFriends=(e,t)=>this.fetch(this.url("SearchFriends"),A(e,t)).then((e=>T(e).then((e=>({friends:e.friends}))))),this.addFriend=(e,t)=>this.fetch(this.url("AddFriend"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,friend:e.friend}))))),this.updateFriendNickname=(e,t)=>this.fetch(this.url("UpdateFriendNickname"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,friend:e.friend}))))),this.removeFriend=(e,t)=>this.fetch(this.url("RemoveFriend"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.contractCall=(e,t)=>this.fetch(this.url("ContractCall"),A(e,t)).then((e=>T(e).then((e=>({returns:e.returns}))))),this.decodeContractCall=(e,t)=>this.fetch(this.url("DecodeContractCall"),A(e,t)).then((e=>T(e).then((e=>({call:e.call}))))),this.lookupContractCallSelectors=(e,t)=>this.fetch(this.url("LookupContractCallSelectors"),A(e,t)).then((e=>T(e).then((e=>({signatures:e.signatures}))))),this.userStorageFetch=(e,t)=>this.fetch(this.url("UserStorageFetch"),A(e,t)).then((e=>T(e).then((e=>({object:e.object}))))),this.userStorageSave=(e,t)=>this.fetch(this.url("UserStorageSave"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.userStorageDelete=(e,t)=>this.fetch(this.url("UserStorageDelete"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.userStorageFetchAll=(e,t)=>this.fetch(this.url("UserStorageFetchAll"),A(e,t)).then((e=>T(e).then((e=>({objects:e.objects}))))),this.getMoonpayLink=(e,t)=>this.fetch(this.url("GetMoonpayLink"),A(e,t)).then((e=>T(e).then((e=>({signedUrl:e.signedUrl}))))),this.getSardineClientToken=e=>this.fetch(this.url("GetSardineClientToken"),A({},e)).then((e=>T(e).then((e=>({token:e.token}))))),this.isUsingGoogleMail=(e,t)=>this.fetch(this.url("IsUsingGoogleMail"),A(e,t)).then((e=>T(e).then((e=>({yes:e.yes}))))),this.resolveENSAddress=(e,t)=>this.fetch(this.url("ResolveENSAddress"),A(e,t)).then((e=>T(e).then((e=>({address:e.address,ok:e.ok}))))),this.isValidSignature=(e,t)=>this.fetch(this.url("IsValidSignature"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.isValidMessageSignature=(e,t)=>this.fetch(this.url("IsValidMessageSignature"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.isValidTypedDataSignature=(e,t)=>this.fetch(this.url("IsValidTypedDataSignature"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.isValidETHAuthProof=(e,t)=>this.fetch(this.url("IsValidETHAuthProof"),A(e,t)).then((e=>T(e).then((e=>({isValid:e.isValid}))))),this.getCoinPrices=(e,t)=>this.fetch(this.url("GetCoinPrices"),A(e,t)).then((e=>T(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getCollectiblePrices=(e,t)=>this.fetch(this.url("GetCollectiblePrices"),A(e,t)).then((e=>T(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getExchangeRate=(e,t)=>this.fetch(this.url("GetExchangeRate"),A(e,t)).then((e=>T(e).then((e=>({exchangeRate:e.exchangeRate}))))),this.memoryStore=(e,t)=>this.fetch(this.url("MemoryStore"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.memoryLoad=(e,t)=>this.fetch(this.url("MemoryLoad"),A(e,t)).then((e=>T(e).then((e=>({value:e.value}))))),this.listPayCardsOnFile=e=>this.fetch(this.url("ListPayCardsOnFile"),A({},e)).then((e=>T(e).then((e=>({payCards:e.payCards}))))),this.savePayCard=(e,t)=>this.fetch(this.url("SavePayCard"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok,payCard:e.payCard}))))),this.updatePayCardCVC=(e,t)=>this.fetch(this.url("UpdatePayCardCVC"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.deletePayCard=(e,t)=>this.fetch(this.url("DeletePayCard"),A(e,t)).then((e=>T(e).then((e=>({ok:e.ok}))))),this.smartRampQuote=(e,t)=>this.fetch(this.url("SmartRampQuote"),A(e,t)).then((e=>T(e).then((e=>({status:e.status,quoteDetails:e.quoteDetails}))))),this.smartRampPurchase=(e,t)=>this.fetch(this.url("SmartRampPurchase"),A(e,t)).then((e=>T(e).then((e=>({processing:e.processing,receipt:e.receipt}))))),this.smartRampWaitOrderConfirmation=(e,t)=>this.fetch(this.url("SmartRampWaitOrderConfirmation"),A(e,t)).then((e=>T(e).then((e=>({done:e.done,receipt:e.receipt}))))),this.smartRampGetOrder=(e,t)=>this.fetch(this.url("SmartRampGetOrder"),A(e,t)).then((e=>T(e).then((e=>({order:e.order}))))),this.smartRampCheckCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampCheckCardAuthorization"),A(e,t)).then((e=>T(e).then((e=>({cardAuth:e.cardAuth}))))),this.smartRampOrdersList=(e,t)=>this.fetch(this.url("SmartRampOrdersList"),A(e,t)).then((e=>T(e).then((e=>({page:e.page,orders:e.orders}))))),this.smartRampGetOrderTxnHash=(e,t)=>this.fetch(this.url("SmartRampGetOrderTxnHash"),A(e,t)).then((e=>T(e).then((e=>({txnHash:e.txnHash,txnSuccessful:e.txnSuccessful}))))),this.smartRampSubmitCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampSubmitCardAuthorization"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.adminSmartRampGetOrder=(e,t)=>this.fetch(this.url("AdminSmartRampGetOrder"),A(e,t)).then((e=>T(e).then((e=>({order:e.order}))))),this.adminSmartRampListCompletedOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListCompletedOrders"),A(e,t)).then((e=>T(e).then((e=>({orders:e.orders}))))),this.adminSmartRampListPendingOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListPendingOrders"),A(e,t)).then((e=>T(e).then((e=>({pendingOrders:e.pendingOrders}))))),this.getInviteInfo=e=>this.fetch(this.url("GetInviteInfo"),A({},e)).then((e=>T(e).then((e=>({inviteInfo:e.inviteInfo}))))),this.isValidAccessCode=(e,t)=>this.fetch(this.url("IsValidAccessCode"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.internalClaimAccessCode=(e,t)=>this.fetch(this.url("InternalClaimAccessCode"),A(e,t)).then((e=>T(e).then((e=>({status:e.status}))))),this.walletRecover=(e,t)=>this.fetch(this.url("WalletRecover"),A(e,t)).then((e=>T(e).then((e=>({encryptedWallet:e.encryptedWallet}))))),this.blockNumberAtTime=(e,t)=>this.fetch(this.url("BlockNumberAtTime"),A(e,t)).then((e=>T(e).then((e=>({blocks:e.blocks}))))),this.paperSessionSecret=(e,t)=>this.fetch(this.url("PaperSessionSecret"),A(e,t)).then((e=>T(e).then((e=>({secret:e.secret}))))),this.paperSessionSecret2=(e,t)=>this.fetch(this.url("PaperSessionSecret2"),A(e,t)).then((e=>T(e).then((e=>({secret:e.secret}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const A=(e={},t={})=>({method:"POST",headers:w({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),T=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n})),_="object"==typeof n.g?n.g.fetch:window.fetch;class O extends k{constructor(e,t){super(e.endsWith("/")?e.slice(0,-1):e,_),this.jwtAuth=t,this._fetch=(e,t)=>{const n={};return this.jwtAuth&&this.jwtAuth.length>0&&(n.Authorization=`BEARER ${this.jwtAuth}`),t.headers=w({},t.headers,n),_(e,t)},this.fetch=this._fetch}}var N=n(58549),S=n(22759),x=n(67640),R=n(59256),M=n(79378),U=n(60578),B=n(76582),P=n(48834).Buffer;const L="function"==typeof atob,D="function"==typeof btoa,q="function"==typeof P,G="function"==typeof TextDecoder?new TextDecoder:void 0,F="function"==typeof TextEncoder?new TextEncoder:void 0,W=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),$=(e=>{let t={};return e.forEach(((e,n)=>t[e]=n)),t})(W),V=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,j=String.fromCharCode.bind(String),H="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),K=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Y=D?e=>btoa(e):q?e=>P.from(e,"binary").toString("base64"):e=>{let t,n,i,s,r="";const o=e.length%3;for(let o=0;o<e.length;){if((n=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255||(s=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=n<<16|i<<8|s,r+=W[t>>18&63]+W[t>>12&63]+W[t>>6&63]+W[63&t]}return o?r.slice(0,o-3)+"===".substring(o):r},J=q?e=>P.from(e).toString("base64"):e=>{let t=[];for(let n=0,i=e.length;n<i;n+=4096)t.push(j.apply(null,e.subarray(n,n+4096)));return Y(t.join(""))},z=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?j(192|t>>>6)+j(128|63&t):j(224|t>>>12&15)+j(128|t>>>6&63)+j(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return j(240|t>>>18&7)+j(128|t>>>12&63)+j(128|t>>>6&63)+j(128|63&t)},Z=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Q=q?e=>P.from(e,"utf8").toString("base64"):F?e=>J(F.encode(e)):e=>Y(e.replace(Z,z)),X=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,ee=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return j(55296+(t>>>10))+j(56320+(1023&t));case 3:return j((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return j((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},te=L?e=>atob(K(e)):q?e=>P.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!V.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,n,i,s="";for(let r=0;r<e.length;)t=$[e.charAt(r++)]<<18|$[e.charAt(r++)]<<12|(n=$[e.charAt(r++)])<<6|(i=$[e.charAt(r++)]),s+=64===n?j(t>>16&255):64===i?j(t>>16&255,t>>8&255):j(t>>16&255,t>>8&255,255&t);return s},ne=q?e=>H(P.from(e,"base64")):e=>H(te(e).split("").map((e=>e.charCodeAt(0)))),ie=q?e=>P.from(e,"base64").toString("utf8"):G?e=>G.decode(ne(e)):e=>te(e).replace(X,ee),se=(e,t=!1)=>t?(e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")))(Q(e)):Q(e),re=e=>ie(K(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))));var oe=function(){return oe=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},oe.apply(this,arguments)};function ae(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function ce(e,t){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(s=2&a[0]?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var le=function(){function e(e){this.prefix=fe,this.address=(null==e?void 0:e.address)?e.address.toLowerCase():"",this.claims=(null==e?void 0:e.claims)?e.claims:{app:"",iat:0,exp:0,v:ge},this.signature=(null==e?void 0:e.signature)?e.signature:"",this.extra=(null==e?void 0:e.extra)?e.extra:""}return e.prototype.setIssuedAtNow=function(){this.claims.iat=Math.round((new Date).getTime()/1e3)},e.prototype.setExpiryIn=function(e){this.claims.exp=Math.round((new Date).getTime()/1e3)+e},e.prototype.validateClaims=function(){return he(this.claims)},e.prototype.messageDigest=function(){var e,t=this.validateClaims();if(t.err)throw t.err;return x.arrayify((e=this.messageTypedData(),M.E.hash(e.domain,e.types,e.message)))},e.prototype.messageTypedData=function(){var e={domain:oe({},me),types:{Claims:[]},message:{}};return this.claims.app&&this.claims.app.length>0&&(e.types.Claims.push({name:"app",type:"string"}),e.message.app=this.claims.app),this.claims.iat&&this.claims.iat>0&&(e.types.Claims.push({name:"iat",type:"int64"}),e.message.iat=this.claims.iat),this.claims.exp&&this.claims.exp>0&&(e.types.Claims.push({name:"exp",type:"int64"}),e.message.exp=this.claims.exp),this.claims.n&&this.claims.n>0&&(e.types.Claims.push({name:"n",type:"uint64"}),e.message.n=this.claims.n),this.claims.typ&&this.claims.typ.length>0&&(e.types.Claims.push({name:"typ",type:"string"}),e.message.typ=this.claims.typ),this.claims.ogn&&this.claims.ogn.length>0&&(e.types.Claims.push({name:"ogn",type:"string"}),e.message.ogn=this.claims.ogn),this.claims.v&&this.claims.v.length>0&&(e.types.Claims.push({name:"v",type:"string"}),e.message.v=this.claims.v),e},e}(),he=function(e){if(""===e.app)return{ok:!1,err:new Error("claims: app is empty")};var t=Math.round((new Date).getTime()/1e3),n=31536300;return""===e.v?{ok:!1,err:new Error("claims: ethauth version is empty")}:e.iat&&0!==e.iat&&(e.iat>t+300||e.iat<t-n)?{ok:!1,err:new Error("claims: iat is invalid")}:e.exp<t-300||e.exp>t+n?{ok:!1,err:new Error("claims: token has expired")}:{ok:!0}},de=function(e,t,n){return ae(void 0,void 0,void 0,(function(){var e,t;return ce(this,(function(i){return e=n.messageDigest(),"0x"===(t=U.verifyMessage(e,n.signature)).slice(0,2)&&42===t.length&&t.toLowerCase()===n.address.toLowerCase()?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}))}))},ue=function(e,t,n){return ae(void 0,void 0,void 0,(function(){var t,i,s;return ce(this,(function(r){switch(r.label){case 0:return e&&void 0!==e?(t=n.messageDigest(),[4,e.getCode(n.address)]):[2,{isValid:!1}];case 1:if("0x"===(i=r.sent())||i.length<=2)throw new Error("ValidateContractAccountProof failed. unable to fetch wallet contract code");return s=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],[4,new S.CH(n.address,s,e).isValidSignature(t,x.arrayify(n.signature))];case 2:return r.sent()===pe?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}}))}))},pe="0x1626ba7e",ge="1",fe="eth",me={name:"ETHAuth",version:ge},we=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;this.configJsonRpcProvider=function(e){return ae(n,void 0,void 0,(function(){var t;return ce(this,(function(n){switch(n.label){case 0:return this.provider=new B.JsonRpcProvider(e),[4,this.provider.send("net_version",[])];case 1:if(t=n.sent(),this.chainId=parseInt(t),!this.chainId||0===this.chainId||NaN===this.chainId)throw new Error("ethauth: unable to get chainId");return this.ethereumJsonRpcURL=e,[2]}}))}))},this.configValidators=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0==e.length)throw new Error("validators list is empty");n.validators=e},this.encodeProof=function(e,t){return void 0===t&&(t=!1),ae(n,void 0,void 0,(function(){var n,i;return ce(this,(function(s){switch(s.label){case 0:if(42!==e.address.length||"0x"!==e.address.slice(0,2))throw new Error("ethauth: invalid address");if(""===e.signature||"0x"!==e.signature.slice(0,2))throw new Error("ethauth: invalid signature");if(e.extra&&"0x"!==e.extra.slice(0,2))throw new Error("ethauth: invalid extra encoding, expecting hex data");return[4,this.validateProof(e,t)];case 1:if(!s.sent())throw new Error("ethauth: proof is invalid");return n=JSON.stringify(e.claims),i=fe+"."+e.address.toLowerCase()+"."+se(n,!0)+"."+e.signature,e.extra&&e.extra.length>0&&(i+="."+e.extra),[2,i]}}))}))},this.decodeProof=function(e,t){return void 0===t&&(t=!1),ae(n,void 0,void 0,(function(){var n,i,s,r,o,a,c,l,h;return ce(this,(function(d){switch(d.label){case 0:if((n=e.split(".")).length<4||n.length>5)throw new Error("ethauth: invalid proof string");if(i=n[0],s=n[1],r=n[2],o=n[3],a=n[4],i!==fe)throw new Error("ethauth: not an ethauth proof");return c=re(r),l=JSON.parse(c),h=new le({address:s,claims:l,signature:o,extra:a}),[4,this.validateProof(h,t)];case 1:if(!d.sent())throw new Error("ethauth: proof is invalid");return[2,h]}}))}))},this.validateProof=function(e,t){return void 0===t&&(t=!1),ae(n,void 0,void 0,(function(){var n;return ce(this,(function(i){switch(i.label){case 0:if((n=this.validateProofClaims(e)).err)throw new Error("ethauth: proof claims are invalid ".concat(n.err));return!0===t?[3,2]:[4,this.validateProofSignature(e)];case 1:if(!0!==i.sent())throw new Error("ethauth: proof signature is invalid");i.label=2;case 2:return[2,!0]}}))}))},this.validateProofSignature=function(e){return ae(n,void 0,void 0,(function(){var t,n,i;return ce(this,(function(s){switch(s.label){case 0:t=[],i=0,s.label=1;case 1:if(!(i<this.validators.length))return[3,6];s.label=2;case 2:return s.trys.push([2,4,,5]),[4,(0,this.validators[i])(this.provider,this.chainId,e)];case 3:return!0===(n=s.sent().isValid)?[2,!0]:(t.push(n),[3,5]);case 4:return s.sent(),t.push(!1),[3,5];case 5:return i++,[3,1];case 6:for(i=0;i<t.length;i++)if(t[i])return[2,!0];return[2,!1]}}))}))},this.validateProofClaims=function(e){return e.validateClaims()},0==e.length?this.validators=[de,ue]:this.validators=e},ye=n(10196),ve=n(10528),be=n(90711),Ee=n(19769),Ce=n(99780),Ie=n(88210),ke=n(13390),Ae=n(2222),Te=n(95958),_e=n(34406);const Oe=e=>se(e,!0),Ne=e=>se(JSON.stringify(e),!0),Se=e=>{if(null!=e)return re(e)},xe=e=>{if(null!=e)return JSON.parse(re(e))},Re=e=>"string"==typeof e?x.arrayify(R.keccak256(Ae.Y0(e))):x.arrayify(R.keccak256(e)),Me=(e,t,n)=>Ee.pack(["string","uint256","address","bytes32"],["",t,e,n]),Ue=(e,t,n)=>R.keccak256(Me(e,t,n)),Be=()=>"undefined"==typeof window&&"object"==typeof _e,Pe=()=>!Be(),Le=e=>{const t=e.split(".");if(3!==t.length)throw new Error("invalid jwt");return JSON.parse(re(t[1]))};function De(){return De=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},De.apply(this,arguments)}var qe;!function(e){e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DISABLED=5]="DISABLED"}(qe||(qe={}));class Ge{constructor(e){this.config=e,this.logLevel=void 0,this.configure(e)}configure(e){switch(this.config=De({},this.config,e),this.config.logLevel){case"DEBUG":this.logLevel=qe.DEBUG;break;case"INFO":default:this.logLevel=qe.INFO;break;case"WARN":this.logLevel=qe.WARN;break;case"ERROR":this.logLevel=qe.ERROR;break;case"DISABLED":this.logLevel=qe.DISABLED}void 0===this.config.silence&&(this.config.silence=!1)}debug(e,...t){!0!==this.config.silence&&this.logLevel===qe.DEBUG&&console.log(e,...t)}info(e,...t){!0!==this.config.silence&&this.logLevel<=qe.INFO&&console.log(e,...t)}warn(e,...t){!0!==this.config.silence&&this.logLevel<=qe.WARN&&(console.warn(e,...t),this.config.onwarn&&this.config.onwarn(e,t))}error(e,...t){!0!==this.config.silence&&this.logLevel<=qe.ERROR&&(console.error(e,...t),this.config.onerror&&this.config.onerror(e,t))}}const Fe=new Ge({logLevel:"INFO",silence:!0}),We=e=>Fe.configure(e);function $e(e,t){return function(...n){const i=Array.prototype.slice.call(n);return new Promise((async(n,s)=>{try{i.push(((e,t)=>e?s(e):n(t))),await e.apply(t,i)}catch(e){s(e)}}))}}const Ve=(e=0,t=Number.MAX_SAFE_INTEGER)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e);function je(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(JSON.stringify(t))}`}function He(e){const t=e.split("&"),n={};for(const e of t){const t=e.split("=");n[decodeURIComponent(t[0])]=JSON.parse(decodeURIComponent(t[1]))}return n}const Ke=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\d.]+/);return t&&t.length>0?t[0].trim():""},Ye=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\s\d]+/);return t&&t.length>0?t[0].trim():""},Je=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\d.\-:\/]+/);return t&&t.length>0?t[0].trim():""},ze=e=>new Promise((t=>{const n=setTimeout((()=>{clearTimeout(n),t()}),e)})),Ze=e=>{const t=De({},e.types);return delete t.EIP712Domain,M.E.hash(e.domain,t,e.message)},Qe=e=>x.arrayify(Ze(e)),{defineReadOnly:Xe,getStatic:et,resolveProperties:tt,checkProperties:nt,shallowCopy:it,deepCopy:st}=Te,rt=e=>e.replace(/([^:]\/)\/+/g,"$1");function ot(e){return null!=e&&(ve.O$.isBigNumber(e)||"number"==typeof e&&e%1==0||"string"==typeof e&&!!e.match(/^-?[0-9]+$/)||x.isHexString(e)||"bigint"==typeof e||x.isBytes(e))}var at=n(99268),ct=n(87581);function lt(){return lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},lt.apply(this,arguments)}const ht=e=>((e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const o=i.map((e=>e.name)).sort(),a=o.filter(((e,t)=>o.indexOf(e)!==t));if(a.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${a}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l&&t)throw new Error("invalid network config: AuthChain must be set")})(e,!0,t),e))(dt(e)),dt=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},ut=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let pt;var gt;(gt=pt||(pt={}))[gt.MAINNET=1]="MAINNET",gt[gt.ROPSTEN=3]="ROPSTEN",gt[gt.RINKEBY=4]="RINKEBY",gt[gt.GOERLI=5]="GOERLI",gt[gt.KOVAN=42]="KOVAN",gt[gt.POLYGON=137]="POLYGON",gt[gt.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",gt[gt.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",gt[gt.BSC=56]="BSC",gt[gt.BSC_TESTNET=97]="BSC_TESTNET",gt[gt.OPTIMISM=10]="OPTIMISM",gt[gt.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",gt[gt.ARBITRUM=42161]="ARBITRUM",gt[gt.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",gt[gt.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",gt[gt.AVALANCHE=43114]="AVALANCHE",gt[gt.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",gt[gt.FANTOM=250]="FANTOM",gt[gt.FANTOM_TESTNET=4002]="FANTOM_TESTNET",gt[gt.GNOSIS=100]="GNOSIS",gt[gt.AURORA=1313161554]="AURORA",gt[gt.AURORA_TESTNET=1313161556]="AURORA_TESTNET",gt[gt.BASE_GOERLI=84531]="BASE_GOERLI";const ft=e=>ut("https://${network}-indexer.sequence.app",{network:e}),mt=e=>ut("https://${network}-relayer.sequence.app",{network:e}),wt=e=>ut("https://nodes.sequence.app/${network}",{network:e}),yt={[pt.MAINNET]:{chainId:pt.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[pt.ROPSTEN]:{chainId:pt.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[pt.RINKEBY]:{chainId:pt.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[pt.GOERLI]:{chainId:pt.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[pt.KOVAN]:{chainId:pt.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[pt.POLYGON]:{chainId:pt.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[pt.POLYGON_MUMBAI]:{chainId:pt.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[pt.POLYGON_ZKEVM]:{chainId:pt.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[pt.BSC]:{chainId:pt.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[pt.BSC_TESTNET]:{chainId:pt.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[pt.OPTIMISM]:{chainId:pt.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[pt.OPTIMISM_TESTNET]:{chainId:pt.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[pt.ARBITRUM]:{chainId:pt.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[pt.ARBITRUM_GOERLI]:{chainId:pt.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[pt.ARBITRUM_NOVA]:{chainId:pt.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[pt.AVALANCHE]:{chainId:pt.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[pt.AVALANCHE_TESTNET]:{chainId:pt.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[pt.FANTOM]:{chainId:pt.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[pt.FANTOM_TESTNET]:{chainId:pt.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[pt.GNOSIS]:{chainId:pt.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[pt.AURORA]:{chainId:pt.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[pt.AURORA_TESTNET]:{chainId:pt.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[pt.BASE_GOERLI]:{chainId:pt.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},vt=(ht([lt({},yt[pt.MAINNET],{rpcUrl:wt("mainnet"),relayer:{url:mt("mainnet")},indexerUrl:ft("mainnet")}),lt({},yt[pt.POLYGON],{rpcUrl:wt("polygon"),relayer:{url:mt("polygon")},indexerUrl:ft("polygon"),isDefaultChain:!0,isAuthChain:!0}),lt({},yt[pt.BSC],{rpcUrl:wt("bsc"),indexerUrl:ft("bsc"),relayer:{url:mt("bsc")}}),lt({},yt[pt.AVALANCHE],{rpcUrl:wt("avalanche"),indexerUrl:ft("avalanche"),relayer:{url:mt("avalanche")}}),lt({},yt[pt.ARBITRUM],{rpcUrl:wt("arbitrum"),indexerUrl:ft("arbitrum"),relayer:{url:mt("arbitrum")}}),lt({},yt[pt.ARBITRUM_NOVA],{rpcUrl:wt("arbitrum-nova"),indexerUrl:ft("arbitrum-nova"),relayer:{url:mt("arbitrum-nova")}}),lt({},yt[pt.OPTIMISM],{rpcUrl:wt("optimism"),indexerUrl:ft("optimism"),relayer:{url:mt("optimism")}}),lt({},yt[pt.POLYGON_ZKEVM],{rpcUrl:wt("polygon-zkevm"),indexerUrl:ft("polygon-zkevm"),relayer:{url:mt("polygon-zkevm")}}),lt({},yt[pt.GNOSIS],{rpcUrl:wt("gnosis"),indexerUrl:ft("gnosis"),relayer:{url:mt("gnosis")}})]),ht([lt({},yt[pt.RINKEBY],{rpcUrl:wt("rinkeby"),relayer:{url:mt("rinkeby")},indexerUrl:ft("rinkeby")}),lt({},yt[pt.GOERLI],{rpcUrl:wt("goerli"),relayer:{url:mt("goerli")},indexerUrl:ft("goerli")}),lt({},yt[pt.POLYGON_MUMBAI],{rpcUrl:wt("mumbai"),relayer:{url:mt("mumbai")},indexerUrl:ft("mumbai"),isDefaultChain:!0,isAuthChain:!0}),lt({},yt[pt.BSC_TESTNET],{rpcUrl:wt("bsc-testnet"),relayer:{url:mt("bsc-testnet")},indexerUrl:ft("bsc-testnet")}),lt({},yt[pt.ARBITRUM_GOERLI],{rpcUrl:wt("arbitrum-goerli"),relayer:{url:mt("arbitrum-goerli")},indexerUrl:ft("arbitrum-goerli")}),lt({},yt[pt.BASE_GOERLI],{rpcUrl:wt("base-goerli"),relayer:{url:mt("base-goerli")},indexerUrl:ft("base-goerli")})]),"2.0");function bt(){return bt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},bt.apply(this,arguments)}let Et;function Ct(e,t){return e.reduce((function(e,n,i){return t(n,i)?e[0].push(n):e[1].push(n),e}),[[],[]])}B.JsonRpcProvider,function(e){e.ethCall="eth_call",e.ethGetBalance="eth_getBalance",e.ethGetCode="eth_getCode"}(Et||(Et={}));class It{constructor(e){var t=this;if(this.batchableJsonRpcMethods=[Et.ethCall,Et.ethGetCode,Et.ethGetBalance],this.multicallInterface=new at.vU(m.sequenceUtils.abi),this.options=void 0,this.timeout=void 0,this.queue=[],this.scheduleExecution=()=>{this.queue.length>0&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.run,this.options.timeWindow))},this.handle=(e,t,n)=>this.batchableJsonRpcMethods.find((e=>e===t.method))?(this.queue.push({request:t,callback:n,next:e}),this.options.verbose&&console.log("Scheduling call",t.method),void this.scheduleExecution()):(this.options.verbose&&console.log("Forwarded call",t.method),e(t,n)),this.run=async function(){t.options.verbose&&console.log("Processing multicall");const e=Math.min(t.options.batchSize,t.queue.length);if(0===e)return;if(1===e)return t.forward(t.queue[0]),t.queue=[],void(t.options.verbose&&console.log("Skip multicall, single item"));t.options.verbose&&console.log("Resolving",e);var n=t.queue.slice(0,e);t.queue=e===t.queue.length?[]:t.queue.slice(e),t.options.verbose&&console.log("Updated queue",t.queue.length),0!==t.queue.length&&t.scheduleExecution();const i=n[0].next;let s;var[n,r]=Ct(n,(e=>{try{if(e.next!==i)return!1;switch(e.request.method){case Et.ethCall:if(e.request.params[0].from||e.request.params[0].gasPrice||e.request.params[0].value)return!1;case Et.ethGetBalance:case Et.ethGetCode:const i=function(e){if(void 0===e)return"latest";switch(e){case"earliest":case"latest":case"pending":return e}return ve.O$.from(e)}(e.request.params[1]);if(void 0===s&&(s=i),(t=i)!==(n=s)&&!(ve.O$.isBigNumber(t)?ve.O$.isBigNumber(n)&&t.eq(n):!ve.O$.isBigNumber(n)&&t===n))return!1}return!0}catch(e){return!1}var t,n}));if(0!==r.length&&(t.options.verbose&&console.log("Forwarding incompatible calls",r.length),t.forward(r),0===n.length))return;let o=n.map((e=>{try{switch(e.request.method){case Et.ethCall:return{delegateCall:!1,revertOnError:!1,target:e.request.params[0].to,data:e.request.params[0].data,gasLimit:e.request.params[0].gas?e.request.params[0].gas:0,value:0};case Et.ethGetCode:return{delegateCall:!1,revertOnError:!1,target:t.options.contract,gasLimit:0,value:0,data:t.multicallInterface.encodeFunctionData(t.multicallInterface.getFunction("callCode"),[e.request.params[0]])};case Et.ethGetBalance:return{delegateCall:!1,revertOnError:!1,target:t.options.contract,gasLimit:0,value:0,data:t.multicallInterface.encodeFunctionData(t.multicallInterface.getFunction("callBalanceOf"),[e.request.params[0]])};default:return null}}catch(e){return null}}));var[n,r]=Ct(n,((e,t)=>void 0!==o[t]));if(o=o.filter((e=>e)),0!==r.length&&(t.options.verbose&&console.log("Forwarding calls on error",r.length),t.forward(r),0===n.length))return;let a;try{a=t.multicallInterface.encodeFunctionData(t.multicallInterface.getFunction("multiCall"),[o])}catch(e){return void t.forward(n)}const c=Ve(),l=await async function(e,t){try{return await e}catch(e){return t instanceof Function?t(e):t}}($e(i)({id:c,jsonrpc:vt,method:Et.ethCall,params:[{to:t.options.contract,value:0,data:a},ve.O$.isBigNumber(s)?s.toNumber():s]}),(e=>({jsonrpc:vt,id:c,result:void 0,error:e})));if(l.error)return t.forward(n);let h;try{h=t.multicallInterface.decodeFunctionResult(t.multicallInterface.getFunction("multiCall"),l.result)}catch(e){return void t.forward(n)}t.options.verbose&&console.log("Got response for",n.length),n.forEach(((e,n)=>{if(h[0][n])switch(e.request.method){case Et.ethCall:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:h[1][n]});break;case Et.ethGetCode:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:Ce.$.decode(["bytes"],h[1][n])[0]});break;case Et.ethGetBalance:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:Ce.$.decode(["uint256"],h[1][n])[0]})}else t.forward(e)}))},this.options=e?bt({},It.DefaultOptions,e):It.DefaultOptions,this.options.batchSize<=0)throw new Error(`Invalid batch size of ${this.options.batchSize}`)}forward(e){Array.isArray(e)?e.forEach((e=>e.next(e.request,e.callback))):e.next(e.request,e.callback)}static isMulticall(e){return e&&void 0!==e.handle&&void 0!==e.conf&&It.isMulticallOptions(e.options)}static isMulticallOptions(e){return void 0!==e&&void 0!==e.batchSize&&void 0!==e.timeWindow&&void 0!==e.contract}}It.DefaultOptions=bt({},{batchSize:50,timeWindow:50,contract:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",verbose:!1});const kt=["getNetwork","getBlockNumber","getGasPrice","getTransactionCount","getStorageAt","sendTransaction","estimateGas","getBlock","getTransaction","getTransactionReceipt","getLogs","emit","litenerCount","addListener","removeListener","waitForTransaction","detectNetwork","getBlockWithTransactions"];class At extends B.BaseProvider{constructor(e,t){var n;super(e.getNetwork()),n=this,this.provider=e,this.multicall=void 0,this.listenerCount=this.provider.listenerCount,this.getResolver=async function(e){const t=n.provider;if(t.getResolver){const i=await t.getResolver(await e);return i?new B.Resolver(n,i.address,i.name):null}return t.getResolver(await e)},this.next=async function(e,t){try{switch(e.method){case Et.ethCall:n.callback(e,t,await n.provider.call(e.params[0],e.params[1]));break;case Et.ethGetCode:n.callback(e,t,await n.provider.getCode(e.params[0],e.params[1]));break;case Et.ethGetBalance:n.callback(e,t,await n.provider.getBalance(e.params[0],e.params[1]))}}catch(i){n.callback(e,t,void 0,i)}},this.multicall=It.isMulticall(t)?t:new It(t),kt.forEach((t=>{void 0!==e[t]&&(this[t]=(...n)=>e[t](...n))}))}callback(e,t,n,i){t(i,{jsonrpc:vt,id:e.id,result:n,error:i})}async call(e,t){return this.rpcCall(Et.ethCall,e,t)}async getCode(e,t){return this.rpcCall(Et.ethGetCode,e,t)}async getBalance(e,t){return this.rpcCall(Et.ethGetBalance,e,t)}async rpcCall(e,...t){const n=Ve();return(await $e(this.multicall.handle)(this.next,{jsonrpc:vt,id:n,method:e,params:t})).result}}var Tt=Object.freeze({__proto__:null,ProxyMethods:kt,MulticallProvider:At,MulticallExternalProvider:class{constructor(e,t){if(this.provider=e,this.multicall=void 0,this.multicall=It.isMulticall(t)?t:new It(t),e.send){const t=async function(t,n){e.send(t,n)};this.send=(e,n)=>{this.multicall.handle(t,e,n)}}if(e.sendAsync){const t=async function(t,n){e.sendAsync(t,n)};this.sendAsync=(e,n)=>{this.multicall.handle(t,e,n)}}}get isMetaMask(){return this.provider.isMetaMask}get isStatus(){return this.provider.isStatus}},multicallMiddleware:e=>t=>{const n=It.isMulticall(e)?e:new It(e);return(e,i)=>n.handle(t,e,i)}});const _t="0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3",Ot=10,Nt="@sequence.config.imageHashes",St=e=>`@sequence.config.${e}`;let xt;try{xt=localStorage}catch(e){const t=new Map;xt={getItem:e=>{var n;return null!=(n=t.get(e))?n:null},setItem:(e,n)=>t.set(e,n),removeItem:e=>t.delete(e)}}function Rt(e){var t;const n=JSON.parse(null!=(t=xt.getItem(St(e)))?t:"null");return n?(Mt(e),n):void 0}function Mt(e){var t;let n=JSON.parse(null!=(t=xt.getItem(Nt))?t:"[]");for(n=n.filter((t=>t!==e)),n.push(e);n.length>Ot;)xt.removeItem(St(n.shift()));xt.setItem(Nt,JSON.stringify(n))}const Ut=async(e,t)=>{const n={threshold:e,signers:[]};if(t.forEach((async e=>{n.signers.push({weight:e.weight,address:ye.E.isSigner(e.signer)?await e.signer.getAddress():e.signer})})),!Bt(n))throw new Error("wallet config is not usable");return n},Bt=e=>e.signers.reduce(((e,t)=>ve.O$.from(t.weight).add(e)),be._Y).gte(ve.O$.from(e.threshold)),Pt=(e,t)=>{if(0===t.length)return!0;const n=e.signers.map((e=>N.getAddress(e.address))),i=t.map((e=>N.getAddress(e)));let s=!0;return i.forEach((e=>{n.includes(e)||(s=!1)})),s},Lt=(e,t,n=!1)=>{if("string"==typeof e){const n=R.keccak256(Ee.pack(["bytes","bytes32"],[_t,x.hexZeroPad(t.mainModule,32)])),i=R.keccak256(Ee.pack(["bytes1","address","bytes32","bytes32"],["0xff",t.factory,e,n]));return N.getAddress(x.hexDataSlice(i,12))}return e.address&&!n?e.address:Lt(Dt(e),t)},Dt=e=>{const t=(e=qt(e)).signers.reduce(((e,t)=>R.keccak256(Ce.$.encode(["bytes32","uint8","address"],[e,t.weight,t.address]))),Ee.pack(["uint256"],[e.threshold]));return function(e,t){xt.setItem(St(e),JSON.stringify(t)),Mt(e)}(t,e),t},qt=e=>{e.signers.sort(((e,t)=>Ft(e.address,t.address))),e.signers.forEach((e=>e.address=N.getAddress(e.address))),e.address&&(e.address=N.getAddress(e.address));const t=e.signers.map((e=>e.address));if(t.filter(((e,n)=>t.indexOf(e)!==n)).length>0)throw new Error("invalid wallet config: duplicate signer addresses detected in the config, ${signerDupes}");return e},Gt=(e,t)=>Dt(e)===Dt(t),Ft=(e,t)=>{const n=ve.O$.from(e),i=ve.O$.from(t);return n.lt(i)?-1:n.eq(i)?0:1};function Wt(e,t){const n=e=>({weight:ve.O$.from(e.weight).toNumber(),address:N.getAddress(e.address)}),i=e.signers.map(n),s=t.set?t.set.map(n):[],r=t.del?t.del.map((e=>N.getAddress(e.address))):[],o=s.map((e=>e.address)),a=i.filter((e=>-1===r.indexOf(e.address)&&-1===o.indexOf(e.address))).concat(...s);return qt({address:e.address,threshold:t.threshold?ve.O$.from(t.threshold).toNumber():e.threshold,signers:a})}function $t(e,t){return qt({threshold:ve.O$.from(e).toNumber(),signers:t.map((e=>({weight:ve.O$.from(e.weight).toNumber(),address:N.getAddress(e.address)})))})}class Vt{constructor(){this.findCurrentConfig=void 0,this.findLastWalletOfInitialSigner=void 0}}function jt(){return jt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},jt.apply(this,arguments)}class Ht{constructor(e){var t=this;this.authProvider=e,this.findCurrentConfig=async function(e){const{provider:n,context:i,ignoreIndex:s,requireIndex:r,skipCache:o}=e,a=N.getAddress(e.address);if(Fe.info(`[findCurrentConfig] address:${a}, ignoreIndex:${s}, requireIndex:${r}`),r&&s)throw Error("findCurrentConfig: can't ignore index and require index");const c=n.getNetwork(),l=e.knownConfigs?e.knownConfigs:[],{imageHash:h,config:d}=await t.findCurrentImageHash(i,n,a,l,o);if(void 0===h)return{config:void 0};const u=await t.findConfigForImageHash(i,h,d?[d,...l]:l,o),p=(await c).chainId;return{config:u?jt({},u,{chainId:p,address:a}):void 0}},this.findLastWalletOfInitialSigner=async function(e){const{signer:n,context:i,ignoreIndex:s,requireIndex:r}=e;if(Fe.info(`[findLastWalletOfInitialSigner] signer:${n}`),r&&s)throw Error("findCurrentConfig: can't ignore index and require index");const o=new S.CH(i.sequenceUtils,m.sequenceUtils.abi,t.authProvider),a=s?0:(await o.lastSignerUpdate(n)).toNumber();if(r&&0===a)return{wallet:void 0};const c=o.filters.RequiredSigner(null,n),l=await t.findLatestLog(t.authProvider,jt({},c,{fromBlock:a,toBlock:0!==a?a:"latest"}));return void 0===l?(Fe.warn("publishConfig: wallet config last log not found"),{wallet:void 0}):{wallet:o.interface.decodeEventLog("RequiredSigner",l.data,l.topics)._wallet}},this.findConfigForImageHash=async function(e,n,i=[],s=!1){const r=i.find((e=>Dt(e)===n));if(r)return r;if(!s){const e=Rt(n);if(e)return e}Fe.info(`[findConfigForImageHash] image:${n}`);const o=new S.CH(e.sequenceUtils,m.sequenceUtils.abi,t.authProvider),a=(await o.lastImageHashUpdate(n)).toNumber(),c=o.filters.RequiredConfig(void 0,n),l=await t.findLatestLog(t.authProvider,jt({},c,{fromBlock:a,toBlock:0!==a?a:"latest"}));if(void 0===l)return;const h=o.interface.decodeEventLog("RequiredConfig",l.data,l.topics),d=Ce.$.decode(["tuple(\n        uint256 weight,\n        address signer\n      )[]"],h._signers)[0],u={threshold:ve.O$.from(h._threshold).toNumber(),signers:d.map((e=>({address:e.signer,weight:ve.O$.from(e.weight).toNumber()})))};return Dt(u),u},this.findCurrentImageHash=async function(e,n,i,s=[],r){Fe.info(`[findCurrentImageHash] address:${i}`);const o=new S.CH(i,m.mainModuleUpgradable.abi,n),a=await o.functions.imageHash.call([]).catch((()=>[]));if(void 0!==a[0])return{imageHash:a[0],config:r?void 0:Rt(a[0])};const c=N.getAddress(i),l=s.find((t=>Lt(t,e,!0)===c));if(l)return{imageHash:Dt(l),config:l};const h=new S.CH(e.sequenceUtils,m.sequenceUtils.abi,t.authProvider),d=await h.knownImageHashes(i);if(d!==Ie.R){if(Lt(d,e)!==i)throw Error("findCurrentImageHash: inconsistent RequireUtils results");return{imageHash:d}}const u=h.filters.RequiredConfig(i),p=await t.findFirstLog(t.authProvider,u);if(void 0!==p){const t=h.interface.decodeEventLog("RequiredConfig",p.data,p.topics),n=Ce.$.decode(["tuple(\n          uint256 weight,\n          address signer\n        )[]"],t._signers)[0],s={threshold:ve.O$.from(t._threshold).toNumber(),signers:n.map((e=>({address:e.signer,weight:ve.O$.from(e.weight).toNumber()})))},r=Dt(s);if(Lt(r,e)===i)return{imageHash:r,config:s}}return{}},this.findLatestLog=async function(e,n){const i="latest"===n.toBlock?await e.getBlockNumber():n.toBlock,s=n.fromBlock;0===s&&Fe.warn(`findLatestLog: expensive getLogs query fromBlock 0 toBlock ${i}`);try{const t=await e.getLogs(jt({},n,{toBlock:i}));return 0===t.length?void 0:t[t.length-1]}catch(r){const o=Math.floor((i-s)/2+s),a=await t.findLatestLog(e,jt({},n,{fromBlock:o,toBlock:i}));return void 0!==a?a:t.findLatestLog(e,jt({},n,{fromBlock:s,toBlock:o}))}},this.findFirstLog=async function(e,n){const i="latest"!==n.toBlock&&n.toBlock?n.toBlock:await e.getBlockNumber(),s=n.fromBlock?n.fromBlock:0;0===s&&Fe.warn(`findFirstLog: expensive getLogs query fromBlock 0 toBlock ${i}`);try{const t=await e.getLogs(jt({},n,{fromBlock:s,toBlock:i}));return 0===t.length?void 0:t[0]}catch(r){const o=Math.floor((i-s)/2+s),a=await t.findFirstLog(e,jt({},n,{fromBlock:s,toBlock:o}));return void 0!==a?a:t.findFirstLog(e,jt({},n,{fromBlock:o,toBlock:i}))}}}}function Kt(e){return void 0!==e.address&&!Yt(e)}function Yt(e){return Jt(e)||zt(e)||Zt(e)}function Jt(e){const t=e;return void 0!==t.signature&&void 0===t.address}function zt(e){const t=e;return void 0!==t.r&&void 0!==t.s&&void 0!==t.v&&void 0!==t.t}function Zt(e){const t=e;return void 0!==t.address&&void 0!==t.signature}let Qt;!function(e){e[e.EOA=0]="EOA",e[e.Address=1]="Address",e[e.Full=2]="Full"}(Qt||(Qt={}));const Xt=e=>{if("string"!=typeof e)return e;const t=e.replace("0x",""),n=ve.O$.from(`0x${t.slice(0,4)}`).toNumber(),i=[];for(let e=4;e<t.length;){const n=ve.O$.from(t.slice(e,e+2)).toNumber();e+=2;const s=ve.O$.from(`0x${t.slice(e,e+2)}`).toNumber();switch(e+=2,n){case Qt.Address:const n=N.getAddress(t.slice(e,e+40));e+=40,i.push({weight:s,address:n});break;case Qt.EOA:const r=x.arrayify(`0x${t.slice(e,e+132)}`);e+=132;const o=x.splitSignature(r.slice(0,65)),a=o.r,c=o.s,l=o.v,h=ve.O$.from(r[r.length-1]).toNumber();i.push({weight:s,signature:r,r:a,s:c,v:l,t:h});break;case Qt.Full:const d=N.getAddress(t.slice(e,e+40));e+=40;const u=ve.O$.from(`0x${t.slice(e,e+4)}`).mul(2).toNumber();e+=4;const p=x.arrayify(`0x${t.slice(e,e+u)}`);e+=u,i.push({weight:s,address:d,signature:p});break;default:throw Error("Signature type not supported")}}return{threshold:n,signers:i}},en=3,tn=e=>{const t=x.arrayify(e.signature);return jt({},e,x.splitSignature(t.slice(0,65)),{t:ve.O$.from(t[t.length-1]).toNumber()})},nn=(e,t)=>{const n=zt(t)?t:tn(t);switch(n.t){case 1:return ke.recoverAddress(e,{r:n.r,s:n.s,v:n.v});case 2:const t=R.keccak256(Ee.pack(["string","bytes32"],["Ethereum Signed Message:\n32",e]));return ke.recoverAddress(t,{r:n.r,s:n.s,v:n.v});default:throw new Error("Unknown signature")}},sn=(...e)=>e.map((e=>"string"==typeof e?Xt(e):e)).reduce(((e,t)=>rn(e,t))),rn=(e,t)=>({threshold:e.threshold,signers:e.signers.map(((e,n)=>Kt(e)?t.signers[n]:e))}),on=e=>{if("string"==typeof e)return on(Xt(e));const t=e.signers.map((e=>{if(Kt(e))return Ee.pack(["uint8","uint8","address"],[Qt.Address,e.weight,e.address]);if(zt(e))return Ee.pack(["uint8","uint8","bytes32","bytes32","uint8","uint8"],[Qt.EOA,e.weight,e.r,e.s,e.v,e.t]);if(Zt(e)){const t=x.arrayify(e.signature).length;return Ee.pack(["uint8","uint8","address","uint16","bytes"],[Qt.Full,e.weight,e.address,t,e.signature])}if(Jt(e))return Ee.pack(["uint8","uint8","bytes"],[Qt.EOA,e.weight,e.signature]);throw Error("Unkwnown signature part type")}));return Ee.pack(["uint16",...Array(t.length).fill("bytes")],[e.threshold,...t])};function an(e,t){if(Kt(e))return e.address;if(Zt(e))return e.address;if(zt(e)||Jt(e))return nn(t,e);throw Error("Unkwnown signature part type")}function cn(e,t,n){const i=e.signers.map((e=>an(e,n)));return{threshold:t.threshold,signers:t.signers.map((t=>{const n=i.indexOf(t.address);return-1!==n?jt({},e.signers[n],{weight:t.weight}):{weight:t.weight,address:t.address}}))}}async function ln(e,t){const n=new Tt.MulticallProvider(e);let i=(await Promise.all(t.signers.map((async(e,t)=>jt({},e,{index:t,isEOA:0===x.arrayify(await n.getCode(e.address)).length}))))).sort(((e,t)=>e.weight-t.weight)),s=0;i=i.map((e=>s>=t.threshold||e.isEOA?e:(s+=e.weight,jt({},e,{willSign:!0})))),s<t.threshold&&(i=i.map((e=>e.willSign||s>=t.threshold?e:(s+=e.weight,jt({},e,{willSign:!0})))));const r=x.arrayify("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a01b02"),o=i.sort(((e,t)=>e.index-t.index));return{threshold:t.threshold,signers:o.map((e=>e.willSign?e.isEOA?{weight:e.weight,signature:r}:{weight:e.weight,address:e.address,signature:on({threshold:1,signers:[{address:U.Wallet.createRandom().address,weight:1},{weight:1,signature:r}]})+x.hexlify(en).substring(2)}:{address:e.address,weight:e.weight}))}}function hn(){return hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},hn.apply(this,arguments)}const dn="v1",un="v0.4.0",pn="3254a537c563d6b612b7ab5365c305664abb5951";let gn,fn,mn,wn,yn,vn,bn;!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e.SEQUENCE_WALLET="SEQUENCE_WALLET",e.ERC20_BRIDGE="ERC20_BRIDGE",e.ERC721_BRIDGE="ERC721_BRIDGE",e.ERC1155_BRIDGE="ERC1155_BRIDGE"}(gn||(gn={})),function(e){e.UNKNOWN="UNKNOWN",e.BLOCK_ADDED="BLOCK_ADDED",e.BLOCK_REMOVED="BLOCK_REMOVED"}(fn||(fn={})),function(e){e.UNKNOWN="UNKNOWN",e.TOKEN_TRANSFER="TOKEN_TRANSFER",e.NATIVE_TOKEN_TRANSFER="NATIVE_TOKEN_TRANSFER",e.SEQUENCE_TXN="SEQUENCE_TXN"}(mn||(mn={})),function(e){e.UNKNOWN="UNKNOWN",e.SEND="SEND",e.RECEIVE="RECEIVE"}(wn||(wn={})),function(e){e.FAILED="FAILED",e.SUCCESSFUL="SUCCESSFUL"}(yn||(yn={})),function(e){e.LegacyTxnType="LegacyTxnType",e.AccessListTxnType="AccessListTxnType",e.DynamicFeeTxnType="DynamicFeeTxnType"}(vn||(vn={})),function(e){e.DESC="DESC",e.ASC="ASC"}(bn||(bn={}));class En{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Indexer/",this.ping=e=>this.fetch(this.url("Ping"),Cn({},e)).then((e=>In(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),Cn({},e)).then((e=>In(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),Cn({},e)).then((e=>In(e).then((e=>({status:e.status}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),Cn({},e)).then((e=>In(e).then((e=>({chainID:e.chainID}))))),this.getEtherBalance=(e,t)=>this.fetch(this.url("GetEtherBalance"),Cn(e,t)).then((e=>In(e).then((e=>({balance:e.balance}))))),this.getTokenBalances=(e,t)=>this.fetch(this.url("GetTokenBalances"),Cn(e,t)).then((e=>In(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTokenSupplies=(e,t)=>this.fetch(this.url("GetTokenSupplies"),Cn(e,t)).then((e=>In(e).then((e=>({page:e.page,contractType:e.contractType,tokenIDs:e.tokenIDs}))))),this.getTokenSuppliesMap=(e,t)=>this.fetch(this.url("GetTokenSuppliesMap"),Cn(e,t)).then((e=>In(e).then((e=>({supplies:e.supplies}))))),this.getBalanceUpdates=(e,t)=>this.fetch(this.url("GetBalanceUpdates"),Cn(e,t)).then((e=>In(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTransactionHistory=(e,t)=>this.fetch(this.url("GetTransactionHistory"),Cn(e,t)).then((e=>In(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.syncBalance=(e,t)=>this.fetch(this.url("SyncBalance"),Cn(e,t)).then((e=>In(e).then((e=>({}))))),this.fetchTransactionReceipt=(e,t)=>this.fetch(this.url("FetchTransactionReceipt"),Cn(e,t)).then((e=>In(e).then((e=>({receipt:e.receipt}))))),this.fetchTransactionReceiptWithFilter=(e,t)=>this.fetch(this.url("FetchTransactionReceiptWithFilter"),Cn(e,t)).then((e=>In(e).then((e=>({receipt:e.receipt}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const Cn=(e={},t={})=>({method:"POST",headers:hn({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),In=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));let kn;!function(e){e.MAINNET="https://mainnet-indexer.sequence.app",e.POLYGON="https://polygon-indexer.sequence.app",e.POLYGON_MUMBAI="https://mumbai-indexer.sequence.app",e.POLYGON_ZKEVM="https://polygon-zkevm-indexer.sequence.app",e.ARBITRUM="https://arbitrum-indexer.sequence.app",e.ARBITRUM_NOVA="https://arbitrum-nova-indexer.sequence.app",e.OPTIMISM="https://optimism-indexer.sequence.app",e.AVALANCHE="https://avalanche-indexer.sequence.app",e.GNOSIS="https://gnosis-indexer.sequence.app",e.BSC="https://bsc-indexer.sequence.app",e.BSC_TESTNET="https://bsc-testnet-indexer.sequence.app",e.GOERLI="https://goerli-indexer.sequence.app"}(kn||(kn={}));const An="object"==typeof n.g?n.g.fetch:window.fetch;class Tn extends En{constructor(e,t){super(e.endsWith("/")?e.slice(0,-1):e,An),this.jwtAuth=t,this._fetch=(e,t)=>{const n={};return this.jwtAuth&&this.jwtAuth.length>0&&(n.Authorization=`BEARER ${this.jwtAuth}`),t.headers=hn({},t.headers,n),An(e,t)},this.fetch=this._fetch}}function _n(){return _n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_n.apply(this,arguments)}const On="v1",Nn="v0.4.0",Sn="5d87d77b951c5d197544d97d75241bf3d02679d9";let xn,Rn,Mn,Un;!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155"}(xn||(xn={})),function(e){e.INT="INT",e.STRING="STRING",e.ARRAY="ARRAY",e.GENERIC="GENERIC"}(Rn||(Rn={})),function(e){e.UNKNOWN="UNKNOWN",e.BUY="BUY",e.SELL="SELL"}(Mn||(Mn={})),function(e){e.DESC="DESC",e.ASC="ASC"}(Un||(Un={}));class Bn{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Metadata/",this.ping=e=>this.fetch(this.url("Ping"),Pn({},e)).then((e=>Ln(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),Pn({},e)).then((e=>Ln(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),Pn({},e)).then((e=>Ln(e).then((e=>({status:e.status}))))),this.getTokenMetadata=(e,t)=>this.fetch(this.url("GetTokenMetadata"),Pn(e,t)).then((e=>Ln(e).then((e=>({tokenMetadata:e.tokenMetadata}))))),this.refreshTokenMetadata=(e,t)=>this.fetch(this.url("RefreshTokenMetadata"),Pn(e,t)).then((e=>Ln(e).then((e=>({status:e.status}))))),this.getTokenMetadataBatch=(e,t)=>this.fetch(this.url("GetTokenMetadataBatch"),Pn(e,t)).then((e=>Ln(e).then((e=>({contractTokenMetadata:e.contractTokenMetadata}))))),this.searchTokenMetadata=(e,t)=>this.fetch(this.url("SearchTokenMetadata"),Pn(e,t)).then((e=>Ln(e).then((e=>({page:e.page,tokenMetadata:e.tokenMetadata}))))),this.searchTokenIDs=(e,t)=>this.fetch(this.url("SearchTokenIDs"),Pn(e,t)).then((e=>Ln(e).then((e=>({page:e.page,tokenIds:e.tokenIds}))))),this.tokenCollectionFilters=(e,t)=>this.fetch(this.url("TokenCollectionFilters"),Pn(e,t)).then((e=>Ln(e).then((e=>({filters:e.filters}))))),this.getContractInfo=(e,t)=>this.fetch(this.url("GetContractInfo"),Pn(e,t)).then((e=>Ln(e).then((e=>({contractInfo:e.contractInfo}))))),this.getContractInfoBatch=(e,t)=>this.fetch(this.url("GetContractInfoBatch"),Pn(e,t)).then((e=>Ln(e).then((e=>({contractInfoMap:e.contractInfoMap}))))),this.searchContractInfo=(e,t)=>this.fetch(this.url("SearchContractInfo"),Pn(e,t)).then((e=>Ln(e).then((e=>({contractInfoList:e.contractInfoList}))))),this.searchContractInfoBatch=(e,t)=>this.fetch(this.url("SearchContractInfoBatch"),Pn(e,t)).then((e=>Ln(e).then((e=>({contractInfoByChain:e.contractInfoByChain}))))),this.searchMetadata=(e,t)=>this.fetch(this.url("SearchMetadata"),Pn(e,t)).then((e=>Ln(e).then((e=>({tokenMetadata:e.tokenMetadata,contractInfo:e.contractInfo}))))),this.getNiftyswapTokenQuantity=(e,t)=>this.fetch(this.url("GetNiftyswapTokenQuantity"),Pn(e,t)).then((e=>Ln(e).then((e=>({quantity:e.quantity}))))),this.getNiftyswapUnitPrices=(e,t)=>this.fetch(this.url("GetNiftyswapUnitPrices"),Pn(e,t)).then((e=>Ln(e).then((e=>({prices:e.prices}))))),this.getNiftyswapUnitPricesWithQuantities=(e,t)=>this.fetch(this.url("GetNiftyswapUnitPricesWithQuantities"),Pn(e,t)).then((e=>Ln(e).then((e=>({prices:e.prices}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const Pn=(e={},t={})=>({method:"POST",headers:_n({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),Ln=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n})),Dn="object"==typeof n.g?n.g.fetch:window.fetch;class qn extends Bn{constructor(e="https://metadata.sequence.app"){super(e.endsWith("/")?e.slice(0,-1):e,Dn)}}function Gn(){return Gn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Gn.apply(this,arguments)}const Fn=e=>((e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const o=i.map((e=>e.name)).sort(),a=o.filter(((e,t)=>o.indexOf(e)!==t));if(a.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${a}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l&&t)throw new Error("invalid network config: AuthChain must be set")})(e,!0,t),e))(Wn(e)),Wn=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},$n=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let Vn;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(Vn||(Vn={}));const jn=e=>$n("https://${network}-indexer.sequence.app",{network:e}),Hn=e=>$n("https://${network}-relayer.sequence.app",{network:e}),Kn=e=>$n("https://nodes.sequence.app/${network}",{network:e}),Yn={[Vn.MAINNET]:{chainId:Vn.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Vn.ROPSTEN]:{chainId:Vn.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Vn.RINKEBY]:{chainId:Vn.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[Vn.GOERLI]:{chainId:Vn.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Vn.KOVAN]:{chainId:Vn.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[Vn.POLYGON]:{chainId:Vn.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[Vn.POLYGON_MUMBAI]:{chainId:Vn.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[Vn.POLYGON_ZKEVM]:{chainId:Vn.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[Vn.BSC]:{chainId:Vn.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[Vn.BSC_TESTNET]:{chainId:Vn.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[Vn.OPTIMISM]:{chainId:Vn.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[Vn.OPTIMISM_TESTNET]:{chainId:Vn.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[Vn.ARBITRUM]:{chainId:Vn.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[Vn.ARBITRUM_GOERLI]:{chainId:Vn.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[Vn.ARBITRUM_NOVA]:{chainId:Vn.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[Vn.AVALANCHE]:{chainId:Vn.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[Vn.AVALANCHE_TESTNET]:{chainId:Vn.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[Vn.FANTOM]:{chainId:Vn.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[Vn.FANTOM_TESTNET]:{chainId:Vn.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[Vn.GNOSIS]:{chainId:Vn.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[Vn.AURORA]:{chainId:Vn.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[Vn.AURORA_TESTNET]:{chainId:Vn.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[Vn.BASE_GOERLI]:{chainId:Vn.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},Jn=(Fn([Gn({},Yn[Vn.MAINNET],{rpcUrl:Kn("mainnet"),relayer:{url:Hn("mainnet")},indexerUrl:jn("mainnet")}),Gn({},Yn[Vn.POLYGON],{rpcUrl:Kn("polygon"),relayer:{url:Hn("polygon")},indexerUrl:jn("polygon"),isDefaultChain:!0,isAuthChain:!0}),Gn({},Yn[Vn.BSC],{rpcUrl:Kn("bsc"),indexerUrl:jn("bsc"),relayer:{url:Hn("bsc")}}),Gn({},Yn[Vn.AVALANCHE],{rpcUrl:Kn("avalanche"),indexerUrl:jn("avalanche"),relayer:{url:Hn("avalanche")}}),Gn({},Yn[Vn.ARBITRUM],{rpcUrl:Kn("arbitrum"),indexerUrl:jn("arbitrum"),relayer:{url:Hn("arbitrum")}}),Gn({},Yn[Vn.ARBITRUM_NOVA],{rpcUrl:Kn("arbitrum-nova"),indexerUrl:jn("arbitrum-nova"),relayer:{url:Hn("arbitrum-nova")}}),Gn({},Yn[Vn.OPTIMISM],{rpcUrl:Kn("optimism"),indexerUrl:jn("optimism"),relayer:{url:Hn("optimism")}}),Gn({},Yn[Vn.POLYGON_ZKEVM],{rpcUrl:Kn("polygon-zkevm"),indexerUrl:jn("polygon-zkevm"),relayer:{url:Hn("polygon-zkevm")}}),Gn({},Yn[Vn.GNOSIS],{rpcUrl:Kn("gnosis"),indexerUrl:jn("gnosis"),relayer:{url:Hn("gnosis")}})]),Fn([Gn({},Yn[Vn.RINKEBY],{rpcUrl:Kn("rinkeby"),relayer:{url:Hn("rinkeby")},indexerUrl:jn("rinkeby")}),Gn({},Yn[Vn.GOERLI],{rpcUrl:Kn("goerli"),relayer:{url:Hn("goerli")},indexerUrl:jn("goerli")}),Gn({},Yn[Vn.POLYGON_MUMBAI],{rpcUrl:Kn("mumbai"),relayer:{url:Hn("mumbai")},indexerUrl:jn("mumbai"),isDefaultChain:!0,isAuthChain:!0}),Gn({},Yn[Vn.BSC_TESTNET],{rpcUrl:Kn("bsc-testnet"),relayer:{url:Hn("bsc-testnet")},indexerUrl:jn("bsc-testnet")}),Gn({},Yn[Vn.ARBITRUM_GOERLI],{rpcUrl:Kn("arbitrum-goerli"),relayer:{url:Hn("arbitrum-goerli")},indexerUrl:jn("arbitrum-goerli")}),Gn({},Yn[Vn.BASE_GOERLI],{rpcUrl:Kn("base-goerli"),relayer:{url:Hn("base-goerli")},indexerUrl:jn("base-goerli")})]),{factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}});class zn{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=Zn(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const Zn=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};let Qn=0;class Xn{constructor(e,t){var n;this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,void 0!==(n=e)&&void 0!==n.send&&void 0!==n.constructor.defaultUrl&&void 0!==n.detectNetwork&&void 0!==n.getSigner&&void 0!==n.perform?this.send=e.send.bind(e):function(e){return void 0!==e&&void 0!==e.sendAsync}(e)?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:"2.0",id:++Qn,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class ei{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class ti{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}class ni{constructor(){this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(!this.singleflightJsonRpcMethods.includes(t.method))return void e(t,n,i);const s=this.requestKey(t.method,t.params||[],i);this.inflight[s]?this.inflight[s].push({id:t.id,callback:n}):(this.inflight[s]=[],e(t,((e,t,i)=>{n(e,t);for(let n=0;n<this.inflight[s].length;n++){const i=this.inflight[s][n];e?i.callback(e,t):t&&i.callback(void 0,{jsonrpc:"2.0",id:i.id,result:t.result})}delete this.inflight[s]}),i))},this.requestKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.inflight={}}}class ii extends B.JsonRpcProvider{constructor(e,t){super(e,null==t?void 0:t.chainId),this._chainId=void 0,this._sender=void 0,this.send=(e,t)=>this._sender.send(e,t),this.fetch=(e,t)=>{const n={method:e,params:t,id:this._nextId++,jsonrpc:"2.0"};return ct.fetchJson(this.connection,JSON.stringify(n),si).then((e=>e),(e=>{throw e}))};const n=null==t?void 0:t.chainId,i=null==t?void 0:t.middlewares,s=null==t?void 0:t.blockCache;this._chainId=n;const r=new zn(null!=i?i:[new ti({chainId:n}),new ni,new ei({defaultChainId:n,blockCache:s})],new Xn(this.fetch,n));this._sender=new Xn(r,n)}async getNetwork(){const e=this._chainId;if(e){const t=Yn[e];return{name:(null==t?void 0:t.name)||"",chainId:e,ensAddress:null==t?void 0:t.ensAddress}}{const e=await this.send("eth_chainId",[]);return this._chainId=ve.O$.from(e).toNumber(),this.getNetwork()}}}function si(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}var ri=n(80221),oi=n(7495),ai=n(42366),ci=n(51906);function li(){return li=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},li.apply(this,arguments)}const hi="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]";function di(...e){const t=Ci(...e);if(void 0===t)throw new Error("Encoding transactions without defined nonce");return ui(t,...e)}function ui(e,...t){return Ce.$.encode(["uint256",hi],[e,Ii(t)])}function pi(...e){const t=Ci(...e);if(void 0===t)throw new Error("Computing hash for transactions without defined nonce");return gi(t,...e)}function gi(e,...t){return R.keccak256(ui(e,...t))}function fi(e,t,...n){return Ue(e,t,pi(...n)).replace(/^0x/,"")}async function mi(e,t,n=!1,i){const s=wi(t),r=(await Promise.all(t.map((e=>e.nonce)))).filter((e=>void 0!==e)).map((e=>ve.O$.from(e))),o=0!==r.length?r.reduce(((e,t)=>e.lt(t)?e:t)):void 0;return Promise.all(s.map((t=>yi(e,t,n,i,o))))}function wi(e){if(!Array.isArray(e)){if("auxiliary"in e){const t=e.auxiliary,n=li({},e);return delete n.auxiliary,t?[n,...wi(t)]:[n]}return[e]}return e.flatMap(wi)}async function yi(e,t,n=!1,i,s){if(bi(t))return t;const r=void 0===t.gasLimit?t.gas:t.gasLimit;if(t.to)return{delegateCall:!1,revertOnError:n,gasLimit:r?await r:i,to:await t.to,value:t.value?await t.value:0,data:await t.data,nonce:s||await t.nonce};{const o=new at.vU(m.mainModule.abi),a=o.encodeFunctionData(o.getFunction("createContract"),[t.data]),c="string"==typeof e?e:e.getAddress();return{delegateCall:!1,revertOnError:n,gasLimit:r?await r:i,to:await c,value:t.value?await t.value:0,data:a,nonce:s||await t.nonce}}}function vi(e){return e.send||e.sendAsync}function bi(e){return void 0!==e.delegateCall||void 0!==e.revertOnError}function Ei(e){return void 0!==e.find((e=>bi(e)))}function Ci(...e){const t=e.find((e=>void 0!==e.nonce));if(!t)return;const n=ve.O$.from(t.nonce);if(e.find((e=>void 0!==e.nonce&&!ve.O$.from(e.nonce).eq(n))))throw new Error("Mixed nonces on Sequence transactions");return t?t.nonce:void 0}function Ii(e){return e.map((e=>{var t;return{delegateCall:!0===e.delegateCall,revertOnError:!0===e.revertOnError,gasLimit:void 0!==e.gasLimit?e.gasLimit:be._Y,target:null!=(t=e.to)?t:ci.d,value:void 0!==e.value?e.value:be._Y,data:void 0!==e.data?e.data:[]}}))}function ki(e,t){return e.map((e=>li({},e,{nonce:t})))}function Ai(e,t,n){const i=new at.vU(m.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:i.encodeFunctionData(i.getFunction("requireNonExpired"),[n])},...t]}function Ti(e,t,n){const i=new at.vU(m.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:i.encodeFunctionData(i.getFunction("requireMinNonce"),[n.address,n.space?_i(n.space,n.nonce):n.nonce])},...t]}function _i(e,t){const n=ve.O$.from(e),i=ve.O$.from(t),s=be.Py.pow(ve.O$.from(96));if(!i.div(s).eq(be._Y))throw new Error("Space already encoded");return i.add(n.mul(s))}function Oi(e){const t=ve.O$.from(e),n=be.Py.pow(ve.O$.from(96));return[t.div(n),t.mod(n)]}function Ni(e){return void 0!==e&&void 0!==e.chainId&&void 0!==e.config&&void 0!==e.context&&void 0!==e.signature&&void 0!==e.transactions&&Array.isArray(e.transactions)&&e.transactions.reduce(((e,t)=>e&&bi(t)),!0)}async function Si(e,t,n){let i=[];if(i=Array.isArray(n)?Ei(n)?wi(n):await mi(t,n):bi(n)?wi([n]):await mi(t,[n]),n.expiration&&(i=Ai(e,i,n.expiration)),n.afterNonce){const s=n.afterNonce;i=Ti(e,i,s.address?{address:s.address,nonce:s.nonce,space:s.space}:{address:t,nonce:s})}return i}function xi(){return xi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},xi.apply(this,arguments)}const Ri=e=>"number"==typeof e?e:e.chainId?e.chainId:ve.O$.from(e).toNumber(),Mi=(e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const o=i.map((e=>e.name)).sort(),a=o.filter(((e,t)=>o.indexOf(e)!==t));if(a.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${a}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l){if(t)throw new Error("invalid network config: AuthChain must be set")}})(e,!0,t),e),Ui=e=>Mi(Bi(e)),Bi=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},Pi=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let Li;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(Li||(Li={}));const Di=e=>Pi("https://${network}-indexer.sequence.app",{network:e}),qi=e=>Pi("https://${network}-relayer.sequence.app",{network:e}),Gi=e=>Pi("https://nodes.sequence.app/${network}",{network:e}),Fi={[Li.MAINNET]:{chainId:Li.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Li.ROPSTEN]:{chainId:Li.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Li.RINKEBY]:{chainId:Li.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[Li.GOERLI]:{chainId:Li.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[Li.KOVAN]:{chainId:Li.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[Li.POLYGON]:{chainId:Li.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[Li.POLYGON_MUMBAI]:{chainId:Li.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[Li.POLYGON_ZKEVM]:{chainId:Li.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[Li.BSC]:{chainId:Li.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[Li.BSC_TESTNET]:{chainId:Li.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[Li.OPTIMISM]:{chainId:Li.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[Li.OPTIMISM_TESTNET]:{chainId:Li.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[Li.ARBITRUM]:{chainId:Li.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[Li.ARBITRUM_GOERLI]:{chainId:Li.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[Li.ARBITRUM_NOVA]:{chainId:Li.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[Li.AVALANCHE]:{chainId:Li.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[Li.AVALANCHE_TESTNET]:{chainId:Li.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[Li.FANTOM]:{chainId:Li.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[Li.FANTOM_TESTNET]:{chainId:Li.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[Li.GNOSIS]:{chainId:Li.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[Li.AURORA]:{chainId:Li.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[Li.AURORA_TESTNET]:{chainId:Li.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[Li.BASE_GOERLI]:{chainId:Li.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},Wi=Ui([xi({},Fi[Li.MAINNET],{rpcUrl:Gi("mainnet"),relayer:{url:qi("mainnet")},indexerUrl:Di("mainnet")}),xi({},Fi[Li.POLYGON],{rpcUrl:Gi("polygon"),relayer:{url:qi("polygon")},indexerUrl:Di("polygon"),isDefaultChain:!0,isAuthChain:!0}),xi({},Fi[Li.BSC],{rpcUrl:Gi("bsc"),indexerUrl:Di("bsc"),relayer:{url:qi("bsc")}}),xi({},Fi[Li.AVALANCHE],{rpcUrl:Gi("avalanche"),indexerUrl:Di("avalanche"),relayer:{url:qi("avalanche")}}),xi({},Fi[Li.ARBITRUM],{rpcUrl:Gi("arbitrum"),indexerUrl:Di("arbitrum"),relayer:{url:qi("arbitrum")}}),xi({},Fi[Li.ARBITRUM_NOVA],{rpcUrl:Gi("arbitrum-nova"),indexerUrl:Di("arbitrum-nova"),relayer:{url:qi("arbitrum-nova")}}),xi({},Fi[Li.OPTIMISM],{rpcUrl:Gi("optimism"),indexerUrl:Di("optimism"),relayer:{url:qi("optimism")}}),xi({},Fi[Li.POLYGON_ZKEVM],{rpcUrl:Gi("polygon-zkevm"),indexerUrl:Di("polygon-zkevm"),relayer:{url:qi("polygon-zkevm")}}),xi({},Fi[Li.GNOSIS],{rpcUrl:Gi("gnosis"),indexerUrl:Di("gnosis"),relayer:{url:qi("gnosis")}})]),$i=(Ui([xi({},Fi[Li.RINKEBY],{rpcUrl:Gi("rinkeby"),relayer:{url:qi("rinkeby")},indexerUrl:Di("rinkeby")}),xi({},Fi[Li.GOERLI],{rpcUrl:Gi("goerli"),relayer:{url:qi("goerli")},indexerUrl:Di("goerli")}),xi({},Fi[Li.POLYGON_MUMBAI],{rpcUrl:Gi("mumbai"),relayer:{url:qi("mumbai")},indexerUrl:Di("mumbai"),isDefaultChain:!0,isAuthChain:!0}),xi({},Fi[Li.BSC_TESTNET],{rpcUrl:Gi("bsc-testnet"),relayer:{url:qi("bsc-testnet")},indexerUrl:Di("bsc-testnet")}),xi({},Fi[Li.ARBITRUM_GOERLI],{rpcUrl:Gi("arbitrum-goerli"),relayer:{url:qi("arbitrum-goerli")},indexerUrl:Di("arbitrum-goerli")}),xi({},Fi[Li.BASE_GOERLI],{rpcUrl:Gi("base-goerli"),relayer:{url:qi("base-goerli")},indexerUrl:Di("base-goerli")})]),{factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}});class Vi{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=ji(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const ji=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};function Hi(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}let Ki=0;class Yi{constructor(e,t){var n;this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,Hi(e)?this.send=e.send.bind(e):void 0!==(n=e)&&void 0!==n.sendAsync?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:"2.0",id:++Ki,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class Ji{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class zi{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}class Zi{constructor(){this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(!this.singleflightJsonRpcMethods.includes(t.method))return void e(t,n,i);const s=this.requestKey(t.method,t.params||[],i);this.inflight[s]?this.inflight[s].push({id:t.id,callback:n}):(this.inflight[s]=[],e(t,((e,t,i)=>{n(e,t);for(let n=0;n<this.inflight[s].length;n++){const i=this.inflight[s][n];e?i.callback(e,t):t&&i.callback(void 0,{jsonrpc:"2.0",id:i.id,result:t.result})}delete this.inflight[s]}),i))},this.requestKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.inflight={}}}class Qi extends B.JsonRpcProvider{constructor(e,t){super(e,null==t?void 0:t.chainId),this._chainId=void 0,this._sender=void 0,this.send=(e,t)=>this._sender.send(e,t),this.fetch=(e,t)=>{const n={method:e,params:t,id:this._nextId++,jsonrpc:"2.0"};return ct.fetchJson(this.connection,JSON.stringify(n),Xi).then((e=>e),(e=>{throw e}))};const n=null==t?void 0:t.chainId,i=null==t?void 0:t.middlewares,s=null==t?void 0:t.blockCache;this._chainId=n;const r=new Vi(null!=i?i:[new zi({chainId:n}),new Zi,new Ji({defaultChainId:n,blockCache:s})],new Yi(this.fetch,n));this._sender=new Yi(r,n)}async getNetwork(){const e=this._chainId;if(e){const t=Fi[e];return{name:(null==t?void 0:t.name)||"",chainId:e,ensAddress:null==t?void 0:t.ensAddress}}{const e=await this.send("eth_chainId",[]);return this._chainId=ve.O$.from(e).toNumber(),this.getNetwork()}}}function Xi(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}function es(){return es=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},es.apply(this,arguments)}function ts(e){return void 0!==e.bundleCreation&&"boolean"==typeof e.bundleCreation||void 0!==e.creationGasLimit&&ot(e.creationGasLimit)||void 0!==e.provider&&(oi.zt.isProvider(e.provider)||"string"==typeof e.provider)}const ns={bundleCreation:!0,creationGasLimit:be.Py.pow(17)};class is{constructor(e){this.provider=void 0,this.bundleCreation=void 0,this.creationGasLimit=void 0;const t=es({},ns,e);this.bundleCreation=t.bundleCreation,this.provider=t.provider,this.creationGasLimit=ve.O$.from(t.creationGasLimit)}async isWalletDeployed(e){if(!this.provider)throw new Error("Bundled creation provider not found");return"0x"!==await this.provider.getCode(e)}prepareWalletDeploy(e,t){const n=new at.vU(m.factory.abi);return{to:t.factory,data:n.encodeFunctionData(n.getFunction("deploy"),[t.mainModule,Dt(e)])}}async prependWalletDeploy(e){const{config:t,context:n,transactions:i,nonce:s,signature:r}=e,o=Lt(t,n),a=new at.vU(m.mainModule.abi),c=async function(){const e=await r;return"string"==typeof e?e:on(e)}();return this.bundleCreation&&!await this.isWalletDeployed(o)?{to:n.guestModule,execute:{transactions:[es({},this.prepareWalletDeploy(t,n),{delegateCall:!1,revertOnError:!1,gasLimit:this.creationGasLimit,value:be._Y}),{delegateCall:!1,revertOnError:!0,gasLimit:be._Y,to:o,value:be._Y,data:a.encodeFunctionData(a.getFunction("execute"),[Ii(i),s,await c])}],nonce:be._Y,signature:"0x"}}:{to:o,execute:{transactions:i,nonce:ve.O$.from(s),signature:await c}}}async prepareTransactions(e,t,n,...i){const s=Ci(...i);if(!s)throw new Error("Unable to prepare transactions without a defined nonce");const{to:r,execute:o}=await this.prependWalletDeploy({config:e,context:t,transactions:i,nonce:s,signature:n}),a=new at.vU(m.mainModule.abi);return{to:r,data:a.encodeFunctionData(a.getFunction("execute"),[Ii(o.transactions),o.nonce,o.signature])}}}const ss=ve.O$.from(8e5),rs={waitPollRate:1e3,deltaBlocksLog:12,fromBlockLog:-1024};function os(e){return void 0!==e.provider&&oi.zt.isProvider(e.provider)}class as extends is{constructor(e){super(e),this.provider=void 0,this.waitPollRate=void 0,this.deltaBlocksLog=void 0,this.fromBlockLog=void 0;const t=es({},rs,e);this.provider=t.provider,this.waitPollRate=t.waitPollRate,this.deltaBlocksLog=t.deltaBlocksLog,this.fromBlockLog=t.fromBlockLog}async simulate(e,...t){var n=this;return(await Promise.all(t.map((async function(t){if(t.gasLimit&&!ve.O$.from(t.gasLimit||0).eq(be._Y))return t.gasLimit;if(t.delegateCall)return ss;if(t.to===e&&!await n.isWalletDeployed(e))return ss;if(!n.provider)throw new Error("signer.provider is not set, but is required");return n.provider.estimateGas({from:e,to:t.to,data:t.data,value:t.value})})))).map((e=>({executed:!0,succeeded:!0,gasUsed:ve.O$.from(e).toNumber(),gasLimit:ve.O$.from(e).toNumber()})))}async getNonce(e,t,n,i){if(!this.provider)throw new Error("provider is not set");const s=Lt(e,t);if("0x"===await this.provider.getCode(s))return 0;void 0===n&&(n=0);const r=new S.CH(s,m.mainModule.abi,this.provider);return _i(n,await r.readNonce(n,{blockTag:i}))}async wait(e,t,n=this.waitPollRate,i=5){var s=this;"string"!=typeof e&&(Fe.info("computing id",e.config,e.context,e.chainId,...e.transactions),e=fi(Lt(e.config,e.context),e.chainId,...e.transactions));let r=!1;const o=async function(e,t){let s=0;for(;!r;){try{return await e()}catch(e){if(s++,void 0!==i&&s>=i)throw Fe.error(`giving up after ${s} failed attempts${t?`: ${t}`:""}`,e),e;Fe.warn(`attempt #${s} failed${t?`: ${t}`:""}`,e)}n>0&&await new Promise((e=>setTimeout(e,n)))}throw new Error(`timed out after ${s} failed attempts${t?`: ${t}`:""}`)},a=async function(){let t=s.fromBlockLog;if(t<0){const e=await o((()=>s.provider.getBlockNumber()),"unable to get latest block number");t=e+t}if("string"!=typeof e)throw new Error("impossible");const i=e.replace("0x","");for(;!r;){const e=await o((()=>s.provider.getBlockNumber()),"unable to get latest block number"),a=await o((()=>s.provider.getLogs({fromBlock:Math.max(0,t-s.deltaBlocksLog),toBlock:e,topics:["0x1f180c27086c7a39ea2a7b25239d1ab92348f07ca7bb59d1438fcf527568f881"]})),`unable to get NonceChange logs for blocks ${Math.max(0,t-s.deltaBlocksLog)} to ${e}`);t=e;const c=(await Promise.all(a.map((e=>o((()=>s.provider.getTransactionReceipt(e.transactionHash)),`unable to get receipt for transaction ${e.transactionHash}`))))).find((e=>e.logs.find((e=>0===e.topics.length&&e.data.replace("0x","")===i||1===e.topics.length&&"0x3dbd1590ea96dd3253a91f24e64e3a502e1225d602a5731357bc12643070ccd7"===e.topics[0]&&e.data.length>=64&&e.data.replace("0x","").startsWith(i)))));if(c)return es({receipt:c},await o((()=>s.provider.getTransaction(c.transactionHash)),`unable to get transaction ${c.transactionHash}`));r||await new Promise((e=>setTimeout(e,n)))}throw new Error(`Timeout waiting for transaction receipt ${e}`)};return void 0!==t?Promise.race([a(),new Promise(((n,i)=>setTimeout((()=>{r=!0,i(`Timeout waiting for transaction receipt ${e}`)}),t)))]):a()}}function cs(e){return void 0!==e.signer&&ye.E.isSigner(e.signer)}class ls extends as{constructor(e){if(super(ye.E.isSigner(e)?{provider:e.provider}:es({},e,{provider:e.signer.provider})),this.signer=void 0,this.txnOptions=void 0,this.signer=ye.E.isSigner(e)?e:e.signer,!this.signer.provider)throw new Error("Signer must have a provider")}async deployWallet(e,t){const n=this.prepareWalletDeploy(e,t);return this.signer.sendTransaction(es({},n,{gasLimit:be.Py.pow(17)}))}async getFeeOptions(e,t,...n){return{options:[]}}async gasRefundOptions(e,t,...n){const{options:i}=await this.getFeeOptions(e,t,...n);return i}setTransactionOptions(e){this.txnOptions=e}async relay(e,t,n=!0){if(void 0!==t&&Fe.warn("LocalRelayer doesn't accept fee quotes"),!e.context.guestModule||42!==e.context.guestModule.length)throw new Error("LocalRelayer requires the context.guestModule address");const{to:i,execute:s}=await this.prependWalletDeploy(e),r=new at.vU(m.mainModule.abi),o=r.encodeFunctionData(r.getFunction("execute"),[Ii(s.transactions),s.nonce,s.signature]),a=this.signer.sendTransaction(es({to:i,data:o},this.txnOptions));if(n){const e=await a;return e.receipt=await e.wait(),e}return a}}let hs,ds,us,ps;!function(e){e.UNKNOWN="UNKNOWN",e.DROPPED="DROPPED",e.QUEUED="QUEUED",e.SENT="SENT",e.SUCCEEDED="SUCCEEDED",e.PARTIALLY_FAILED="PARTIALLY_FAILED",e.FAILED="FAILED"}(hs||(hs={})),function(e){e.SEND="SEND",e.RECEIVE="RECEIVE",e.BRIDGE_DEPOSIT="BRIDGE_DEPOSIT",e.BRIDGE_WITHDRAW="BRIDGE_WITHDRAW",e.BURN="BURN",e.UNKNOWN="UNKNOWN"}(ds||(ds={})),function(e){e.UNKNOWN="UNKNOWN",e.ERC20_TOKEN="ERC20_TOKEN",e.ERC1155_TOKEN="ERC1155_TOKEN"}(us||(us={})),function(e){e.DESC="DESC",e.ASC="ASC"}(ps||(ps={}));class gs{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Relayer/",this.ping=e=>this.fetch(this.url("Ping"),fs({},e)).then((e=>ms(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),fs({},e)).then((e=>ms(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),fs({},e)).then((e=>ms(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),fs({},e)).then((e=>ms(e).then((e=>({data:e.data}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),fs({},e)).then((e=>ms(e).then((e=>({chainID:e.chainID}))))),this.sendMetaTxn=(e,t)=>this.fetch(this.url("SendMetaTxn"),fs(e,t)).then((e=>ms(e).then((e=>({status:e.status,txnHash:e.txnHash}))))),this.getMetaTxnNonce=(e,t)=>this.fetch(this.url("GetMetaTxnNonce"),fs(e,t)).then((e=>ms(e).then((e=>({nonce:e.nonce}))))),this.getMetaTxnReceipt=(e,t)=>this.fetch(this.url("GetMetaTxnReceipt"),fs(e,t)).then((e=>ms(e).then((e=>({receipt:e.receipt}))))),this.simulate=(e,t)=>this.fetch(this.url("Simulate"),fs(e,t)).then((e=>ms(e).then((e=>({results:e.results}))))),this.updateMetaTxnGasLimits=(e,t)=>this.fetch(this.url("UpdateMetaTxnGasLimits"),fs(e,t)).then((e=>ms(e).then((e=>({payload:e.payload}))))),this.feeTokens=e=>this.fetch(this.url("FeeTokens"),fs({},e)).then((e=>ms(e).then((e=>({isFeeRequired:e.isFeeRequired,tokens:e.tokens}))))),this.feeOptions=(e,t)=>this.fetch(this.url("FeeOptions"),fs(e,t)).then((e=>ms(e).then((e=>({options:e.options,quote:e.quote}))))),this.getMetaTxnNetworkFeeOptions=(e,t)=>this.fetch(this.url("GetMetaTxnNetworkFeeOptions"),fs(e,t)).then((e=>ms(e).then((e=>({options:e.options}))))),this.sentTransactions=(e,t)=>this.fetch(this.url("SentTransactions"),fs(e,t)).then((e=>ms(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.pendingTransactions=(e,t)=>this.fetch(this.url("PendingTransactions"),fs(e,t)).then((e=>ms(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.listGasSponsors=(e,t)=>this.fetch(this.url("ListGasSponsors"),fs(e,t)).then((e=>ms(e).then((e=>({page:e.page,gasSponsors:e.gasSponsors}))))),this.addGasSponsor=(e,t)=>this.fetch(this.url("AddGasSponsor"),fs(e,t)).then((e=>ms(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.updateGasSponsor=(e,t)=>this.fetch(this.url("UpdateGasSponsor"),fs(e,t)).then((e=>ms(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.reportGasSponsorUsage=(e,t)=>this.fetch(this.url("ReportGasSponsorUsage"),fs(e,t)).then((e=>ms(e).then((e=>({gasSponsorUsage:e.gasSponsorUsage}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const fs=(e={},t={})=>({method:"POST",headers:es({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),ms=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));var ws=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"752f4f4274ca80d2fd974b5b44ed8245dfe40554",get ETHTxnStatus(){return hs},get TransferType(){return ds},get FeeTokenType(){return us},get SortOrder(){return ps},Relayer:gs});const ys=[hs.DROPPED,hs.SUCCEEDED,hs.PARTIALLY_FAILED,hs.FAILED],vs=[hs.DROPPED,hs.PARTIALLY_FAILED,hs.FAILED];function bs(e){return void 0!==e.url&&"string"==typeof e.url}const Es="object"==typeof n.g?n.g.fetch:window.fetch;class Cs extends is{constructor(e){super(e),this.service=void 0,this.service=new gs(e.url,Es)}async waitReceipt(e,t=1e3,n=5,i){"string"!=typeof e&&(Fe.info("computing id",e.config,e.context,e.chainId,...e.transactions),e=fi(Lt(e.config,e.context),e.chainId,...e.transactions)),Fe.info(`[rpc-relayer/waitReceipt] waiting for ${e}`);let s=0;for(;void 0===i||!i();){try{const{receipt:t}=await this.service.getMetaTxnReceipt({metaTxID:e});if(t&&t.txnReceipt&&"null"!==t.txnReceipt&&ys.includes(t.status))return{receipt:t}}catch(e){if(s++,s===n)throw e}void 0!==i&&i()||await new Promise((e=>setTimeout(e,t)))}throw new Error(`Cancelled waiting for transaction receipt ${e}`)}async simulate(e,...t){const n=Ce.$.encode([hi],[Ii(t)]);return(await this.service.simulate({wallet:e,transactions:n})).results}async getFeeOptions(e,t,...n){const i=await this.service.feeTokens();if(i.isFeeRequired){const s=i.tokens.map((e=>e.symbol)).join(", ");Fe.info(`[rpc-relayer/getFeeOptions] relayer fees are required, accepted tokens are ${s}`);const r=Lt(e,t);let o=Ci(...n);if(void 0===o&&(o=await this.getNonce(e,t)),!this.provider)throw Fe.warn("[rpc-relayer/getFeeOptions] provider not set, needed for stub signature"),new Error("provider is not set");const{to:a,execute:c}=await this.prependWalletDeploy({config:e,context:t,transactions:n,nonce:o,signature:ln(this.provider,e)}),l=new at.vU(m.mainModule.abi),h=l.encodeFunctionData(l.getFunction("execute"),[Ii(c.transactions),c.nonce,c.signature]),{options:d,quote:u}=await this.service.feeOptions({wallet:r,to:a,data:h});return Fe.info(`[rpc-relayer/getFeeOptions] got refund options ${JSON.stringify(d)}`),{options:d,quote:{_tag:"FeeQuote",_quote:u}}}return Fe.info("[rpc-relayer/getFeeOptions] relayer fees are not required"),{options:[]}}async gasRefundOptions(e,t,...n){const{options:i}=await this.getFeeOptions(e,t,...n);return i}async getNonce(e,t,n){const i=Lt(e,t);Fe.info(`[rpc-relayer/getNonce] get nonce for wallet ${i} space: ${n}`);const s=void 0!==n?ve.O$.from(n).toHexString():void 0,r=await this.service.getMetaTxnNonce({walletContractAddress:i,space:s}),o=ve.O$.from(r.nonce),[a,c]=Oi(o);return Fe.info(`[rpc-relayer/getNonce] got next nonce for wallet ${i} ${c} space: ${a}`),o}async relay(e,t,n=!0){var i=this;let s;if(Fe.info(`[rpc-relayer/relay] relaying signed meta-transactions ${JSON.stringify(e)} with quote ${JSON.stringify(t)}`),void 0!==t&&("string"==typeof t._quote?s=t._quote:Fe.warn("[rpc-relayer/relay] ignoring invalid fee quote")),!this.provider)throw Fe.warn("[rpc-relayer/relay] provider not set, failed relay"),new Error("provider is not set");const{to:r,execute:o}=await this.prependWalletDeploy(e),a=Lt(e.config,e.context),c=new at.vU(m.mainModule.abi),l=c.encodeFunctionData(c.getFunction("execute"),[Ii(o.transactions),o.nonce,o.signature]),h=await this.service.sendMetaTxn({call:{walletAddress:a,contract:r,input:l},quote:s});if(Fe.info(`[rpc-relayer/relay] got relay result ${JSON.stringify(h)}`),n)return this.wait(h.txnHash);{const e={hash:h.txnHash,confirmations:0,from:a,wait:e=>Promise.reject(new Error("impossible"))},t=async function(t){var n;if(!i.provider)throw new Error("cannot wait for receipt, relayer has no provider set");const s=await i.wait(h.txnHash),r=null==(n=s.receipt)?void 0:n.transactionHash;if(!r)throw new Error("cannot wait for receipt, unknown native transaction hash");return Object.assign(e,s),i.provider.waitForTransaction(r,t)};return e.wait=t,e}}async wait(e,t,n=1e3,i=5){var s=this;let r=!1;const{receipt:o}=await(void 0!==t?Promise.race([this.waitReceipt(e,n,i,(()=>r)),new Promise(((n,i)=>setTimeout((()=>{r=!0,i(`Timeout waiting for transaction receipt ${e}`)}),t)))]):this.waitReceipt(e,n,i));if(!o.txnReceipt||vs.includes(o.status))throw new Is(o);const a=JSON.parse(o.txnReceipt);return{blockHash:a.blockHash,blockNumber:ve.O$.from(a.blockNumber).toNumber(),confirmations:1,from:"string"==typeof e?void 0:Lt(e.config,e.context),hash:a.transactionHash,raw:o.txnReceipt,receipt:a,wait:async function(e){return s.provider.waitForTransaction(a.transactionHash,e)}}}}class Is{constructor(e){this.receipt=e}}function ks(e){return"object"==typeof e&&"function"==typeof e.simulate&&"function"==typeof e.getFeeOptions&&"function"==typeof e.gasRefundOptions&&"function"==typeof e.getNonce&&"function"==typeof e.relay&&"function"==typeof e.wait}function As(){return As=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},As.apply(this,arguments)}class Ts extends ye.E{static isSequenceSigner(e){return _s(e)}}function _s(e){const t=e;return t&&void 0!==t.updateConfig&&void 0!==t.publishConfig&&void 0!==t.getWalletContext&&void 0!==t.getWalletConfig}class Os extends Error{}class Ns extends ye.E{signMessage(e,t){return this.signMessageWithData(e)}sendTransaction(e){throw new Error("sendTransaction method is not supported in RemoteSigner")}signTransaction(e){throw new Error("signTransaction method is not supported in RemoteSigner")}connect(e){throw new Error("connect method is not supported in RemoteSigner")}static signMessageWithData(e,t,n,i){return this.isRemoteSigner(e)?e.signMessageWithData(t,n,i):e.signMessage(t)}static isRemoteSigner(e){return void 0!==e.signMessageWithData}}async function Ss(e){return Array.isArray(e)?Promise.all(e.map((e=>ri.resolveProperties(e)))):ri.resolveProperties(e)}"object"==typeof n.g?n.g.fetch:window.fetch;class xs extends Ts{constructor(e,...t){super(),this.context=void 0,this.config=void 0,this._signers=void 0,this.provider=void 0,this.sender=void 0,this.relayer=void 0,this.chainId=void 0;const{config:n,context:i,strict:s}=e;if(this.context=As({},i||$i),!0===s?this.context.nonStrict=void 0:!1===s&&(this.context.nonStrict=!0),!this.context.nonStrict&&!Bt(n))throw new Error("wallet config is not usable (strict mode)");this.config=qt(n),this._signers=t.map((e=>ye.E.isSigner(e)?e:new U.Wallet(e))),this.imageHash}useConfig(e,t){return new xs({config:e,context:this.context,strict:t},...this._signers).setProvider(this.provider,this.chainId).setRelayer(this.relayer)}useSigners(...e){return new xs({config:this.config,context:this.context},...e).setProvider(this.provider,this.chainId).setRelayer(this.relayer)}connect(e,t){if(Hi(e))return new xs({config:this.config,context:this.context},...this._signers).setProvider(e,this.chainId).setRelayer(t);throw new Error("Wallet provider argument is expected to be a JsonRpcProvider")}setProvider(e,t){if(void 0===e)return this;if(oi.zt.isProvider(e))this.provider=e,this.sender=new Yi(e);else{const n=new Qi(e,{chainId:t,blockCache:!0});this.provider=n,this.sender=new Yi(n)}return this.chainId=t,this}setRelayer(e){return void 0===e||(this.relayer=e),this}async getProvider(e){return e&&await this.getChainIdNumber(e),this.provider}async getRelayer(e){return e&&await this.getChainIdNumber(e),this.relayer}async getWalletContext(){return this.context}async getWalletConfig(e){return e=await this.getChainIdNumber(e),[As({},this.config,{chainId:e})]}async getWalletState(e){const[t,n,i]=await Promise.all([this.getAddress(),this.getChainId(),this.isDeployed()]);return[{context:this.context,config:this.config,address:t,chainId:n,deployed:i,imageHash:this.imageHash,lastImageHash:i?await Bs(this):void 0}]}get connected(){return void 0!==this.sender}get address(){return Lt(this.config,this.context)}get imageHash(){return Dt(this.config)}async getAddress(){return this.address}async getSigners(){return this._signers&&0!==this._signers.length?Promise.all(this._signers.map((e=>e.getAddress().then((e=>N.getAddress(e)))))):[]}async getChainId(){if(this.chainId)return this.chainId;if(!this.provider)throw new Error("provider is not set, first connect a provider");return this.chainId=(await this.provider.getNetwork()).chainId,this.chainId}async getNetworks(){return[{chainId:await this.getChainId(),name:"",rpcUrl:""}]}async getNonce(e,t){return this.relayer.getNonce(this.config,this.context,t,e)}async getTransactionCount(e){const t=await this.getNonce(e,0),[n,i]=Oi(t);return ve.O$.from(i).toNumber()}async sendTransaction(e,t,n,i,s,r){const o=await this.signTransactions(e,t,n);return s&&s(o,fi(Lt(o.config,o.context),o.chainId,...o.transactions)),this.relayer.relay(o,i,r)}async sendTransactionBatch(e,t,n=!0,i,s,r){return this.sendTransaction(e,t,n,i,s,r)}async signTransactions(e,t,n){const i=await this.getChainIdNumber(t),s=await Ss(e);if(!this.provider)throw new Error("missing provider");if(!this.relayer)throw new Error("missing relayer");let r=await Si(this.context,this.address,s);if(r.some((e=>void 0===e.gasLimit))){const e=await this.relayer.simulate(this.address,...r);for(const t in r)void 0===r[t].gasLimit&&(r[t].gasLimit=e[t].gasLimit)}const o=Ci(...r)||await this.getNonce();r=ki(r,o);const a=gi(o,...r);return{digest:a,chainId:i,context:this.context,config:this.config,transactions:r,nonce:o,signature:await this.sign(a,!0,t,n)}}async sendSignedTransactions(e,t,n){if(!this.relayer)throw new Error("relayer is not set, first connect a relayer");return await this.getChainIdNumber(t),this.relayer.relay(e,n)}async signMessage(e,t,n,i=!1){const s="string"!=typeof e||e.startsWith("0x")?e:Ae.Y0(e);return this.sign(s,i,t,n)}async signTypedData(e,t,n,i,s){const r=await this.getChainIdNumber(i),o=e.chainId?ve.O$.from(e.chainId).toNumber():void 0;if(o&&o!==r)throw new Error(`signTypedData: domain.chainId (${e.chainId}) is expected to be ${r}`);const a=Qe({domain:e,types:t,message:n});return this.sign(a,!0,r,s)}async _signTypedData(e,t,n,i,s){return this.signTypedData(e,t,n,i,s)}async subDigest(e,t){const n=await this.getChainIdNumber(t);return x.arrayify(Ue(this.address,n,e))}async sign(e,t=!0,n,i){var s=this;const r=await this.getChainIdNumber(n),o=t?e:R.keccak256(e),a=await this.subDigest(o,n),c=async function(e,t){const n=await Promise.all(e.map((e=>e.getAddress()))),o=await Promise.all(s.config.signers.map((async function(o){try{const c=e[n.indexOf(o.address)];if(!c)return o;if(_s(c)){if(c===s)throw Error("Can't sign transactions for self");return As({},o,{signature:await c.signMessage(a,r,i,!0)+"03"})}if(Ns.isRemoteSigner(c)){const e=await c.signMessageWithData(a,t,r);try{if(nn(a,{weight:o.weight,signature:e})===o.address)return{weight:o.weight,signature:e}}catch(e){}return As({},o,{signature:e})}return{weight:o.weight,signature:await c.signMessage(a)+"02"}}catch(e){if(i)throw e;return console.warn(`Skipped signer ${o.address}`),o}})));return{threshold:s.config.threshold,signers:o}},l=this._signers.filter((e=>!Ns.isRemoteSigner(e))),h=await c(l,this.packMsgAndSig(o,[],r));if(h.signers.filter(Yt).reduce(((e,t)=>e+t.weight),0)>=this.config.threshold)return on(h);const d=this._signers.filter((e=>Ns.isRemoteSigner(e))),u=await c(d,this.packMsgAndSig(o,on(h),r));return on(sn(h,u))}async signWeight(){return(await this.getSigners()).reduce(((e,t)=>{const n=this.config.signers.find((e=>e.address===t));return n?e.add(n.weight):e}),be._Y)}async isDeployed(e){await this.getChainIdNumber(e);const t=await this.provider.getCode(this.address);return!!t&&"0x"!==t}async updateConfig(e,t,n=!1,i,s,r,o){e||(e=this.config);const[a,c]=await Promise.all([this.buildUpdateConfigTransaction(e,n,i),null!=t?t:this.getNonce()]);return[As({address:this.address},e),await this.sendTransaction(ki(a,c),void 0,void 0,s,r,o)]}async publishConfig(e,t,n=[],i,s,r){return this.sendTransaction(this.config.address?this.buildPublishConfigTransaction(this.config,e,t):await this.buildPublishSignersTransaction(e,t,n),void 0,void 0,i,s,r)}async buildUpdateConfigTransaction(e,t=!1,n){var i=this;if(!this.context.nonStrict&&!Bt(e))throw new Error("wallet config is not usable (strict mode)");const s=await async function(){try{const e=await i.provider.getStorageAt(i.address,Ce.$.encode(["address"],[i.address]));return 0===Ft(e,i.context.mainModuleUpgradable)}catch(e){return!1}}(),r=new at.vU(m.mainModule.abi),o=2*(1e5+1800*e.signers.length),a=s?[]:[{delegateCall:!1,revertOnError:!0,gasLimit:be._Y,to:this.address,value:be._Y,data:r.encodeFunctionData(r.getFunction("updateImplementation"),[this.context.mainModuleUpgradable])}],c=new at.vU(m.mainModuleUpgradable.abi),l=[...a,{delegateCall:!1,revertOnError:!0,gasLimit:be._Y,to:this.address,value:be._Y,data:c.encodeFunctionData(c.getFunction("updateImageHash"),[Dt(e)])},...t?await this.buildPublishConfigTransaction(e,n):[]];return 1===l.length?l:[{delegateCall:!1,revertOnError:!1,gasLimit:o,to:this.address,value:be._Y,data:r.encodeFunctionData(r.getFunction("selfExecute"),[Ii(l)])}]}buildPublishConfigTransaction(e,t=!0,n){const i=new at.vU(m.sequenceUtils.abi);return[{delegateCall:!1,revertOnError:!0,gasLimit:be._Y,to:this.context.sequenceUtils,value:be._Y,nonce:n,data:i.encodeFunctionData(i.getFunction("publishConfig"),[this.address,e.threshold,qt(e).signers.map((e=>({weight:e.weight,signer:e.address}))),t])}]}async buildPublishSignersTransaction(e=!0,t,n=[]){var i;const s=new at.vU(m.sequenceUtils.abi),r=new at.vU(m.requireFreshSigner.abi),o=ai.O(32),a=await this.signMessage(o,this.chainId,!1),c=Xt(a),l=on({threshold:c.threshold,signers:c.signers.map(((e,t)=>{if(Zt(e)){const e=this.config.signers[t];return{weight:e.weight,address:e.address}}return e}))}),h=null==(i=this.context.libs)?void 0:i.requireFreshSigner;if(n.length>0&&void 0===h)throw Error("requireFreshSigners missing library");return[...n.map((e=>({delegateCall:!1,revertOnError:!0,gasLimit:be._Y,to:h,value:be._Y,nonce:t,data:r.encodeFunctionData(r.getFunction("requireFreshSigner"),[e])}))),{delegateCall:!1,revertOnError:!0,gasLimit:be._Y,to:this.context.sequenceUtils,value:be._Y,nonce:t,data:s.encodeFunctionData(s.getFunction("publishInitialSigners"),[this.address,R.keccak256(o),this.config.signers.length,l,e])}]}async getChainIdNumber(e){if(!e)return await this.getChainId();const t=Ri(e);if(this.context.nonStrict)return t;const n=await this.getChainId();if(n!==t)throw new Error(`the specified chainId ${t} does not match the wallet's connected chainId ${n}`);return n}packMsgAndSig(e,t,n){return Ce.$.encode(["address","uint256","bytes","bytes"],[this.address,n,e,t])}signTransaction(e){throw new Error("signTransaction method is not supported in Wallet, please use signTransactions(...)")}static async singleOwner(e,t){const n=ye.E.isSigner(e)?e:new U.Wallet(e),i={threshold:1,signers:[{weight:1,address:N.getAddress(await n.getAddress())}]};return new xs({config:i,context:t},n)}async hasEnoughSigners(e){return e&&await this.getChainIdNumber(e),(await this.signWeight()).gte(this.config.threshold)}}class Rs extends Ts{constructor(e,...t){super(),this.options=void 0,this._wallets=void 0,this._signers=void 0,this.provider=void 0,this._chainId=void 0,this.options=e,this._signers=t,e.context||(this.options.context=As({},$i)),this.options.networks?this.setNetworks(this.options.networks):this.setNetworks([...Wi])}useSigners(...e){return this._signers=e,this._wallets.forEach((t=>{t.wallet=t.wallet.useSigners(...e)})),this}async getWalletContext(){return this.options.context}getConfigFinder(){return this.options.configFinder?this.options.configFinder:new Ht(this.authWallet().wallet.provider)}async getWalletConfig(e){let t=[];if(e){const n=this.getWalletByNetwork(e);n&&t.push(n)}else t=this._wallets;return(await Promise.all(t.map((e=>e.wallet.getWalletConfig())))).flat()}async getWalletState(e){let t=[];if(e){const n=this.getWalletByNetwork(e);n&&t.push(n)}else t=this._wallets;const n=Promise.all(t.map((e=>this.getConfigFinder().findCurrentConfig({address:e.wallet.address,provider:e.wallet.provider,context:e.wallet.context,knownConfigs:[e.wallet.config]})))),i=(await Promise.all(t.map((e=>e.wallet.getWalletState())))).flat(),s=i.findIndex((e=>e.chainId===this.getAuthChainId()));s>=0&&(i[s].config=await this.currentConfig(t[s].wallet));const r=await n;return i.map(((e,t)=>{var n;return As({},e,{config:null==(n=r[t])?void 0:n.config})}))}get address(){return this._wallets[0].wallet.address}getAddress(){return this._wallets[0].wallet.getAddress()}async getSigners(){return this._wallets[0].wallet.getSigners()}async getProvider(e){var t,n;return e?null==(n=this._wallets.find((t=>t.network.chainId===e)))?void 0:n.wallet.getProvider():null==(t=this.mainWallet())?void 0:t.wallet.getProvider()}async getRelayer(e){var t,n;return e?null==(n=this._wallets.find((t=>t.network.chainId===e)))?void 0:n.wallet.getRelayer():null==(t=this.mainWallet())?void 0:t.wallet.getRelayer()}async getNetworks(){return this.options.networks}async getChainId(){if(this._chainId)return this._chainId;const e=await this.provider.getNetwork();return this._chainId=e.chainId,this._chainId}getAuthChainId(){try{return this.options.networks.find((e=>e.isAuthChain)).chainId}catch(e){throw new Error("no auth network")}}async signMessage(e,t,n=!0,i=!1){var s=this;let{wallet:r}=await async function(){if(!t)return s.mainWallet();if(t.address){const e=await t.getChainId();return s.getWalletByNetwork(e)}return s.getWalletByNetwork(t)}(),o=await this.currentConfig(r);o=o||this._wallets[0].wallet.config,r=r.useConfig(o);const a=await r.signWeight();if(a.lt(r.config.threshold)&&!1!==n)throw new Os(`Sign message - wallet combined weight ${a.toString()} below required ${r.config.threshold.toString()}`);return r.signMessage(e,void 0,n,i)}async signAuthMessage(e,t=!0,n=!1){var i;return this.signMessage(e,null==(i=this.authWallet())?void 0:i.wallet,t,n)}async signTypedData(e,t,n,i,s=!0){const r=i?this.getWalletByNetwork(i).wallet:this.mainWallet().wallet,o=Qe({domain:e,types:t,message:n});return this.signMessage(o,r,s,!0)}async _signTypedData(e,t,n,i,s=!0){return this.signTypedData(e,t,n,i,s)}async hasEnoughSigners(e){const t=e?this.getWalletByNetwork(e).wallet:this.mainWallet().wallet,n=await this.currentConfig(t);return t.useConfig(n).hasEnoughSigners()}async getFeeOptions(e,t,n=!0){const i=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,s=this.options.context;if(!s)throw new Error("missing wallet context");const[r,o]=await Promise.all([this.currentConfig(i),this.prependConfigUpdate(e,t,n,!0)]);if(!r)throw new Error(`missing current config for chain ${t}`);const a=await Si(s,this.address,o);return i.relayer.getFeeOptions(r,s,...a)}async sendTransaction(e,t,n=!0,i,s){const r=await this.signTransactions(e,t,n);return s&&s(r,fi(Lt(r.config,r.context),r.chainId,...r.transactions)),(t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet).sendSignedTransactions(r,t,i)}async sendTransactionBatch(e,t,n=!0,i,s){return this.sendTransaction(e,t,n,i,s)}async signTransactions(e,t,n){const i=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet;let s=await this.currentConfig(i);if(!s&&(s=await this.currentConfig(),!s))throw new Error("missing auth chain config");const r=await this.prependConfigUpdate(e,t,n);return i.useConfig(s).signTransactions(r)}async prependConfigUpdate(e,t,n,i){const s=await Ss(e),r=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,[o,a]=await Promise.all([this.currentConfig(r),this.currentConfig()]);if(!i){const e=await r.useConfig(o).signWeight();if(e.lt(o.threshold)&&n)throw new Os(`wallet combined weight ${e.toString()} below required threshold ${o.threshold.toString()}`)}if(await r.isDeployed()&&Gt(a,o))return s;const c=Array.isArray(s)?s:[s];return[...await r.buildUpdateConfigTransaction(a,!1),...c]}async sendSignedTransactions(e,t,n){return(t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet).sendSignedTransactions(e,void 0,n)}async updateConfig(e,t,n,i){const s=this.authWallet().wallet;if(e=e?qt(e):s.config,Gt(s.config,e)&&!await this.isDeployed())return await s.updateConfig(e,void 0,!0,t,n,i);const r=await this.currentConfig();if(Gt(r,e))return[As({},r,{address:this.address}),void 0];const[o,a]=await s.useConfig(r).updateConfig(e,void 0,!0,t,n,i);return[As({},e,{address:this.address}),a]}publishConfig(e,t=[],n,i){return this.authWallet().wallet.publishConfig(e,void 0,t,n,i)}async isDeployed(e){return(()=>e?e.address?e:this.getWalletByNetwork(e).wallet:this.authWallet().wallet)().isDeployed()}async currentConfig(e){const t=(()=>e?e.address?e:this.getWalletByNetwork(e).wallet:this.authWallet().wallet)();return(await this.getConfigFinder().findCurrentConfig({address:this.address,provider:t.provider,context:t.context,knownConfigs:[t.config]})).config}getWallets(){return this._wallets}getWalletByNetwork(e){const t=Ri(e),n=this._wallets.find((e=>e.network.chainId===t));if(!n)throw new Error(`network ${e} not found in wallets list`);return n}mainWallet(){const e=this._wallets.find((e=>e.network.isDefaultChain));if(!e)throw new Error("mainWallet not found");return e}authWallet(){const e=this._wallets.find((e=>e.network.isAuthChain));if(!e)throw new Error("authChain wallet not found");return e}setNetworks(e,t=[],n){let i=[];if(this._chainId=void 0,n){const s=parseInt(n),r=e.find((e=>e.name===n||e.chainId===s)),o=t.find((e=>e.name===n||e.chainId===s));if(!r&&!o)throw new Error(`unable to set default network as chain '${n}' does not exist`);r?(e.forEach((e=>e.isDefaultChain=!1)),r.isDefaultChain=!0,i=e):o&&(t.forEach((e=>e.isDefaultChain=!1)),o.isDefaultChain=!0,i=t)}else i=e;return this.options.networks=Mi(Bi(i)),this._wallets=this.options.networks.map((e=>{const t=new xs({config:this.options.initialConfig,context:this.options.context},...this._signers);if(e.provider)t.setProvider(e.provider,e.chainId);else{if(!e.rpcUrl||""===e.rpcUrl)throw new Error(`network config is missing provider settings for chainId ${e.chainId}`);t.setProvider(e.rpcUrl,e.chainId)}if(ks(e.relayer))t.setRelayer(e.relayer);else{if(!bs(e.relayer))throw new Error(`network config is missing relayer settings for chainId ${e.chainId}`);t.setRelayer(new Cs(As({provider:t.provider},e.relayer)))}return e.isDefaultChain&&(this._chainId=e.chainId,this.provider=t.provider),{network:e,wallet:t}})),this.options.networks.find((e=>e.isDefaultChain)).chainId}connect(e){throw new Error("connect method is not supported in MultiWallet")}signTransaction(e){throw new Error("signTransaction method is not supported in MultiWallet, please use signTransactions(...)")}}async function Ms(e,t,n,i,s,r){if(function(e,t,n){try{return 0===Ft(ke.recoverAddress(t,x.splitSignature(n)),e)}catch(e){return!1}}(e,t,n)||function(e,t,n){try{const i=R.keccak256(Ee.pack(["string","bytes32"],["Ethereum Signed Message:\n32",t]));return 0===Ft(ke.recoverAddress(i,x.splitSignature(n)),e)}catch(e){return!1}}(e,t,n))return!0;const o=await async function(e,t,n,i){if(i)try{if("0x"===await i.getCode(e))return;const s=new S.CH(e,m.erc1271.abi,i),r=await s.isValidSignature(t,n);return m.erc1271.returns.isValidSignatureBytes32===r}catch(e){return!1}}(e,t,n,i);return void 0===o?!!await Us(e,t,n,s,i,r):o}async function Us(e,t,n,i,s,r){if((s||r)&&i)try{const o=r||(await s.getNetwork()).chainId,a=Xt(n),c=x.arrayify(R.keccak256(Me(e,o,t))),l=await Ps(c,a,s,i,r,!0),h=a.signers.reduce(((e,t)=>Jt(t)||Zt(t)?e+t.weight:e),0);return 0===Ft(Lt(l,i),e)&&h>=a.threshold}catch(e){return!1}}const Bs=async e=>{const t=await e.getAddress(),n=new S.CH(t,m.mainModuleUpgradable.abi,await e.getProvider()),i=await n.functions.imageHash.call([]).catch((()=>[]));return i&&i.length>0?i[0]:""},Ps=async(e,t,n,i,s,r)=>{const o=void 0!==t.threshold?t:Xt(t),a=await Promise.all(o.signers.map((async t=>{if(Jt(t))return{weight:t.weight,address:nn(e,t)};if(Kt(t))return{weight:t.weight,address:N.getAddress(t.address)};if(Zt(t)){if(r&&!await Ms(t.address,x.arrayify(e),x.hexlify(t.signature),n,i,s))throw Error("Invalid signature");return{weight:t.weight,address:t.address}}throw Error("Uknown signature type")})));return{threshold:o.threshold,signers:a}};function Ls(){return Ls=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ls.apply(this,arguments)}const Ds=604800,qs=3e7;class Gs{constructor(e,t,n,i,s,r,o,a,c){var l;this.sequenceApiUrl=e,this.sequenceMetadataUrl=t,this.networks=n,this.config=i,this.context=s,this.account=r,this.metadata=o,this.authProvider=a,this._initialAuthRequest=void 0,this._jwt=void 0,this.proofStrings=new Map,this.onAuthCallbacks=[],this.apiClient=void 0,this.metadataClient=void 0,this.indexerClients=new Map,c&&(this._jwt={token:Promise.resolve(c.token),expiration:null!=(l=c.expiration)?l:Ws(c.token)})}get name(){return this.metadata.name}get expiration(){return this.metadata.expiration?Math.max(this.metadata.expiration,120):Ds}onAuth(e){this.onAuthCallbacks.push(e)}setAccount(e){this.account=e}setConfig(e){this.config=e}async auth(e=5){const t=this.sequenceApiUrl;if(!t)throw Error("No sequence api url");let n;for(let t=0;;t++)try{n=(await this.getJWT(!0)).token;break}catch(n){if(t===e-1)throw console.error(`couldn't authenticate after ${e} attempts`,n),n}return new O(t,n)}get isTestnetMode(){if(this.networks&&0!==this.networks.length)return!!this.networks[0].testnet}async getAPIClient(e=!0){if(!this.apiClient){const t=this.sequenceApiUrl;if(!t)throw Error("No chaind url");const n=(await this.getJWT(e)).token;this.apiClient=new O(t,n)}return this.apiClient}getMetadataClient(){return this.metadataClient||(this.metadataClient=new qn(this.sequenceMetadataUrl)),this.metadataClient}async getIndexerClient(e){const t=((e,t)=>{if("string"==typeof t){if(t.startsWith("0x")){const n=ve.O$.from(t).toNumber();return e.find((e=>e.chainId===n))}return e.find((e=>e.name===t))}return"number"==typeof t?e.find((e=>e.chainId===t)):t.chainId?e.find((e=>e.chainId===t.chainId)):void 0})(this.networks,e);if(!t)throw Error(`No network for chain ${e}`);if(!this.indexerClients.has(t.chainId))if(t.indexer)this.indexerClients.set(t.chainId,t.indexer);else{if(!t.indexerUrl)throw Error(`No indexer url for chain ${e}`);this.indexerClients.set(t.chainId,new Tn(t.indexerUrl))}return this.indexerClients.get(t.chainId)}async getJWT(e){var t=this;const n=this.sequenceApiUrl;if(!n)throw Error("No chaind url");if(this._jwt){const e=this._jwt,t=await e.token;if(this.now()<e.expiration)return{token:t,expiration:e.expiration};this._jwt=void 0}if(!e)throw new Error("no auth token in memory");const i=this.getProofStringKey(),{proofString:s,expiration:r}=this.getProofString(i),o={token:s.then((async function(e){const s=new O(n),r=await s.getAuthToken({ewtString:e,testnetMode:t.isTestnetMode});if(!0===(null==r?void 0:r.status)&&0!==r.jwtToken.length)return r.jwtToken;throw await t.isProofStringValid(e)||t.proofStrings.delete(i),new Error("no auth token from server")})).catch((e=>{throw this._jwt=void 0,e})),expiration:r};return this._jwt=o,o.token.then((()=>{this.onAuthCallbacks.forEach((e=>{try{e({status:"fulfilled",value:void 0})}catch(e){}}))})).catch((e=>{this.onAuthCallbacks.forEach((t=>{try{t({status:"rejected",reason:e})}catch(e){}}))})),{token:await o.token,expiration:r}}getProofString(e){if(this.proofStrings.has(e)){const t=this.proofStrings.get(e);if(this.now()<t.expiration)return t;this.proofStrings.delete(e)}const t=new le({address:this.account.address});t.claims.app=this.name,"object"==typeof window&&(t.claims.ogn=window.location.origin),t.setExpiryIn(this.expiration);const n=new we,i=new Ht(this.authProvider),s=this.account.authWallet(),r=this.now()+this.expiration-60,o={proofString:i.findCurrentConfig({address:s.wallet.address,provider:this.authProvider,context:s.wallet.context,knownConfigs:[s.wallet.config]}).then((e=>{if(!e.config)throw Error("Can't find latest config");return s.wallet.useConfig(e.config).sign(t.messageDigest()).then((e=>{const i=Xt(e),s=i.signers.filter(Yt).reduce(((e,t)=>e+t.weight),0);if(s<i.threshold)throw Error(`insufficient signing power, need ${i.threshold}, have ${s}`);return t.signature=e,n.encodeProof(t,!0)}))})).catch((t=>{throw this.proofStrings.delete(e),t})),expiration:r};return this.proofStrings.set(e,o),o}getProofStringKey(){return`${this.account.address} - ${this.name}`}async isProofStringValid(e){try{const t=new we;return t.provider=this.authProvider,await t.decodeProof(e),!0}catch(e){return!1}}async dump(){let e;if(this._jwt)try{const t=this._jwt.expiration;e={token:await this._jwt.token,expiration:t}}catch(e){}return{config:this.config,context:this.context,metadata:this.metadata,jwt:e}}now(){return Math.floor((new Date).getTime()/1e3)}static async open(e){const{sequenceApiUrl:t,sequenceMetadataUrl:n,context:i,networks:s,referenceSigner:r,signers:o,threshold:a,deepSearch:c,knownConfigs:l,noIndex:h,metadata:d}=e,u=Fs(s),p=e.configFinder?e.configFinder:new Ht(u),g=Promise.all(o.map((async function(e){return Ls({},e,{address:"string"==typeof e.signer?e.signer:await e.signer.getAddress()})}))),f=o.filter((e=>"string"!=typeof e.signer)).map((e=>e.signer)),m=(await p.findLastWalletOfInitialSigner({signer:r,context:i,provider:u,requireIndex:!c})).wallet;if(m){const e=(await p.findCurrentConfig({address:m,provider:u,context:i,knownConfigs:l})).config;if(!e)throw Error("Wallet config not found");const r=new Rs({initialConfig:e,networks:s,context:i},...f),o=new Gs(t,n,s,e,i,r,d,u),[c]=await r.updateConfig(Wt(e,{threshold:a,set:await g}),!h);return o.setConfig(c),o.setAccount(new Rs({initialConfig:c,networks:s,context:i},...f)),o._initialAuthRequest=t?o.auth():Promise.reject("no sequence api url"),o}{const e=$t(a,await g),o=new Rs({initialConfig:e,networks:s,context:i},...f);await o.publishConfig(!h,[r]);const c=new Gs(t,n,s,e,i,o,d,u);return c._initialAuthRequest=t?c.auth():Promise.reject("no sequence api url"),c}}static load(e){const{sequenceApiUrl:t,sequenceMetadataUrl:n,dump:i,signers:s,networks:r}=e;return new Gs(t,n,r,i.config,i.context,new Rs({initialConfig:i.config,context:i.context,networks:r},...s),i.metadata,Fs(r),i.jwt)}}function Fs(e){var t;const n=(e=>e.find((e=>e.isAuthChain)))(e);if(!n)throw Error("Auth chain not found");return null!=(t=n.provider)?t:new ii(n.rpcUrl,{chainId:n.chainId,blockCache:!0})}function Ws(e){return Le(e).exp}const $s=async(e,t)=>{const n=await e.getChainId(),i=N.getAddress(await e.getAddress());if(!i||""===i||"0x"===i)throw js;const s=new le;if(s.address=i,!t||!t.app||""===t.app)throw new Vs("authorization options requires app to be set");s.claims.app=t.app,s.claims.ogn=t.origin,s.setExpiryIn(t.expiry?Math.max(t.expiry,200):Ds);const r=s.messageTypedData();s.signature=await e.signTypedData(r.domain,r.types,r.message,n);const o=new we;return{typedData:r,proofString:await o.encodeProof(s,!0)}};class Vs extends Error{constructor(e){super(e),this.name="AuthError"}}const js=new Vs("auth error: account address is empty"),Hs=async(e,t,n)=>{if(!e||void 0===e||void 0===t)return{isValid:!1};const i=n.messageDigest(),s=await e.getCode(n.address);if("0x"===s||s.length<=2)throw new Error("ValidateSequenceDeployedWalletProof failed. unable to fetch wallet contract code");const r=new S.CH(n.address,["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],e);return await r.isValidSignature(i,x.arrayify(n.signature))===pe?{isValid:!0}:{isValid:!1}},Ks=e=>async(t,n,i)=>{if(!t||void 0===t||void 0===n)return{isValid:!1};if(0!==x.arrayify(await t.getCode(i.address)).length)return{isValid:!1};const s=i.messageDigest(),r=x.arrayify(R.keccak256(s));return{isValid:!!await Us(i.address,r,i.signature,e||Jn,t,n)}};function Ys(){return Ys=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ys.apply(this,arguments)}const Js="v1",zs="v0.4.0",Zs="98e0726794b2b5922a0e356280daac3a409602e4";class Qs{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Guard/",this.ping=e=>this.fetch(this.url("Ping"),Xs({},e)).then((e=>er(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),Xs({},e)).then((e=>er(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),Xs({},e)).then((e=>er(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),Xs({},e)).then((e=>er(e).then((e=>({data:e.data}))))),this.getSignerConfig=e=>this.fetch(this.url("GetSignerConfig"),Xs({},e)).then((e=>er(e).then((e=>({signerConfig:e.signerConfig}))))),this.sign=(e,t)=>this.fetch(this.url("Sign"),Xs(e,t)).then((e=>er(e).then((e=>({sig:e.sig}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const Xs=(e={},t={})=>({method:"POST",headers:Ys({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),er=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));var tr=n(1005);function nr(){return nr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},nr.apply(this,arguments)}function ir(e){return e&&void 0!==e.chainId&&void 0!==e.name&&void 0!==e.rpcUrl&&void 0!==e.relayer}const sr=e=>"number"==typeof e?e:e.chainId?e.chainId:ve.O$.from(e).toNumber(),rr=e=>{if(e)return sr(e)},or=e=>e.find((e=>e.isAuthChain)),ar=(e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const o=i.map((e=>e.name)).sort(),a=o.filter(((e,t)=>o.indexOf(e)!==t));if(a.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${a}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l){if(t)throw new Error("invalid network config: AuthChain must be set");return!1}return!0},cr=(e,t=!1)=>(ar(e,!0,t),e),lr=(e,t=!0)=>{const n=e.map((e=>e.chainId)).sort(),i=n.filter(((e,t)=>n.indexOf(e)!==t));if(i.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${i}`);return!1}return!0},hr=(e,t)=>{if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}},dr=e=>cr(fr(e)),ur=(e,t)=>{if("string"==typeof t){if(t.startsWith("0x")){const n=ve.O$.from(t).toNumber();return e.find((e=>e.chainId===n))}return e.find((e=>e.name===t))}return"number"==typeof t?e.find((e=>e.chainId===t)):t.chainId?e.find((e=>e.chainId===t.chainId)):void 0},pr=(e,t)=>!!e&&(e.name===t||e.chainId===t),gr=e=>{const t={};for(let n=0;n<e.length;n++)t[e[n].name]=e[n];return t},fr=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},mr=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let wr;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(wr||(wr={}));const yr=e=>mr("https://${network}-indexer.sequence.app",{network:e}),vr=e=>mr("https://${network}-relayer.sequence.app",{network:e}),br=e=>mr("https://nodes.sequence.app/${network}",{network:e}),Er={[wr.MAINNET]:{chainId:wr.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[wr.ROPSTEN]:{chainId:wr.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[wr.RINKEBY]:{chainId:wr.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[wr.GOERLI]:{chainId:wr.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[wr.KOVAN]:{chainId:wr.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[wr.POLYGON]:{chainId:wr.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[wr.POLYGON_MUMBAI]:{chainId:wr.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[wr.POLYGON_ZKEVM]:{chainId:wr.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[wr.BSC]:{chainId:wr.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[wr.BSC_TESTNET]:{chainId:wr.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[wr.OPTIMISM]:{chainId:wr.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[wr.OPTIMISM_TESTNET]:{chainId:wr.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[wr.ARBITRUM]:{chainId:wr.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[wr.ARBITRUM_GOERLI]:{chainId:wr.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[wr.ARBITRUM_NOVA]:{chainId:wr.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[wr.AVALANCHE]:{chainId:wr.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[wr.AVALANCHE_TESTNET]:{chainId:wr.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[wr.FANTOM]:{chainId:wr.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[wr.FANTOM_TESTNET]:{chainId:wr.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[wr.GNOSIS]:{chainId:wr.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[wr.AURORA]:{chainId:wr.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[wr.AURORA_TESTNET]:{chainId:wr.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[wr.BASE_GOERLI]:{chainId:wr.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}},Cr=dr([nr({},Er[wr.MAINNET],{rpcUrl:br("mainnet"),relayer:{url:vr("mainnet")},indexerUrl:yr("mainnet")}),nr({},Er[wr.POLYGON],{rpcUrl:br("polygon"),relayer:{url:vr("polygon")},indexerUrl:yr("polygon"),isDefaultChain:!0,isAuthChain:!0}),nr({},Er[wr.BSC],{rpcUrl:br("bsc"),indexerUrl:yr("bsc"),relayer:{url:vr("bsc")}}),nr({},Er[wr.AVALANCHE],{rpcUrl:br("avalanche"),indexerUrl:yr("avalanche"),relayer:{url:vr("avalanche")}}),nr({},Er[wr.ARBITRUM],{rpcUrl:br("arbitrum"),indexerUrl:yr("arbitrum"),relayer:{url:vr("arbitrum")}}),nr({},Er[wr.ARBITRUM_NOVA],{rpcUrl:br("arbitrum-nova"),indexerUrl:yr("arbitrum-nova"),relayer:{url:vr("arbitrum-nova")}}),nr({},Er[wr.OPTIMISM],{rpcUrl:br("optimism"),indexerUrl:yr("optimism"),relayer:{url:vr("optimism")}}),nr({},Er[wr.POLYGON_ZKEVM],{rpcUrl:br("polygon-zkevm"),indexerUrl:yr("polygon-zkevm"),relayer:{url:vr("polygon-zkevm")}}),nr({},Er[wr.GNOSIS],{rpcUrl:br("gnosis"),indexerUrl:yr("gnosis"),relayer:{url:vr("gnosis")}})]),Ir=dr([nr({},Er[wr.RINKEBY],{rpcUrl:br("rinkeby"),relayer:{url:vr("rinkeby")},indexerUrl:yr("rinkeby")}),nr({},Er[wr.GOERLI],{rpcUrl:br("goerli"),relayer:{url:vr("goerli")},indexerUrl:yr("goerli")}),nr({},Er[wr.POLYGON_MUMBAI],{rpcUrl:br("mumbai"),relayer:{url:vr("mumbai")},indexerUrl:yr("mumbai"),isDefaultChain:!0,isAuthChain:!0}),nr({},Er[wr.BSC_TESTNET],{rpcUrl:br("bsc-testnet"),relayer:{url:vr("bsc-testnet")},indexerUrl:yr("bsc-testnet")}),nr({},Er[wr.ARBITRUM_GOERLI],{rpcUrl:br("arbitrum-goerli"),relayer:{url:vr("arbitrum-goerli")},indexerUrl:yr("arbitrum-goerli")}),nr({},Er[wr.BASE_GOERLI],{rpcUrl:br("base-goerli"),relayer:{url:vr("base-goerli")},indexerUrl:yr("base-goerli")})]),kr={factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}},Ar="2.0";class Tr{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=_r(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const _r=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};function Or(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}function Nr(e){return void 0!==e&&void 0!==e.sendAsync}let Sr=0;class xr{constructor(e,t){this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,Or(e)?this.send=e.send.bind(e):Nr(e)?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:Ar,id:++Sr,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class Rr{constructor(e){this.provider=e,this.sendAsync=(e,t)=>{this.provider.send(e.method,e.params).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.send=this.sendAsync}}class Mr{constructor(e){this.sendAsyncMiddleware=void 0,this.isAllowedFunc=void 0,this.isAllowedFunc=e||(e=>!0),this.sendAsyncMiddleware=Ur(this.isAllowedFunc)}setIsAllowedFunc(e){this.isAllowedFunc=e,this.sendAsyncMiddleware=Ur(this.isAllowedFunc)}}const Ur=e=>t=>(n,i,s)=>{if(!e(n))throw new Error("allowProvider middleware precondition is unmet.");t(n,i,s)};class Br{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class Pr{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}const Lr=e=>(t,n,i)=>{e(t,((e,t)=>{if(!e&&t&&t.error)throw"string"==typeof t.error?new Error(t.error):new Error(t.error.message);n(e,t)}),i)},Dr=e=>(t,n,i)=>{const s=i?` chainId:${i}`:"";Fe.info(`[provider request]${s} id:${t.id} method:${t.method} params:`,t.params),e(t,((e,i)=>{e?Fe.warn(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"error:",e):Fe.info(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"response:",i),n(e,i)}),i)},qr=e=>t=>(n,i,s)=>{const r=e(n),{id:o,method:a}=n;switch(a){case"net_version":return void i(void 0,{jsonrpc:"2.0",id:o,result:`${r}`});case"eth_chainId":return void i(void 0,{jsonrpc:"2.0",id:o,result:x.hexlify(r)})}t(n,i,s)},Gr=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];class Fr{constructor(e){this.provider=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{Gr.includes(t.method)?this.provider.sendAsync(t,n,i):e(t,n,i)},this.provider=e}}class Wr{constructor(e){this.privateJsonRpcMethods=["net_version","eth_chainId","eth_accounts",...Gr],this.provider=void 0,this.rpcUrl=void 0,this.sendAsyncMiddleware=e=>(t,n)=>{!this.provider||this.privateJsonRpcMethods.includes(t.method)?(Fe.debug("[public-provider] sending request to signer window",t.method),e(t,n)):this.provider.send(t.method,t.params).then((e=>{n(void 0,{jsonrpc:"2.0",id:t.id,result:e})})).catch((e=>n(e)))},e&&this.setRpcUrl(e)}getRpcUrl(){return this.rpcUrl}setRpcUrl(e){e&&""!==e?(this.rpcUrl=e,this.provider=new tr.r(e)):(this.rpcUrl=void 0,this.provider=void 0)}}class $r{constructor(){this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(!this.singleflightJsonRpcMethods.includes(t.method))return void e(t,n,i);const s=this.requestKey(t.method,t.params||[],i);this.inflight[s]?this.inflight[s].push({id:t.id,callback:n}):(this.inflight[s]=[],e(t,((e,t,i)=>{n(e,t);for(let n=0;n<this.inflight[s].length;n++){const i=this.inflight[s][n];e?i.callback(e,t):t&&i.callback(void 0,{jsonrpc:"2.0",id:i.id,result:t.result})}delete this.inflight[s]}),i))},this.requestKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.inflight={}}}class Vr extends B.JsonRpcProvider{constructor(e,t){super(e,null==t?void 0:t.chainId),this._chainId=void 0,this._sender=void 0,this.send=(e,t)=>this._sender.send(e,t),this.fetch=(e,t)=>{const n={method:e,params:t,id:this._nextId++,jsonrpc:"2.0"};return ct.fetchJson(this.connection,JSON.stringify(n),jr).then((e=>e),(e=>{throw e}))};const n=null==t?void 0:t.chainId,i=null==t?void 0:t.middlewares,s=null==t?void 0:t.blockCache;this._chainId=n;const r=new Tr(null!=i?i:[new Pr({chainId:n}),new $r,new Br({defaultChainId:n,blockCache:s})],new xr(this.fetch,n));this._sender=new xr(r,n)}async getNetwork(){const e=this._chainId;if(e){const t=Er[e];return{name:(null==t?void 0:t.name)||"",chainId:e,ensAddress:null==t?void 0:t.ensAddress}}{const e=await this.send("eth_chainId",[]);return this._chainId=ve.O$.from(e).toNumber(),this.getNetwork()}}}function jr(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}var Hr=n(21883),Kr=n(8550);function Yr(){return Yr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Yr.apply(this,arguments)}const Jr=e=>{if(e)return(e=>"number"==typeof e?e:e.chainId?e.chainId:ve.O$.from(e).toNumber())(e)},zr=(e,t=!1)=>(((e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const i=[];if(Array.isArray(e)?i.push(...e):i.push(e),0===i.length){if(t)throw new Error("invalid network config: empty config");return!1}const s=i.map((e=>e.chainId)).sort(),r=s.filter(((e,t)=>s.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}i.forEach((e=>e.name=e.name.toLowerCase()));const o=i.map((e=>e.name)).sort(),a=o.filter(((e,t)=>o.indexOf(e)!==t));if(a.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${a}`);return!1}let c=!1,l=!1;for(let e=0;e<i.length;e++){const s=i[e];if(!(s.rpcUrl&&""!==s.rpcUrl||s.provider)){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!s.relayer){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: relayer must be provided`);return!1}if(s.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${s.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(s.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${s.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l){if(t)throw new Error("invalid network config: AuthChain must be set")}})(e,!0,t),e),Zr=e=>zr(Xr(e)),Qr=(e,t)=>{if("string"==typeof t){if(t.startsWith("0x")){const n=ve.O$.from(t).toNumber();return e.find((e=>e.chainId===n))}return e.find((e=>e.name===t))}return"number"==typeof t?e.find((e=>e.chainId===t)):t.chainId?e.find((e=>e.chainId===t.chainId)):void 0},Xr=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const i=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return i>0&&t.splice(1,0,t.splice(i,1)[0]),t},eo=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let i=t[n];return i="function"==typeof i?i():null==i?"":"object"==typeof i||"symbol"==typeof i?i.toString():i.valueOf(),i}))):"";let to;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET",e[e.BASE_GOERLI=84531]="BASE_GOERLI"}(to||(to={}));const no=e=>eo("https://${network}-indexer.sequence.app",{network:e}),io=e=>eo("https://${network}-relayer.sequence.app",{network:e}),so=e=>eo("https://nodes.sequence.app/${network}",{network:e}),ro={[to.MAINNET]:{chainId:to.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[to.ROPSTEN]:{chainId:to.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[to.RINKEBY]:{chainId:to.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",disabled:!0},[to.GOERLI]:{chainId:to.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[to.KOVAN]:{chainId:to.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[to.POLYGON]:{chainId:to.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[to.POLYGON_MUMBAI]:{chainId:to.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[to.POLYGON_ZKEVM]:{chainId:to.POLYGON_ZKEVM,name:"polygon-zkevm",title:"Polygon zkEVM",blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[to.BSC]:{chainId:to.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[to.BSC_TESTNET]:{chainId:to.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[to.OPTIMISM]:{chainId:to.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[to.OPTIMISM_TESTNET]:{chainId:to.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[to.ARBITRUM]:{chainId:to.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[to.ARBITRUM_GOERLI]:{chainId:to.ARBITRUM_GOERLI,name:"arbitrum-goerli",title:"Arbitrum Goerli",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[to.ARBITRUM_NOVA]:{chainId:to.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[to.AVALANCHE]:{chainId:to.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[to.AVALANCHE_TESTNET]:{chainId:to.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[to.FANTOM]:{chainId:to.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[to.FANTOM_TESTNET]:{chainId:to.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[to.GNOSIS]:{chainId:to.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[to.AURORA]:{chainId:to.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[to.AURORA_TESTNET]:{chainId:to.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}},[to.BASE_GOERLI]:{chainId:to.BASE_GOERLI,name:"base-goerli",title:"Base Goerli",blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"}}};Zr([Yr({},ro[to.MAINNET],{rpcUrl:so("mainnet"),relayer:{url:io("mainnet")},indexerUrl:no("mainnet")}),Yr({},ro[to.POLYGON],{rpcUrl:so("polygon"),relayer:{url:io("polygon")},indexerUrl:no("polygon"),isDefaultChain:!0,isAuthChain:!0}),Yr({},ro[to.BSC],{rpcUrl:so("bsc"),indexerUrl:no("bsc"),relayer:{url:io("bsc")}}),Yr({},ro[to.AVALANCHE],{rpcUrl:so("avalanche"),indexerUrl:no("avalanche"),relayer:{url:io("avalanche")}}),Yr({},ro[to.ARBITRUM],{rpcUrl:so("arbitrum"),indexerUrl:no("arbitrum"),relayer:{url:io("arbitrum")}}),Yr({},ro[to.ARBITRUM_NOVA],{rpcUrl:so("arbitrum-nova"),indexerUrl:no("arbitrum-nova"),relayer:{url:io("arbitrum-nova")}}),Yr({},ro[to.OPTIMISM],{rpcUrl:so("optimism"),indexerUrl:no("optimism"),relayer:{url:io("optimism")}}),Yr({},ro[to.POLYGON_ZKEVM],{rpcUrl:so("polygon-zkevm"),indexerUrl:no("polygon-zkevm"),relayer:{url:io("polygon-zkevm")}}),Yr({},ro[to.GNOSIS],{rpcUrl:so("gnosis"),indexerUrl:no("gnosis"),relayer:{url:io("gnosis")}})]),Zr([Yr({},ro[to.RINKEBY],{rpcUrl:so("rinkeby"),relayer:{url:io("rinkeby")},indexerUrl:no("rinkeby")}),Yr({},ro[to.GOERLI],{rpcUrl:so("goerli"),relayer:{url:io("goerli")},indexerUrl:no("goerli")}),Yr({},ro[to.POLYGON_MUMBAI],{rpcUrl:so("mumbai"),relayer:{url:io("mumbai")},indexerUrl:no("mumbai"),isDefaultChain:!0,isAuthChain:!0}),Yr({},ro[to.BSC_TESTNET],{rpcUrl:so("bsc-testnet"),relayer:{url:io("bsc-testnet")},indexerUrl:no("bsc-testnet")}),Yr({},ro[to.ARBITRUM_GOERLI],{rpcUrl:so("arbitrum-goerli"),relayer:{url:io("arbitrum-goerli")},indexerUrl:no("arbitrum-goerli")}),Yr({},ro[to.BASE_GOERLI],{rpcUrl:so("base-goerli"),relayer:{url:io("base-goerli")},indexerUrl:no("base-goerli")})]);class oo{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=ao(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const ao=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let i;i=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)i=n(e[t])(i);return i};let co=0;class lo{constructor(e,t){var n;this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,void 0!==(n=e)&&void 0!==n.send&&void 0!==n.constructor.defaultUrl&&void 0!==n.detectNetwork&&void 0!==n.getSigner&&void 0!==n.perform?this.send=e.send.bind(e):function(e){return void 0!==e&&void 0!==e.sendAsync}(e)?this.send=(t,n,i)=>new Promise(((s,r)=>{e.sendAsync({jsonrpc:"2.0",id:++co,method:t,params:n},((e,t)=>{e?r(e):s(t?t.result:void 0)}),i||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}class ho{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId),s=this.getCacheValue(e);if(s&&""!==s)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,((e,i,s)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&i&&i.result&&this.shouldCacheResponse(t,i)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,i.result):this.setCacheByBlockValue(e,i.result)}n(e,i)}),i||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let i="";return i=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?i+JSON.stringify(t):i+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result||"eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class uo{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{const{id:s,method:r}=t;switch(r){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:s,result:x.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:s,result:[N.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:s,result:this.options.walletContext})}e(t,n,i)},this.options=e}}const po=e=>(t,n,i)=>{e(t,((e,t)=>{if(!e&&t&&t.error)throw"string"==typeof t.error?new Error(t.error):new Error(t.error.message);n(e,t)}),i)},go=e=>(t,n,i)=>{const s=i?` chainId:${i}`:"";Fe.info(`[provider request]${s} id:${t.id} method:${t.method} params:`,t.params),e(t,((e,i)=>{e?Fe.warn(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"error:",e):Fe.info(`[provider response]${s} id:${t.id} method:${t.method} params:`,t.params,"response:",i),n(e,i)}),i)},fo=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];class mo{constructor(e){this.provider=void 0,this.sendAsyncMiddleware=e=>(t,n,i)=>{fo.includes(t.method)?this.provider.sendAsync(t,n,i):e(t,n,i)},this.provider=e}}function wo(){return wo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},wo.apply(this,arguments)}B.JsonRpcProvider;class yo extends URLSearchParams{static new(e){return new URLSearchParams(e)}}let vo,bo,Eo;!function(e){e.OPEN="open",e.CLOSE="close",e.MESSAGE="message",e.CONNECT="connect",e.DISCONNECT="disconnect",e.ACCOUNTS_CHANGED="accountsChanged",e.CHAIN_CHANGED="chainChanged",e.NETWORKS="networks",e.WALLET_CONTEXT="walletContext",e.INIT="init",e.DEBUG="_debug"}(vo||(vo={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.OPENING=1]="OPENING",e[e.OPENED=2]="OPENED"}(bo||(bo={})),function(e){e[e.NIL=0]="NIL",e[e.SENT_NONCE=1]="SENT_NONCE",e[e.OK=2]="OK"}(Eo||(Eo={}));class Co extends Error{constructor(e){super(e),this.name="ProviderError"}}const Io=new Co("Wallet is not signed in. Connect a wallet and try again."),ko=3e4;let Ao=0;const To=()=>++Ao;class _o{constructor(){var e=this;this.pendingMessageRequests=[],this.responseCallbacks=new Map,this.state=void 0,this.confirmationOnly=!1,this.events=new Hr.EventEmitter2,this.openPayload=void 0,this.connectPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this._sessionId=void 0,this._init=void 0,this._registered=void 0,this.sendAsync=async function(t,n,i){e.state===bo.CLOSED&&(e.confirmationOnly=!0),e.openWallet(void 0,{type:"jsonRpcRequest",method:t.method},i);try{e.isOpened()||await e.waitUntilOpened(),n(void 0,(await e.sendMessageRequest({idx:To(),type:vo.MESSAGE,data:t,chainId:i})).data)}catch(e){n(e)}},this.sendMessageRequest=async function(t){return new Promise(((n,i)=>{(!t.idx||t.idx<=0)&&"init"!==t.type&&i(new Error("message idx not set"));const s=t.idx;e.responseCallbacks.get(s)?i(new Error("duplicate message idx, should never happen")):e.responseCallbacks.set(s,((e,t)=>{if(e)i(e);else{if(!t)throw new Error("no valid response to return");n(t)}})),e.isOpened()?e.sendMessage(t):(Fe.debug("pushing to pending requests",t),e.pendingMessageRequests.push(t))}))},this.waitUntilOpened=async function(t=ko){let n=!1;return Promise.race([new Promise(((i,s)=>{const r=setTimeout((()=>{clearTimeout(r),n||(e.state=bo.CLOSED,e.events.emit("close",{code:1005,message:"opening wallet timed out"})),s(new Error("opening wallet timed out"))}),t)})),new Promise((t=>{var i;if(e.isOpened())return n=!0,void t(null==(i=e.openPayload)?void 0:i.session);e.events.once("open",(i=>{e.openPayload=i,n=!0,t(i.session)}))}))])},this.waitUntilConnected=async function(){await e.waitUntilOpened();const t=new Promise((t=>{e.connectPayload?t(e.connectPayload):e.events.once("connect",(n=>{e.connectPayload=n,t(n)}))})),n=new Promise(((t,n)=>{e.events.once("close",(e=>{n(e?new Error(`wallet closed due to ${JSON.stringify(e)}`):new Error("user closed the wallet"))}))}));return Promise.race([t,n])},this.state=bo.CLOSED,this._registered=!1,this._init=Eo.NIL}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}openWallet(e,t,n){throw new Error("abstract method")}closeWallet(){throw new Error("abstract method")}isOpened(){return this.registered&&this.state===bo.OPENED}isConnected(){var e;const t=null==(e=this.openPayload)?void 0:e.session;return this.registered&&void 0!==t&&!!t.accountAddress&&42===t.accountAddress.length&&!!t.networks&&t.networks.length>0}handleMessage(e){var t=this;if(e.type===vo.INIT){Fe.debug("MessageProvider, received INIT message",e);const{nonce:t}=e.data;if(!t||0==t.length)return void Fe.error("invalid init nonce");this._init=Eo.OK,this.sendMessage({idx:-1,type:vo.INIT,data:{sessionId:this._sessionId,nonce:t}})}if(this._init!==Eo.OK)return;Fe.debug("RECEIVED MESSAGE FROM WALLET",e.idx,e);const n=e.idx,i=this.responseCallbacks.get(n);if(n&&this.responseCallbacks.delete(n),e.type!==vo.OPEN||this.isOpened()){if(e.type===vo.MESSAGE){if(this.confirmationOnly&&setTimeout((()=>{0===this.responseCallbacks.size&&this.closeWallet()}),500),!i)throw new Error("impossible state");if(i)return this.events.emit("message",e),void i(e.data.error,e)}if(e.type===vo.ACCOUNTS_CHANGED)return this.accountsChangedPayload={accounts:[]},void(e.data&&e.data.length>0?(this.accountsChangedPayload={accounts:[N.getAddress(e.data[0])],origin:e.origin},this.events.emit("accountsChanged",this.accountsChangedPayload.accounts,this.accountsChangedPayload.origin)):this.events.emit("accountsChanged",[],e.origin));if(e.type!==vo.CHAIN_CHANGED){if(e.type===vo.NETWORKS)return this.networksPayload=e.data,void this.events.emit("networks",this.networksPayload);if(e.type===vo.WALLET_CONTEXT)return this.walletContextPayload=e.data,void this.events.emit("walletContext",this.walletContextPayload);e.type===vo.CLOSE&&this.state!==bo.CLOSED&&this.close(e.data),e.type===vo.CONNECT&&(this.connectPayload=e.data,this.events.emit("connect",this.connectPayload)),e.type===vo.DISCONNECT&&this.isConnected()&&(this.events.emit("disconnect",e.data),this.close())}else this.events.emit("chainChanged",e.data)}else{var s,r;if(this._sessionId&&this._sessionId!==(null==(s=e.data)?void 0:s.sessionId))return void Fe.debug("open event received from wallet, but does not match sessionId",this._sessionId);if(null!=(r=e.data)&&r.error){var o;const t=new Error(`opening wallet failed: received ${null==(o=e.data)?void 0:o.error}`);throw Fe.error(t),this.close(),t}this.state=bo.OPENED,this.openPayload=e.data,this.events.emit("open",this.openPayload),0!==this.pendingMessageRequests.length&&this.pendingMessageRequests.splice(0,this.pendingMessageRequests.length).forEach((async function(e){t.sendMessage(e)}))}}sendMessage(e){throw new Error("abstract method")}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}emit(e,...t){return this.events.emit(e,...t)}close(e){this.state!==bo.CLOSED&&(this.state=bo.CLOSED,this.confirmationOnly=!1,this._sessionId=void 0,Fe.info("closing wallet and flushing!"),this.pendingMessageRequests.length=0,this.responseCallbacks.forEach((e=>{e(wo({},new Error("wallet closed"),{code:4001}))})),this.responseCallbacks.clear(),this.connectPayload=void 0,this.openPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this.events.emit("close",e))}}class Oo{constructor(e,t,n,i=[]){var s=this;this.signer=void 0,this.signerReadyCallbacks=[],this.prompter=void 0,this.mainnetNetworks=void 0,this.testnetNetworks=void 0,this._openIntent=void 0,this._connectOptions=void 0,this._defaultNetworkId=void 0,this._chainId=void 0,this.events=new Hr.EventEmitter2,this.onConnectOptionsChange=void 0,this.promptConnect=async function(e){if(!e&&!s._connectOptions)throw new Error("prompter connect options are empty");if(!s.prompter)return s.connect(e);const t=await s.prompter.promptConnect(e||s._connectOptions).catch((e=>({connected:!1}))),n=t;return n.connected&&!n.session&&(n.session=await s.walletSession()),t},this.sendAsync=async function(e,t,n){const i={jsonrpc:"2.0",id:e.id,result:null};await s.getSigner();try{if(!(s.signer&&null!==s.signer||No.includes(e.method)))throw Io;const t=s.signer;if(!t)throw new Error("WalletRequestHandler: wallet signer is not configured");const r=await t.getProvider(n);if(!r)throw new Error(`WalletRequestHandler: wallet provider is not configured for chainId ${n}`);switch(e.method){case"net_version":{const e=await r.send("net_version",[]);i.result=e;break}case"eth_chainId":{const e=await r.send("eth_chainId",[]);i.result=e;break}case"eth_accounts":{const e=await t.getAddress();i.result=[e];break}case"eth_getBalance":{const[t,n]=e.params,s=await r.getBalance(t,n);i.result=s.toHexString();break}case"personal_sign":case"eth_sign":{let r;if("personal_sign"===e.method){const[t,n]=e.params;r=t}else{const[t,n]=e.params;r=n}let o="";const a=Wo(r);if(null===s.prompter?o=await t.signMessage(a,n):await s.handleConfirmWalletDeployPrompt(s.prompter,t,n)&&(o=await s.prompter.promptSignMessage({chainId:n,message:a},s.connectOptions)),!(o&&o.length>0))throw new Error("declined by user");i.result=o;break}case"eth_signTypedData":case"eth_signTypedData_v4":{const[r,o]=e.params;let a;if("string"==typeof o)try{a=JSON.parse(o)}catch(e){}else a=o;if(!(a&&a.domain&&a.types&&a.message))throw new Error("invalid typedData object");let c="";if(null===s.prompter?c=await t.signTypedData(a.domain,a.types,a.message,n):await s.handleConfirmWalletDeployPrompt(s.prompter,t,n)&&(c=await s.prompter.promptSignMessage({chainId:n,typedData:a},s.connectOptions)),!(c&&c.length>0))throw new Error("declined by user");i.result=c;break}case"eth_sendTransaction":{const[r]=e.params;"gas"in r&&void 0===r.gasLimit&&(r.gasLimit=r.gas,delete r.gas);let o="";if(o=null===s.prompter?(await t.sendTransaction(r,n)).hash:await s.prompter.promptSendTransaction(r,n,s.connectOptions),!o)throw new Error("declined by user");i.result=o;break}case"eth_signTransaction":{const[r]=e.params;if(N.getAddress(r.from)!==await t.getAddress())throw new Error("sender address does not match wallet");null===s.prompter?i.result=await t.signTransactions(r,n):i.result=await s.prompter.promptSignTransaction(r,n,s.connectOptions);break}case"eth_sendRawTransaction":if(Ni(e.params[0])){const n=ve.O$.from(e.params[0].chainId).toNumber(),s=await(await t.getRelayer(n)).relay(e.params[0]);i.result=(await s).hash}else{const t=await r.sendTransaction(e.params[0]);i.result=t.hash}break;case"eth_getTransactionCount":{const n=N.getAddress(e.params[0]),s=e.params[1];if(n===N.getAddress(await t.getAddress())){const e=await t.getTransactionCount(s);i.result=ve.O$.from(e).toHexString()}else{const e=await r.getTransactionCount(n,s);i.result=ve.O$.from(e).toHexString()}break}case"eth_blockNumber":i.result=await r.getBlockNumber();break;case"eth_getBlockByNumber":case"eth_getBlockByHash":i.result=await r.getBlock(e.params[0]);break;case"eth_getTransactionByHash":i.result=await r.getTransaction(e.params[0]);break;case"eth_call":{const[t,n]=e.params;i.result=await r.call(t,n);break}case"eth_getCode":{const[t,n]=e.params;i.result=await r.getCode(t,n);break}case"eth_estimateGas":{const[t]=e.params;i.result=await r.estimateGas(t);break}case"eth_gasPrice":{const e=await r.getGasPrice();i.result=e.toHexString();break}case"wallet_switchEthereumChain":{const[t]=e.params;if(!t.chainId||0===t.chainId.length)throw new Error("invalid chainId");const n=ve.O$.from(t.chainId);if(!await s.setDefaultNetwork(n.toString(),!0))throw new Error(`unable to set chainId ${n}`);i.result=null;break}case"sequence_getWalletContext":i.result=await t.getWalletContext();break;case"sequence_getWalletConfig":{const[n]=e.params;i.result=await t.getWalletConfig(n);break}case"sequence_getWalletState":{const[n]=e.params;i.result=await t.getWalletState(n);break}case"sequence_getNetworks":i.result=await s.getNetworks(!0);break;case"sequence_isSequence":i.result=!0;break;case"sequence_updateConfig":throw new Error("sequence_updateConfig method is not allowed from a dapp");case"sequence_publishConfig":throw new Error("sequence_publishConfig method is not allowed from a dapp");case"sequence_gasRefundOptions":case"sequence_getNonce":case"sequence_relay":break;case"sequence_setDefaultNetwork":{const[t]=e.params;if(!t)throw new Error("invalid request, method argument defaultNetworkId cannot be empty");if(!await s.setDefaultNetwork(t))throw new Error(`unable to set default network ${t}`);i.result=await s.getNetworks(!0);break}default:{const t=await r.send(e.method,e.params);i.result=t}}}catch(e){Fe.error(e),i.result=null,i.error=wo({},new Error(e),{code:4001})}t(void 0,i)},this.isSignedIn=async function(){return await s.signerReady(),!!s.signer},this.getSigner=async function(){if(await s.signerReady(),void 0===s.signer)throw new Error("signerReady failed resolve");return s.signer},this.signer=e,this.prompter=t,this.mainnetNetworks=n,this.testnetNetworks=i}async signIn(e,t={}){this.setSigner(e);const{connect:n,mainnetNetworks:i,testnetNetworks:s,defaultNetworkId:r}=t;if(i&&i.length>0&&(this.mainnetNetworks=i),s&&s.length>0&&(this.testnetNetworks=s),!(this.mainnetNetworks&&0!==this.mainnetNetworks.length||this.testnetNetworks&&0!==this.testnetNetworks.length))throw new Error("signIn failed as network configuration is empty");const o=r||this._defaultNetworkId;if(o&&!await this.setDefaultNetwork(o,!1))throw new Error(`WalletRequestHandler setup unable to set defaultNetworkId ${o}`);if(n){const e=this._connectOptions;let t;var a;t=null!==this.prompter?await(null==(a=this.prompter)?void 0:a.promptSignInConnect(e)):await this.connect(e),this.notifyConnect(t),e&&!0===e.keepWalletOpened||this.notifyClose()}}signOut(){this.setSigner(null)}signerReset(){this.signer=void 0}signerReady(e=1e4){return new Promise(((t,n)=>{void 0!==this.signer?t():(setTimeout((()=>{void 0===this.signer&&(this.signerReadyCallbacks=[],n("signerReady timed out"))}),e),this.signerReadyCallbacks.push(t))}))}async connect(e){if(!this.signer)return{connected:!1,chainId:"0x0",error:"unable to connect without signed in account"};const t={connected:!0,chainId:x.hexlify(await this.getChainId())};if(e&&e.authorize){const n={app:e.app,origin:e.origin,expiry:e.expiry};try{t.proof=await $s(this.signer,n)}catch(t){return Fe.warn(`connect, signAuthorization failed for options: ${JSON.stringify(e)}, due to: ${t.message}`),{connected:!1,chainId:"0x0",error:`signAuthorization failed: ${t.message}`}}}return t.session=await this.walletSession(),t}sendMessageRequest(e){return new Promise((t=>{this.sendAsync(e.data,((n,i)=>{const s=wo({},e,{data:i});t(s)}),e.chainId)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}async getAddress(){return this.signer?this.signer.getAddress():""}async getChainId(){return this.signer?(this._chainId||(this._chainId=await this.signer.getChainId()),this._chainId):0}get openIntent(){return this._openIntent}setOpenIntent(e){this._openIntent=e}get connectOptions(){return this._connectOptions}setConnectOptions(e){var t;this._connectOptions=e,null==(t=this.onConnectOptionsChange)||t.call(this,e)}get defaultNetworkId(){return this._defaultNetworkId}async setDefaultNetwork(e,t=!0){if(e&&(this._defaultNetworkId=e,this._chainId=void 0,this.signer&&this.signer.setNetworks)){const n=this.signer.setNetworks(this.mainnetNetworks,this.testnetNetworks,e);return n&&t&&await this.notifyNetworks(),n}}async getNetworks(e){if(!this.signer)return Fe.warn("signer not set: getNetworks is returning an empty list"),[];const t=await this.signer.getNetworks();return e?t.map((e=>{const t=wo({},e);return t.provider=void 0,t.relayer=void 0,t})):t}async walletSession(){return this.signer?{walletContext:await this.signer.getWalletContext(),accountAddress:await this.signer.getAddress(),networks:await this.getNetworks(!0)}:void 0}notifyConnect(e,t){var n,i;this.events.emit("connect",e),null!=(n=e.session)&&n.accountAddress&&this.events.emit("accountsChanged",[null==(i=e.session)?void 0:i.accountAddress],t)}notifyDisconnect(e){this.events.emit("accountsChanged",[],e),this.events.emit("disconnect")}async notifyNetworks(e){const t=e||await this.getNetworks(!0);if(this.events.emit("networks",t),t.length>0){const e=t.find((e=>e.isDefaultChain));e&&this.events.emit("chainChanged",x.hexlify(e.chainId))}else this.events.emit("chainChanged","0x0")}async notifyWalletContext(){if(!this.signer)return void Fe.warn("signer not set: skipping to notify wallet context");const e=await this.signer.getWalletContext();this.events.emit("walletContext",e)}notifyClose(e){this.events.emit("close",e)}setSigner(e){if(this.signer=e,void 0!==e){for(let e=0;e<this.signerReadyCallbacks.length;e++)this.signerReadyCallbacks[e]();this.signerReadyCallbacks=[]}}async handleConfirmWalletDeployPrompt(e,t,n){return!n||(!!await Jo(t,n)||!!await e.promptConfirmWalletDeploy(n,this.connectOptions)&&(!!await Jo(t,n)||(Fe.error("WalletRequestHandler: result for promptConfirmWalletDeploy is not correct"),!1)))}}const No=["net_version","eth_chainId","eth_getBalance","eth_getTransactionCount","eth_blockNumber","eth_getBlockByNumber","eth_getBlockByHash","eth_getTransactionByHash","eth_getCode","eth_estimateGas","eth_gasPrice","sequence_getWalletContext","sequence_getNetworks","sequence_setDefaultNetwork"];class So extends Kr.Q{static isSequenceProvider(e){return xo(e)}constructor(e,t){const n=new lo(e,Jr(t));super(e=n,"any"),this._sender=void 0,this._isSequenceProvider=void 0,this._defaultChainId=void 0,this._sender=n,this._isSequenceProvider=!0,this._defaultChainId=Jr(t)}sendAsync(e,t,n){this._sender.sendAsync(e,t,n)}send(e,t,n){return this._sender.send(e,t,n)}request(e){return this.send(e.method,e.params||[],e.chainId)}getSigner(){return new Mo(this,this._defaultChainId)}async getChainId(){const e=await this.send("eth_chainId",[]),t=ve.O$.from(e).toNumber();if(this._defaultChainId&&this._defaultChainId!==t)throw new Error(`provider chainId (${t}) does not match provider-bound chainId ${this._defaultChainId}`);return t}}function xo(e){const t=e;return t&&void 0!==t.send&&!0===t._isSequenceProvider}class Ro extends So{constructor(e,t){super(new Oo(e,null,t||[]))}}class Mo extends Ts{constructor(e,t){super(),this.provider=void 0,this.defaultChainId=void 0,this._address=void 0,this._index=void 0,this._context=void 0,this._networks=void 0,this._providers={},this.provider=e,this.defaultChainId=t}async getAddress(){if(this._address)return this._address;const e=await this.provider.send("eth_accounts",[]);return this._address=e[0],this._index=0,N.getAddress(this._address)}signTransaction(e){throw new Error("signTransaction is unsupported, use signTransactions instead")}connect(e){throw new Error("unsupported: cannot alter JSON-RPC Signer connection")}async getProvider(e){if(e){const t=await this.getChainId();if(t!==e)throw new Error(`signer is attempting to access chain ${e}, but is already bound to chain ${t}`)}return this.provider}async getSender(e){return!e||e&&e===this.defaultChainId?this.provider:(this._providers[e]||(this._providers[e]=new So(new lo(this.provider,e),e)),this._providers[e])}getRelayer(e){throw new Error("TODO")}async getWalletContext(){return this._context||(this._context=await this.provider.send("sequence_getWalletContext",[])),this._context}async getWalletConfig(e){return await this.provider.send("sequence_getWalletConfig",[Jr(e)],Jr(e)||this.defaultChainId)}async getWalletState(e){return await this.provider.send("sequence_getWalletState",[Jr(e)],Jr(e)||this.defaultChainId)}async getNetworks(){return this._networks||(this._networks=await this.provider.send("sequence_getNetworks",[])),this._networks}async getSigners(){const e=(await this.getNetworks()).find((e=>e.isAuthChain));if(!e)throw new Error("authChainId could not be determined from network list");const t=await this.getWalletConfig(e);if(!t||0===t.length)throw new Error("walletConfig returned zero results for authChainId {authChainId}");return t[0].signers.map((e=>e.address))}async signMessage(e,t,n){const i=await this.getSender(Jr(t)||this.defaultChainId),s="string"==typeof e?Ae.Y0(e):e,r=await this.getAddress();return await i.send("personal_sign",[x.hexlify(s),r])}async signTypedData(e,t,n,i,s){return await this.provider.send("eth_signTypedData_v4",[await this.getAddress(),M.E.getPayload(e,t,n)],Jr(i)||this.defaultChainId)}async sendTransaction(e,t,n){const i=await this.getSender(Jr(t)||this.defaultChainId);return this.sendUncheckedTransaction(e,t).then((e=>ct.poll((()=>i.getTransaction(e).then((t=>{if(null!==t)return i._wrapTransaction(t,e)}))),{onceBlock:this.provider}).catch((t=>{throw t.transactionHash=e,t}))))}async sendTransactionBatch(e,t,n){const i=await Ss(e);if(!i||0===i.length)throw new Error("cannot send empty batch");if(i.find((e=>void 0!==e.wait&&null!==e.wait)))throw new Error("transaction request expected for sendTransactionBatch, transaction response found");const s=wo({},i[0]);return i.length>1&&(s.auxiliary=i.splice(1)),this.sendTransaction(s,t,n)}signTransactions(e,t,n){return e=it(e),this.provider.send("eth_signTransaction",[e],Jr(t)||this.defaultChainId)}sendSignedTransactions(e,t){throw new Error("TODO")}async updateConfig(e){const[t,n]=await this.provider.send("sequence_updateConfig",[e],this.defaultChainId);return null===n?[t,void 0]:[t,(await this.getSender(this.defaultChainId))._wrapTransaction(n,n.hash)]}async publishConfig(){const e=await this.getSender(this.defaultChainId),t=await e.send("sequence_publishConfig",[]);if(null!==t)return e._wrapTransaction(t,t.hash)}async isDeployed(e){const t=await this.getSender(Jr(e)),n=await t.getCode(await this.getAddress());return!!n&&"0x"!==n}async _legacySignMessage(e,t,n){const i=await this.getSender(Jr(t)||this.defaultChainId),s="string"==typeof e?Ae.Y0(e):e,r=await this.getAddress();return await i.send("eth_sign",[r,x.hexlify(s)])}async _signTypedData(e,t,n,i,s){return this.signTypedData(e,t,n,i,s)}async sendUncheckedTransaction(e,t){e=it(e);const n=this.getAddress(),i=await this.getSender(Jr(t)||this.defaultChainId);return tt({tx:tt(e),sender:await n}).then((({tx:t,sender:n})=>{if(null!=t.from){if(N.getAddress(t.from)!==n)throw new Error(`from address mismatch for transaction ${e}`)}else t.from=n;const s=Bo(t);return i.send("eth_sendTransaction",[s]).then((e=>e),(e=>{throw e}))}))}connectUnchecked(){return new Po(this.provider,this.defaultChainId)}async unlock(e){const t=await this.getAddress();return this.provider.send("personal_unlockAccount",[t,e,null])}}const Uo={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0,from:!0,auxiliary:!0,expiration:!0,afterNonce:!0,delegateCall:!0,revertOnError:!0},Bo=(e,t)=>{const n=it(Uo);if(t)for(const e in t)t[e]&&(n[e]=!0);ri.checkProperties(e,n);const i={};["gasLimit","gasPrice","nonce","value"].forEach((t=>{const n=e[t];if(null==n)return;const s=x.hexValue(n);"gasLimit"===t&&(t="gas"),i[t]=s})),["from","to","data"].forEach((t=>{e[t]&&(i[t]=x.hexlify(e[t]))})),["delegateCall","revertOnError"].forEach((t=>{const n=e[t];null!=n&&(i[t]=n)}));const s=e.auxiliary;return s&&s.length>0&&(i.auxiliary=[],s.forEach((e=>{i.auxiliary.push(Bo(e))}))),i};class Po extends Mo{sendTransaction(e){return this.sendUncheckedTransaction(e).then((e=>({chainId:0,confirmations:0,data:"",from:"",gasLimit:be._Y,gasPrice:be._Y,hash:e,nonce:0,value:be._Y,wait:t=>this.provider.waitForTransaction(e,t)})))}}const Lo=[{name:"Decentraland Exception",predicate:function(e){try{const t=Ae.ZN(e);return Do.test(t)}catch(e){return!1}}},{name:"0x v3 Exception",predicate:function(e){const t=new at.vU(qo);try{return t.decodeFunctionData("OrderWithHash",e),!0}catch(e){return!1}}}],Do=/^Decentraland Login\nEphemeral address: 0x[a-fA-F0-9]{40}\nExpiration: (\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)((-(\d{2}):(\d{2})|Z)?)$/,qo=[{inputs:[{components:[{internalType:"address",name:"makerAddress",type:"address"},{internalType:"address",name:"takerAddress",type:"address"},{internalType:"address",name:"feeRecipientAddress",type:"address"},{internalType:"address",name:"senderAddress",type:"address"},{internalType:"uint256",name:"makerAssetAmount",type:"uint256"},{internalType:"uint256",name:"takerAssetAmount",type:"uint256"},{internalType:"uint256",name:"makerFee",type:"uint256"},{internalType:"uint256",name:"takerFee",type:"uint256"},{internalType:"uint256",name:"expirationTimeSeconds",type:"uint256"},{internalType:"uint256",name:"salt",type:"uint256"},{internalType:"bytes",name:"makerAssetData",type:"bytes"},{internalType:"bytes",name:"takerAssetData",type:"bytes"},{internalType:"bytes",name:"makerFeeAssetData",type:"bytes"},{internalType:"bytes",name:"takerFeeAssetData",type:"bytes"}],internalType:"struct IEIP1271Data.Order",name:"order",type:"tuple"},{internalType:"bytes32",name:"orderHash",type:"bytes32"}],name:"OrderWithHash",outputs:[],stateMutability:"pure",type:"function"}],Go=Ae.Y0("Ethereum Signed Message:\n"),Fo=e=>x.isBytes(e)||x.isHexString(e)?x.arrayify(e):Ae.Y0(e),Wo=e=>{const t=Fo(e);return function(e){return Lo.some((t=>t.predicate(e)))}(t)?t:x.concat([Go,Ae.Y0(String(t.length)),t])},$o=async(e,t,n,i,s,r)=>{var o;return s||(s=null==(o=await i.getNetwork())?void 0:o.chainId),!r&&So.isSequenceProvider(i)&&(r=await i.getSigner().getWalletContext()),Ms(e,t,n,i,r,s)},Vo=async(e,t,n,i,s,r)=>{const o=Wo(t),a=Re(o);return $o(e,a,n,i,s,r)},jo=(e,t,n,i,s,r)=>$o(e,Qe(t),n,i,s,r),Ho=async(e,t,n,i,s)=>{const r=Me(e,i,t),o=await(async(e,t,n,i,s,r)=>{const o=x.arrayify(R.keccak256(e));return Ps(o,t,void 0,void 0,void 0,void 0)})(r,n);if(s){const e=Lt(o,s);if(o.address&&o.address!==e)throw new Error("recovered address does not match the WalletConfig address, check the WalletContext");o.address=e}return o},Ko=()=>"chrome-extension:"===window.location.protocol||"moz-extension:"===window.location.protocol,Yo=()=>!!navigator.userAgent.match(/UnitySequence/i),Jo=async(e,t)=>{var n;const i=await e.getWalletState(),s=await e.getNetworks(),r=i.find((e=>e.chainId===t));if(!r)throw new Error(`WalletRequestHandler: could not find wallet state for chainId ${t}`);const o=r.deployed;if(!s)throw new Error("isWalletUpToDate util: could not get networks from signer");const a=s.find((e=>e.isAuthChain));if(!a)throw new Error("isWalletUpToDate util: could not get auth chain network information");const c=a.chainId,l=null==(n=i.find((e=>e.chainId===c)))?void 0:n.config;if(!l)throw new Error("isWalletUpToDate util: could not get auth chain config");const h=r.config;if(!h)throw new Error(`isWalletUpToDate util: could not get config for chainId ${t}`);const d=Gt(l,h);return o&&d};class zo{constructor(){}static getInstance(){return"object"==typeof window?zo._instance||(zo._instance={getItem:e=>Promise.resolve(window.localStorage.getItem(e)),setItem:(e,t)=>Promise.resolve(window.localStorage.setItem(e,t)),removeItem:e=>Promise.resolve(window.localStorage.removeItem(e))}):zo._instance||(zo._instance={getItem:e=>Promise.resolve(null),setItem:(e,t)=>Promise.resolve(),removeItem:e=>Promise.resolve()}),this._instance}static use(e){zo._instance=e}}zo._instance=void 0;class Zo{constructor(e,t){this.def=t,this.key=void 0,this.key=e}async get(){const e=await zo.getInstance().getItem(this.key);if(null===e)return this.def;try{return JSON.parse(e)}catch(e){console.error(e)}}set(e){e?zo.getInstance().setItem(this.key,JSON.stringify(e)):zo.getInstance().removeItem(this.key)}del(){zo.getInstance().removeItem(this.key)}}const Qo="@sequence.transportSession";class Xo{constructor(e){var t=this;this.walletRequestHandler=void 0,this._sessionId=void 0,this._registered=void 0,this._init=void 0,this._initNonce=void 0,this._initCallback=void 0,this.appOrigin=void 0,this.sendAsync=async function(e,t,n){throw new Error("abstract method")},this.handleMessage=async function(e){const n=e;if(t._init===Eo.OK)switch(n.type){case vo.OPEN:{if(t._init!==Eo.OK)return;const e={sessionId:n.data.sessionId,intent:n.data.intent,networkId:n.data.networkId};return void await t.open(e)}case vo.CLOSE:return t._init,void Eo.OK;case vo.MESSAGE:{const e=await t.walletRequestHandler.sendMessageRequest(n);return t.sendMessage(e),void e.data.error}default:Fe.error(`unexpected payload type ${n.type}`)}else if(n.type===vo.INIT){if(!t.isValidInitAck(e))return void(t._initCallback&&t._initCallback("invalid init"));t._initCallback&&t._initCallback()}},this.sendMessageRequest=async function(e){return t.walletRequestHandler.sendMessageRequest(e)},this.open=async function({sessionId:e,intent:n,networkId:i}){if(e&&(t._sessionId=Ke(e),t.saveTransportSession({sessionId:e,intent:n,networkId:i})),t.walletRequestHandler.setOpenIntent(n),await t.init(),n&&"connect"===n.type&&n.options){const e=n.options,s=e;if(t.appOrigin&&null!=s&&s.origin){if(!Ko()&&s.origin!==t.appOrigin)throw new Error("origin is invalid")}else!t.appOrigin&&null!=s&&s.origin?e.origin=Je(s.origin):t.appOrigin&&(e.origin=t.appOrigin);e.app&&(e.app=Ye(e.app)),t.walletRequestHandler.setConnectOptions(e),e.networkId?i=e.networkId:i&&(e.networkId=i)}else t.walletRequestHandler.setConnectOptions(void 0);if(await t.walletRequestHandler.getSigner(),!await t.walletRequestHandler.isSignedIn())return t.notifyOpen({sessionId:t._sessionId}),!0;if(n&&"connect"===n.type){let e;try{e=i?await t.walletRequestHandler.setDefaultNetwork(i,!1):await t.walletRequestHandler.getChainId()}catch(e){console.error(e)}(!e||e<=0)&&console.log("Failed to set default network on open"),t.notifyOpen({sessionId:t._sessionId});try{const e=await t.walletRequestHandler.promptConnect(n.options);e.connected&&t.walletRequestHandler.notifyConnect(e)}catch(e){Fe.warn("promptConnect not connected:",e)}finally{n.options&&!0===n.options.keepWalletOpened||t.notifyClose()}}else{let e;try{e=i?await t.walletRequestHandler.setDefaultNetwork(i,!1):await t.walletRequestHandler.getChainId()}catch(e){console.error(e)}if(!e||e<=0)return t.notifyOpen({sessionId:t._sessionId,error:`failed to open wallet on network ${i}`}),!1;t.notifyOpen({sessionId:t._sessionId,chainId:`${e}`,session:await t.walletRequestHandler.walletSession()})}return!0},this.saveTransportSession=e=>{zo.getInstance().setItem(Qo,JSON.stringify(e))},this.getCachedTransportSession=async function(){const e=await zo.getInstance().getItem(Qo);try{return e?JSON.parse(e):null}catch(t){return console.error(`unable to parse transport session: ${e}`),null}},this.walletRequestHandler=e,this._init=Eo.NIL,this.walletRequestHandler.on("connect",(e=>{this.registered&&this.notifyConnect(e)})),this.walletRequestHandler.on("disconnect",(e=>{this.registered&&this.notifyDisconnect(e)})),this.walletRequestHandler.on("accountsChanged",((e,t)=>{this.registered&&this.notifyAccountsChanged(e,t)})),this.walletRequestHandler.on("networks",(e=>{this.registered&&(this.notifyNetworks(e),e&&0!==e.length?this.notifyChainChanged(x.hexlify(e.find((e=>e.isDefaultChain)).chainId)):this.notifyChainChanged("0x0"))})),this.walletRequestHandler.on("walletContext",(e=>{this.registered&&e&&this.notifyWalletContext(e)})),this.walletRequestHandler.on("close",(e=>{this.registered&&this.notifyClose(e)}))}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}sendMessage(e){throw new Error("abstract method")}notifyOpen(e){const{chainId:t,sessionId:n,session:i,error:s}=e;this.sendMessage({idx:-1,type:vo.OPEN,data:{chainId:t,sessionId:n,session:i,error:s}})}notifyClose(e){this.sendMessage({idx:-1,type:vo.CLOSE,data:e?{error:e}:null})}notifyConnect(e){this.sendMessage({idx:-1,type:vo.CONNECT,data:e})}notifyDisconnect(e){this.sendMessage({idx:-1,type:vo.DISCONNECT,data:e?{error:e}:null})}notifyAccountsChanged(e,t){this.sendMessage({idx:-1,type:vo.ACCOUNTS_CHANGED,data:e,origin:t})}notifyChainChanged(e){this.sendMessage({idx:-1,type:vo.CHAIN_CHANGED,data:e})}notifyNetworks(e){this.sendMessage({idx:-1,type:vo.NETWORKS,data:e})}notifyWalletContext(e){this.sendMessage({idx:-1,type:vo.WALLET_CONTEXT,data:e})}isValidInitAck(e){if(this._init===Eo.OK)return Fe.warn("isValidInitAck, already in init'd state, so inquiry is invalid."),!1;if(e.type!==vo.INIT)return Fe.warn("isValidInitAck, invalid message type, expecting init"),!1;const{sessionId:t,nonce:n}=e.data;return t&&0!==t.length&&n&&0!==n.length?t===this._sessionId&&n===this._initNonce||(Fe.error("invalid init ack match"),!1):(Fe.error("invalid init ack"),!1)}init(){return new Promise(((e,t)=>{if(this._init===Eo.OK)return void e();if(this._init!==Eo.NIL||this._initCallback)return void t("transport init is in progress");const n=setTimeout((()=>{Fe.warn("transport init timed out"),this._initCallback&&this._initCallback("transport init timed out")}),ko/2);this._initCallback=i=>{this._initCallback=void 0,clearTimeout(n),i?t(i):(this._init=Eo.OK,e())},this._initNonce=`${performance.now()}`,this.sendMessage({idx:-1,type:vo.INIT,data:{nonce:this._initNonce}}),this._init=Eo.SENT_NONCE}))}}class ea{constructor(){this.app=void 0,this.wallet=void 0;const e=new ta,t=new ta;e.conn=t,t.conn=e,this.app=e,this.wallet=t}}class ta{constructor(){this.conn=void 0,this.events=new Hr.EventEmitter2,this.handleMessage=e=>{throw new Error("ProxyMessageChannelPort is not registered")},this.sendMessage=e=>{this.conn.handleMessage(e),"open"===e.type&&this.events.emit("open",e),"close"===e.type&&this.events.emit("close",e),"connect"===e.type&&this.events.emit("connect",e),"disconnect"===e.type&&this.events.emit("disconnect",e)}}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}}class na extends _o{constructor(e){if(super(),this.port=void 0,this.register=()=>{this.port.handleMessage=e=>{this.handleMessage(e)},this.on("open",((...e)=>{this.port.events.emit("open",...e)})),this.on("close",((...e)=>{this.port.events.emit("close",...e)})),this.on("connect",((...e)=>{this.port.events.emit("connect",...e)})),this.on("disconnect",((...e)=>{this.port.events.emit("disconnect",...e)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),this.events.removeAllListeners(),this.port.handleMessage=void 0},this.openWallet=(e,t,n)=>{if(this.state===bo.CLOSED){this.state=bo.OPENING;const i=`${performance.now()}`;this._sessionId=i,this.sendMessage({idx:-1,type:vo.OPEN,data:{path:e,intent:t,networkId:n,sessionId:i}})}},this.state=bo.CLOSED,this.port=e,!e)throw new Error("port argument cannot be empty");this._init=Eo.OK}closeWallet(){this.sendMessage({idx:-1,type:vo.CLOSE,data:null}),this.close()}sendMessage(e){if(!e.idx)throw new Error("message idx is empty");this.port.sendMessage(e)}}class ia extends Xo{constructor(e,t){super(e),this.port=void 0,this.port=t,this._init=Eo.OK}register(){this.port.handleMessage=e=>{this.handleMessage(e)},this._registered=!0}async restoreSession(){const e=await this.getCachedTransportSession();e&&this.open(e)}unregister(){this.port.handleMessage=void 0,this._registered=!1}sendMessage(e){this.port.sendMessage(e)}}class sa{constructor(...e){var t=this;this.messageProviders=void 0,this.provider=void 0,this.register=()=>{if(1===this.messageProviders.length)return this.provider=this.messageProviders[0],void this.provider.register();this.messageProviders.forEach((e=>{e.register(),e.once("open",(()=>{this.provider||(this.provider=e,this.messageProviders.forEach((e=>{this.provider!==e&&e.unregister()})))}))}))},this.unregister=()=>{this.messageProviders.forEach((e=>e.unregister())),this.provider=void 0},this.openWallet=(e,t,n)=>{this.provider?this.provider.openWallet(e,t,n):this.messageProviders.forEach((i=>i.openWallet(e,t,n)))},this.sendAsync=async function(e,n,i){if(!t.provider)throw new Error("impossible state, wallet must be opened first");t.provider.sendAsync(e,n,i)},this.sendMessageRequest=async function(e){if(t.provider)return t.provider.sendMessageRequest(e);throw new Error("impossible state, wallet must be opened first")},this.waitUntilOpened=async function(){return t.provider?t.provider.waitUntilOpened():Promise.race(t.messageProviders.map((e=>e.waitUntilOpened())))},this.waitUntilConnected=async function(){if(t.provider)return t.provider.waitUntilConnected();throw new Error("impossible state, wallet must be opened first")},this.messageProviders=e,this.provider=void 0}add(...e){this.messageProviders.push(...e)}closeWallet(){this.provider&&this.provider.closeWallet()}isOpened(){return!!this.provider&&this.provider.isOpened()}isConnected(){return!!this.provider&&this.provider.isConnected()}on(e,t){this.provider?this.provider.on(e,t):this.messageProviders.forEach((n=>{n.on(e,t)}))}once(e,t){this.provider?this.provider.once(e,t):this.messageProviders.forEach((n=>{n.once(e,t)}))}emit(e,...t){if(this.provider)return this.provider.emit(e,...t);for(let n=0;n<this.messageProviders.length;n++)this.messageProviders[n].emit(e,...t);return!0}sendMessage(e){if(!e.idx||e.idx<=0)throw new Error("message idx is empty");if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.sendMessage(e)}handleMessage(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.handleMessage(e)}}let ra;class oa extends _o{constructor(e){super(),this.walletURL=void 0,this.walletWindow=void 0,this.register=()=>{ra&&(ra.unregister(),ra=this),window.addEventListener("message",this.onWindowEvent),ra=this,this.on("open",(()=>{const e=this.walletWindow,t=setInterval((()=>{e&&e.closed&&(clearInterval(t),this.close())}),500)})),this.on("close",(()=>{this.walletWindow&&(this.walletWindow.close(),this.walletWindow=null)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),ra===this&&(ra=void 0),window.removeEventListener("message",this.onWindowEvent),this.events.removeAllListeners()},this.openWallet=(e,t,n)=>{if(this.walletWindow&&this.isOpened())return void this.walletWindow.focus();const i=new URL(this.walletURL.href),s=new yo;let r,o;e&&""!==e&&(i.pathname=e.toLowerCase()),this._init=Eo.NIL,this._sessionId=`${performance.now()}`,s.set("sid",this._sessionId),t&&("connect"===t.type&&(t.options||(t.options={}),Ko()||Yo()||(t.options.origin=window.location.origin)),s.set("intent",Ne(t))),n&&s.set("net",`${n}`),Ko()?(r=[450,750],o=[Math.abs(window.screen.width/2-r[0]/2),Math.abs(window.screen.height/2-r[1]/2)]):(r=[450,750],o=[Math.abs(window.screenX+window.innerWidth/2-r[0]/2),Math.abs(window.screenY+window.innerHeight/2-r[1]/2)]);const a=`toolbar=0,location=0,menubar=0,scrollbars=yes,status=yes,width=${r[0]},height=${r[1]},left=${o[0]},top=${o[1]}`;i.search=s.toString(),this.walletWindow=window.open(i.href,"sequence.app",a)},this.onWindowEvent=e=>{if(e.origin!==this.walletURL.origin)return;let t;try{t=JSON.parse(e.data)}catch(e){return}if(!t)throw new Error("ProviderMessage object is empty");this.handleMessage(t)},this.walletURL=new URL(e)}closeWallet(){var e;this.close(),null==(e=this.walletWindow)||e.close()}sendMessage(e){if(!this.walletWindow)return void Fe.warn("WindowMessageProvider: sendMessage failed as walletWindow is unavailable");const t="string"!=typeof e?JSON.stringify(e):e;this.walletWindow.postMessage(t,this.walletURL.origin)}}class aa extends Xo{constructor(e){var t;super(e),t=this,this.parentWindow=void 0,this._isPopup=!1,this.onWindowEvent=async function(e){if(!e.origin||""===e.origin)return;if(t.appOrigin&&e.origin!==t.appOrigin)return;let n;try{n=JSON.parse(e.data)}catch(e){return}Fe.debug("RECEIVED MESSAGE",n),t._init!==Eo.OK&&t.isValidInitAck(n)&&(t.appOrigin=e.origin),t._init!==Eo.OK||t.appOrigin&&!(t.appOrigin.length<8)?t.handleMessage(n):Fe.error("impossible state, init.OK and appOrigin required")},this.getWindowTransportSession=e=>{const t=new yo(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:xe(t.get("intent"))}},this._init=Eo.NIL}async register(e){const t=null!==parent.window.opener;if(this._isPopup=t,!0!==t)return;const{pathname:n,search:i}=new URL(e||window.location.href);let s=this.getWindowTransportSession(i);!!s.sessionId||(s=await this.getCachedTransportSession()),s?(this.parentWindow=parent.window.opener,window.addEventListener("message",this.onWindowEvent,!1),this._registered=!0,this.open(s).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=s)?void 0:t.networkId}`;Fe.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const n=`failed to open to network ${null==(t=s)?void 0:t.networkId}, due to: ${e}`;Fe.error(n),this.notifyClose({message:n}),window.close()}))):Fe.error("window session is undefined")}unregister(){window.removeEventListener("message",this.onWindowEvent),this._registered=!1}sendMessage(e){const t=JSON.stringify(e);e.type===vo.INIT?this.postMessage(t,!0):this.postMessage(t)}get isPopup(){return this._isPopup}postMessage(e,t=!1){!0===t||this._init===Eo.OK?t?this.parentWindow.postMessage(e,"*"):this.appOrigin&&this.appOrigin.length>4?this.parentWindow.postMessage(e,this.appOrigin):Fe.error("unable to postMessage as parentOrigin is invalid"):Fe.error("impossible state, should not be calling postMessage until inited")}}const ca="sequence-extension-message-handler";class la extends Xo{constructor(e,t){super(e),this.runtime=t,this.port=void 0,this._init=Eo.OK}register(){this._registered=!0,this.port=this.runtime.connect({name:ca})}sendMessage(e){Fe.info("[ExtensionMessageHandler send]",e),this.port.postMessage(e)}}class ha extends _o{constructor(e){super(),this.register=()=>{this._registered=!0},e.onConnect.addListener((e=>{e.name===ca&&(this._init=Eo.OK,e.onMessage.addListener((e=>{this.handleMessage(e)})))}))}sendMessage(e){}unregister(){}openWallet(e,t,n){}closeWallet(){}}class da extends Hr.EventEmitter2{constructor(e){var t;super(),t=this,this.stream=e,this.responseCallbacks=new Map,this._messageIdx=0,this.nextMessageIdx=()=>++this._messageIdx,this.handleMessage=e=>{if(!e.type||!e.data)return;Fe.info("[received message]",e);const t=e.idx,n=this.responseCallbacks.get(t);switch(t&&this.responseCallbacks.delete(t),e.type){case vo.MESSAGE:if(!n)throw new Error("impossible state");this.emit(vo.MESSAGE,e),n(e.data.error,e);break;case vo.DISCONNECT:case vo.ACCOUNTS_CHANGED:case vo.CHAIN_CHANGED:this.emit(e.type,e.data);break;default:console.error("unknown message type",e)}},this.sendMessageRequest=async function(e){return new Promise(((n,i)=>{(!e.idx||e.idx<=0)&&i(new Error("message idx not set"));const{idx:s}=e;t.responseCallbacks.get(s)?i(new Error("duplicate message idx, should never happen")):t.responseCallbacks.set(s,((e,t)=>{if(e)i(e);else{if(!t)throw new Error("no valid response to return");n(t)}})),t.sendMessage(e)}))},this.stream.on("data",this.handleMessage)}sendMessage(e){this.stream.writable||console.error("window post message stream is not writable"),this.stream.write(e)}}function ua(e){var t;if(null!=(t=window.ue)&&t.sequencewallettransport&&!window.logsOverriddenForUnreal){var n;const t=null==(n=window.ue)?void 0:n.sequencewallettransport;console.log=(...n)=>{t.logfromjs(`${e}: ${pa(n)}`)},console.warn=(...n)=>{t.warnfromjs(`${e}: ${pa(n)}`)},console.error=(...n)=>{t.errorfromjs(`${e}: ${pa(n)}`)},window.logsOverriddenForUnreal=!0}}function pa(e){return e.map((e=>"object"==typeof e?e instanceof Error?e.message:JSON.stringify(e):String(e))).join(" ")}let ga;class fa extends _o{constructor(e){super(),this.walletURL=void 0,this.register=()=>{var e;ua("dapp"),ga&&(ga.unregister(),ga=this),null!=(e=window.ue)&&e.sequencewallettransport&&(window.ue.sequencewallettransport.onmessagefromwallet=this.onUnrealCallback),ga=this,this._registered=!0,console.log("registering transport!")},this.unregister=()=>{var e,t;this._registered=!1,this.closeWallet(),ga===this&&(ga=void 0),(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromwallet)===this.onUnrealCallback&&delete window.ue.sequencewallettransport.onmessagefromwallet,this.events.removeAllListeners()},this.openWallet=(e,t,n)=>{if(this.isOpened())return void console.log("wallet already open!");console.log("opening wallet!");const i=new URL(this.walletURL.href),s=new yo;e&&(i.pathname=e.toLowerCase()),this._init=Eo.NIL,this._sessionId=`${performance.now()}`,s.set("sid",this._sessionId),t&&s.set("intent",Ne(t)),n&&s.set("net",`${n}`),i.search=s.toString(),console.log("opening wallet to",i.href),window.open(i.href)},this.onUnrealCallback=e=>{if(!e)throw new Error("ProviderMessage object is empty");this.handleMessage(e)},this.walletURL=new URL(e)}closeWallet(){this.close()}sendMessage(e){var t,n;const i="string"!=typeof e?JSON.stringify(e):e;console.log("Sending message to wallet:",i),null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetowallet(i)}}class ma extends Xo{constructor(e){super(e),this.onMessageFromUnreal=e=>{Fe.debug("RECEIVED MESSAGE",e),this.handleMessage(e)},this.getUnrealTransportSession=e=>{const t=new yo(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:xe(t.get("intent"))}},this._init=Eo.NIL}async register(e){var t;if(void 0===(null==(t=window.ue)?void 0:t.sequencewallettransport))return;ua("wallet");const{search:n}=new URL(e||window.location.href);let i=this.getUnrealTransportSession(n);!!i.sessionId||(i=await this.getCachedTransportSession()),i?(window.ue.sequencewallettransport.onmessagefromsequencejs=this.onMessageFromUnreal,this._registered=!0,this.open(i).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=i)?void 0:t.networkId}`;Fe.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const n=`failed to open to network ${null==(t=i)?void 0:t.networkId}, due to: ${e}`;Fe.error(n),this.notifyClose({message:n}),window.close()}))):Fe.error("unreal session is undefined")}unregister(){var e,t;(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromsequencejs)===this.onMessageFromUnreal&&delete window.ue.sequencewallettransport.onmessagefromsequencejs,this._registered=!1}sendMessage(e){var t,n;if(e.type!==vo.INIT&&this._init!==Eo.OK)return void Fe.error("impossible state, should not be calling postMessage until inited");const i=JSON.stringify(e);null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetosequencejs(i)}}class wa{constructor(e){var t=this;this.wallet=void 0,this.recoverWalletConfig=async function(e,n,i,s,r){return r=r||await t.wallet.getWalletContext(),Ho(e,n,i,s,r)},this.recoverWalletConfigFromMessage=async function(e,n,i,s,r){return r=r||await t.wallet.getWalletContext(),Ho(e,Re(Wo(n)),i,s,r)},this.recoverWalletConfigFromTypedData=async function(e,n,i,s,r){return r=r||await t.wallet.getWalletContext(),Ho(e,Qe(n),i,s,r)},this.wallet=e}signMessage(e,t,n){const i=this.wallet.getSigner();if(!i)throw new Error("unable to get signer");return i.signMessage(e,t,n)}async signAuthMessage(e,t){const n=await this.wallet.getAuthSigner();if(!n)throw new Error("unable to get AuthChain signer");return n.signMessage(e,await n.getChainId(),t)}signTypedData(e,t,n,i,s){const r=this.wallet.getSigner();if(!r)throw new Error("unable to get signer");return r.signTypedData(e,t,n,i,s)}async signAuthTypedData(e,t,n,i){const s=await this.wallet.getAuthSigner();if(!s)throw new Error("unable to get AuthChain signer");return s.signTypedData(e,t,n,await s.getChainId(),i)}async isValidSignature(e,t,n,i,s){const r=this.wallet.getProvider(i);if(!r)throw new Error(`unable to get provider for chainId ${i}`);return $o(e,t,n,r,i,s)}async isValidMessageSignature(e,t,n,i,s){const r=this.wallet.getProvider(i);if(!r)throw new Error(`unable to get provider for chainId ${i}`);const o=Wo(t),a=Re(o);return $o(e,a,n,r,i,s)}isValidTypedDataSignature(e,t,n,i,s){return this.isValidSignature(e,Qe(t),n,i,s)}}class ya{constructor(e,t){var n=this;this.utils=void 0,this.config=void 0,this.session=void 0,this.connectedSites=void 0,this.transport=void 0,this.networks=void 0,this.providers=void 0,this.init=()=>{var e,t,n,i,s,r,o,a,c,l;this.transport.provider||(this.transport.messageProvider=new sa,null!=(e=this.config.transports)&&null!=(t=e.windowTransport)&&t.enabled&&"object"==typeof window&&(this.transport.windowMessageProvider=new oa(this.config.walletAppURL),this.transport.messageProvider.add(this.transport.windowMessageProvider)),null!=(n=this.config.transports)&&null!=(i=n.proxyTransport)&&i.enabled&&(this.transport.proxyMessageProvider=new na(this.config.transports.proxyTransport.appPort),this.transport.messageProvider.add(this.transport.proxyMessageProvider)),null!=(s=this.config.transports)&&null!=(r=s.extensionTransport)&&r.enabled&&(this.transport.extensionMessageProvider=new ha(this.config.transports.extensionTransport.runtime),this.transport.messageProvider.add(this.transport.extensionMessageProvider)),null!=(o=this.config.transports)&&null!=(a=o.unrealTransport)&&a.enabled&&(this.transport.unrealMessageProvider=new fa(this.config.walletAppURL),this.transport.messageProvider.add(this.transport.unrealMessageProvider)),this.transport.messageProvider.register(),this.transport.allowProvider=(l=e=>{if("sequence_setDefaultNetwork"===e.method)return!0;const t=this.isConnected();if(!t)throw new Error("Sequence: wallet not connected");return t},e=>(t,n,i)=>{if(!l(t))throw new Error("allowProvider middleware precondition is unmet.");e(t,n,i)}),this.transport.networkProvider=(c=e=>this.networks&&0!==this.networks.length?this.networks.find((e=>e.isDefaultChain)).chainId:0,e=>(t,n,i)=>{const s=c(),{id:r,method:o}=t;switch(o){case"net_version":return void n(void 0,{jsonrpc:"2.0",id:r,result:`${s}`});case"eth_chainId":return void n(void 0,{jsonrpc:"2.0",id:r,result:x.hexlify(s)})}e(t,n,i)}),this.transport.cachedProvider=new ho,this.transport.cachedProvider.onUpdate((()=>{this.session||(this.session={providerCache:{}}),this.session.providerCache=this.transport.cachedProvider.getCache(),this.saveSession(this.session)})),this.transport.router=new oo([go,this.transport.networkProvider,this.transport.allowProvider,po,this.transport.cachedProvider],this.transport.messageProvider),this.transport.provider=new So(this.transport.router),this.transport.messageProvider.on("open",(e=>{const{session:t}=e;t?this.useSession(t,!0):(this.session&&this.session.accountAddress&&this.transport.messageProvider.emit("disconnect"),this.clearSession())})),this.transport.messageProvider.on("accountsChanged",((e,t)=>{t?e.length>0&&this.useSession({accountAddress:e[0]},!0):e&&0!==e.length&&""!==e[0]?this.useSession({accountAddress:e[0]},!0):this.clearSession()})),this.transport.messageProvider.on("networks",(e=>{this.useSession({networks:e},!0)})),this.transport.messageProvider.on("walletContext",(e=>{this.useSession({walletContext:e},!0)})))},this.loadSession=async function(e){const t=await zo.getInstance().getItem("@sequence.session");if(t&&""!==t)try{const s=JSON.parse(t);if(s){if(void 0!==e){var i;const t="string"==typeof e?parseInt(e):e,n=n=>n.name===e||n.chainId===t,r=null==(i=s.networks)?void 0:i.find(n),o=null==r?void 0:r.isDefaultChain;if(s.networks&&r&&!o){const e=s.networks.map((e=>wo({},e,{isDefaultChain:n(e)})));s.networks=Xr(e),s.providerCache=void 0}}n.useSession(s,!0)}return s}catch(e){return void Fe.warn("loadSession failed, unable to parse session payload from storage.")}},this.connect=async function(e){if(!0===(null==e?void 0:e.refresh)&&n.disconnect(),n.isConnected()&&await n.isSiteConnected(null==e?void 0:e.origin)&&n.session&&(null==e||!e.authorize)&&(null==e||!e.askForEmail))return{connected:!0,session:n.session,chainId:x.hexlify(await n.getChainId())};if(e&&e.authorize&&(!e.app||""===e.app))throw new Error("connecting with 'authorize' option also requires 'app' to be set");await n.openWallet(void 0,{type:"connect",options:e});const t=await n.transport.messageProvider.waitUntilConnected().catch((e=>e instanceof Error?{connected:!1,error:e.message}:{connected:!1,error:JSON.stringify(e)}));if(t.connected){if(!t.session)throw new Error("impossible state, connect response is missing session");n.useSession(t.session,!0),n.addConnectedSite(null==e?void 0:e.origin)}return t},this.authorize=async function(e){return n.connect(wo({},e,{authorize:!0}))},this.getSession=()=>{if(this.isConnected())return this.session},this.getAddress=async function(){if(!n.isConnected())throw new Error("connect first");return n.getSession().accountAddress},this.getNetworks=async function(e){if(!n.isConnected()||!n.networks)throw new Error("connect first");if(e){const t=Qr(n.networks,e);return t?[t]:[]}return n.networks},this.getChainId=async function(){if(!n.networks||n.networks.length<1)throw new Error("networks have not been set by session. connect first.");const e=n.networks.find((e=>e.isDefaultChain));if(!e)throw new Error("networks must have a default chain specified");return e.chainId},this.getAuthChainId=async function(){if(!n.networks||n.networks.length<1)throw new Error("networks have not been set by session. connect first.");const e=n.networks.find((e=>e.isAuthChain));if(!e)throw new Error("networks must have an auth chain specified");return e.chainId},this.openWallet=async function(e,t,i){if("connect"!==(null==t?void 0:t.type)&&!n.isConnected())throw new Error("connect first");let s;return s=!n.networks||n.networks.length<1?n.config.defaultNetworkId:await n.getChainId(),n.transport.messageProvider.openWallet(e,t,i||s),await n.transport.messageProvider.waitUntilOpened(),!0},this.closeWallet=()=>{this.transport.messageProvider.closeWallet()},this.unregister=()=>{var e;this.disconnect(),null==(e=this.transport.messageProvider)||e.unregister()},this.saveSession=async function(e){Fe.debug("wallet provider: saving session");const t=JSON.stringify(e);await zo.getInstance().setItem("@sequence.session",t)},this.useSession=async function(e,t=!0){n.session||(n.session={}),n.config.walletContext?n.session.walletContext=n.config.walletContext:e.walletContext&&(n.session.walletContext=e.walletContext),e.accountAddress&&n.useAccountAddress(e.accountAddress),e.networks&&n.useNetworks(e.networks),e.providerCache?n.transport.cachedProvider.setCache(e.providerCache):n.transport.cachedProvider.clearCache(),t&&n.saveSession(n.session)},this.config=wo({},va),t&&(this.config=wo({},this.config,t)),e?this.config.defaultNetworkId=e:this.config.defaultNetworkId||(this.config.defaultNetworkId="mainnet"),null!=t&&t.localStorage&&zo.use(t.localStorage),this.transport={},this.networks=[],this.providers={},this.connectedSites=new Zo("@sequence.connectedSites",[]),this.utils=new wa(this),this.init()}async addConnectedSite(e){e=e||window.location.origin;const t=await this.connectedSites.get();if(t){if(t.includes(e))return;this.connectedSites.set([...t,e])}else this.connectedSites.set([e])}async removeConnectedSite(e){const t=await this.connectedSites.get();t&&this.connectedSites.set(t.filter((t=>t!==e)))}getConnectedSites(){return this.connectedSites.get()}async isSiteConnected(e){const t=await this.connectedSites.get();return!!t&&t.includes(e||window.location.origin)}disconnect(){this.isOpened()&&this.closeWallet(),this.clearSession()}getProviderConfig(){return this.config}isOpened(){return this.transport.messageProvider.isOpened()}isConnected(){return void 0!==this.session&&void 0!==this.session.networks&&this.session.networks.length>0&&void 0!==this.networks&&this.networks.length>0&&!!this.session.accountAddress&&this.session.accountAddress.startsWith("0x")}getProvider(e){if(!this.isConnected()){if(e)throw new Error("session is empty. connect and try again.");return this.transport.provider}let t,n=this.networks.find((e=>e.isDefaultChain));if(e&&(n=Qr(this.networks,e),!n))throw new Error(`network ${e} is not in the network list`);if(this.providers[n.chainId])return this.providers[n.chainId];const i=n.provider?n.provider:new tr.r(n.rpcUrl,n.chainId);if(n.isDefaultChain){const e=new oo([go,po,new uo({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext}),new mo(this.transport.provider),this.transport.cachedProvider],new lo(i));t=new So(e,n.chainId)}else{const e=new oo([go,po,new uo({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext,chainId:n.chainId}),new mo(this.transport.provider),new ho({defaultChainId:n.chainId})],new lo(i));t=new So(e,n.chainId)}return this.providers[n.chainId]=t,t}async getAuthProvider(){return this.getProvider((await this.getAuthNetwork()).chainId)}async getAuthNetwork(){return(await this.getNetworks()).find((e=>e.isAuthChain))}getAllProviders(){return this.providers}getSigner(e){return this.getProvider(e).getSigner()}async getAuthSigner(){return(await this.getAuthProvider()).getSigner()}getWalletConfig(e){return this.getSigner().getWalletConfig(e)}getWalletState(e){return this.getSigner().getWalletState(e)}getWalletContext(){return this.getSigner().getWalletContext()}isDeployed(e){return this.getSigner(e).isDeployed()}on(e,t){this.transport.messageProvider.on(e,t)}once(e,t){this.transport.messageProvider.once(e,t)}useAccountAddress(e){this.session||(this.session={}),this.session.accountAddress=N.getAddress(e)}useNetworks(e){if(this.session||(this.session={}),this.session.networks=e,this.session.networks&&0!==this.session.networks.length)if(this.config.networks||this.config.networkRpcUrl){if(this.networks=e,this.config.networks&&(this.networks=e.map((e=>wo({},e))),this.config.networks.forEach((e=>{const t=Qr(this.networks,e.chainId||e.name);t&&((e,t)=>{if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}})(e,t)})),zr(this.networks,!0)),this.config.networkRpcUrl){const e=this.networks.find((e=>e.isDefaultChain));e&&(e.rpcUrl=this.config.networkRpcUrl)}}else this.networks=e}clearSession(){var e;Fe.debug("wallet provider: clearing session"),zo.getInstance().removeItem("@sequence.session"),this.session=void 0,this.networks=[],this.providers={},null==(e=this.transport.cachedProvider)||e.clearCache()}}const va={walletAppURL:"https://sequence.app",transports:{windowTransport:{enabled:!0},proxyTransport:{enabled:!1}}};let ba;const Ea=async(e,t)=>ba||(ba=new ya(e,t),await ba.loadSession(e),ba),Ca=()=>{ba&&(ba.closeWallet(),ba.unregister())},Ia=()=>{if(!ba)throw new Error("Wallet has not been initialized, call sequence.initWallet(network, config) first.");return ba};function ka(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var Aa=ka({__proto__:null},[i]),Ta=ka({__proto__:null},[s]),_a=ka({__proto__:null},[u]),Oa=ka({__proto__:null},[a]),Na=ka({__proto__:null},[p]),Sa=ka({__proto__:null},[c]),xa=ka({__proto__:null},[l]),Ra=ka({__proto__:null},[o]),Ma=ka({__proto__:null},[g]),Ua=ka({__proto__:null},[f]),Ba=ka({__proto__:null},[d]),Pa=ka({__proto__:null},[h]),La=ka({__proto__:null,isValidSignature:$o,isValidMessageSignature:Vo,isValidTypedDataSignature:jo,recoverWalletConfig:Ho,isWalletUpToDate:Jo},[r]),Da=Object.freeze({__proto__:null,abi:Aa,api:Ta,auth:_a,config:Oa,guard:Na,indexer:Sa,metadata:xa,multicall:Ra,network:Ma,provider:Ua,relayer:Ba,transactions:Pa,utils:La,initWallet:Ea,getWallet:Ia,Wallet:ya})},21883:(e,t,n)=>{var i,s=n(34406);!function(r){var o=Object.hasOwnProperty,a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},c="object"==typeof s&&"function"==typeof s.nextTick,l="function"==typeof Symbol,h="object"==typeof Reflect,d="function"==typeof setImmediate?setImmediate:setTimeout,u=l?h&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function p(){this._events={},this._conf&&g.call(this,this._conf)}function g(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function f(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),void 0!==s&&s.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=e,s.emitWarning(i)}else console.error(n),console.trace&&console.trace()}var m=function(e,t,n){var i=arguments.length;switch(i){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var s=new Array(i);i--;)s[i]=arguments[i];return s}};function w(e,t){for(var n={},i=e.length,s=t?t.length:0,o=0;o<i;o++)n[e[o]]=o<s?t[o]:r;return n}function y(e,t,n){var i,s;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(i=n.on,s=n.off),t.addEventListener?(i=t.addEventListener,s=t.removeEventListener):t.addListener?(i=t.addListener,s=t.removeListener):t.on&&(i=t.on,s=t.off),!i&&!s)throw Error("target does not implement any known event API");if("function"!=typeof i)throw TypeError("on method must be a function");if("function"!=typeof s)throw TypeError("off method must be a function");this._on=i,this._off=s;var r=e._observers;r?r.push(this):e._observers=[this]}function v(e,t,n,i){var s=Object.assign({},t);if(!e)return s;if("object"!=typeof e)throw TypeError("options must be an object");var a,c,l,h=Object.keys(e),d=h.length;function u(e){throw Error('Invalid "'+a+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<d;p++){if(a=h[p],!i&&!o.call(t,a))throw Error('Unknown "'+a+'" option');(c=e[a])!==r&&(l=n[a],s[a]=l?l(c,u):c)}return s}function b(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function E(e){var t="value must be type of "+e.join("|"),n=e.length,i=e[0],s=e[1];return 1===n?function(e,n){if(typeof e===i)return e;n(t)}:2===n?function(e,n){var r=typeof e;if(r===i||r===s)return e;n(t)}:function(i,s){for(var r=typeof i,o=n;o-- >0;)if(r===e[o])return i;s(t)}}Object.assign(y.prototype,{subscribe:function(e,t,n){var i=this,s=this._target,r=this._emitter,o=this._listeners,a=function(){var i=m.apply(null,arguments),o={data:i,name:t,original:e};n?!1!==n.call(s,o)&&r.emit.apply(r,[o.name].concat(i)):r.emit.apply(r,[t].concat(i))};if(o[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,r._newListener&&r._removeListener&&!i._onNewListener?(this._onNewListener=function(n){n===t&&null===o[e]&&(o[e]=a,i._on.call(s,e,a))},r.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!r.hasListeners(n)&&o[e]&&(o[e]=null,i._off.call(s,e,a))},o[e]=null,r.on("removeListener",this._onRemoveListener)):(o[e]=a,i._on.call(s,e,a))},unsubscribe:function(e){var t,n,i,s=this,r=this._listeners,o=this._emitter,a=this._off,c=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function l(){s._onNewListener&&(o.off("newListener",s._onNewListener),o.off("removeListener",s._onRemoveListener),s._onNewListener=null,s._onRemoveListener=null);var e=A.call(o,s);o._observers.splice(e,1)}if(e){if(!(t=r[e]))return;a.call(c,e,t),delete r[e],--this._listenersCount||l()}else{for(i=(n=u(r)).length;i-- >0;)e=n[i],a.call(c,e,r[e]);this._listeners={},this._listenersCount=0,l()}}});var C=E(["function"]),I=E(["object","function"]);function k(e,t,n){var i,s,r,o=0,a=new e((function(c,l,h){function d(){s&&(s=null),o&&(clearTimeout(o),o=0)}n=v(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),i=!n.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof h;var u=function(e){d(),c(e)},p=function(e){d(),l(e)};i?t(u,p,h):(s=[function(e){p(e||Error("canceled"))}],t(u,p,(function(e){if(r)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");s.push(e)})),r=!0),n.timeout>0&&(o=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",o=0,a.cancel(e),l(e)}),n.timeout))}));return i||(a.cancel=function(e){if(s){for(var t=s.length,n=1;n<t;n++)s[n](e);s[0](e),s=null}}),a}function A(e){var t=this._observers;if(!t)return-1;for(var n=t.length,i=0;i<n;i++)if(t[i]._target===e)return i;return-1}function T(e,t,n,i,s){if(!n)return null;if(0===i){var r=typeof t;if("string"===r){var o,a,c=0,l=0,h=this.delimiter,d=h.length;if(-1!==(a=t.indexOf(h))){o=new Array(5);do{o[c++]=t.slice(l,a),l=a+d}while(-1!==(a=t.indexOf(h,l)));o[c++]=t.slice(l),t=o,s=c}else t=[t],s=1}else"object"===r?s=t.length:(t=[t],s=1)}var p,g,f,m,w,y,v,b=null,E=t[i],C=t[i+1];if(i===s)n._listeners&&("function"==typeof n._listeners?(e&&e.push(n._listeners),b=[n]):(e&&e.push.apply(e,n._listeners),b=[n]));else{if("*"===E){for(a=(y=u(n)).length;a-- >0;)"_listeners"!==(p=y[a])&&(v=T(e,t,n[p],i+1,s))&&(b?b.push.apply(b,v):b=v);return b}if("**"===E){for((w=i+1===s||i+2===s&&"*"===C)&&n._listeners&&(b=T(e,t,n,s,s)),a=(y=u(n)).length;a-- >0;)"_listeners"!==(p=y[a])&&("*"===p||"**"===p?(n[p]._listeners&&!w&&(v=T(e,t,n[p],s,s))&&(b?b.push.apply(b,v):b=v),v=T(e,t,n[p],i,s)):v=T(e,t,n[p],p===C?i+2:i,s),v&&(b?b.push.apply(b,v):b=v));return b}n[E]&&(b=T(e,t,n[E],i+1,s))}if((g=n["*"])&&T(e,t,g,i+1,s),f=n["**"])if(i<s)for(f._listeners&&T(e,t,f,s,s),a=(y=u(f)).length;a-- >0;)"_listeners"!==(p=y[a])&&(p===C?T(e,t,f[p],i+2,s):p===E?T(e,t,f[p],i+1,s):((m={})[p]=f[p],T(e,t,{"**":m},i+1,s)));else f._listeners?T(e,t,f,s,s):f["*"]&&f["*"]._listeners&&T(e,t,f["*"],s,s);return b}function _(e,t,n){var i,s,r=0,o=0,a=this.delimiter,c=a.length;if("string"==typeof e)if(-1!==(i=e.indexOf(a))){s=new Array(5);do{s[r++]=e.slice(o,i),o=i+c}while(-1!==(i=e.indexOf(a,o)));s[r++]=e.slice(o)}else s=[e],r=1;else s=e,r=e.length;if(r>1)for(i=0;i+1<r;i++)if("**"===s[i]&&"**"===s[i+1])return;var l,h=this.listenerTree;for(i=0;i<r;i++)if(h=h[l=s[i]]||(h[l]={}),i===r-1)return h._listeners?("function"==typeof h._listeners&&(h._listeners=[h._listeners]),n?h._listeners.unshift(t):h._listeners.push(t),!h._listeners.warned&&this._maxListeners>0&&h._listeners.length>this._maxListeners&&(h._listeners.warned=!0,f.call(this,h._listeners.length,l))):h._listeners=t,!0;return!0}function O(e,t,n,i){for(var s,r,o,a,c=u(e),l=c.length,h=e._listeners;l-- >0;)s=e[r=c[l]],o="_listeners"===r?n:n?n.concat(r):[r],a=i||"symbol"==typeof r,h&&t.push(a?o:o.join(this.delimiter)),"object"==typeof s&&O.call(this,s,t,o,a);return t}function N(e){for(var t,n,i,s=u(e),r=s.length;r-- >0;)(t=e[n=s[r]])&&(i=!0,"_listeners"===n||N(t)||delete e[n]);return i}function S(e,t,n){this.emitter=e,this.event=t,this.listener=n}function x(e,t,n){if(!0===n)o=!0;else if(!1===n)i=!0;else{if(!n||"object"!=typeof n)throw TypeError("options should be an object or true");var i=n.async,o=n.promisify,a=n.nextTick,l=n.objectify}if(i||a||o){var h=t,u=t._origin||t;if(a&&!c)throw Error("process.nextTick is not supported");o===r&&(o="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,n=this.event;return o?a?Promise.resolve():new Promise((function(e){d(e)})).then((function(){return t.event=n,h.apply(t,e)})):(a?s.nextTick:d)((function(){t.event=n,h.apply(t,e)}))},t._async=!0,t._origin=u}return[t,l?new S(this,e,t):this]}function R(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,g.call(this,e)}S.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},R.EventEmitter2=R,R.prototype.listenTo=function(e,t,n){if("object"!=typeof e)throw TypeError("target musts be an object");var i=this;function s(t){if("object"!=typeof t)throw TypeError("events must be an object");var s,r=n.reducers,o=A.call(i,e);s=-1===o?new y(i,e,n):i._observers[o];for(var a,c=u(t),l=c.length,h="function"==typeof r,d=0;d<l;d++)a=c[d],s.subscribe(a,t[a]||a,h?r:r&&r[a])}return n=v(n,{on:r,off:r,reducers:r},{on:C,off:C,reducers:I}),a(t)?s(w(t)):s("string"==typeof t?w(t.split(/\s+/)):t),this},R.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var i,s=n.length,r=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;s-- >0;)i=n[s],e&&i._target!==e||(i.unsubscribe(t),r=!0);return r},R.prototype.delimiter=".",R.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},R.prototype.getMaxListeners=function(){return this._maxListeners},R.prototype.event="",R.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},R.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},R.prototype._once=function(e,t,n,i){return this._many(e,1,t,n,i)},R.prototype.many=function(e,t,n,i){return this._many(e,t,n,!1,i)},R.prototype.prependMany=function(e,t,n,i){return this._many(e,t,n,!0,i)},R.prototype._many=function(e,t,n,i,s){var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&r.off(e,o),n.apply(this,arguments)}return o._origin=n,this._on(e,o,i,s)},R.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var e,t,n,i,s,r,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return!1;if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(n=o.length,l)for(i=0;i<n;i++)if("symbol"==typeof o[i]){r=!0;break}r||(o=o.join(this.delimiter))}var c,h=arguments.length;if(this._all&&this._all.length)for(i=0,n=(c=this._all.slice()).length;i<n;i++)switch(this.event=o,h){case 1:c[i].call(this,o);break;case 2:c[i].call(this,o,arguments[1]);break;case 3:c[i].call(this,o,arguments[1],arguments[2]);break;default:c[i].apply(this,arguments)}if(a)c=[],T.call(this,c,e,this.listenerTree,0,n);else{if("function"==typeof(c=this._events[o])){switch(this.event=o,h){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(h-1),s=1;s<h;s++)t[s-1]=arguments[s];c.apply(this,t)}return!0}c&&(c=c.slice())}if(c&&c.length){if(h>3)for(t=new Array(h-1),s=1;s<h;s++)t[s-1]=arguments[s];for(i=0,n=c.length;i<n;i++)switch(this.event=o,h){case 1:c[i].call(this);break;case 2:c[i].call(this,arguments[1]);break;case 3:c[i].call(this,arguments[1],arguments[2]);break;default:c[i].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===o)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},R.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var e,t,n,i,s,r,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(i=o.length,l)for(s=0;s<i;s++)if("symbol"==typeof o[s]){t=!0;break}t||(o=o.join(this.delimiter))}var c,h=[],d=arguments.length;if(this._all)for(s=0,i=this._all.length;s<i;s++)switch(this.event=o,d){case 1:h.push(this._all[s].call(this,o));break;case 2:h.push(this._all[s].call(this,o,arguments[1]));break;case 3:h.push(this._all[s].call(this,o,arguments[1],arguments[2]));break;default:h.push(this._all[s].apply(this,arguments))}if(a?(c=[],T.call(this,c,e,this.listenerTree,0)):c=this._events[o],"function"==typeof c)switch(this.event=o,d){case 1:h.push(c.call(this));break;case 2:h.push(c.call(this,arguments[1]));break;case 3:h.push(c.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(d-1),r=1;r<d;r++)n[r-1]=arguments[r];h.push(c.apply(this,n))}else if(c&&c.length){if(c=c.slice(),d>3)for(n=new Array(d-1),r=1;r<d;r++)n[r-1]=arguments[r];for(s=0,i=c.length;s<i;s++)switch(this.event=o,d){case 1:h.push(c[s].call(this));break;case 2:h.push(c[s].call(this,arguments[1]));break;case 3:h.push(c[s].call(this,arguments[1],arguments[2]));break;default:h.push(c[s].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===o)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(h)},R.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},R.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},R.prototype.onAny=function(e){return this._onAny(e,!1)},R.prototype.prependAny=function(e){return this._onAny(e,!0)},R.prototype.addListener=R.prototype.on,R.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},R.prototype._on=function(e,t,n,i){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");this._events||p.call(this);var s,o=this;return i!==r&&(t=(s=x.call(this,e,t,i))[0],o=s[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(_.call(this,e,t,n),o):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,f.call(this,this._events[e].length,e))):this._events[e]=t,o)},R.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();if(!(i=T.call(this,null,s,this.listenerTree,0)))return this}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var r=0;r<i.length;r++){var o=i[r];if(n=o._listeners,a(n)){for(var c=-1,l=0,h=n.length;l<h;l++)if(n[l]===t||n[l].listener&&n[l].listener===t||n[l]._origin&&n[l]._origin===t){c=l;break}if(c<0)continue;return this.wildcard?o._listeners.splice(c,1):this._events[e].splice(c,1),0===n.length&&(this.wildcard?delete o._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete o._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&N(this.listenerTree),this},R.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(n=0,i=(t=this._all).length;n<i;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,i=t.length;n<i;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},R.prototype.removeListener=R.prototype.off,R.prototype.removeAllListeners=function(e){if(e===r)return!this._events||p.call(this),this;if(this.wildcard){var t,n=T.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&N(this.listenerTree)}else this._events&&(this._events[e]=null);return this},R.prototype.listeners=function(e){var t,n,i,s,o,a=this._events;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!a)return[];for(s=(t=u(a)).length,i=[];s-- >0;)"function"==typeof(n=a[t[s]])?i.push(n):i.push.apply(i,n);return i}if(this.wildcard){if(!(o=this.listenerTree))return[];var c=[],l="string"==typeof e?e.split(this.delimiter):e.slice();return T.call(this,c,l,o,0),c}return a&&(n=a[e])?"function"==typeof n?[n]:n:[]},R.prototype.eventNames=function(e){var t=this._events;return this.wildcard?O.call(this,this.listenerTree,[],null,e):t?u(t):[]},R.prototype.listenerCount=function(e){return this.listeners(e).length},R.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return T.call(this,t,n,this.listenerTree,0),t.length>0}var i=this._events,s=this._all;return!!(s&&s.length||i&&(e===r?u(i).length:i[e]))},R.prototype.listenersAny=function(){return this._all?this._all:[]},R.prototype.waitFor=function(e,t){var n=this,i=typeof t;return"number"===i?t={timeout:t}:"function"===i&&(t={filter:t}),k((t=v(t,{timeout:0,filter:r,handleError:!1,Promise,overload:!1},{filter:C,Promise:b})).Promise,(function(i,s,r){function o(){var r=t.filter;if(!r||r.apply(n,arguments))if(n.off(e,o),t.handleError){var a=arguments[0];a?s(a):i(m.apply(null,arguments).slice(1))}else i(m.apply(null,arguments))}r((function(){n.off(e,o)})),n._on(e,o,!1)}),{timeout:t.timeout,overload:t.overload})};var M=R.prototype;Object.defineProperties(R,{defaultMaxListeners:{get:function(){return M._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");M._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return k((n=v(n,{Promise,timeout:0,overload:!1},{Promise:b})).Promise,(function(n,i,s){var r;if("function"==typeof e.addEventListener)return r=function(){n(m.apply(null,arguments))},s((function(){e.removeEventListener(t,r)})),void e.addEventListener(t,r,{once:!0});var o,a=function(){o&&e.removeListener("error",o),n(m.apply(null,arguments))};"error"!==t&&(o=function(n){e.removeListener(t,a),i(n)},e.once("error",o)),s((function(){o&&e.removeListener("error",o),e.removeListener(t,a)})),e.once(t,a)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(M,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(i=function(){return R}.call(t,n,t,e))===r||(e.exports=i)}()}}]);