(("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect=("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect||[]).push([[834],{1308:t=>{function e(t){return null==t?t:Number.parseInt(t,16)}function r(t){return null==t?t:"0x"+t.toString(16)}function n(t,e){return new Promise((r,n)=>{t.sendAsync(e,(t,e)=>{t?n(t):e.error?n(e.error):e.result?r(e.result):n(new Error("Result was empty"))})})}t.exports=async function({provider:t,fromBlock:s,toBlock:o}){s||(s=o);const a=e(s),i=e(o),c=Array(i-a+1).fill().map((t,e)=>a+e).map(r);let l=await Promise.all(c.map(e=>async function(t,e,r){for(let e=0;e<3;e++)try{return await n(t,{id:1,jsonrpc:"2.0",method:"eth_getBlockByNumber",params:r})}catch(t){console.error(`provider.sendAsync failed: ${t.stack||t.message||t}`)}return null}(t,0,[e,!1])));return l=l.filter(t=>null!==t),l}},12522:(t,e,r)=>{const n=r(53116),s=r(1308),{incrementHexInt:o}=r(30446);t.exports=class extends n{constructor({provider:t,params:e}){super(),this.type="block",this.provider=t}async update({oldBlock:t,newBlock:e}){const r=e,n=o(t),a=(await s({provider:this.provider,fromBlock:n,toBlock:r})).map(t=>t.hash);this.addResults(a)}}},30446:t=>{function e(t){return t.sort((t,e)=>"latest"===t||"earliest"===e?1:"latest"===e||"earliest"===t?-1:r(t)-r(e))}function r(t){return null==t?t:Number.parseInt(t,16)}function n(t){if(null==t)return t;let e=t.toString(16);return e.length%2&&(e="0"+e),"0x"+e}function s(){return Math.floor(16*Math.random()).toString(16)}t.exports={minBlockRef:function(...t){return e(t)[0]},maxBlockRef:function(...t){const r=e(t);return r[r.length-1]},sortBlockRefs:e,bnToHex:function(t){return"0x"+t.toString(16)},blockRefIsNumber:function(t){return t&&!["earliest","latest","pending"].includes(t)},hexToInt:r,incrementHexInt:function(t){return null==t?t:n(r(t)+1)},intToHex:n,unsafeRandomBytes:function(t){let e="0x";for(let r=0;r<t;r++)e+=s(),e+=s();return e}}},45233:(t,e,r)=>{const n=r(53116);t.exports=class extends n{constructor(){super(),this.allResults=[]}async update(){throw new Error("BaseFilterWithHistory - no update method specified")}addResults(t){this.allResults=this.allResults.concat(t),super.addResults(t)}addInitialResults(t){this.allResults=this.allResults.concat(t),super.addInitialResults(t)}getAllResults(){return this.allResults}}},48333:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(50046);function s(t,e,r){try{Reflect.apply(t,e,r)}catch(t){setTimeout(()=>{throw t})}}class o extends n.EventEmitter{emit(t,...e){let r="error"===t;const n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){let t;if(e.length>0&&([t]=e),t instanceof Error)throw t;const r=new Error("Unhandled error."+(t?` (${t.message})`:""));throw r.context=t,r}const o=n[t];if(void 0===o)return!1;if("function"==typeof o)s(o,this,e);else{const t=o.length,r=function(t){const e=t.length,r=new Array(e);for(let n=0;n<e;n+=1)r[n]=t[n];return r}(o);for(let n=0;n<t;n+=1)s(r[n],this,e)}return!0}}e.default=o},53116:(t,e,r)=>{const n=r(48333).default;t.exports=class extends n{constructor(){super(),this.updates=[]}async initialize(){}async update(){throw new Error("BaseFilter - no update method specified")}addResults(t){this.updates=this.updates.concat(t),t.forEach(t=>this.emit("update",t))}addInitialResults(t){}getChangesAndClear(){const t=this.updates;return this.updates=[],t}}},60834:(t,e,r)=>{const n=r(48333).default,{createAsyncMiddleware:s,createScaffoldMiddleware:o}=r(89900),a=r(64750),{unsafeRandomBytes:i,incrementHexInt:c}=r(30446),l=r(1308);function u(t){return null==t?null:{hash:t.hash,parentHash:t.parentHash,sha3Uncles:t.sha3Uncles,miner:t.miner,stateRoot:t.stateRoot,transactionsRoot:t.transactionsRoot,receiptsRoot:t.receiptsRoot,logsBloom:t.logsBloom,difficulty:t.difficulty,number:t.number,gasLimit:t.gasLimit,gasUsed:t.gasUsed,nonce:t.nonce,mixHash:t.mixHash,timestamp:t.timestamp,extraData:t.extraData}}t.exports=function({blockTracker:t,provider:e}){const r={},d=a({blockTracker:t,provider:e});let p=!1;const h=new n,f=o({eth_subscribe:s(async function(n,s){if(p)throw new Error("SubscriptionManager - attempting to use after destroying");const o=n.params[0],a=i(16);let h;switch(o){case"newHeads":h=function({subId:r}){const n={type:o,destroy:async()=>{t.removeListener("sync",n.update)},update:async({oldBlock:t,newBlock:n})=>{const s=n,o=c(t);(await l({provider:e,fromBlock:o,toBlock:s})).map(u).filter(t=>null!==t).forEach(t=>{m(r,t)})}};return t.on("sync",n.update),n}({subId:a});break;case"logs":const r=n.params[1];h=function({subId:t,filter:e}){return e.on("update",e=>m(t,e)),{type:o,destroy:async()=>await d.uninstallFilter(e.idHex)}}({subId:a,filter:await d.newLogFilter(r)});break;default:throw new Error(`SubscriptionManager - unsupported subscription type "${o}"`)}return r[a]=h,void(s.result=a)}),eth_unsubscribe:s(async function(t,e){if(p)throw new Error("SubscriptionManager - attempting to use after destroying");const n=t.params[0],s=r[n];s?(delete r[n],await s.destroy(),e.result=!0):e.result=!1})});return f.destroy=function(){h.removeAllListeners();for(const t in r)r[t].destroy(),delete r[t];p=!0},{events:h,middleware:f};function m(t,e){h.emit("notification",{jsonrpc:"2.0",method:"eth_subscription",params:{subscription:t,result:e}})}}},64750:(t,e,r)=>{const n=r(24200).eu,{createAsyncMiddleware:s,createScaffoldMiddleware:o}=r(89900),a=r(95751),i=r(12522),c=r(72147),{intToHex:l,hexToInt:u}=r(30446);function d(t){return p(async(...e)=>{const r=await t(...e);return l(r.id)})}function p(t){return s(async(e,r)=>{const n=await t.apply(null,e.params);r.result=n})}function h(t,e){const r=[];for(let e in t)r.push(t[e]);return r}t.exports=function({blockTracker:t,provider:e}){let r=0,s={};const f=new n,m=function({mutex:t}){return e=>async(r,n,s,o)=>{(await t.acquire())(),e(r,n,s,o)}}({mutex:f}),w=o({eth_newFilter:m(d(g)),eth_newBlockFilter:m(d(k)),eth_newPendingTransactionFilter:m(d(B)),eth_uninstallFilter:m(p(v)),eth_getFilterChanges:m(p(b)),eth_getFilterLogs:m(p(x))}),y=async({oldBlock:t,newBlock:e})=>{if(0===s.length)return;const r=await f.acquire();try{await Promise.all(h(s).map(async r=>{try{await r.update({oldBlock:t,newBlock:e})}catch(t){console.error(t)}}))}catch(t){console.error(t)}r()};return w.newLogFilter=g,w.newBlockFilter=k,w.newPendingTransactionFilter=B,w.uninstallFilter=v,w.getFilterChanges=b,w.getFilterLogs=x,w.destroy=()=>{!async function(){const t=h(s).length;s={},F({prevFilterCount:t,newFilterCount:0})}()},w;async function g(t){const r=new a({provider:e,params:t});return await R(r),r}async function k(){const t=new i({provider:e});return await R(t),t}async function B(){const t=new c({provider:e});return await R(t),t}async function b(t){const e=u(t),r=s[e];if(!r)throw new Error(`No filter for index "${e}"`);return r.getChangesAndClear()}async function x(t){const e=u(t),r=s[e];if(!r)throw new Error(`No filter for index "${e}"`);let n=[];return"log"===r.type&&(n=r.getAllResults()),n}async function v(t){const e=u(t),r=s[e],n=Boolean(r);return n&&await async function(t){const e=h(s).length;delete s[t];F({prevFilterCount:e,newFilterCount:h(s).length})}(e),n}async function R(e){const n=h(s).length,o=await t.getLatestBlock();return await e.initialize({currentBlock:o}),r++,s[r]=e,e.id=r,e.idHex=l(r),F({prevFilterCount:n,newFilterCount:h(s).length}),r}function F({prevFilterCount:e,newFilterCount:r}){0===e&&r>0?t.on("sync",y):e>0&&0===r&&t.removeListener("sync",y)}}},72147:(t,e,r)=>{const n=r(53116),s=r(1308),{incrementHexInt:o}=r(30446);t.exports=class extends n{constructor({provider:t}){super(),this.type="tx",this.provider=t}async update({oldBlock:t}){const e=t,r=o(t),n=await s({provider:this.provider,fromBlock:r,toBlock:e}),a=[];for(const t of n)a.push(...t.transactions);this.addResults(a)}}},95751:(t,e,r)=>{const n=r(12532),s=r(42108),o=r(45233),{bnToHex:a,hexToInt:i,incrementHexInt:c,minBlockRef:l,blockRefIsNumber:u}=r(30446);t.exports=class extends o{constructor({provider:t,params:e}){super(),this.type="log",this.ethQuery=new n(t),this.params=Object.assign({fromBlock:"latest",toBlock:"latest",address:void 0,topics:[]},e),this.params.address&&(Array.isArray(this.params.address)||(this.params.address=[this.params.address]),this.params.address=this.params.address.map(t=>t.toLowerCase()))}async initialize({currentBlock:t}){let e=this.params.fromBlock;["latest","pending"].includes(e)&&(e=t),"earliest"===e&&(e="0x0"),this.params.fromBlock=e;const r=l(this.params.toBlock,t),n=Object.assign({},this.params,{toBlock:r}),s=await this._fetchLogs(n);this.addInitialResults(s)}async update({oldBlock:t,newBlock:e}){const r=e;let n;n=t?c(t):e;const s=Object.assign({},this.params,{fromBlock:n,toBlock:r}),o=(await this._fetchLogs(s)).filter(t=>this.matchLog(t));this.addResults(o)}async _fetchLogs(t){return await s(e=>this.ethQuery.getLogs(t,e))()}matchLog(t){if(i(this.params.fromBlock)>=i(t.blockNumber))return!1;if(u(this.params.toBlock)&&i(this.params.toBlock)<=i(t.blockNumber))return!1;const e=t.address&&t.address.toLowerCase();return!(this.params.address&&e&&!this.params.address.includes(e))&&this.params.topics.every((e,r)=>{let n=t.topics[r];if(!n)return!1;n=n.toLowerCase();let s=Array.isArray(e)?e:[e];return!!s.includes(null)||(s=s.map(t=>t.toLowerCase()),s.includes(n))})}}}}]);