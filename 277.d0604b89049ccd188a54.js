(("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect=("undefined"!=typeof self?self:this).webpackChunk_subwallet_sub_connect||[]).push([[277],{30277:function(t,e,n){t.exports=function(){"use strict";function t(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function a(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}h((r=r.apply(t,e||[])).next())}))}function e(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}function r(t,e){if(!t)throw new Error(e)}const i={56:"https://bsc-dataseed1.binance.org",97:"https://data-seed-prebsc-1-s1.binance.org:8545",137:"https://rpc-mainnet.maticvigil.com/",80001:"https://rpc-mumbai.matic.today/",43114:"https://api.avax.network/ext/bc/C/rpc",43113:"https://api.avax-test.network/ext/bc/C/rpc",42161:"https://arb1.arbitrum.io/rpc",421613:"https://endpoints.omniatech.io/v1/arbitrum/goerli/public",10:"https://mainnet.optimism.io",420:"https://goerli.optimism.io"},s={1:"ethereum",5:"ethereum",56:"bsc",97:"bsc",137:"polygon",80001:"polygon",43114:"avalanche",43113:"avalanche",42161:"arbitrum",421613:"arbitrum",10:"optimism",420:"optimism"},o={1:"mainnet",5:"testnet",56:"mainnet",97:"testnet",137:"mainnet",80001:"testnet",43114:"mainnet",43113:"testnet",42161:"mainnet",421613:"testnet",10:"mainnet",420:"testnet"},a={1:"https://wallet-v2.blocto.app",5:"https://wallet-v2-dev.blocto.app",56:"https://wallet-v2.blocto.app",97:"https://wallet-v2-dev.blocto.app",137:"https://wallet-v2.blocto.app",80001:"https://wallet-v2-dev.blocto.app",43114:"https://wallet-v2.blocto.app",43113:"https://wallet-v2-dev.blocto.app",42161:"https://wallet-v2.blocto.app",421613:"https://wallet-v2-dev.blocto.app",10:"https://wallet-v2.blocto.app",420:"https://wallet-v2-dev.blocto.app"},h={prod:"https://wallet-v2.blocto.app",staging:"https://wallet-v2-staging.blocto.app",dev:"https://wallet-v2-dev.blocto.app"},c={devnet:"https://wallet-v2-dev.blocto.app",testnet:"https://wallet-v2-dev.blocto.app","mainnet-beta":"https://wallet-v2.blocto.app"},u=["devnet","testnet","mainnet-beta"],l={1:"https://wallet-v2.blocto.app",2:"https://wallet-v2-dev.blocto.app",3:"https://wallet-v2-dev.blocto.app",4:"https://wallet-v2-dev.blocto.app",5:"https://wallet-v2-staging.blocto.app"};var d;!function(t){t.Mainnet="mainnet",t.Testnet="testnet",t.Devnet="devnet",t.Testing="testing",t.Premainnet="premainnet"}(d||(d={}));const f={1:d.Mainnet,2:d.Testnet,3:d.Devnet,4:d.Testing,5:d.Premainnet},p={1:"https://fullnode.mainnet.aptoslabs.com/v1",2:"https://fullnode.testnet.aptoslabs.com/v1",3:"https://fullnode.devnet.aptoslabs.com/v1",4:"",5:"https://premainnet.aptosdev.com/v1"},g=["connect","disconnect","message","chainChanged","accountsChanged"],w=864e5,y="00000000-0000-0000-0000-000000000000",v="sdk.session",m="undefined"!=typeof window?window.memoryStorage:new class{constructor(){this.storage={}}getItem(t){return this[t]||null}setItem(t,e){this.storage[t]=e}removeItem(t){delete this.storage[t]}};"undefined"!=typeof window&&(window.memoryStorage=m);const b=(()=>{if("undefined"==typeof window)return!1;try{window.localStorage.setItem("local_storage_supported","1");const t=window.localStorage.getItem("local_storage_supported");return window.localStorage.removeItem("local_storage_supported"),"1"===t}catch(t){return!1}})()?window.localStorage:m,E=(t,e)=>b.setItem(t,"string"==typeof e?e:JSON.stringify(e)),A=(t,e,n)=>E(t,{value:e,expiry:(new Date).getTime()+n}),I=t=>{E(t,""),b.removeItem(t)};class S{constructor(t){this.isBlocto=!0,this.isConnecting=!1,this.eventListeners={},this.sessionKey=v,this.off=this.removeListener,this.session=t,g.forEach((t=>{this.eventListeners[t]=[]}))}formatAndSetSessionAccount(t={}){this.session.accounts=Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}tryRetrieveSessionFromStorage(t){const e=((t,e=null)=>{const n=((t,e=null)=>{const n=b.getItem(t);try{return n&&JSON.parse(n)||e}catch(t){return n||e}})(t,null);return n?(new Date).getTime()>n.expiry?(I(t),e):n.value:e})(this.sessionKey,{}),n=e&&e.code,r=e&&e.address&&e.address[t];this.session.connected=Boolean(n&&r),this.session.code=n||null,this.formatAndSetSessionAccount(e?e.address:{})}request(e){return t(this,void 0,void 0,(function*(){}))}on(t,e){g.includes(t)&&this.eventListeners[t].push(e)}once(){}removeListener(t,e){const n=this.eventListeners[t].findIndex((t=>t===e));-1!==n&&this.eventListeners[t].splice(n,1)}}function T(t){const e=document.createElement("iframe");return e.setAttribute("src",t),e.setAttribute("style","width:100vw;height:100%;position:fixed;top:0;left:0;z-index:2147483646;border:none;box-sizing:border-box;color-scheme:light;inset:0px;display:block;"),e}function _(t){document.body.appendChild(t)}function R(t){const e=t&&t.parentNode;e&&e.removeChild instanceof Function&&e.removeChild(t)}var P=(t,e,n=window)=>{n.addEventListener(t,(function r(i){e(i,(()=>n.removeEventListener(t,r)))}))};function O(e,n){return t(this,void 0,void 0,(function*(){if(403===e.status)throw n.session.code=null,I(n.sessionKey),new Error("[Blocto SDK]: Session expired!");return e.json()}))}const B=t=>/\S+@\S+\.\S+/.test(t);function U(){return t(this,void 0,void 0,(function*(){const{networks:t}=yield fetch("https://api.blocto.app/networks/evm").then((t=>t.json()));return t.reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.chain_id]:e})),{})}))}var C,k,N;function M(t){return t?"number"==typeof t?t:t.startsWith("0x")?parseInt(t,16):parseInt(t,10):1}class L extends S{constructor({chainId:t,rpc:e,server:n,appId:h,session:c}){super(c),C.add(this),this.supportNetwork={},this.switchableNetwork={},r(t,"'chainId' is required"),this.chainId=M(t),this.networkId=this.chainId,this.chain=s[this.chainId],this.net=o[this.chainId],r(this.chain,`unsupported 'chainId': ${this.chainId}`),this.rpc=e||i[this.chainId]||"",r(this.rpc,"'rpc' is required for Ethereum"),this.server=n||a[this.chainId]||"",this.appId=h||y,this.switchableNetwork[this.chainId]={name:this.chain,display_name:this.chain,network_type:this.net,wallet_web_url:this.server,rpc_url:this.rpc}}loadSwitchableNetwork(n){return t(this,void 0,void 0,(function*(){return U().then((t=>(this.supportNetwork=t,(null==n?void 0:n.length)&&n.forEach((({chainId:t,rpcUrls:n})=>{if(r(n,"rpcUrls is required for networksList"),!(null==n?void 0:n.length))throw new Error("Empty rpcUrls array");e(this,C,"m",k).call(this,{chainId:M(t),rpcUrls:n})})),null)))}))}send(e,n){return t(this,void 0,void 0,(function*(){switch(!0){case n instanceof Function:return this.sendAsync(e,n);case"string"==typeof e&&Array.isArray(n):return this.sendAsync({jsonrpc:"2.0",method:e,params:n});default:return this.sendAsync(e)}}))}sendAsync(e,n){return t(this,void 0,void 0,(function*(){const t=new Promise((t=>{if(Array.isArray(e)){const n=e.filter((t=>"eth_sendTransaction"===t.method)).map((t=>{var e;return null===(e=t.params)||void 0===e?void 0:e[0]})),r=Math.floor(1e4*Math.random()),i={method:"blocto_sendBatchTransaction",params:n},s=this.request(i),o=e.map((({method:t,params:e},n)=>"eth_sendTransaction"===t?s:this.request({id:r+n+1,jsonrpc:"2.0",method:t,params:e})));Promise.allSettled(o).then((n=>t(n.map(((t,n)=>({id:String(r+n+1),jsonrpc:"2.0",method:e[n].method,result:"fulfilled"===t.status?t.value:void 0,error:"fulfilled"!==t.status?t.reason:void 0}))))))}else this.request(Object.assign(Object.assign({},e),{id:Number(e.id)})).then(t)}));if(!n)return t;t.then((t=>n(null,t))).catch((t=>n(t)))}))}request(n){var i,s,o,a,h,c,u;return t(this,void 0,void 0,(function*(){const t=window.ethereum;if(t&&t.isBlocto)return t.request(n);if(!this.session.connected){const t=null===(i=null==n?void 0:n.params)||void 0===i?void 0:i[0];"eth_requestAccounts"===n.method&&B(t)?yield this.enable(t):yield this.enable()}try{let t=null,i=null;switch(n.method){case"eth_requestAccounts":yield this.fetchAccounts();case"eth_accounts":i=this.session.accounts[this.chain];break;case"eth_coinbase":i=this.session.accounts[this.chain][0];break;case"eth_chainId":i=this.chainId,i=`0x${i.toString(16)}`;break;case"net_version":i=this.networkId||this.chainId,i=`0x${i.toString(16)}`;break;case"eth_signTypedData_v3":case"eth_signTypedData":case"eth_signTypedData_v4":case"personal_sign":case"eth_sign":i=yield this.handleSign(n);break;case"wallet_disconnect":this.handleDisconnect(),i=null;break;case"blocto_sendBatchTransaction":case"eth_sendTransaction":i=yield this.handleSendTransaction(n);break;case"eth_signTransaction":case"eth_sendRawTransaction":i=null;break;case"wallet_addEthereumChain":if(!(null===(o=null===(s=null==n?void 0:n.params)||void 0===s?void 0:s[0])||void 0===o?void 0:o.chainId)||!(null===(h=null===(a=null==n?void 0:n.params)||void 0===a?void 0:a[0])||void 0===h?void 0:h.rpcUrls.length))throw new Error("Invalid params");yield U().then((t=>{var r,i,s;this.supportNetwork=t,e(this,C,"m",k).call(this,{chainId:M(null===(i=null===(r=null==n?void 0:n.params)||void 0===r?void 0:r[0])||void 0===i?void 0:i.chainId),rpcUrls:null===(s=null==n?void 0:n.params)||void 0===s?void 0:s[0].rpcUrls})})),i=null;break;case"wallet_switchEthereumChain":if(!(null===(u=null===(c=null==n?void 0:n.params)||void 0===c?void 0:c[0])||void 0===u?void 0:u.chainId))throw new Error("Invalid params");if(!this.switchableNetwork[M(n.params[0].chainId)]){const t=new Error("This chain has not been added to SDK. Please try wallet_addEthereumChain first.");throw t.code=4902,t}this.chainId=M(n.params[0].chainId),this.networkId=this.chainId,this.chain=this.switchableNetwork[this.chainId].name,this.net=this.switchableNetwork[this.chainId].network_type,r(this.chain,`unsupported 'chainId': ${this.chainId}`),this.rpc=this.switchableNetwork[this.chainId].rpc_url,r(this.rpc,"'rpc' is required"),this.server=this.switchableNetwork[this.chainId].wallet_web_url,yield this.fetchAccounts(),this.eventListeners.chainChanged.forEach((t=>t(this.chainId))),i=null;break;default:t=yield this.handleReadRequests(n)}if(t&&!t.result&&t.error){const e=t.error.message?t.error.message:"Request failed";throw new Error(e)}return t?t.result:i}catch(t){throw console.error(t),t}}))}enable(e){return t(this,void 0,void 0,(function*(){const t=window.ethereum;if(t&&t.isBlocto){if(parseInt(t.chainId,16)!==this.chainId)try{yield t.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${this.chainId.toString(16)}`}]}),this.session.accounts[this.chain]=[t.address]}catch(t){console.error(t)}return new Promise(((e,n)=>setTimeout((()=>t.enable().then(e).catch(n)),10)))}return this.tryRetrieveSessionFromStorage(this.chain),new Promise(((t,n)=>{if("undefined"==typeof window)return n("Currently only supported in browser");if(this.session.connected)return t(this.session.accounts[this.chain]);const r=new URLSearchParams;r.set("l6n",window.location.origin);const i=e&&B(e)?`/${e}`:"",s=T(`${this.server}/${this.appId}/${this.chain}/authn${i}?${r.toString()}`);_(s),P("message",((e,r)=>{const i=e;if(i.origin===this.server){if("ETH:FRAME:RESPONSE"===i.data.type){r(),R(s),this.session.code=i.data.code,this.session.connected=!0,this.eventListeners.connect.forEach((t=>t(this.chainId)));const e=i.data.address;this.formatAndSetSessionAccount(e),A(this.sessionKey,{code:this.session.code,address:e},w),t(this.session.accounts[this.chain])}"ETH:FRAME:CLOSE"===i.data.type&&(r(),R(s),n(new Error("User declined the login request")))}}))}))}))}fetchAccounts(){return t(this,void 0,void 0,(function*(){e(this,C,"m",N).call(this);const{accounts:t}=yield fetch(`${this.server}/api/${this.chain}/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code}}).then((t=>O(t,this)));return this.session.accounts[this.chain]=t,t}))}handleReadRequests(n){return t(this,void 0,void 0,(function*(){return e(this,C,"m",N).call(this),fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},n))}).then((t=>t.json()))}))}handleSign({method:n,params:r}){return t(this,void 0,void 0,(function*(){let t="";if(Array.isArray(r))if("eth_sign"===n)t=r[1].slice(2);else if("personal_sign"===n)t=r[0].slice(2);else if(["eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4"].includes(n)){t=r[1];const{domain:e}=JSON.parse(t);if(M(e.chainId)!==M(this.chainId))throw new Error(`Provided chainId "${e.chainId}" must match the active chainId "${this.chainId}"`)}e(this,C,"m",N).call(this);const{signatureId:i}=yield fetch(`${this.server}/api/${this.chain}/user-signature`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify({method:n,message:t})}).then((t=>O(t,this)));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const s=T(`${this.server}/${this.appId}/${this.chain}/user-signature/${i}`);return _(s),new Promise(((t,e)=>P("message",((n,r)=>{const i=n;i.origin===this.server&&"ETH:FRAME:RESPONSE"===i.data.type&&("APPROVED"===i.data.status&&(r(),R(s),t(i.data.signature)),"DECLINED"===i.data.status&&(r(),R(s),e(new Error(i.data.errorMessage))))}))))}))}handleSendTransaction(n){return t(this,void 0,void 0,(function*(){e(this,C,"m",N).call(this);const{authorizationId:t}=yield fetch(`${this.server}/api/${this.chain}/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(n.params)}).then((t=>O(t,this)));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const r=T(`${this.server}/${this.appId}/${this.chain}/authz/${t}`);return _(r),new Promise(((t,e)=>P("message",((n,i)=>{const s=n;s.origin===this.server&&"ETH:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(i(),R(r),t(s.data.txHash)),"DECLINED"===s.data.status&&(i(),R(r),e(new Error(s.data.errorMessage))))}))))}))}handleDisconnect(){return t(this,void 0,void 0,(function*(){this.session.connected=!1,this.session.code=null,this.session.accounts={},I(v)}))}}C=new WeakSet,k=function({chainId:t,rpcUrls:e}){const n=new URL(e[0]).hostname,{chain_id:r,name:i,display_name:s,network_type:o,blocto_service_environment:a,rpc_endpoint_domains:c}=this.supportNetwork[t];if(c.includes(n)){const t=h[a];this.switchableNetwork[r]={name:i,display_name:s,network_type:o,wallet_web_url:t,rpc_url:e[0]}}else console.warn(`The rpc url ${e[0]} is not supported.`)},N=function(){const t=window.ethereum;if(t&&t.isBlocto&&parseInt(t.chainId,16)!==this.chainId)throw new Error("Blocto SDK network mismatched")};var D=[],x=[],$="undefined"!=typeof Uint8Array?Uint8Array:Array,j=!1;function Y(){j=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;e<64;++e)D[e]=t[e],x[t.charCodeAt(e)]=e;x["-".charCodeAt(0)]=62,x["_".charCodeAt(0)]=63}function q(t,e,n){for(var r,i,s=[],o=e;o<n;o+=3)r=(t[o]<<16)+(t[o+1]<<8)+t[o+2],s.push(D[(i=r)>>18&63]+D[i>>12&63]+D[i>>6&63]+D[63&i]);return s.join("")}function K(t){var e;j||Y();for(var n=t.length,r=n%3,i="",s=[],o=16383,a=0,h=n-r;a<h;a+=o)s.push(q(t,a,a+o>h?h:a+o));return 1===r?(e=t[n-1],i+=D[e>>2],i+=D[e<<4&63],i+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],i+=D[e>>10],i+=D[e>>4&63],i+=D[e<<2&63],i+="="),s.push(i),s.join("")}function F(t,e,n,r,i){var s,o,a=8*i-r-1,h=(1<<a)-1,c=h>>1,u=-7,l=n?i-1:0,d=n?-1:1,f=t[e+l];for(l+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+t[e+l],l+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+t[e+l],l+=d,u-=8);if(0===s)s=1-c;else{if(s===h)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=c}return(f?-1:1)*o*Math.pow(2,s-r)}function z(t,e,n,r,i,s){var o,a,h,c=8*s-i-1,u=(1<<c)-1,l=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+l>=1?d/h:d*Math.pow(2,1-l))*h>=2&&(o++,h/=2),o+l>=u?(a=0,o=u):o+l>=1?(a=(e*h-1)*Math.pow(2,i),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;t[n+f]=255&o,f+=p,o/=256,c-=8);t[n+f-p]|=128*g}var J={}.toString,W=Array.isArray||function(t){return"[object Array]"==J.call(t)};function V(){return Z.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function H(t,e){if(V()<e)throw new RangeError("Invalid typed array length");return Z.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Z.prototype:(null===t&&(t=new Z(e)),t.length=e),t}function Z(t,e,n){if(!(Z.TYPED_ARRAY_SUPPORT||this instanceof Z))return new Z(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return X(this,t)}return G(this,t,e,n)}function G(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),Z.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Z.prototype:t=tt(t,e),t}(t,e,n,r):"string"==typeof e?function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!Z.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|rt(e,n),i=(t=H(t,r)).write(e,n);return i!==r&&(t=t.slice(0,i)),t}(t,e,n):function(t,e){if(nt(e)){var n=0|et(e.length);return 0===(t=H(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?H(t,0):tt(t,e);if("Buffer"===e.type&&W(e.data))return tt(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function Q(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function X(t,e){if(Q(e),t=H(t,e<0?0:0|et(e)),!Z.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function tt(t,e){var n=e.length<0?0:0|et(e.length);t=H(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function et(t){if(t>=V())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+V().toString(16)+" bytes");return 0|t}function nt(t){return!(null==t||!t._isBuffer)}function rt(t,e){if(nt(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Bt(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Ut(t).length;default:if(r)return Bt(t).length;e=(""+e).toLowerCase(),r=!0}}function it(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return mt(this,e,n);case"utf8":case"utf-8":return gt(this,e,n);case"ascii":return yt(this,e,n);case"latin1":case"binary":return vt(this,e,n);case"base64":return pt(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function st(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ot(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=Z.from(e,r)),nt(e))return 0===e.length?-1:at(t,e,n,r,i);if("number"==typeof e)return e&=255,Z.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):at(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function at(t,e,n,r,i){var s,o=1,a=t.length,h=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,h/=2,n/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var u=-1;for(s=n;s<a;s++)if(c(t,s)===c(e,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===h)return u*o}else-1!==u&&(s-=s-u),u=-1}else for(n+h>a&&(n=a-h),s=n;s>=0;s--){for(var l=!0,d=0;d<h;d++)if(c(t,s+d)!==c(e,d)){l=!1;break}if(l)return s}return-1}function ht(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[n+o]=a}return o}function ct(t,e,n,r){return Ct(Bt(e,t.length-n),t,n,r)}function ut(t,e,n,r){return Ct(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function lt(t,e,n,r){return ut(t,e,n,r)}function dt(t,e,n,r){return Ct(Ut(e),t,n,r)}function ft(t,e,n,r){return Ct(function(t,e){for(var n,r,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=(n=t.charCodeAt(o))>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function pt(t,e,n){return 0===e&&n===t.length?K(t):K(t.slice(e,n))}function gt(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var s,o,a,h,c=t[i],u=null,l=c>239?4:c>223?3:c>191?2:1;if(i+l<=n)switch(l){case 1:c<128&&(u=c);break;case 2:128==(192&(s=t[i+1]))&&(h=(31&c)<<6|63&s)>127&&(u=h);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(h=(15&c)<<12|(63&s)<<6|63&o)>2047&&(h<55296||h>57343)&&(u=h);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(h=(15&c)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&h<1114112&&(u=h)}null===u?(u=65533,l=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=l}return function(t){var e=t.length;if(e<=wt)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=wt));return n}(r)}Z.TYPED_ARRAY_SUPPORT=void 0===n.g.TYPED_ARRAY_SUPPORT||n.g.TYPED_ARRAY_SUPPORT,V(),Z.poolSize=8192,Z._augment=function(t){return t.__proto__=Z.prototype,t},Z.from=function(t,e,n){return G(null,t,e,n)},Z.TYPED_ARRAY_SUPPORT&&(Z.prototype.__proto__=Uint8Array.prototype,Z.__proto__=Uint8Array),Z.alloc=function(t,e,n){return function(t,e,n,r){return Q(e),e<=0?H(t,e):void 0!==n?"string"==typeof r?H(t,e).fill(n,r):H(t,e).fill(n):H(t,e)}(null,t,e,n)},Z.allocUnsafe=function(t){return X(null,t)},Z.allocUnsafeSlow=function(t){return X(null,t)},Z.isBuffer=function(t){return null!=t&&(!!t._isBuffer||kt(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&kt(t.slice(0,0))}(t))},Z.compare=function(t,e){if(!nt(t)||!nt(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},Z.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Z.concat=function(t,e){if(!W(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Z.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=Z.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var s=t[n];if(!nt(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},Z.byteLength=rt,Z.prototype._isBuffer=!0,Z.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)st(this,e,e+1);return this},Z.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)st(this,e,e+3),st(this,e+1,e+2);return this},Z.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)st(this,e,e+7),st(this,e+1,e+6),st(this,e+2,e+5),st(this,e+3,e+4);return this},Z.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?gt(this,0,t):it.apply(this,arguments)},Z.prototype.equals=function(t){if(!nt(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Z.compare(this,t)},Z.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},Z.prototype.compare=function(t,e,n,r,i){if(!nt(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(e>>>=0),a=Math.min(s,o),h=this.slice(r,i),c=t.slice(e,n),u=0;u<a;++u)if(h[u]!==c[u]){s=h[u],o=c[u];break}return s<o?-1:o<s?1:0},Z.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},Z.prototype.indexOf=function(t,e,n){return ot(this,t,e,n,!0)},Z.prototype.lastIndexOf=function(t,e,n){return ot(this,t,e,n,!1)},Z.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return ht(this,t,e,n);case"utf8":case"utf-8":return ct(this,t,e,n);case"ascii":return ut(this,t,e,n);case"latin1":case"binary":return lt(this,t,e,n);case"base64":return dt(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ft(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},Z.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var wt=4096;function yt(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function vt(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function mt(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=e;s<n;++s)i+=Ot(t[s]);return i}function bt(t,e,n){for(var r=t.slice(e,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function Et(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function At(t,e,n,r,i,s){if(!nt(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function It(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-n,2);i<s;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function St(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-n,4);i<s;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function Tt(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function _t(t,e,n,r,i){return i||Tt(t,0,n,4),z(t,e,n,r,23,4),n+4}function Rt(t,e,n,r,i){return i||Tt(t,0,n,8),z(t,e,n,r,52,8),n+8}Z.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),Z.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=Z.prototype;else{var i=e-t;n=new Z(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+t]}return n},Z.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||Et(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r},Z.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||Et(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},Z.prototype.readUInt8=function(t,e){return e||Et(t,1,this.length),this[t]},Z.prototype.readUInt16LE=function(t,e){return e||Et(t,2,this.length),this[t]|this[t+1]<<8},Z.prototype.readUInt16BE=function(t,e){return e||Et(t,2,this.length),this[t]<<8|this[t+1]},Z.prototype.readUInt32LE=function(t,e){return e||Et(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Z.prototype.readUInt32BE=function(t,e){return e||Et(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Z.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||Et(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},Z.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||Et(t,e,this.length);for(var r=e,i=1,s=this[t+--r];r>0&&(i*=256);)s+=this[t+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},Z.prototype.readInt8=function(t,e){return e||Et(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Z.prototype.readInt16LE=function(t,e){e||Et(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},Z.prototype.readInt16BE=function(t,e){e||Et(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},Z.prototype.readInt32LE=function(t,e){return e||Et(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Z.prototype.readInt32BE=function(t,e){return e||Et(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Z.prototype.readFloatLE=function(t,e){return e||Et(t,4,this.length),F(this,t,!0,23,4)},Z.prototype.readFloatBE=function(t,e){return e||Et(t,4,this.length),F(this,t,!1,23,4)},Z.prototype.readDoubleLE=function(t,e){return e||Et(t,8,this.length),F(this,t,!0,52,8)},Z.prototype.readDoubleBE=function(t,e){return e||Et(t,8,this.length),F(this,t,!1,52,8)},Z.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||At(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},Z.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||At(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},Z.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,1,255,0),Z.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Z.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,2,65535,0),Z.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):It(this,t,e,!0),e+2},Z.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,2,65535,0),Z.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):It(this,t,e,!1),e+2},Z.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,4,4294967295,0),Z.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):St(this,t,e,!0),e+4},Z.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,4,4294967295,0),Z.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):St(this,t,e,!1),e+4},Z.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);At(this,t,e,n,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<n&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},Z.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);At(this,t,e,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},Z.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,1,127,-128),Z.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Z.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,2,32767,-32768),Z.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):It(this,t,e,!0),e+2},Z.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,2,32767,-32768),Z.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):It(this,t,e,!1),e+2},Z.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,4,2147483647,-2147483648),Z.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):St(this,t,e,!0),e+4},Z.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||At(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Z.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):St(this,t,e,!1),e+4},Z.prototype.writeFloatLE=function(t,e,n){return _t(this,t,e,!0,n)},Z.prototype.writeFloatBE=function(t,e,n){return _t(this,t,e,!1,n)},Z.prototype.writeDoubleLE=function(t,e,n){return Rt(this,t,e,!0,n)},Z.prototype.writeDoubleBE=function(t,e,n){return Rt(this,t,e,!1,n)},Z.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,s=r-n;if(this===t&&n<e&&e<r)for(i=s-1;i>=0;--i)t[i+e]=this[i+n];else if(s<1e3||!Z.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+s),e);return s},Z.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Z.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var s;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=e;s<n;++s)this[s]=t;else{var o=nt(t)?t:Bt(new Z(t,r).toString()),a=o.length;for(s=0;s<n-e;++s)this[s+e]=o[s%a]}return this};var Pt=/[^+\/0-9A-Za-z-_]/g;function Ot(t){return t<16?"0"+t.toString(16):t.toString(16)}function Bt(t,e){var n;e=e||1/0;for(var r=t.length,i=null,s=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function Ut(t){return function(t){var e,n,r,i,s,o;j||Y();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===t[a-2]?2:"="===t[a-1]?1:0,o=new $(3*a/4-s),r=s>0?a-4:a;var h=0;for(e=0,n=0;e<r;e+=4,n+=3)i=x[t.charCodeAt(e)]<<18|x[t.charCodeAt(e+1)]<<12|x[t.charCodeAt(e+2)]<<6|x[t.charCodeAt(e+3)],o[h++]=i>>16&255,o[h++]=i>>8&255,o[h++]=255&i;return 2===s?(i=x[t.charCodeAt(e)]<<2|x[t.charCodeAt(e+1)]>>4,o[h++]=255&i):1===s&&(i=x[t.charCodeAt(e)]<<10|x[t.charCodeAt(e+1)]<<4|x[t.charCodeAt(e+2)]>>2,o[h++]=i>>8&255,o[h++]=255&i),o}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Pt,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Ct(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function kt(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var Nt=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(function(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var r=0;r<t.length;r++){var i=t.charAt(r),s=i.charCodeAt(0);if(255!==e[s])throw new TypeError(i+" is ambiguous");e[s]=r}var o=t.length,a=t.charAt(0),h=Math.log(o)/Math.log(256),c=Math.log(256)/Math.log(o);function u(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;for(var n=0,r=0,i=0;t[n]===a;)r++,n++;for(var s=(t.length-n)*h+1>>>0,c=new Uint8Array(s);t[n];){var u=e[t.charCodeAt(n)];if(255===u)return;for(var l=0,d=s-1;(0!==u||l<i)&&-1!==d;d--,l++)u+=o*c[d]>>>0,c[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=l,n++}for(var f=s-i;f!==s&&0===c[f];)f++;for(var p=new Uint8Array(r+(s-f)),g=r;f!==s;)p[g++]=c[f++];return p}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";for(var n=0,r=0,i=0,s=e.length;i!==s&&0===e[i];)i++,n++;for(var h=(s-i)*c+1>>>0,u=new Uint8Array(h);i!==s;){for(var l=e[i],d=0,f=h-1;(0!==l||d<r)&&-1!==f;f--,d++)l+=256*u[f]>>>0,u[f]=l%o>>>0,l=l/o>>>0;if(0!==l)throw new Error("Non-zero carry");r=d,i++}for(var p=h-r;p!==h&&0===u[p];)p++;for(var g=a.repeat(n);p<h;++p)g+=t.charAt(u[p]);return g},decodeUnsafe:u,decode:function(t){var e=u(t);if(e)return e;throw new Error("Non-base"+o+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"));let Mt;try{Mt=n(98818)}catch(t){}class Lt extends S{constructor({net:t="mainnet-beta",server:e,appId:n,rpc:i,session:s}){if(super(s),r(t,"'net' is required"),r(u.includes(t),"unsupported net"),this.net=t,this.rpc=i||("mainnet-beta"===t?"https://free.rpcpool.com":`https://api.${t}.solana.com`),this.server=e||c[this.net]||"",this.appId=n||y,!Mt)throw new Error("No @solana/web3.js installed. Please install it to interact with Solana.")}request(e){return t(this,void 0,void 0,(function*(){this.session.connected||(yield this.connect());try{let t=null,n=null;switch(e.method){case"connect":n=yield this.fetchAccounts();break;case"disconnect":this.disconnect();break;case"getAccounts":n=this.session.accounts.solana.length?this.session.accounts.solana:yield this.fetchAccounts();break;case"getAccountInfo":{const t=yield this.handleReadRequests(e),[r,i]=t.result.value.data;n=Object.assign(Object.assign({},t.result.value),{data:Z.from(r,i),owner:new Mt.PublicKey(t.result.value.owner)});break}case"convertToProgramWalletTransaction":n=yield this.handleConvertTransaction(e);break;case"signAndSendTransaction":n=yield this.handleSignAndSendTransaction(e);break;case"signTransaction":case"signAllTransactions":throw new Error(`Blocto is program wallet, which doesn't support ${e.method}. Use signAndSendTransaction instead.`);default:t=yield this.handleReadRequests(e)}if(t&&!t.result&&t.error){const e=t.error.message?t.error.message:"Request failed";throw new Error(e)}return t?t.result:n}catch(t){throw console.error(t),t}}))}connect(){return t(this,void 0,void 0,(function*(){const t=window.solana;return t&&t.isBlocto?new Promise((e=>{t.on("connect",(()=>{this.session.accounts.solana=[t.publicKey.toBase58()],e()})),t.connect()})):(this.tryRetrieveSessionFromStorage("solana"),new Promise(((t,e)=>{if("undefined"==typeof window)return e("Currently only supported in browser");if(this.session.connected)return t();const n=encodeURIComponent(window.location.origin),r=T(`${this.server}/${this.appId}/solana/authn?l6n=${n}`);_(r),P("message",((n,i)=>{const s=n;if(s.origin===this.server){if("SOL:FRAME:RESPONSE"===s.data.type){i(),R(r),this.session.code=s.data.code,this.session.connected=!0,this.eventListeners.connect.forEach((t=>t(this.net)));const e=s.data.address;this.formatAndSetSessionAccount(e),A(this.sessionKey,{code:this.session.code,address:e},w),t()}"SOL:FRAME:CLOSE"===s.data.type&&(i(),R(r),e(new Error("User declined the login request")))}}))})))}))}disconnect(){return t(this,void 0,void 0,(function*(){const t=window.solana;t&&t.isBlocto?yield t.disconnect():(this.session.code=null,this.session.accounts={},this.eventListeners.disconnect.forEach((t=>t(null))),this.session.connected=!1)}))}fetchAccounts(){return t(this,void 0,void 0,(function*(){const{accounts:t}=yield fetch(`${this.server}/api/solana/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code}}).then((t=>t.json()));return this.session.accounts.solana=t,t}))}handleReadRequests(e){return t(this,void 0,void 0,(function*(){return fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))}).then((t=>t.json()))}))}convertToProgramWalletTransaction(e){return t(this,void 0,void 0,(function*(){const t=window.solana;if(t&&t.isBlocto)return t.convertToProgramWalletTransaction(e);const n=yield this.request({method:"convertToProgramWalletTransaction",params:{message:e.serializeMessage().toString("hex")}});return this.toTransaction(n,[])}))}signAndSendTransaction(e,n){return t(this,void 0,void 0,(function*(){const t=window.solana;if(t&&t.isBlocto)return t.signAndSendTransaction(e);const r={};if(n){n.commitment&&(r.commitment=n.commitment);const t=n?n._rpcEndpoint:null;t&&t!==this.rpc&&(this.rpc=t,this.disconnect(),yield this.connect())}return this.request({method:"signAndSendTransaction",params:Object.assign({signatures:yield this.collectSignatures(e),message:e.serializeMessage().toString("hex")},r)})}))}toTransaction(e,n){return t(this,void 0,void 0,(function*(){const t=Mt.Message.from(Z.from(e,"hex")),r=new Mt.Transaction;return r.recentBlockhash=t.recentBlockhash,t.header.numRequiredSignatures>0&&(r.feePayer=t.accountKeys[0]),n.forEach(((e,n)=>{const i={signature:e===Mt.PublicKey.default.toBase58()?null:Nt.decode(e),publicKey:t.accountKeys[n]};r.signatures.push(i)})),t.instructions.forEach((e=>{const n=e.accounts.map((e=>({pubkey:t.accountKeys[e],isSigner:e<t.header.numRequiredSignatures,isWritable:t.isAccountWritable(e)})));r.instructions.push(new Mt.TransactionInstruction({keys:n,programId:t.accountKeys[e.programIdIndex],data:Nt.decode(e.data)}))})),r}))}collectSignatures(e){return t(this,void 0,void 0,(function*(){return e.signatures.reduce(((t,e)=>(e.signature&&(t[e.publicKey.toBase58()]=e.signature.toString("hex")),t)),{})}))}handleConvertTransaction(e){return t(this,void 0,void 0,(function*(){return fetch(`${this.server}/api/solana/convertToWalletTx`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(e.params)}).then((t=>O(t,this)))}))}handleSignAndSendTransaction(e){return t(this,void 0,void 0,(function*(){const{authorizationId:t}=yield fetch(`${this.server}/api/solana/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(e.params)}).then((t=>O(t,this)));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const n=T(`${this.server}/${this.appId}/solana/authz/${t}`);return _(n),new Promise(((t,e)=>P("message",((r,i)=>{const s=r;s.origin===this.server&&"SOL:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(i(),R(n),t(s.data.txHash)),"DECLINED"===s.data.status&&(i(),R(n),e(new Error(s.data.errorMessage))))}))))}))}}class Dt extends S{constructor({chainId:t,server:e,appId:n,session:i}){super(i),this.publicKey=[],this.authKey="",r(t,"'chainId' is required"),r(n,"It is necessary to interact with Blocto wallet via your app id. Please visit https://developers.blocto.app for more details."),this.chainId=t,this.networkName=f[t],this.api=p[t];const s=l[t];this.appId=n||y,this.server=e||s||""}get publicAccount(){return{address:this.session.accounts.aptos[0]||null,publicKey:this.publicKey.length?this.publicKey:null,authKey:null,minKeysRequired:2}}network(){return t(this,void 0,void 0,(function*(){return{name:this.networkName,api:this.api,chainId:this.chainId.toString()}}))}isConnected(){return t(this,void 0,void 0,(function*(){return this.session.connected}))}signTransaction(e){return t(this,void 0,void 0,(function*(){const t=window.bloctoAptos;if(t)return t.signTransaction(e);if((yield this.isConnected())||(yield this.connect()),!this.session.accounts.aptos.length)throw new Error("Fail to get account");throw new Error("signTransaction method not supported.")}))}disconnect(){return t(this,void 0,void 0,(function*(){const t=window.bloctoAptos;t?yield t.disconnect():(this.session.code=null,this.session.accounts={},this.session.connected=!1)}))}signAndSubmitTransaction(e,n={}){return t(this,void 0,void 0,(function*(){const t=window.bloctoAptos;if(t)return t.signAndSubmitTransaction(e,n);if((yield this.isConnected())||(yield this.connect()),!this.session.accounts.aptos.length)throw new Error("Fail to get account");const{authorizationId:r}=yield fetch(`${this.server}/api/aptos/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(Object.assign(Object.assign({},e),n))}).then((t=>O(t,this)));if("undefined"==typeof window)throw new Error("Currently only supported in browser");const i=T(`${this.server}/${this.appId}/aptos/authz/${r}`);return _(i),new Promise(((t,e)=>P("message",((n,r)=>{const s=n;s.origin===this.server&&"APTOS:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(r(),R(i),t({hash:s.data.txHash})),"DECLINED"===s.data.status&&(r(),R(i),e(new Error(s.data.errorMessage))))}))))}))}signMessage(e){return t(this,void 0,void 0,(function*(){const t=window.bloctoAptos,n=(t=>{var e,n;const r=Object.assign({},t),{message:i,nonce:s,address:o,application:a,chainId:h}=t;return"string"!=typeof i&&(r.message=null!==(e=String(i))&&void 0!==e?e:""),"string"!=typeof s&&(r.nonce=null!==(n=String(s))&&void 0!==n?n:""),o&&"boolean"!=typeof o&&(r.address=!!o),a&&"boolean"!=typeof a&&(r.application=!!a),h&&"boolean"!=typeof h&&(r.chainId=!!h),r})(e);if(t)return t.signMessage(n);if((yield this.isConnected())||(yield this.connect()),!this.session.accounts.aptos.length)throw new Error("Fail to get account");if("undefined"==typeof window)throw new Error("Currently only supported in browser");const{signatureId:r}=yield fetch(`${this.server}/api/aptos/user-signature`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code},body:JSON.stringify(n)}).then((t=>O(t,this))),i=T(`${this.server}/${this.appId}/aptos/user-signature/${r}`);return _(i),new Promise(((t,e)=>P("message",((n,r)=>{const s=n;s.origin===this.server&&"APTOS:FRAME:RESPONSE"===s.data.type&&("APPROVED"===s.data.status&&(r(),R(i),t(s.data)),"DECLINED"===s.data.status&&(r(),R(i),e(new Error(s.data.errorMessage))))}))))}))}connect(){return t(this,void 0,void 0,(function*(){const e=window.bloctoAptos;return new Promise(e?(t,n)=>setTimeout((()=>e.connect().then(t).catch(n)),10):(e,n)=>{if("undefined"==typeof window)return n("Currently only supported in browser");if(this.session.connected&&this.session.accounts.aptos.length)return e({address:this.session.accounts.aptos[0],publicKey:this.publicKey,authKey:null,minKeysRequired:2});const r=encodeURIComponent(window.location.origin),i=T(`${this.server}/${this.appId}/aptos/authn?l6n=${r}`);_(i),P("message",((r,s)=>t(this,void 0,void 0,(function*(){const t=r;if(t.origin===this.server){if("APTOS:FRAME:RESPONSE"===t.data.type){s(),R(i),this.session.code=t.data.code,this.session.connected=!0;const r=t.data.address;if(this.formatAndSetSessionAccount(r),A(this.sessionKey,{code:this.session.code,address:r},w),!this.session.accounts.aptos.length)return n();try{const{public_keys:t}=yield fetch(`${this.server}/blocto/aptos/accounts/${this.session.accounts.aptos[0]}`).then((t=>t.json()));this.publicKey=t||[],e({address:this.session.accounts.aptos[0]||"",publicKey:this.publicKey,authKey:null,minKeysRequired:2})}catch(e){return n(t)}}"APTOS:FRAME:CLOSE"===t.data.type&&(s(),R(i),n(new Error("User declined the login request")))}}))))})}))}fetchAddress(){return t(this,void 0,void 0,(function*(){const{accounts:t}=yield fetch(`${this.server}/api/aptos/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":this.session.code}}).then((t=>O(t,this)));return this.session.accounts.aptos=t||[],this.session.accounts.aptos[0]}))}}const xt={connected:!1,code:null,accounts:{}};return class{constructor({appId:t,ethereum:e,solana:n,aptos:r}){e&&(this.ethereum=new L(Object.assign(Object.assign({},e),{appId:t,session:xt}))),n&&(this.solana=new Lt(Object.assign(Object.assign({},n),{appId:t,session:xt}))),r&&(this.aptos=new Dt(Object.assign(Object.assign({},r),{appId:t,session:xt})))}}}()}}]);